{
  "writeup_id": "Htb_Aragog",
  "scenario_fingerprint": {
    "scenario_name": "linux_web_xxe_credential_capture",
    "primary_services": [
      "http",
      "ftp",
      "ssh"
    ],
    "port_signature": "21+22+80",
    "service_combination": "ftp+ssh+http",
    "os_family": "linux",
    "environment_type": "web_application",
    "entry_vector": "xxe_injection",
    "privilege_path": "xxe_to_credential_capture",
    "attack_complexity": "medium",
    "estimated_time": "60-90 minutes",
    "scenario_confidence": 0.92,
    "distinguishing_factors": [
      "anonymous_ftp_with_xml_sample",
      "xml_processing_endpoint",
      "post_based_xml_submission",
      "subnet_calculation_functionality"
    ],
    "environmental_clues": [
      "apache_ubuntu_default_page",
      "xml_file_in_ftp_root",
      "custom_php_xml_processor",
      "limited_directory_structure"
    ],
    "similar_scenarios": [
      "xxe_web_applications",
      "file_disclosure_via_xml"
    ],
    "unique_aspects": [
      "subnet_mask_calculation_feature",
      "ftp_provides_xml_template",
      "website_modification_for_credential_capture"
    ]
  },
  "success_patterns": {
    "success_factors": [
      {
        "technique": "XXE_file_disclosure",
        "success_reason": "XML parser processes external entities without restrictions",
        "prerequisite_indicators": [
          "xml_input_accepted",
          "xml_parser_processes_entities",
          "no_entity_restrictions",
          "file_system_accessible"
        ],
        "recognition_patterns": [
          "XML input fields or endpoints",
          "XML content-type accepted",
          "Server processes and reflects XML data",
          "Error messages reveal XML parsing"
        ],
        "failure_modes": [
          "external_entities_disabled",
          "xml_parser_hardened",
          "input_validation_blocks_entities",
          "sandboxed_execution_environment"
        ],
        "environmental_factors": [
          "default_xml_parser_config",
          "legacy_application_framework",
          "insufficient_input_validation",
          "direct_xml_processing"
        ],
        "success_probability": 0.75,
        "typical_timeframe": "10-30 minutes"
      },
      {
        "technique": "anonymous_ftp_access",
        "success_reason": "FTP server allows anonymous login with readable files",
        "prerequisite_indicators": [
          "ftp_service_running",
          "anonymous_login_enabled",
          "readable_files_present"
        ],
        "recognition_patterns": [
          "nmap shows ftp-anon allowed",
          "230 Login successful with anonymous",
          "Directory listings accessible",
          "Files downloadable"
        ],
        "failure_modes": [
          "anonymous_access_disabled",
          "no_useful_files_accessible",
          "ftp_service_not_running"
        ],
        "environmental_factors": [
          "default_vsftpd_configuration",
          "development_environment_settings",
          "insufficient_access_controls"
        ],
        "success_probability": 0.9,
        "typical_timeframe": "2-5 minutes"
      }
    ],
    "critical_discoveries": [
      {
        "discovery": "XML structure in test.txt",
        "discovery_method": "Anonymous FTP file download",
        "why_critical": "Revealed expected XML format for hosts.php endpoint",
        "how_to_recognize": [
          "XML file in anonymous FTP",
          "Matches web application input format",
          "Contains application-specific elements"
        ],
        "follow_up_actions": [
          "test_xml_endpoint_functionality",
          "craft_xxe_payload",
          "enumerate_file_system"
        ]
      },
      {
        "discovery": "hosts.php XML processing endpoint",
        "discovery_method": "Directory enumeration with gobuster",
        "why_critical": "Vulnerable XML parser enabling file disclosure",
        "how_to_recognize": [
          "Accepts POST requests with XML data",
          "Processes and reflects XML content",
          "No apparent input validation",
          "Calculates subnet hosts from XML input"
        ],
        "follow_up_actions": [
          "test_external_entity_injection",
          "read_sensitive_system_files",
          "enumerate_application_files"
        ]
      }
    ],
    "escalation_keys": [
      {
        "privilege_level": "anonymous_web_user",
        "escalation_method": "XXE_to_file_disclosure",
        "why_possible": "XML parser processes external entities without restrictions",
        "recognition_signs": [
          "xml_input_reflected_in_response",
          "external_entity_processing_enabled",
          "file_system_access_available",
          "no_entity_filtering"
        ],
        "exploitation_path": "Anonymous FTP → XML format discovery → XXE payload → System file access"
      }
    ]
  },
  "decision_tree": {
    "decision_points": [
      {
        "step": 1,
        "situation": "Found ports 21,22,80 open on Linux host with anonymous FTP",
        "decision": "Check FTP for reconnaissance files and examine web services",
        "reasoning": "Anonymous FTP often contains useful files, web services may have vulnerabilities",
        "confidence": 0.9,
        "alternatives": [
          {
            "option": "web_enumeration_only",
            "when": "if ftp contains no useful data"
          },
          {
            "option": "ssh_bruteforce",
            "when": "if other vectors fail"
          }
        ],
        "success_indicators": [
          "files_found_in_ftp",
          "web_directories_discovered",
          "xml_files_identified"
        ],
        "next_decision": "analyze_file_formats_and_web_functionality"
      },
      {
        "step": 2,
        "situation": "Found XML file in FTP and PHP endpoint that processes XML",
        "decision": "Test for XXE vulnerability with file disclosure",
        "reasoning": "XML processing endpoints are prime targets for XXE attacks",
        "confidence": 0.85,
        "prerequisites": [
          "xml_processing_endpoint_found",
          "sample_xml_format_available"
        ],
        "success_indicators": [
          "file_contents_disclosed",
          "system_files_readable"
        ],
        "failure_fallbacks": [
          "parameter_fuzzing",
          "directory_traversal",
          "sql_injection"
        ]
      },
      {
        "step": 3,
        "situation": "XXE vulnerability confirmed with file read capability",
        "decision": "Extract sensitive files prioritizing SSH keys and user enumeration",
        "reasoning": "SSH keys provide direct access, /etc/passwd reveals user accounts",
        "confidence": 0.95,
        "prerequisites": [
          "xxe_file_read_working"
        ],
        "success_indicators": [
          "ssh_keys_found",
          "user_accounts_enumerated"
        ],
        "failure_fallbacks": [
          "web_shell_upload",
          "credential_harvesting"
        ]
      }
    ],
    "branching_logic": {
      "if_xxe_succeeds": {
        "action": "systematically_extract_sensitive_files",
        "priority_targets": [
          "/etc/passwd",
          "/home/*/ssh/id_rsa",
          "/root/.ssh/id_rsa"
        ],
        "next_phase": "ssh_key_authentication"
      },
      "if_ssh_keys_found": {
        "action": "attempt_ssh_login_with_extracted_keys",
        "tools": [
          "ssh",
          "chmod"
        ],
        "next_phase": "privilege_escalation_enumeration"
      },
      "if_xxe_fails": {
        "action": "try_alternative_web_attacks",
        "alternatives": [
          "file_upload",
          "command_injection",
          "directory_traversal"
        ],
        "decision_criteria": "based_on_application_functionality"
      }
    },
    "optimization_rules": [
      {
        "rule": "always_test_xxe_when_xml_processing_found",
        "reasoning": "high_success_rate_and_immediate_file_access",
        "applicability": "xml_processing_endpoints"
      },
      {
        "rule": "prioritize_ssh_keys_over_password_files_in_xxe",
        "reasoning": "direct_access_without_cracking_required",
        "applicability": "file_disclosure_vulnerabilities"
      },
      {
        "rule": "check_ftp_anonymous_access_first_on_standard_ports",
        "reasoning": "quick_reconnaissance_with_potential_format_samples",
        "applicability": "ftp_service_detected"
      }
    ]
  },
  "applicability_rules": {
    "technique_rules": [
      {
        "technique": "XXE_Injection",
        "mitre_id": "T1190",
        "required_services": [
          "http",
          "https"
        ],
        "required_ports": [
          80,
          443,
          8080,
          8443
        ],
        "os_requirements": [
          "linux",
          "windows"
        ],
        "environmental_prerequisites": [
          "xml_processing_endpoint",
          "xml_parser_accepts_external_entities",
          "post_method_accepts_xml_data"
        ],
        "success_indicators": [
          "xml_content_type_accepted",
          "xml_parsing_errors_revealed",
          "file_disclosure_successful",
          "ssrf_response_received"
        ],
        "incompatible_with": [
          "xml_external_entities_disabled",
          "input_validation_strict",
          "xml_parser_hardened"
        ],
        "confidence_boosters": [
          "xml_sample_files_found",
          "xml_processing_functionality_visible",
          "error_messages_verbose",
          "legacy_xml_libraries"
        ],
        "typical_success_rate": 0.75,
        "estimated_time": "10-30 minutes"
      },
      {
        "technique": "Anonymous_FTP_Enumeration",
        "mitre_id": "T1083",
        "required_services": [
          "ftp"
        ],
        "required_ports": [
          21
        ],
        "os_requirements": [
          "linux",
          "windows"
        ],
        "environmental_prerequisites": [
          "ftp_service_running",
          "anonymous_login_enabled"
        ],
        "success_indicators": [
          "anonymous_login_successful",
          "directory_listing_accessible",
          "files_readable"
        ],
        "incompatible_with": [
          "anonymous_access_disabled",
          "ftp_authentication_required"
        ],
        "confidence_boosters": [
          "vsftpd_banner_detected",
          "ftp_anon_nmap_result_positive",
          "default_ftp_configuration"
        ],
        "typical_success_rate": 0.92,
        "estimated_time": "2-5 minutes"
      },
      {
        "technique": "Directory_Bruteforce",
        "mitre_id": "T1083",
        "required_services": [
          "http",
          "https"
        ],
        "required_ports": [
          80,
          443,
          8080,
          8443
        ],
        "os_requirements": [
          "linux",
          "windows"
        ],
        "environmental_prerequisites": [
          "web_server_running",
          "directory_indexing_disabled"
        ],
        "success_indicators": [
          "hidden_directories_found",
          "status_200_responses",
          "different_content_lengths"
        ],
        "incompatible_with": [
          "rate_limiting_aggressive",
          "waf_blocking_requests"
        ],
        "confidence_boosters": [
          "apache_server_detected",
          "default_web_root_structure",
          "php_extensions_present"
        ],
        "typical_success_rate": 0.68,
        "estimated_time": "5-20 minutes"
      }
    ],
    "environmental_detectors": {
      "web_application": {
        "port_indicators": [
          80,
          443,
          8080,
          8443
        ],
        "service_indicators": [
          "http",
          "https",
          "apache",
          "nginx"
        ],
        "banner_indicators": [
          "Apache",
          "nginx",
          "IIS"
        ],
        "confidence_threshold": 0.9
      },
      "ftp_service": {
        "port_indicators": [
          21
        ],
        "service_indicators": [
          "ftp",
          "vsftpd"
        ],
        "banner_indicators": [
          "vsftpd",
          "ProFTPD",
          "FileZilla"
        ],
        "confidence_threshold": 0.95
      },
      "xml_processing": {
        "port_indicators": [
          80,
          443
        ],
        "service_indicators": [
          "http",
          "https"
        ],
        "technology_indicators": [
          "xml",
          "soap",
          "api"
        ],
        "confidence_threshold": 0.8
      },
      "linux_system": {
        "port_indicators": [
          22
        ],
        "service_indicators": [
          "ssh",
          "openssh"
        ],
        "banner_indicators": [
          "Ubuntu",
          "OpenSSH"
        ],
        "confidence_threshold": 0.85
      }
    },
    "attack_prioritization": {
      "high_priority": [
        {
          "attack": "anonymous_ftp_enumeration",
          "when": "ftp_anonymous_access_detected",
          "reason": "immediate_information_disclosure_no_creds_needed"
        },
        {
          "attack": "xxe_injection",
          "when": "xml_processing_endpoint_found",
          "reason": "high_impact_file_disclosure_and_ssrf_potential"
        }
      ],
      "medium_priority": [
        {
          "attack": "directory_bruteforce",
          "when": "web_service_detected",
          "reason": "reliable_discovery_method_moderate_time_investment"
        }
      ],
      "low_priority": [
        {
          "attack": "ssh_bruteforce",
          "when": "ssh_service_detected",
          "reason": "time_intensive_low_success_without_user_enumeration"
        }
      ]
    }
  },
  "technique_intelligence": {
    "techniques": [
      {
        "name": "XML External Entity (XXE) Injection",
        "mitre_id": "T1203",
        "category": "initial_access",
        "phase": "exploitation",
        "tools_used": [
          {
            "name": "curl",
            "command_template": "curl -X POST -d @{xml_file} http://{target}/hosts.php",
            "actual_command": "curl -X POST -d @exploit.xml http://10.10.10.78/hosts.php",
            "output_pattern": "There are {number} possible hosts for {file_contents}",
            "effectiveness_rating": 5,
            "reliability": 0.95
          }
        ],
        "prerequisites": [
          "xml_input_accepted",
          "xml_parser_vulnerable",
          "file_system_access_possible"
        ],
        "success_indicators": [
          "file_contents_reflected_in_response",
          "system_information_disclosed",
          "sensitive_files_accessible"
        ],
        "common_failures": [
          "xml_parser_hardened",
          "external_entity_processing_disabled",
          "file_permissions_restrictive"
        ],
        "follow_up_techniques": [
          "ssh_key_extraction",
          "credential_harvesting",
          "system_enumeration"
        ],
        "time_investment": "10-30 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "SSH Key Extraction via XXE",
        "mitre_id": "T1552.004",
        "category": "credential_access",
        "phase": "credential_access",
        "tools_used": [
          {
            "name": "custom_bash_script",
            "command_template": "./xxe_get_file.sh {file_path}",
            "actual_command": "./xxe_get_file.sh /home/florian/.ssh/id_rsa",
            "output_pattern": "-----BEGIN RSA PRIVATE KEY-----",
            "effectiveness_rating": 5,
            "reliability": 0.9
          },
          {
            "name": "ssh",
            "command_template": "ssh -i {private_key} {user}@{target}",
            "actual_command": "ssh -i ~/id_florian-aragog florian@10.10.10.78",
            "success_factors": [
              "valid_private_key",
              "ssh_service_accessible"
            ],
            "effectiveness_rating": 5
          }
        ],
        "prerequisites": [
          "xxe_vulnerability_confirmed",
          "user_accounts_enumerated",
          "ssh_keys_exist"
        ],
        "success_indicators": [
          "private_key_extracted",
          "ssh_authentication_successful",
          "shell_access_obtained"
        ],
        "common_failures": [
          "no_ssh_keys_present",
          "encrypted_private_keys",
          "ssh_service_unavailable"
        ],
        "follow_up_techniques": [
          "privilege_escalation",
          "lateral_movement",
          "persistence_establishment"
        ],
        "time_investment": "5-15 minutes",
        "skill_level": "beginner"
      },
      {
        "name": "Anonymous FTP Enumeration",
        "mitre_id": "T1083",
        "category": "discovery",
        "phase": "reconnaissance",
        "tools_used": [
          {
            "name": "ftp",
            "command_template": "ftp {target}",
            "actual_command": "ftp 10.10.10.78",
            "output_pattern": "230 Login successful",
            "effectiveness_rating": 4,
            "reliability": 0.98
          }
        ],
        "prerequisites": [
          "ftp_service_accessible",
          "anonymous_login_enabled"
        ],
        "success_indicators": [
          "anonymous_login_successful",
          "files_discovered",
          "information_gathered"
        ],
        "common_failures": [
          "anonymous_access_disabled",
          "empty_directories",
          "permission_restrictions"
        ],
        "follow_up_techniques": [
          "file_analysis",
          "application_testing",
          "vulnerability_identification"
        ],
        "time_investment": "2-5 minutes",
        "skill_level": "beginner"
      }
    ],
    "tool_effectiveness": [
      {
        "tool": "gobuster",
        "use_case": "web_directory_enumeration",
        "effectiveness_rating": 4,
        "reliability": 0.85,
        "learning_curve": "low",
        "essential_for": [
          "web_application_testing"
        ],
        "alternatives": [
          "dirbuster",
          "ffuf",
          "wfuzz"
        ],
        "best_practices": [
          "use_multiple_wordlists",
          "include_common_extensions",
          "adjust_thread_count_for_stability"
        ]
      },
      {
        "tool": "nmap",
        "use_case": "port_scanning_and_service_enumeration",
        "effectiveness_rating": 5,
        "reliability": 0.98,
        "learning_curve": "medium",
        "essential_for": [
          "network_reconnaissance"
        ],
        "alternatives": [
          "masscan",
          "rustscan"
        ],
        "best_practices": [
          "start_with_tcp_scan",
          "follow_up_with_service_detection",
          "include_udp_scan_for_completeness"
        ]
      }
    ],
    "command_sequences": [
      {
        "sequence_name": "xxe_to_ssh_access",
        "steps": [
          {
            "step": 1,
            "command": "curl -X POST -d @test.xml http://10.10.10.78/hosts.php",
            "purpose": "Test XML processing functionality",
            "expected_output": "Subnet calculation response"
          },
          {
            "step": 2,
            "command": "curl -X POST -d @xxe_exploit.xml http://10.10.10.78/hosts.php",
            "purpose": "Extract /etc/passwd for user enumeration",
            "expected_output": "User account information"
          },
          {
            "step": 3,
            "command": "./xxe_get_file.sh /home/florian/.ssh/id_rsa",
            "purpose": "Extract SSH private key",
            "expected_output": "RSA private key content"
          },
          {
            "step": 4,
            "command": "ssh -i extracted_key florian@10.10.10.78",
            "purpose": "Authenticate with extracted key",
            "expected_output": "Shell access as florian user"
          }
        ],
        "success_rate": 0.92,
        "typical_duration": "15-25 minutes"
      },
      {
        "sequence_name": "initial_reconnaissance",
        "steps": [
          {
            "step": 1,
            "command": "nmap -sT -p- --min-rate 5000 --max-retries 1 10.10.10.78",
            "purpose": "Discover open TCP ports",
            "expected_output": "Ports 21, 22, 80 open"
          },
          {
            "step": 2,
            "command": "nmap -sV -sC -p 21,22,80 10.10.10.78",
            "purpose": "Service enumeration and script scanning",
            "expected_output": "Service versions and configurations"
          },
          {
            "step": 3,
            "command": "ftp 10.10.10.78",
            "purpose": "Test anonymous FTP access",
            "expected_output": "Anonymous login successful"
          },
          {
            "step": 4,
            "command": "gobuster -u http://10.10.10.78 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php,html,txt",
            "purpose": "Discover web directories and files",
            "expected_output": "hosts.php discovered"
          }
        ],
        "success_rate": 0.95,
        "typical_duration": "10-20 minutes"
      }
    ]
  },
  "metadata": {
    "basic_metadata": {
      "name": "Aragog",
      "difficulty": "Medium",
      "os": "Linux",
      "platform": "HackTheBox",
      "release_date": "2018-02-10",
      "author": "egre55",
      "estimated_time": "2-3 hours"
    },
    "intelligence_metadata": {
      "attack_complexity": "medium",
      "skill_level_required": "intermediate",
      "primary_attack_vectors": [
        "xxe",
        "web_application",
        "credential_harvesting"
      ],
      "key_vulnerabilities": [
        "xml_external_entity",
        "website_modification",
        "ftp_anonymous_access"
      ],
      "environment_type": "linux_web_server",
      "real_world_relevance": "high",
      "learning_value": [
        "xxe_exploitation",
        "web_app_modification",
        "credential_capture"
      ],
      "prerequisite_knowledge": [
        "xml_fundamentals",
        "web_application_security",
        "linux_basics"
      ]
    },
    "categorization": {
      "primary_category": "web_application",
      "subcategories": [
        "xxe_attacks",
        "credential_harvesting",
        "web_exploitation"
      ],
      "attack_types": [
        "initial_access",
        "credential_access",
        "persistence"
      ],
      "defensive_lessons": [
        "disable_xml_external_entities",
        "secure_ftp_configuration",
        "web_app_integrity_monitoring"
      ]
    },
    "similarity_markers": {
      "similar_boxes": [
        "Bounty",
        "Nineveh",
        "Valentine"
      ],
      "similarity_reasons": [
        "web_exploitation",
        "xxe_vulnerabilities",
        "multi_stage_attacks"
      ],
      "unique_aspects": [
        "website_modification_for_creds",
        "ftp_anonymous_access",
        "xml_parsing_exploitation"
      ],
      "difficulty_factors": [
        "xxe_understanding_required",
        "creative_credential_capture",
        "web_app_modification"
      ]
    }
  },
  "extraction_metadata": {
    "parse_date": "2025-07-04T13:58:45.155594",
    "original_file": "0xdf_writeups/Htb Aragog.md",
    "content_length": 26482,
    "extraction_version": "2.0-claude",
    "model_used": "claude-sonnet-4-20250514"
  },
  "intelligence_confidence": 0.9166666666666667,
  "quality_breakdown": {
    "scenario_uniqueness": 1.0,
    "success_logic_clarity": 0.6666666666666666,
    "applicability_completeness": 1.0,
    "decision_tree_depth": 1.0,
    "technique_actionability": 1.0
  }
}