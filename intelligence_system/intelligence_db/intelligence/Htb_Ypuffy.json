{
  "writeup_id": "Htb_Ypuffy",
  "scenario_fingerprint": {
    "scenario_name": "openbsd_ldap_smb_ssh_privilege_escalation",
    "primary_services": [
      "ssh",
      "http",
      "ldap",
      "smb"
    ],
    "port_signature": "22+80+139+389+445",
    "service_combination": "ssh+http+ldap+smb",
    "os_family": "openbsd",
    "environment_type": "standalone_server",
    "entry_vector": "ldap_anonymous_enumeration",
    "privilege_path": "ssh_key_to_doas_ssh_keygen",
    "attack_complexity": "medium",
    "estimated_time": "60-90 minutes",
    "scenario_confidence": 0.92,
    "distinguishing_factors": [
      "ldap_anonymous_bind_enabled",
      "samba_on_openbsd",
      "doas_ssh_keygen_privilege",
      "ssh_certificate_authentication"
    ],
    "environmental_clues": [
      "openbsd_httpd_empty_response",
      "bsdauth_password_format",
      "samba_workgroup_ypuffy",
      "ksh_login_shell"
    ],
    "similar_scenarios": [
      "lightweight_htb_medium",
      "unix_ldap_boxes"
    ],
    "unique_aspects": [
      "ssh_certificate_signing_abuse",
      "openbsd_doas_configuration",
      "ldap_hash_to_smb_auth_chain"
    ]
  },
  "success_patterns": {
    "success_factors": [
      {
        "technique": "LDAP_Anonymous_Bind",
        "success_reason": "LDAP server allowed anonymous authentication and enumeration",
        "prerequisite_indicators": [
          "ldap_port_389_open",
          "anonymous_bind_enabled",
          "directory_service_accessible"
        ],
        "recognition_patterns": [
          "nmap shows 'Anonymous bind OK'",
          "ldap-search script returns user data",
          "sambaNTPassword field present"
        ],
        "failure_modes": [
          "anonymous_bind_disabled",
          "ldap_service_not_running",
          "firewall_blocking_ldap"
        ],
        "environmental_factors": [
          "default_ldap_configuration",
          "samba_domain_integration",
          "insufficient_access_controls"
        ],
        "success_probability": 0.75,
        "typical_timeframe": "2-5 minutes"
      },
      {
        "technique": "NT_Hash_Extraction",
        "success_reason": "LDAP exposed sambaNTPassword attribute for alice1978",
        "prerequisite_indicators": [
          "samba_integration_enabled",
          "sambaSamAccount_object_class",
          "password_attributes_readable"
        ],
        "recognition_patterns": [
          "sambaNTPassword field in LDAP output",
          "32-character hex hash format",
          "sambaSID attribute present"
        ],
        "failure_modes": [
          "password_attributes_protected",
          "no_samba_integration",
          "hash_fields_empty"
        ],
        "environmental_factors": [
          "samba_domain_controller_setup",
          "legacy_password_storage",
          "inadequate_attribute_permissions"
        ],
        "success_probability": 0.85,
        "typical_timeframe": "immediate"
      },
      {
        "technique": "Pass_The_Hash_SMB",
        "success_reason": "NT hash from LDAP worked for SMB authentication",
        "prerequisite_indicators": [
          "smb_service_available",
          "valid_nt_hash_obtained",
          "user_has_smb_access"
        ],
        "recognition_patterns": [
          "smbclient accepts NT hash",
          "successful SMB session establishment",
          "share enumeration succeeds"
        ],
        "failure_modes": [
          "hash_invalid_or_expired",
          "smb_disabled_for_user",
          "network_authentication_required"
        ],
        "environmental_factors": [
          "ntlm_authentication_enabled",
          "samba_configuration_allows_hash_auth",
          "no_smb_signing_required"
        ],
        "success_probability": 0.9,
        "typical_timeframe": "1-2 minutes"
      }
    ],
    "critical_discoveries": [
      {
        "discovery": "alice1978 NT hash via LDAP",
        "discovery_method": "nmap ldap-search script",
        "why_critical": "Enabled SMB access and potential SSH key discovery",
        "how_to_recognize": [
          "sambaNTPassword attribute in LDAP",
          "32-character hex hash format",
          "sambaSamAccount object class"
        ],
        "follow_up_actions": [
          "attempt_pass_the_hash_smb",
          "crack_hash_with_hashcat",
          "test_hash_against_other_services"
        ]
      },
      {
        "discovery": "SSH private key in SMB share",
        "discovery_method": "SMB share enumeration with alice1978 hash",
        "why_critical": "Direct path to user shell access",
        "how_to_recognize": [
          "private key files in shares",
          "ssh key format identification",
          "key corresponds to system users"
        ],
        "follow_up_actions": [
          "download_private_key",
          "test_ssh_authentication",
          "identify_key_owner"
        ]
      }
    ],
    "escalation_keys": [
      {
        "privilege_level": "user_shell",
        "escalation_method": "doas_ssh_keygen_abuse",
        "why_possible": "User had doas privileges for ssh-keygen command",
        "recognition_signs": [
          "doas_configuration_allows_ssh_keygen",
          "certificate_authority_key_accessible",
          "ssh_certificate_authentication_enabled"
        ],
        "exploitation_path": "doas ssh-keygen → signed certificate → root SSH access"
      }
    ]
  },
  "decision_tree": {
    "decision_points": [
      {
        "step": 1,
        "situation": "Found ports 22,80,139,389,445 open on OpenBSD host",
        "decision": "Prioritize LDAP enumeration due to anonymous bind capability",
        "reasoning": "LDAP anonymous access often reveals user accounts and hashes without authentication",
        "confidence": 0.9,
        "alternatives": [
          {
            "option": "smb_enumeration",
            "when": "if ldap fails or restricted"
          },
          {
            "option": "http_enumeration",
            "when": "if other services fail"
          }
        ],
        "success_indicators": [
          "ldap_anonymous_bind_successful",
          "user_accounts_discovered",
          "password_hashes_found"
        ],
        "next_decision": "extract_and_crack_hashes"
      },
      {
        "step": 2,
        "situation": "LDAP reveals NT hash for alice1978 user",
        "decision": "Use pass-the-hash for SMB authentication immediately",
        "reasoning": "NT hash can be used directly for SMB authentication without cracking",
        "confidence": 0.95,
        "prerequisites": [
          "nt_hash_obtained",
          "smb_service_available"
        ],
        "success_indicators": [
          "smb_authentication_successful",
          "shares_accessible"
        ],
        "failure_fallbacks": [
          "crack_hash_for_cleartext",
          "try_other_protocols"
        ]
      },
      {
        "step": 3,
        "situation": "SMB access granted with alice1978 hash",
        "decision": "Enumerate and download all accessible files from shares",
        "reasoning": "SMB shares often contain credentials, keys, or sensitive data",
        "confidence": 0.85,
        "prerequisites": [
          "smb_access_confirmed"
        ],
        "success_indicators": [
          "files_downloaded",
          "ssh_keys_found",
          "credentials_discovered"
        ],
        "next_decision": "analyze_downloaded_files"
      }
    ],
    "branching_logic": {
      "if_ldap_anonymous_succeeds": {
        "action": "extract_all_user_data_and_hashes",
        "tools": [
          "nmap",
          "ldapsearch"
        ],
        "next_phase": "credential_utilization"
      },
      "if_nt_hash_found": {
        "action": "attempt_pass_the_hash_attacks",
        "protocols": [
          "smb",
          "rdp",
          "winrm"
        ],
        "decision_criteria": "based_on_available_services"
      },
      "if_smb_access_obtained": {
        "action": "comprehensive_file_enumeration",
        "purpose": "find_ssh_keys_or_additional_credentials",
        "tools": [
          "smbclient",
          "smbmap"
        ]
      },
      "if_ssh_key_found": {
        "action": "attempt_ssh_authentication",
        "purpose": "gain_shell_access",
        "tools": [
          "ssh",
          "puttygen"
        ]
      }
    },
    "optimization_rules": [
      {
        "rule": "always_check_ldap_anonymous_bind_first",
        "reasoning": "high_information_yield_with_no_authentication_required",
        "applicability": "any_environment_with_ldap_service"
      },
      {
        "rule": "use_nt_hashes_directly_before_cracking",
        "reasoning": "pass_the_hash_faster_than_cracking_and_equally_effective",
        "applicability": "windows_or_samba_environments"
      },
      {
        "rule": "prioritize_smb_over_other_services_when_hash_available",
        "reasoning": "smb_commonly_accepts_hash_authentication_and_contains_files",
        "applicability": "environments_with_smb_and_obtained_hashes"
      }
    ]
  },
  "applicability_rules": {
    "technique_rules": [
      {
        "technique": "LDAP Anonymous Enumeration",
        "mitre_id": "T1087.002",
        "required_services": [
          "ldap"
        ],
        "required_ports": [
          389
        ],
        "os_requirements": [
          "any"
        ],
        "environmental_prerequisites": [
          "ldap_service_running",
          "anonymous_bind_enabled",
          "directory_service_configured"
        ],
        "success_indicators": [
          "ldap_rootdse_accessible",
          "user_objects_enumerable",
          "organizational_units_visible"
        ],
        "incompatible_with": [
          "anonymous_bind_disabled",
          "ldap_authentication_required",
          "network_isolation"
        ],
        "confidence_boosters": [
          "default_ldap_configuration",
          "posixAccount_objectClass_present",
          "sambaSamAccount_objects_found"
        ],
        "typical_success_rate": 0.75,
        "estimated_time": "2-5 minutes"
      },
      {
        "technique": "SMB Share Enumeration",
        "mitre_id": "T1135",
        "required_services": [
          "smb",
          "netbios-ssn"
        ],
        "required_ports": [
          139,
          445
        ],
        "os_requirements": [
          "any"
        ],
        "environmental_prerequisites": [
          "smb_service_running",
          "guest_access_enabled",
          "shares_configured"
        ],
        "success_indicators": [
          "smb_shares_listable",
          "guest_authentication_successful",
          "readable_shares_found"
        ],
        "incompatible_with": [
          "guest_access_disabled",
          "smb_signing_required",
          "all_shares_protected"
        ],
        "confidence_boosters": [
          "samba_version_detected",
          "workgroup_identified",
          "default_smb_configuration"
        ],
        "typical_success_rate": 0.68,
        "estimated_time": "3-8 minutes"
      },
      {
        "technique": "SSH Key Authentication",
        "mitre_id": "T1078.003",
        "required_services": [
          "ssh"
        ],
        "required_ports": [
          22
        ],
        "os_requirements": [
          "unix",
          "linux",
          "bsd"
        ],
        "environmental_prerequisites": [
          "ssh_service_running",
          "private_key_accessible",
          "key_based_auth_enabled"
        ],
        "success_indicators": [
          "private_key_found",
          "key_format_valid",
          "target_user_identified"
        ],
        "incompatible_with": [
          "password_only_auth",
          "key_passphrase_protected",
          "ssh_disabled"
        ],
        "confidence_boosters": [
          "ssh_keys_in_smb_shares",
          "default_ssh_configuration",
          "openssh_version_detected"
        ],
        "typical_success_rate": 0.92,
        "estimated_time": "1-3 minutes"
      }
    ],
    "environmental_detectors": {
      "ldap_directory": {
        "port_indicators": [
          389,
          636
        ],
        "service_indicators": [
          "ldap",
          "ldaps"
        ],
        "banner_indicators": [
          "LDAP",
          "Active Directory",
          "OpenLDAP"
        ],
        "confidence_threshold": 0.85
      },
      "smb_service": {
        "port_indicators": [
          139,
          445
        ],
        "service_indicators": [
          "netbios-ssn",
          "microsoft-ds",
          "smb"
        ],
        "banner_indicators": [
          "Samba",
          "Windows",
          "SMB"
        ],
        "confidence_threshold": 0.9
      },
      "ssh_service": {
        "port_indicators": [
          22
        ],
        "service_indicators": [
          "ssh"
        ],
        "banner_indicators": [
          "OpenSSH",
          "SSH"
        ],
        "confidence_threshold": 0.95
      },
      "web_service": {
        "port_indicators": [
          80,
          443,
          8080
        ],
        "service_indicators": [
          "http",
          "https"
        ],
        "banner_indicators": [
          "httpd",
          "Apache",
          "nginx",
          "IIS"
        ],
        "confidence_threshold": 0.85
      }
    },
    "attack_prioritization": {
      "high_priority": [
        {
          "attack": "ldap_anonymous_enumeration",
          "when": "ldap_service_detected",
          "reason": "often_reveals_usernames_and_structure"
        },
        {
          "attack": "smb_guest_enumeration",
          "when": "smb_service_detected",
          "reason": "frequently_contains_sensitive_files"
        }
      ],
      "medium_priority": [
        {
          "attack": "ssh_key_authentication",
          "when": "ssh_service_detected_and_keys_found",
          "reason": "high_success_rate_when_keys_available"
        },
        {
          "attack": "web_directory_enumeration",
          "when": "web_service_detected",
          "reason": "may_reveal_additional_attack_surface"
        }
      ]
    }
  },
  "technique_intelligence": {
    "techniques": [
      {
        "name": "LDAP Anonymous Enumeration",
        "mitre_id": "T1087.002",
        "category": "discovery",
        "phase": "reconnaissance",
        "tools_used": [
          {
            "name": "nmap",
            "command_template": "nmap -p 389 --script *ldap* {target_ip}",
            "actual_command": "nmap -p 389 --script *ldap* 10.10.10.107",
            "output_pattern": "sambaNTPassword: {hash}",
            "effectiveness_rating": 5,
            "reliability": 0.95
          }
        ],
        "prerequisites": [
          "ldap_service_accessible",
          "anonymous_bind_enabled"
        ],
        "success_indicators": [
          "user_accounts_enumerated",
          "nt_hashes_extracted",
          "domain_structure_revealed"
        ],
        "common_failures": [
          "anonymous_bind_disabled",
          "network_connectivity_issues",
          "ldap_service_not_running"
        ],
        "follow_up_techniques": [
          "pass_the_hash",
          "smb_enumeration",
          "credential_validation"
        ],
        "time_investment": "2-5 minutes",
        "skill_level": "beginner"
      },
      {
        "name": "Pass-the-Hash SMB Access",
        "mitre_id": "T1550.002",
        "category": "lateral_movement",
        "phase": "initial_access",
        "tools_used": [
          {
            "name": "smbclient",
            "command_template": "smbclient -L \\\\\\\\{target_ip} --pw-nt-hash -U {username}%{nt_hash}",
            "actual_command": "smbclient -L \\\\\\\\10.10.10.107 --pw-nt-hash -U alice1978%0B186E661BBDBDCF6047784DE8B9FD8B",
            "output_pattern": "Sharename.*Type.*Comment",
            "effectiveness_rating": 5,
            "reliability": 0.98
          },
          {
            "name": "smbmap",
            "command_template": "smbmap -u {username} -p '{lm_hash}:{nt_hash}' -H {target_ip}",
            "actual_command": "smbmap -u alice1978 -p 'aad3b435b51404eeaad3b435b51404ee:0B186E661BBDBDCF6047784DE8B9FD8B' -H 10.10.10.107",
            "success_factors": [
              "valid_nt_hash",
              "smb_service_accessible"
            ],
            "effectiveness_rating": 5
          }
        ],
        "prerequisites": [
          "nt_hash_obtained",
          "smb_service_accessible",
          "target_user_has_smb_access"
        ],
        "success_indicators": [
          "shares_enumerated_successfully",
          "file_access_granted",
          "authentication_successful"
        ],
        "common_failures": [
          "invalid_hash_format",
          "user_lacks_smb_permissions",
          "smb_service_unavailable"
        ],
        "follow_up_techniques": [
          "file_collection",
          "credential_harvesting",
          "lateral_movement"
        ],
        "time_investment": "1-3 minutes",
        "skill_level": "beginner"
      },
      {
        "name": "SSH Key Format Conversion",
        "mitre_id": "T1552.004",
        "category": "credential_access",
        "phase": "credential_access",
        "tools_used": [
          {
            "name": "puttygen",
            "command_template": "puttygen {ppk_file} -O private-openssh -o {output_file}",
            "actual_command": "puttygen my_private_key.ppk -O private-openssh -o alice.pem",
            "output_pattern": "PEM RSA private key",
            "effectiveness_rating": 5,
            "reliability": 1.0
          }
        ],
        "prerequisites": [
          "putty_private_key_obtained",
          "puttygen_tool_available"
        ],
        "success_indicators": [
          "key_converted_successfully",
          "openssh_format_confirmed",
          "key_usable_for_ssh_auth"
        ],
        "common_failures": [
          "corrupted_ppk_file",
          "missing_puttygen_tool",
          "incorrect_output_format"
        ],
        "follow_up_techniques": [
          "ssh_authentication",
          "privilege_escalation",
          "lateral_movement"
        ],
        "time_investment": "1-2 minutes",
        "skill_level": "beginner"
      }
    ],
    "tool_effectiveness": [
      {
        "tool": "nmap LDAP scripts",
        "use_case": "ldap_anonymous_enumeration",
        "effectiveness_rating": 5,
        "reliability": 0.95,
        "learning_curve": "low",
        "essential_for": [
          "ldap_environments",
          "active_directory_recon"
        ],
        "alternatives": [
          "ldapsearch",
          "ldapdomaindump"
        ],
        "best_practices": [
          "always_test_anonymous_bind_first",
          "look_for_nt_hashes_in_samba_attributes",
          "enumerate_all_organizational_units"
        ]
      },
      {
        "tool": "smbclient",
        "use_case": "pass_the_hash_authentication",
        "effectiveness_rating": 5,
        "reliability": 0.98,
        "learning_curve": "low",
        "essential_for": [
          "windows_environments",
          "smb_lateral_movement"
        ],
        "alternatives": [
          "smbmap",
          "crackmapexec"
        ],
        "best_practices": [
          "use_pw_nt_hash_flag_for_hash_authentication",
          "enumerate_shares_before_connecting",
          "collect_all_accessible_files"
        ]
      },
      {
        "tool": "puttygen",
        "use_case": "ssh_key_format_conversion",
        "effectiveness_rating": 5,
        "reliability": 1.0,
        "learning_curve": "low",
        "essential_for": [
          "mixed_os_environments",
          "key_format_compatibility"
        ],
        "alternatives": [
          "ssh-keygen",
          "online_converters"
        ],
        "best_practices": [
          "verify_key_format_after_conversion",
          "test_converted_key_immediately",
          "maintain_original_key_backup"
        ]
      }
    ],
    "command_sequences": [
      {
        "sequence_name": "ldap_to_ssh_shell",
        "steps": [
          {
            "step": 1,
            "command": "nmap -p 389 --script *ldap* 10.10.10.107",
            "purpose": "Extract user accounts and NT hashes from LDAP",
            "expected_output": "sambaNTPassword: 0B186E661BBDBDCF6047784DE8B9FD8B"
          },
          {
            "step": 2,
            "command": "smbclient -L \\\\\\\\10.10.10.107 --pw-nt-hash -U alice1978%0B186E661BBDBDCF6047784DE8B9FD8B",
            "purpose": "Enumerate SMB shares using extracted hash",
            "expected_output": "alice share with READ, WRITE permissions"
          },
          {
            "step": 3,
            "command": "smbclient \\\\\\\\10.10.10.107\\\\alice -U alice1978%0B186E661BBDBDCF6047784DE8B9FD8B --pw-nt-hash",
            "purpose": "Connect to SMB share and collect files",
            "expected_output": "my_private_key.ppk file downloaded"
          },
          {
            "step": 4,
            "command": "puttygen my_private_key.ppk -O private-openssh -o alice.pem",
            "purpose": "Convert PuTTY key to OpenSSH format",
            "expected_output": "PEM RSA private key created"
          },
          {
            "step": 5,
            "command": "ssh -i alice.pem alice1978@10.10.10.107",
            "purpose": "Authenticate via SSH using converted key",
            "expected_output": "Shell access as alice1978 user"
          }
        ],
        "success_rate": 0.92,
        "typical_duration": "10-15 minutes"
      }
    ]
  },
  "metadata": {
    "basic_metadata": {
      "name": "Ypuffy",
      "difficulty": "Medium",
      "os": "OpenBSD",
      "platform": "HackTheBox",
      "release_date": "2018-09-15",
      "author": "AuxSarge",
      "estimated_time": "2-3 hours"
    },
    "intelligence_metadata": {
      "attack_complexity": "medium",
      "skill_level_required": "intermediate",
      "primary_attack_vectors": [
        "ldap",
        "smb",
        "ssh_certificate_abuse"
      ],
      "key_vulnerabilities": [
        "ldap_hash_extraction",
        "doas_privilege_abuse",
        "ssh_keygen_exploitation"
      ],
      "environment_type": "mixed_services_server",
      "real_world_relevance": "high",
      "learning_value": [
        "ldap_enumeration",
        "ssh_certificate_attacks",
        "doas_exploitation",
        "cross_protocol_attacks"
      ],
      "prerequisite_knowledge": [
        "ldap_basics",
        "smb_enumeration",
        "ssh_key_management",
        "unix_privilege_escalation"
      ]
    },
    "categorization": {
      "primary_category": "mixed_protocol_exploitation",
      "subcategories": [
        "ldap_attacks",
        "ssh_certificate_abuse",
        "privilege_escalation"
      ],
      "attack_types": [
        "credential_access",
        "lateral_movement",
        "privilege_escalation"
      ],
      "defensive_lessons": [
        "secure_ldap_configuration",
        "ssh_certificate_management",
        "doas_hardening",
        "service_isolation"
      ]
    },
    "similarity_markers": {
      "similar_boxes": [
        "Lightweight",
        "Haystack",
        "Obscurity"
      ],
      "similarity_reasons": [
        "multi_protocol_chain",
        "ssh_key_exploitation",
        "unix_privilege_escalation"
      ],
      "unique_aspects": [
        "openbsd_environment",
        "ssh_certificate_signing",
        "doas_ssh_keygen_abuse",
        "cross_service_authentication"
      ],
      "difficulty_factors": [
        "protocol_chaining_required",
        "ssh_certificate_concepts",
        "openbsd_specific_tools"
      ]
    }
  },
  "extraction_metadata": {
    "parse_date": "2025-07-05T00:56:11.475845",
    "original_file": "0xdf_writeups/Htb Ypuffy.md",
    "content_length": 38818,
    "extraction_version": "2.0-claude",
    "model_used": "claude-sonnet-4-20250514"
  },
  "intelligence_confidence": 1.0,
  "quality_breakdown": {
    "scenario_uniqueness": 1.0,
    "success_logic_clarity": 1.0,
    "applicability_completeness": 1.0,
    "decision_tree_depth": 1.0,
    "technique_actionability": 1.0
  }
}