{
  "writeup_id": "Htb_Sherlock_Campfire_1",
  "scenario_fingerprint": {
    "scenario_name": "windows_kerberoasting_attack_forensics",
    "primary_services": [
      "kerberos",
      "active_directory",
      "powershell",
      "event_logging"
    ],
    "port_signature": "88+389+445+53",
    "service_combination": "kerberos+ldap+smb+dns",
    "os_family": "windows_server",
    "environment_type": "active_directory",
    "entry_vector": "kerberoasting",
    "privilege_path": "service_account_credential_extraction",
    "attack_complexity": "easy",
    "estimated_time": "30-45 minutes",
    "scenario_confidence": 0.98,
    "distinguishing_factors": [
      "rubeus_tool_execution",
      "powerview_enumeration",
      "kerberos_ticket_requests",
      "prefetch_artifacts",
      "powershell_operational_logs"
    ],
    "environmental_clues": [
      "domain_controller_security_logs",
      "workstation_powershell_logs",
      "prefetch_file_evidence",
      "kerberos_service_ticket_requests",
      "active_directory_enumeration"
    ],
    "similar_scenarios": [
      "active_htb_easy",
      "forest_htb_easy",
      "sauna_htb_easy"
    ],
    "unique_aspects": [
      "forensic_investigation_focus",
      "multi_source_log_analysis",
      "prefetch_file_correlation",
      "timeline_reconstruction"
    ]
  },
  "success_patterns": {
    "success_factors": [
      {
        "technique": "Kerberoasting",
        "success_reason": "Service accounts with SPNs had weak passwords vulnerable to offline cracking",
        "prerequisite_indicators": [
          "domain_controller_accessible",
          "valid_domain_credentials",
          "service_accounts_with_spns_exist",
          "kerberos_authentication_enabled"
        ],
        "recognition_patterns": [
          "TGS-REQ events (4769) in DC security logs",
          "service account targeting patterns",
          "Rubeus.exe execution in prefetch",
          "PowerView enumeration activities"
        ],
        "failure_modes": [
          "no_service_accounts_with_spns",
          "strong_service_account_passwords",
          "kerberos_encryption_aes256_only",
          "service_accounts_use_managed_passwords"
        ],
        "environmental_factors": [
          "legacy_service_configurations",
          "weak_password_policies",
          "rc4_encryption_enabled",
          "insufficient_monitoring"
        ],
        "success_probability": 0.75,
        "typical_timeframe": "15-45 minutes"
      },
      {
        "technique": "Active Directory Enumeration",
        "success_reason": "PowerView successfully enumerated domain objects and identified kerberoastable accounts",
        "prerequisite_indicators": [
          "domain_user_access",
          "ldap_queries_permitted",
          "powershell_execution_allowed"
        ],
        "recognition_patterns": [
          "PowerShell operational logs show script execution",
          "LDAP enumeration queries",
          "PowerView module loading",
          "Get-DomainUser cmdlet usage"
        ],
        "failure_modes": [
          "powershell_execution_blocked",
          "ldap_queries_restricted",
          "script_execution_policy_enforced"
        ],
        "environmental_factors": [
          "default_ldap_permissions",
          "unrestricted_powershell_policy",
          "minimal_endpoint_monitoring"
        ],
        "success_probability": 0.85,
        "typical_timeframe": "5-20 minutes"
      }
    ],
    "critical_discoveries": [
      {
        "discovery": "Service accounts with SPNs",
        "discovery_method": "PowerView enumeration via Get-DomainUser",
        "why_critical": "Enabled kerberoasting attack to extract password hashes",
        "how_to_recognize": [
          "accounts with servicePrincipalName attribute",
          "service account naming conventions",
          "accounts in service-related groups"
        ],
        "follow_up_actions": [
          "request_tgs_tickets_with_rubeus",
          "crack_hashes_offline",
          "test_credential_reuse"
        ]
      },
      {
        "discovery": "Rubeus.exe on target workstation",
        "discovery_method": "Prefetch file analysis",
        "why_critical": "Confirms kerberoasting tool execution and timeline",
        "how_to_recognize": [
          "RUBEUS.EXE-*.pf in prefetch directory",
          "execution timestamps in prefetch metadata",
          "command line arguments in prefetch"
        ],
        "follow_up_actions": [
          "analyze_prefetch_execution_times",
          "correlate_with_dc_security_logs",
          "check_for_credential_dumping"
        ]
      }
    ],
    "escalation_keys": [
      {
        "privilege_level": "domain_user",
        "escalation_method": "kerberoasting_to_service_account",
        "why_possible": "Service accounts often have elevated privileges and weak passwords",
        "recognition_signs": [
          "tgs_requests_for_service_accounts",
          "rc4_encryption_in_kerberos_tickets",
          "service_accounts_in_privileged_groups"
        ],
        "exploitation_path": "Enumerate SPNs → Request TGS → Crack Hash → Service Account Access"
      },
      {
        "privilege_level": "service_account",
        "escalation_method": "credential_reuse_lateral_movement",
        "why_possible": "Cracked service account credentials often reused across systems",
        "recognition_signs": [
          "service_account_logon_events",
          "psexec_usage_in_prefetch",
          "multiple_system_access_attempts"
        ],
        "exploitation_path": "Cracked Credentials → Lateral Movement → Additional System Compromise"
      }
    ]
  },
  "decision_tree": {
    "decision_points": [
      {
        "step": 1,
        "situation": "Found ports 88,389,445 open on Windows host",
        "decision": "Identify as Domain Controller and enumerate AD environment",
        "reasoning": "Port combination indicates AD DC - Kerberos (88), LDAP (389), SMB (445)",
        "confidence": 0.95,
        "alternatives": [
          {
            "option": "smb_enumeration",
            "when": "if kerberos fails"
          },
          {
            "option": "ldap_enumeration",
            "when": "if anonymous access available"
          }
        ],
        "success_indicators": [
          "kerberos_service_responds",
          "domain_name_discovered",
          "ldap_base_dn_found"
        ],
        "next_decision": "choose_ad_enumeration_method"
      },
      {
        "step": 2,
        "situation": "Confirmed Active Directory environment accessible",
        "decision": "Use PowerView for comprehensive AD enumeration first",
        "reasoning": "PowerView provides extensive AD object enumeration to identify kerberoastable accounts",
        "confidence": 0.9,
        "prerequisites": [
          "domain_accessible",
          "powershell_available"
        ],
        "success_indicators": [
          "service_accounts_found",
          "spn_accounts_identified"
        ],
        "failure_fallbacks": [
          "bloodhound_enumeration",
          "ldapsearch",
          "manual_enumeration"
        ]
      },
      {
        "step": 3,
        "situation": "PowerView identified kerberoastable service accounts",
        "decision": "Execute Rubeus for kerberoasting attack",
        "reasoning": "Rubeus is most effective tool for extracting service ticket hashes",
        "confidence": 0.95,
        "prerequisites": [
          "kerberoastable_accounts_identified",
          "domain_access"
        ],
        "success_indicators": [
          "service_ticket_hashes_extracted",
          "crackable_hashes_obtained"
        ],
        "next_decision": "hash_cracking_strategy"
      }
    ],
    "branching_logic": {
      "if_powerview_succeeds": {
        "action": "identify_high_value_spn_accounts",
        "tools": [
          "powerview"
        ],
        "next_phase": "kerberoasting_with_rubeus"
      },
      "if_powerview_fails": {
        "action": "try_alternative_enumeration",
        "alternatives": [
          "bloodhound",
          "ldapsearch",
          "impacket_getuserspns"
        ],
        "decision_criteria": "based_on_access_level_and_stealth_requirements"
      },
      "if_kerberoasting_succeeds": {
        "action": "crack_service_ticket_hashes",
        "tools": [
          "hashcat",
          "john"
        ],
        "next_phase": "privilege_escalation_with_service_account"
      },
      "if_service_account_compromised": {
        "action": "lateral_movement_and_privilege_escalation",
        "tools": [
          "bloodhound",
          "powerview",
          "rubeus"
        ],
        "purpose": "find_path_to_domain_admin"
      }
    },
    "optimization_rules": [
      {
        "rule": "always_enumerate_before_attacking",
        "reasoning": "powerview_identifies_best_targets_before_kerberoasting",
        "applicability": "active_directory_environments"
      },
      {
        "rule": "use_rubeus_for_kerberoasting_over_impacket",
        "reasoning": "better_opsec_and_more_reliable_hash_extraction",
        "applicability": "windows_host_with_dotnet_available"
      },
      {
        "rule": "target_service_accounts_with_spns_first",
        "reasoning": "higher_probability_of_weak_passwords_and_privilege_escalation",
        "applicability": "kerberoasting_attacks"
      },
      {
        "rule": "monitor_event_logs_for_kerberos_tgs_requests",
        "reasoning": "kerberoasting_generates_detectable_event_4769_patterns",
        "applicability": "stealth_considerations"
      }
    ]
  },
  "applicability_rules": {
    "technique_rules": [
      {
        "technique": "Kerberoasting",
        "mitre_id": "T1558.003",
        "required_services": [
          "kerberos"
        ],
        "required_ports": [
          88
        ],
        "os_requirements": [
          "windows"
        ],
        "environmental_prerequisites": [
          "active_directory_domain",
          "kerberos_authentication_enabled",
          "service_accounts_with_spn_exist"
        ],
        "success_indicators": [
          "TGS_requests_for_service_accounts",
          "domain_controller_accessible",
          "service_principal_names_enumerated"
        ],
        "incompatible_with": [
          "kerberos_disabled",
          "no_service_accounts_with_spn",
          "network_isolation"
        ],
        "confidence_boosters": [
          "powerview_enumeration_detected",
          "rubeus_tool_execution",
          "multiple_tgs_requests"
        ],
        "typical_success_rate": 0.82,
        "estimated_time": "10-30 minutes"
      },
      {
        "technique": "Active Directory Enumeration",
        "mitre_id": "T1087.002",
        "required_services": [
          "ldap",
          "kerberos"
        ],
        "required_ports": [
          389,
          636,
          88
        ],
        "os_requirements": [
          "windows"
        ],
        "environmental_prerequisites": [
          "active_directory_domain",
          "domain_user_credentials",
          "ldap_accessible"
        ],
        "success_indicators": [
          "powerview_execution_detected",
          "ldap_queries_successful",
          "user_enumeration_completed"
        ],
        "incompatible_with": [
          "ldap_disabled",
          "no_domain_access",
          "strict_access_controls"
        ],
        "confidence_boosters": [
          "powershell_operational_logs",
          "prefetch_files_present",
          "domain_controller_logs"
        ],
        "typical_success_rate": 0.91,
        "estimated_time": "5-20 minutes"
      },
      {
        "technique": "PowerShell Execution",
        "mitre_id": "T1059.001",
        "required_services": [
          "powershell"
        ],
        "required_ports": [],
        "os_requirements": [
          "windows"
        ],
        "environmental_prerequisites": [
          "powershell_available",
          "execution_policy_allows",
          "user_privileges_sufficient"
        ],
        "success_indicators": [
          "powershell_operational_logs",
          "prefetch_files_created",
          "script_execution_events"
        ],
        "incompatible_with": [
          "powershell_disabled",
          "constrained_language_mode",
          "applocker_blocking"
        ],
        "confidence_boosters": [
          "powershell_ise_usage",
          "script_block_logging",
          "command_line_arguments"
        ],
        "typical_success_rate": 0.95,
        "estimated_time": "1-5 minutes"
      }
    ],
    "environmental_detectors": {
      "active_directory": {
        "port_indicators": [
          53,
          88,
          389,
          445,
          636,
          3268
        ],
        "service_indicators": [
          "kerberos",
          "ldap",
          "smb",
          "dns"
        ],
        "banner_indicators": [
          "Active Directory",
          "Windows Server",
          "Domain Controller"
        ],
        "confidence_threshold": 0.85
      },
      "windows_workstation": {
        "port_indicators": [
          135,
          139,
          445,
          3389
        ],
        "service_indicators": [
          "smb",
          "rpc",
          "rdp"
        ],
        "technology_indicators": [
          "windows",
          "powershell",
          "prefetch"
        ],
        "confidence_threshold": 0.9
      },
      "kerberos_environment": {
        "port_indicators": [
          88
        ],
        "service_indicators": [
          "kerberos"
        ],
        "banner_indicators": [
          "Kerberos",
          "KDC"
        ],
        "confidence_threshold": 0.95
      }
    },
    "attack_prioritization": {
      "high_priority": [
        {
          "attack": "kerberoasting",
          "when": "active_directory_detected",
          "reason": "high_success_rate_service_accounts_common"
        },
        {
          "attack": "ad_enumeration",
          "when": "domain_access_available",
          "reason": "reveals_attack_targets_and_spns"
        },
        {
          "attack": "powershell_execution",
          "when": "windows_workstation_detected",
          "reason": "versatile_attack_platform"
        }
      ],
      "medium_priority": [
        {
          "attack": "smb_enumeration",
          "when": "smb_service_detected",
          "reason": "may_reveal_shares_and_users"
        },
        {
          "attack": "ldap_enumeration",
          "when": "ldap_service_detected",
          "reason": "directory_information_disclosure"
        }
      ]
    }
  },
  "technique_intelligence": {
    "techniques": [
      {
        "name": "Kerberoasting",
        "mitre_id": "T1558.003",
        "category": "credential_access",
        "phase": "privilege_escalation",
        "tools_used": [
          {
            "name": "Rubeus",
            "command_template": "Rubeus.exe kerberoast",
            "actual_command": "Rubeus.exe kerberoast",
            "output_pattern": "Kerberos TGS tickets extracted",
            "effectiveness_rating": 5,
            "reliability": 0.95,
            "prefetch_indicator": "RUBEUS.EXE-5873E24B.pf"
          },
          {
            "name": "PowerView",
            "command_template": "Import-Module PowerView.ps1; Get-DomainUser -SPN",
            "actual_command": "PowerView enumeration for kerberoastable accounts",
            "success_factors": [
              "service_accounts_with_spns",
              "domain_user_access"
            ],
            "effectiveness_rating": 5,
            "reliability": 0.98
          }
        ],
        "prerequisites": [
          "domain_user_credentials",
          "network_access_to_domain_controller",
          "service_accounts_with_spns_exist"
        ],
        "success_indicators": [
          "tgs_tickets_extracted",
          "service_account_spns_enumerated",
          "kerberos_authentication_events_in_dc_logs"
        ],
        "common_failures": [
          "no_service_accounts_with_spns",
          "insufficient_domain_privileges",
          "network_connectivity_issues"
        ],
        "follow_up_techniques": [
          "hash_cracking",
          "credential_spraying",
          "lateral_movement"
        ],
        "time_investment": "10-60 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "Active Directory Enumeration",
        "mitre_id": "T1087.002",
        "category": "discovery",
        "phase": "reconnaissance",
        "tools_used": [
          {
            "name": "PowerView",
            "command_template": "Import-Module PowerView.ps1; Get-DomainUser; Get-DomainComputer",
            "actual_command": "PowerView.ps1 enumeration commands",
            "output_pattern": "Domain objects and SPNs listed",
            "effectiveness_rating": 5,
            "reliability": 0.98
          }
        ],
        "prerequisites": [
          "domain_user_access",
          "powershell_execution_allowed"
        ],
        "success_indicators": [
          "domain_users_enumerated",
          "service_accounts_identified",
          "spns_discovered"
        ],
        "common_failures": [
          "powershell_execution_policy_restrictions",
          "insufficient_domain_privileges",
          "antivirus_detection"
        ],
        "follow_up_techniques": [
          "kerberoasting",
          "asreproasting",
          "bloodhound_collection"
        ],
        "time_investment": "5-30 minutes",
        "skill_level": "beginner"
      }
    ],
    "tool_effectiveness": [
      {
        "tool": "Rubeus",
        "use_case": "kerberos_ticket_extraction",
        "effectiveness_rating": 5,
        "reliability": 0.95,
        "learning_curve": "medium",
        "essential_for": [
          "kerberoasting_attacks"
        ],
        "alternatives": [
          "GetUserSPNs.py",
          "PowerView"
        ],
        "best_practices": [
          "run_from_domain_joined_machine",
          "use_domain_user_context",
          "target_specific_spns_when_possible"
        ]
      },
      {
        "tool": "PowerView",
        "use_case": "active_directory_enumeration",
        "effectiveness_rating": 5,
        "reliability": 0.98,
        "learning_curve": "low",
        "essential_for": [
          "domain_reconnaissance"
        ],
        "alternatives": [
          "BloodHound",
          "ldapsearch",
          "net_commands"
        ],
        "best_practices": [
          "import_module_before_use",
          "focus_on_spn_enumeration_for_kerberoasting",
          "combine_with_other_enumeration_tools"
        ]
      }
    ],
    "command_sequences": [
      {
        "sequence_name": "kerberoasting_attack_chain",
        "steps": [
          {
            "step": 1,
            "command": "Import-Module PowerView.ps1",
            "purpose": "Load AD enumeration capabilities",
            "expected_output": "PowerView module loaded"
          },
          {
            "step": 2,
            "command": "Get-DomainUser -SPN",
            "purpose": "Enumerate kerberoastable service accounts",
            "expected_output": "List of users with SPNs"
          },
          {
            "step": 3,
            "command": "Rubeus.exe kerberoast",
            "purpose": "Extract TGS tickets for offline cracking",
            "expected_output": "Kerberos tickets in hashcat format"
          }
        ],
        "success_rate": 0.85,
        "typical_duration": "15-45 minutes"
      }
    ],
    "forensic_artifacts": [
      {
        "artifact_type": "prefetch_files",
        "indicators": [
          "RUBEUS.EXE-5873E24B.pf",
          "POWERSHELL.EXE-CA1AE517.pf",
          "POWERSHELL_ISE.EXE-C4180667.pf"
        ],
        "analysis_method": "PECmd.exe -f [prefetch_file]",
        "key_metadata": [
          "execution_time",
          "run_count",
          "file_paths_accessed"
        ]
      },
      {
        "artifact_type": "security_event_logs",
        "event_ids": [
          "4769"
        ],
        "indicators": [
          "kerberos_tgs_ticket_requests",
          "service_account_authentication",
          "unusual_ticket_request_patterns"
        ],
        "analysis_method": "evtx_dump -o jsonl [security.evtx]"
      },
      {
        "artifact_type": "powershell_operational_logs",
        "event_ids": [
          "4103",
          "4104"
        ],
        "indicators": [
          "powerview_module_loading",
          "get-domainuser_commands",
          "spn_enumeration_activity"
        ],
        "analysis_method": "evtx_dump -o jsonl [powershell-operational.evtx]"
      }
    ]
  },
  "metadata": {
    "basic_metadata": {
      "name": "Campfire-1",
      "difficulty": "Very Easy",
      "os": "Windows Server/Workstation",
      "platform": "HackTheBox Sherlock",
      "release_date": "2024-06-20",
      "author": "CyberJunkie",
      "estimated_time": "30-45 minutes"
    },
    "intelligence_metadata": {
      "attack_complexity": "low",
      "skill_level_required": "beginner",
      "primary_attack_vectors": [
        "kerberoasting",
        "active_directory_enumeration"
      ],
      "key_vulnerabilities": [
        "kerberoastable_service_accounts",
        "powershell_execution"
      ],
      "environment_type": "corporate_domain_environment",
      "real_world_relevance": "very_high",
      "learning_value": [
        "digital_forensics",
        "event_log_analysis",
        "kerberoasting_detection"
      ],
      "prerequisite_knowledge": [
        "windows_event_logs",
        "kerberos_basics",
        "powershell_artifacts"
      ]
    },
    "categorization": {
      "primary_category": "digital_forensics",
      "subcategories": [
        "incident_response",
        "kerberos_attacks",
        "log_analysis"
      ],
      "attack_types": [
        "credential_access",
        "discovery",
        "collection"
      ],
      "defensive_lessons": [
        "event_log_monitoring",
        "powershell_logging",
        "prefetch_analysis"
      ]
    },
    "similarity_markers": {
      "similar_boxes": [
        "Investigation",
        "Reminiscent",
        "Noted"
      ],
      "similarity_reasons": [
        "dfir_focus",
        "windows_artifacts",
        "attack_reconstruction"
      ],
      "unique_aspects": [
        "kerberoasting_forensics",
        "powerview_detection",
        "rubeus_artifacts"
      ],
      "difficulty_factors": [
        "guided_questions",
        "clear_attack_timeline",
        "multiple_evidence_sources"
      ]
    }
  },
  "extraction_metadata": {
    "parse_date": "2025-07-05T01:52:23.560587",
    "original_file": "0xdf_writeups/Htb Sherlock Campfire 1.md",
    "content_length": 70650,
    "extraction_version": "2.0-claude",
    "model_used": "claude-sonnet-4-20250514"
  },
  "intelligence_confidence": 0.9166666666666667,
  "quality_breakdown": {
    "scenario_uniqueness": 1.0,
    "success_logic_clarity": 0.6666666666666666,
    "applicability_completeness": 1.0,
    "decision_tree_depth": 1.0,
    "technique_actionability": 1.0
  }
}