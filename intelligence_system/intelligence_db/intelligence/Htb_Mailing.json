{
  "writeup_id": "Htb_Mailing",
  "scenario_fingerprint": {
    "scenario_name": "windows_mail_server_lfi_to_config_leak",
    "primary_services": [
      "http",
      "smtp",
      "pop3",
      "imap",
      "smb",
      "winrm"
    ],
    "port_signature": "25+80+110+143+445+465+587+993+5985",
    "service_combination": "http+smtp+pop3+imap+smb+winrm",
    "os_family": "windows_server",
    "environment_type": "mail_server",
    "entry_vector": "lfi_directory_traversal",
    "privilege_path": "config_leak_to_credential_crack",
    "attack_complexity": "easy",
    "estimated_time": "30-45 minutes",
    "scenario_confidence": 0.92,
    "distinguishing_factors": [
      "hmailserver_configuration",
      "php_lfi_vulnerability",
      "mail_service_clustering"
    ],
    "environmental_clues": [
      "hmailserver_smtp_banner",
      "iis_10_webserver",
      "multiple_mail_protocols",
      "ssl_certificates_for_mail"
    ],
    "similar_scenarios": [
      "mail_server_misconfigurations",
      "php_lfi_attacks"
    ],
    "unique_aspects": [
      "hmailserver_specific_config_paths",
      "mail_protocol_enumeration",
      "config_hash_cracking"
    ]
  },
  "success_patterns": {
    "success_factors": [
      {
        "technique": "Directory_Traversal_File_Read",
        "success_reason": "PHP download.php parameter vulnerable to path traversal",
        "prerequisite_indicators": [
          "php_application_present",
          "file_parameter_in_url",
          "insufficient_input_validation"
        ],
        "recognition_patterns": [
          "download.php?file= parameter structure",
          "PDF file serving functionality",
          "lack of path sanitization"
        ],
        "failure_modes": [
          "proper_input_validation",
          "chroot_jail_restrictions",
          "whitelist_file_access"
        ],
        "environmental_factors": [
          "windows_iis_php_stack",
          "developer_oversight",
          "legacy_code_patterns"
        ],
        "success_probability": 0.75,
        "typical_timeframe": "10-30 minutes"
      },
      {
        "technique": "Configuration_File_Extraction",
        "success_reason": "hMailServer config accessible via directory traversal",
        "prerequisite_indicators": [
          "hmailserver_identified_via_nmap",
          "file_read_vulnerability_exists",
          "default_installation_paths"
        ],
        "recognition_patterns": [
          "hMailServer service detection",
          "Windows Program Files structure",
          "INI configuration file format"
        ],
        "failure_modes": [
          "non_default_installation_path",
          "encrypted_configuration",
          "restricted_file_permissions"
        ],
        "environmental_factors": [
          "default_hmailserver_installation",
          "windows_file_system_structure",
          "administrator_configuration_habits"
        ],
        "success_probability": 0.85,
        "typical_timeframe": "15-45 minutes"
      },
      {
        "technique": "Hash_Cracking",
        "success_reason": "Weak password policy allowed crackable hash",
        "prerequisite_indicators": [
          "password_hash_extracted",
          "common_hash_format",
          "weak_password_complexity"
        ],
        "recognition_patterns": [
          "MD5/SHA hash formats",
          "service account patterns",
          "corporate password policies"
        ],
        "failure_modes": [
          "strong_password_policy",
          "salted_hashes",
          "unknown_hash_format"
        ],
        "environmental_factors": [
          "default_password_requirements",
          "user_password_habits",
          "legacy_hash_algorithms"
        ],
        "success_probability": 0.65,
        "typical_timeframe": "30 minutes - 4 hours"
      }
    ],
    "critical_discoveries": [
      {
        "discovery": "download.php file parameter vulnerability",
        "discovery_method": "URL parameter analysis and testing",
        "why_critical": "Enabled reading arbitrary files including hMailServer config",
        "how_to_recognize": [
          "file parameter in download URLs",
          "PHP file serving functionality",
          "lack of error handling on invalid paths"
        ],
        "follow_up_actions": [
          "test_directory_traversal_payloads",
          "enumerate_common_config_files",
          "target_application_specific_files"
        ]
      },
      {
        "discovery": "hMailServer configuration file",
        "discovery_method": "Directory traversal to Program Files",
        "why_critical": "Contained password hashes for mail server accounts",
        "how_to_recognize": [
          "hMailServer service detection",
          "Windows Program Files directory structure",
          "INI file configuration format"
        ],
        "follow_up_actions": [
          "extract_password_hashes",
          "identify_user_accounts",
          "attempt_hash_cracking"
        ]
      },
      {
        "discovery": "Valid email credentials",
        "discovery_method": "Hash cracking of extracted configuration",
        "why_critical": "Provided authenticated access to mail services and potential WinRM",
        "how_to_recognize": [
          "successful hash cracking",
          "email account format matching",
          "service authentication success"
        ],
        "follow_up_actions": [
          "test_winrm_access",
          "enumerate_email_contents",
          "check_credential_reuse"
        ]
      }
    ],
    "escalation_keys": [
      {
        "privilege_level": "unauthenticated",
        "escalation_method": "File_Read_to_Config_Access",
        "why_possible": "Directory traversal vulnerability in download functionality",
        "recognition_signs": [
          "file_parameter_in_urls",
          "php_application_stack",
          "insufficient_input_validation"
        ],
        "exploitation_path": "Directory Traversal → Config File Access → Hash Extraction → Credential Cracking"
      },
      {
        "privilege_level": "config_access",
        "escalation_method": "Hash_Extraction_to_Authentication",
        "why_possible": "Plaintext or weakly hashed passwords in configuration",
        "recognition_signs": [
          "configuration_file_access",
          "hash_formats_in_config",
          "weak_password_policies"
        ],
        "exploitation_path": "Config Access → Hash Cracking → Service Authentication → System Access"
      }
    ]
  },
  "decision_tree": {
    "decision_points": [
      {
        "step": 1,
        "situation": "Found web application with download.php file parameter",
        "decision": "Test for Local File Inclusion (LFI) vulnerability",
        "reasoning": "File parameter in URL indicates potential file read vulnerability",
        "confidence": 0.9,
        "alternatives": [
          {
            "option": "directory_traversal",
            "when": "if direct LFI fails"
          },
          {
            "option": "parameter_fuzzing",
            "when": "if file parameter filtered"
          }
        ],
        "success_indicators": [
          "file_contents_disclosed",
          "directory_traversal_successful",
          "sensitive_files_accessible"
        ],
        "next_decision": "identify_target_files"
      },
      {
        "step": 2,
        "situation": "LFI confirmed on PHP application with hMailServer identified",
        "decision": "Target hMailServer configuration files",
        "reasoning": "hMailServer config contains database credentials and password hashes",
        "confidence": 0.85,
        "prerequisites": [
          "lfi_vulnerability_confirmed",
          "hmailserver_identified"
        ],
        "target_files": [
          "C:\\Program Files (x86)\\hMailServer\\Bin\\hMailServer.INI",
          "C:\\ProgramData\\hMailServer\\Logs\\*",
          "C:\\Windows\\System32\\drivers\\etc\\hosts"
        ],
        "success_indicators": [
          "config_file_retrieved",
          "password_hash_found"
        ],
        "next_decision": "crack_obtained_hashes"
      },
      {
        "step": 3,
        "situation": "hMailServer config file obtained with password hash",
        "decision": "Crack hash and test against mail services",
        "reasoning": "Mail server credentials often provide system access",
        "confidence": 0.8,
        "prerequisites": [
          "password_hash_obtained"
        ],
        "tools": [
          "hashcat",
          "john"
        ],
        "success_indicators": [
          "password_cracked",
          "mail_authentication_successful"
        ],
        "next_decision": "test_credential_reuse"
      },
      {
        "step": 4,
        "situation": "Valid mail credentials obtained",
        "decision": "Test credential reuse on WinRM and SMB",
        "reasoning": "Mail server admin credentials often reused for system access",
        "confidence": 0.75,
        "prerequisites": [
          "valid_mail_credentials"
        ],
        "services_to_test": [
          "winrm_5985",
          "smb_445",
          "rdp_3389"
        ],
        "success_indicators": [
          "winrm_access_granted",
          "smb_access_granted"
        ],
        "next_decision": "enumerate_system_for_privesc"
      }
    ],
    "branching_logic": {
      "if_lfi_succeeds": {
        "action": "enumerate_sensitive_files",
        "priority_targets": [
          "application_configs",
          "system_files",
          "log_files"
        ],
        "next_phase": "credential_extraction"
      },
      "if_lfi_fails": {
        "action": "try_alternative_attacks",
        "alternatives": [
          "sql_injection",
          "command_injection",
          "file_upload"
        ],
        "decision_criteria": "based_on_application_functionality"
      },
      "if_hmailserver_config_obtained": {
        "action": "extract_and_crack_hashes",
        "tools": [
          "hashcat",
          "john"
        ],
        "hash_types": [
          "md5",
          "sha1",
          "bcrypt"
        ],
        "next_phase": "credential_validation"
      },
      "if_credentials_valid": {
        "action": "test_service_access",
        "services": [
          "winrm",
          "smb",
          "mail_services"
        ],
        "next_phase": "privilege_escalation"
      }
    },
    "optimization_rules": [
      {
        "rule": "always_test_lfi_on_file_parameters",
        "reasoning": "high_success_rate_for_file_disclosure_vulnerabilities",
        "applicability": "web_applications_with_file_parameters"
      },
      {
        "rule": "target_application_specific_configs_first",
        "reasoning": "application_configs_contain_credentials_and_sensitive_data",
        "applicability": "lfi_vulnerability_confirmed"
      },
      {
        "rule": "test_credential_reuse_across_all_services",
        "reasoning": "administrators_often_reuse_passwords_across_services",
        "applicability": "any_credentials_obtained"
      },
      {
        "rule": "prioritize_mail_server_configs_when_mail_services_detected",
        "reasoning": "mail_server_configs_contain_high_value_credentials",
        "applicability": "mail_services_identified_in_reconnaissance"
      }
    ]
  },
  "applicability_rules": {
    "technique_rules": [
      {
        "technique": "Directory Traversal / File Read",
        "mitre_id": "T1083",
        "required_services": [
          "http",
          "https"
        ],
        "required_ports": [
          80,
          443,
          8080,
          8443
        ],
        "os_requirements": [
          "windows",
          "linux"
        ],
        "environmental_prerequisites": [
          "web_application_present",
          "php_application_detected",
          "file_inclusion_parameters"
        ],
        "success_indicators": [
          "config_files_readable",
          "system_files_accessible",
          "error_messages_reveal_paths"
        ],
        "incompatible_with": [
          "strict_input_validation",
          "chroot_jail",
          "file_access_restrictions"
        ],
        "confidence_boosters": [
          "php_application",
          "file_parameter_names",
          "legacy_applications"
        ],
        "typical_success_rate": 0.75,
        "estimated_time": "10-30 minutes"
      },
      {
        "technique": "Configuration File Extraction",
        "mitre_id": "T1005",
        "required_services": [
          "http",
          "https"
        ],
        "required_ports": [
          80,
          443
        ],
        "os_requirements": [
          "windows"
        ],
        "environmental_prerequisites": [
          "directory_traversal_vulnerability",
          "hmailserver_detected",
          "config_files_accessible"
        ],
        "success_indicators": [
          "hmailserver_config_retrieved",
          "password_hashes_extracted",
          "database_credentials_found"
        ],
        "incompatible_with": [
          "encrypted_config_files",
          "restricted_file_permissions",
          "config_obfuscation"
        ],
        "confidence_boosters": [
          "hmailserver_service_detected",
          "windows_server_environment",
          "default_installation_paths"
        ],
        "typical_success_rate": 0.85,
        "estimated_time": "5-15 minutes"
      },
      {
        "technique": "Hash Cracking",
        "mitre_id": "T1110.002",
        "required_services": [],
        "required_ports": [],
        "os_requirements": [
          "any"
        ],
        "environmental_prerequisites": [
          "password_hashes_obtained",
          "weak_password_policy",
          "common_password_usage"
        ],
        "success_indicators": [
          "hash_successfully_cracked",
          "plaintext_password_recovered",
          "credential_validation_successful"
        ],
        "incompatible_with": [
          "strong_password_policy",
          "salted_hashes",
          "modern_hashing_algorithms"
        ],
        "confidence_boosters": [
          "legacy_hash_formats",
          "service_account_passwords",
          "default_credentials"
        ],
        "typical_success_rate": 0.65,
        "estimated_time": "15-60 minutes"
      }
    ],
    "environmental_detectors": {
      "mail_server": {
        "port_indicators": [
          25,
          110,
          143,
          465,
          587,
          993
        ],
        "service_indicators": [
          "smtp",
          "pop3",
          "imap",
          "smtps"
        ],
        "banner_indicators": [
          "hMailServer",
          "Exchange",
          "Postfix"
        ],
        "confidence_threshold": 0.9
      },
      "web_application": {
        "port_indicators": [
          80,
          443,
          8080,
          8443
        ],
        "service_indicators": [
          "http",
          "https"
        ],
        "technology_indicators": [
          "apache",
          "nginx",
          "iis",
          "php"
        ],
        "confidence_threshold": 0.9
      },
      "windows_server": {
        "port_indicators": [
          135,
          139,
          445,
          5985,
          47001
        ],
        "service_indicators": [
          "msrpc",
          "netbios-ssn",
          "microsoft-ds",
          "wsman"
        ],
        "banner_indicators": [
          "Microsoft",
          "Windows",
          "IIS"
        ],
        "confidence_threshold": 0.85
      }
    },
    "attack_prioritization": {
      "high_priority": [
        {
          "attack": "directory_traversal",
          "when": "php_web_application_detected",
          "reason": "high_success_rate_for_config_extraction"
        },
        {
          "attack": "config_file_extraction",
          "when": "hmailserver_and_traversal_found",
          "reason": "often_contains_crackable_hashes"
        }
      ],
      "medium_priority": [
        {
          "attack": "smb_enumeration",
          "when": "smb_service_detected",
          "reason": "requires_credentials_but_high_value"
        },
        {
          "attack": "mail_service_enumeration",
          "when": "mail_services_detected",
          "reason": "username_enumeration_possible"
        }
      ]
    }
  },
  "technique_intelligence": {
    "techniques": [
      {
        "name": "Directory Traversal / Local File Inclusion",
        "mitre_id": "T1083",
        "category": "discovery",
        "phase": "initial_access",
        "tools_used": [
          {
            "name": "curl",
            "command_template": "curl 'http://{target}/download.php?file=..\\..\\{file_path}'",
            "actual_command": "curl 'http://mailing.htb/download.php?file=..\\..\\windows\\system32\\drivers\\etc\\hosts'",
            "output_pattern": "File contents displayed in response",
            "effectiveness_rating": 5,
            "reliability": 0.95
          },
          {
            "name": "curl",
            "command_template": "curl http://{target}/download.php?file=../../{file_path}",
            "actual_command": "curl http://mailing.htb/download.php?file=../../windows/system32/drivers/etc/hosts",
            "success_factors": [
              "vulnerable_file_parameter",
              "insufficient_input_validation"
            ],
            "effectiveness_rating": 5
          }
        ],
        "prerequisites": [
          "web_application_with_file_parameter",
          "insufficient_input_validation",
          "file_system_access_permissions"
        ],
        "success_indicators": [
          "system_files_readable",
          "configuration_files_accessible",
          "application_source_code_exposed"
        ],
        "common_failures": [
          "path_filtering_implemented",
          "file_permissions_restrict_access",
          "application_sandboxing"
        ],
        "follow_up_techniques": [
          "configuration_file_analysis",
          "credential_extraction",
          "source_code_review"
        ],
        "time_investment": "5-15 minutes",
        "skill_level": "beginner"
      },
      {
        "name": "Web Application Reconnaissance",
        "mitre_id": "T1590.002",
        "category": "reconnaissance",
        "phase": "reconnaissance",
        "tools_used": [
          {
            "name": "nmap",
            "command_template": "nmap -p- --min-rate 10000 {target}",
            "actual_command": "nmap -p- --min-rate 10000 10.10.11.14",
            "output_pattern": "PORT STATE SERVICE listings",
            "effectiveness_rating": 5,
            "reliability": 0.98
          },
          {
            "name": "nmap",
            "command_template": "nmap -p {ports} -sCV {target}",
            "actual_command": "nmap -p 25,80,110,135,139,143,445,465,587,993,5040,5985,7680,47001,49664,49665,49666,49667,49668,64959 -sCV 10.10.11.14",
            "success_factors": [
              "comprehensive_port_coverage",
              "service_version_detection"
            ],
            "effectiveness_rating": 5
          },
          {
            "name": "feroxbuster",
            "command_template": "feroxbuster -u http://{target} -x {extensions}",
            "actual_command": "feroxbuster -u http://mailing.htb -x php,aspx",
            "success_factors": [
              "appropriate_extensions",
              "comprehensive_wordlist"
            ],
            "effectiveness_rating": 4
          }
        ],
        "prerequisites": [
          "target_accessibility",
          "network_connectivity"
        ],
        "success_indicators": [
          "service_enumeration_complete",
          "technology_stack_identified",
          "attack_surface_mapped"
        ],
        "common_failures": [
          "rate_limiting_interference",
          "firewall_blocking",
          "service_detection_evasion"
        ],
        "follow_up_techniques": [
          "vulnerability_assessment",
          "credential_attacks",
          "service_exploitation"
        ],
        "time_investment": "15-30 minutes",
        "skill_level": "beginner"
      },
      {
        "name": "Email Address Enumeration",
        "mitre_id": "T1589.002",
        "category": "reconnaissance",
        "phase": "reconnaissance",
        "tools_used": [
          {
            "name": "manual_analysis",
            "command_template": "Review website content and documentation for email patterns",
            "actual_command": "Analysis of instructions.pdf revealed maya@mailing.htb",
            "output_pattern": "Email addresses in format user@domain.tld",
            "effectiveness_rating": 4,
            "reliability": 0.85
          }
        ],
        "prerequisites": [
          "accessible_documentation",
          "email_examples_in_content"
        ],
        "success_indicators": [
          "valid_email_addresses_identified",
          "naming_convention_established",
          "potential_targets_enumerated"
        ],
        "common_failures": [
          "no_email_examples_present",
          "obfuscated_email_addresses",
          "generic_examples_only"
        ],
        "follow_up_techniques": [
          "credential_spraying",
          "social_engineering",
          "password_attacks"
        ],
        "time_investment": "10-20 minutes",
        "skill_level": "beginner"
      }
    ],
    "tool_effectiveness": [
      {
        "tool": "curl",
        "use_case": "directory_traversal_exploitation",
        "effectiveness_rating": 5,
        "reliability": 0.95,
        "learning_curve": "low",
        "essential_for": [
          "web_application_testing"
        ],
        "alternatives": [
          "burp_suite",
          "wget",
          "browser"
        ],
        "best_practices": [
          "test_both_forward_and_backward_slashes",
          "url_encode_special_characters_when_needed",
          "try_multiple_traversal_depths"
        ]
      },
      {
        "tool": "feroxbuster",
        "use_case": "web_directory_enumeration",
        "effectiveness_rating": 4,
        "reliability": 0.9,
        "learning_curve": "low",
        "essential_for": [
          "web_application_reconnaissance"
        ],
        "alternatives": [
          "gobuster",
          "dirbuster",
          "ffuf"
        ],
        "best_practices": [
          "include_relevant_file_extensions",
          "adjust_thread_count_for_target_stability",
          "use_appropriate_wordlists_for_technology_stack"
        ]
      },
      {
        "tool": "nmap",
        "use_case": "network_service_discovery",
        "effectiveness_rating": 5,
        "reliability": 0.98,
        "learning_curve": "medium",
        "essential_for": [
          "network_reconnaissance"
        ],
        "alternatives": [
          "masscan",
          "zmap",
          "netcat"
        ],
        "best_practices": [
          "start_with_fast_port_scan_then_detailed_scan",
          "use_service_version_detection_on_open_ports",
          "adjust_timing_based_on_network_conditions"
        ]
      }
    ],
    "command_sequences": [
      {
        "sequence_name": "web_app_reconnaissance_to_file_read",
        "steps": [
          {
            "step": 1,
            "command": "nmap -p- --min-rate 10000 10.10.11.14",
            "purpose": "Discover all open ports",
            "expected_output": "List of open TCP ports including 80"
          },
          {
            "step": 2,
            "command": "nmap -p 80 -sCV 10.10.11.14",
            "purpose": "Detailed service enumeration",
            "expected_output": "HTTP service details and headers"
          },
          {
            "step": 3,
            "command": "feroxbuster -u http://mailing.htb -x php,aspx",
            "purpose": "Discover web application structure",
            "expected_output": "Directory and file listings including download.php"
          },
          {
            "step": 4,
            "command": "curl 'http://mailing.htb/download.php?file=../../windows/system32/drivers/etc/hosts'",
            "purpose": "Test for directory traversal vulnerability",
            "expected_output": "Contents of Windows hosts file"
          }
        ],
        "success_rate": 0.75,
        "typical_duration": "20-45 minutes"
      }
    ]
  },
  "metadata": {
    "basic_metadata": {
      "name": "Mailing",
      "difficulty": "Easy",
      "os": "Windows",
      "platform": "HackTheBox",
      "release_date": "2024-05-04",
      "author": "ruycr4ft, TheCyberGeek",
      "estimated_time": "30-45 minutes"
    },
    "intelligence_metadata": {
      "attack_complexity": "low",
      "skill_level_required": "beginner",
      "primary_attack_vectors": [
        "directory_traversal",
        "file_read",
        "credential_extraction"
      ],
      "key_vulnerabilities": [
        "php_file_read",
        "directory_traversal",
        "weak_password_hashing"
      ],
      "environment_type": "mail_server",
      "real_world_relevance": "high",
      "learning_value": [
        "directory_traversal",
        "mail_server_exploitation",
        "config_file_extraction"
      ],
      "prerequisite_knowledge": [
        "basic_web_exploitation",
        "file_system_navigation",
        "hash_cracking"
      ]
    },
    "categorization": {
      "primary_category": "web_exploitation",
      "subcategories": [
        "directory_traversal",
        "credential_access",
        "mail_server"
      ],
      "attack_types": [
        "file_read",
        "credential_extraction",
        "configuration_disclosure"
      ],
      "defensive_lessons": [
        "input_validation",
        "file_access_controls",
        "secure_config_storage"
      ]
    },
    "similarity_markers": {
      "similar_boxes": [
        "Mailroom",
        "Paper",
        "Shoppy"
      ],
      "similarity_reasons": [
        "directory_traversal",
        "file_read_vulnerabilities",
        "config_extraction"
      ],
      "unique_aspects": [
        "hmailserver_exploitation",
        "mail_service_focus",
        "php_traversal"
      ],
      "difficulty_factors": [
        "straightforward_traversal",
        "clear_attack_path",
        "basic_enumeration"
      ]
    }
  },
  "extraction_metadata": {
    "parse_date": "2025-07-04T17:27:41.213907",
    "original_file": "0xdf_writeups/Htb Mailing.md",
    "content_length": 51361,
    "extraction_version": "2.0-claude",
    "model_used": "claude-sonnet-4-20250514"
  },
  "intelligence_confidence": 1.0,
  "quality_breakdown": {
    "scenario_uniqueness": 1.0,
    "success_logic_clarity": 1.0,
    "applicability_completeness": 1.0,
    "decision_tree_depth": 1.0,
    "technique_actionability": 1.0
  }
}