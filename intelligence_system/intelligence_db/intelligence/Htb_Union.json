{
  "writeup_id": "Htb_Union",
  "scenario_fingerprint": {
    "scenario_name": "linux_web_union_sqli_to_sudo_escalation",
    "primary_services": [
      "http",
      "nginx",
      "php"
    ],
    "port_signature": "80",
    "service_combination": "nginx+php",
    "os_family": "linux",
    "environment_type": "web_application",
    "entry_vector": "union_sql_injection",
    "privilege_path": "sqli_to_ssh_to_sudo_root",
    "attack_complexity": "medium",
    "estimated_time": "60-90 minutes",
    "scenario_confidence": 0.88,
    "distinguishing_factors": [
      "union_based_sqli_with_waf",
      "file_read_via_sqli",
      "x_forwarded_for_command_injection",
      "www_data_full_sudo_rights"
    ],
    "environmental_clues": [
      "single_http_port_exposed",
      "php_session_cookies",
      "nginx_ubuntu_stack",
      "firewall_modification_privileges"
    ],
    "similar_scenarios": [
      "medium_web_sqli_boxes",
      "linux_privilege_escalation"
    ],
    "unique_aspects": [
      "tricky_union_sqli_detection",
      "firewall_php_command_injection",
      "database_credentials_reuse",
      "waf_bypass_required"
    ]
  },
  "success_patterns": {
    "success_factors": [
      {
        "technique": "Union SQL Injection",
        "success_reason": "Application vulnerable to UNION-based SQL injection with minimal WAF filtering",
        "prerequisite_indicators": [
          "database_driven_application",
          "user_input_in_sql_queries",
          "error_handling_differences",
          "response_reflects_database_content"
        ],
        "recognition_patterns": [
          "different responses for valid/invalid usernames",
          "response shows database content not user input",
          "comment injection (';-- -) changes behavior",
          "UNION queries return different data"
        ],
        "failure_modes": [
          "proper_parameterized_queries",
          "comprehensive_input_validation",
          "effective_waf_implementation",
          "no_error_information_disclosure"
        ],
        "environmental_factors": [
          "basic_waf_with_simple_keyword_filtering",
          "php_mysql_stack",
          "error_suppression_but_behavioral_differences",
          "direct_database_output_reflection"
        ],
        "success_probability": 0.75,
        "typical_timeframe": "30-60 minutes"
      },
      {
        "technique": "X-Forwarded-For Command Injection",
        "success_reason": "Firewall script processes X-Forwarded-For header without sanitization",
        "prerequisite_indicators": [
          "web_application_modifies_firewall",
          "reverse_proxy_configuration",
          "privileged_operations_from_web_context",
          "header_processing_in_backend"
        ],
        "recognition_patterns": [
          "firewall.php endpoint exists",
          "www-data has sudo privileges",
          "application processes forwarded headers",
          "command injection in header values"
        ],
        "failure_modes": [
          "proper_input_sanitization",
          "no_privileged_web_operations",
          "header_validation",
          "principle_of_least_privilege"
        ],
        "environmental_factors": [
          "nginx_reverse_proxy_setup",
          "sudo_misconfiguration",
          "web_application_firewall_integration",
          "header_trust_without_validation"
        ],
        "success_probability": 0.65,
        "typical_timeframe": "15-30 minutes"
      }
    ],
    "critical_discoveries": [
      {
        "discovery": "SQL injection behavioral differences",
        "discovery_method": "Manual testing of edge cases and response analysis",
        "why_critical": "Enabled database enumeration and credential extraction",
        "how_to_recognize": [
          "subtle response differences between queries",
          "database content reflected in responses",
          "comment injection changes behavior",
          "WAF filtering specific keywords only"
        ],
        "follow_up_actions": [
          "enumerate_database_structure",
          "extract_user_credentials",
          "read_configuration_files",
          "attempt_file_system_access"
        ]
      },
      {
        "discovery": "www-data sudo privileges",
        "discovery_method": "Process monitoring and privilege enumeration",
        "why_critical": "Direct path to root access via command injection",
        "how_to_recognize": [
          "web_processes_running_privileged_commands",
          "sudo_without_password_requirements",
          "firewall_modifications_from_web_context",
          "process_monitoring_shows_privilege_escalation"
        ],
        "follow_up_actions": [
          "analyze_firewall_script_source",
          "test_command_injection_vectors",
          "exploit_header_processing",
          "escalate_to_root_shell"
        ]
      }
    ],
    "escalation_keys": [
      {
        "privilege_level": "database_access",
        "escalation_method": "credential_reuse_ssh",
        "why_possible": "Database credentials valid for SSH authentication",
        "recognition_signs": [
          "database_credentials_extracted",
          "ssh_service_available",
          "credential_reuse_patterns",
          "user_account_enumeration_via_sqli"
        ],
        "exploitation_path": "SQL Injection → Database Creds → SSH Access"
      },
      {
        "privilege_level": "www-data",
        "escalation_method": "sudo_command_injection",
        "why_possible": "www-data has full sudo rights without password",
        "recognition_signs": [
          "sudo_all_privileges",
          "web_application_firewall_integration",
          "header_processing_vulnerabilities",
          "privileged_script_execution"
        ],
        "exploitation_path": "Command Injection → www-data shell → sudo su → root"
      }
    ]
  },
  "decision_tree": {
    "decision_points": [
      {
        "step": 1,
        "situation": "Only port 80 open on initial scan",
        "decision": "Focus on web application enumeration and vulnerability discovery",
        "reasoning": "Limited attack surface requires thorough web app testing",
        "confidence": 0.9,
        "alternatives": [
          {
            "option": "udp_scan",
            "when": "if web enumeration fails"
          },
          {
            "option": "service_version_detection",
            "when": "always run in parallel"
          }
        ],
        "success_indicators": [
          "web_application_responds",
          "technology_stack_identified",
          "forms_or_inputs_found"
        ],
        "next_decision": "analyze_web_functionality"
      },
      {
        "step": 2,
        "situation": "Found PHP application with user input forms",
        "decision": "Test for SQL injection with careful payload crafting",
        "reasoning": "Form submissions to PHP backend suggest database interaction",
        "confidence": 0.85,
        "prerequisites": [
          "form_inputs_identified",
          "post_requests_intercepted"
        ],
        "success_indicators": [
          "different_responses_to_payloads",
          "error_message_variations"
        ],
        "failure_fallbacks": [
          "directory_bruteforce",
          "parameter_fuzzing",
          "file_inclusion_tests"
        ]
      },
      {
        "step": 3,
        "situation": "Basic SQL injection payloads filtered by WAF",
        "decision": "Identify WAF bypass techniques and alternative injection methods",
        "reasoning": "Filtering suggests vulnerability exists but requires evasion",
        "confidence": 0.75,
        "prerequisites": [
          "sql_injection_suspected",
          "filtering_detected"
        ],
        "success_indicators": [
          "payload_bypasses_filter",
          "data_extraction_successful"
        ],
        "failure_fallbacks": [
          "alternative_injection_types",
          "encoding_techniques",
          "time_based_blind"
        ]
      },
      {
        "step": 4,
        "situation": "UNION SQL injection successful with data extraction",
        "decision": "Enumerate database for credentials and system information",
        "reasoning": "UNION injection allows direct data extraction from database",
        "confidence": 0.95,
        "prerequisites": [
          "union_injection_confirmed",
          "column_count_determined"
        ],
        "success_indicators": [
          "database_schema_enumerated",
          "sensitive_data_found"
        ],
        "failure_fallbacks": [
          "file_read_attempts",
          "privilege_escalation_enum"
        ]
      }
    ],
    "branching_logic": {
      "if_sql_injection_succeeds": {
        "action": "enumerate_database_systematically",
        "tools": [
          "curl",
          "custom_scripts",
          "sqlmap_if_waf_bypassed"
        ],
        "next_phase": "credential_extraction_and_access"
      },
      "if_waf_detected": {
        "action": "develop_bypass_techniques",
        "alternatives": [
          "encoding",
          "alternative_syntax",
          "comment_variations"
        ],
        "decision_criteria": "based_on_filter_behavior_analysis"
      },
      "if_credentials_found": {
        "action": "attempt_service_access",
        "purpose": "gain_initial_foothold",
        "tools": [
          "ssh",
          "service_specific_clients"
        ]
      },
      "if_new_services_appear": {
        "action": "rescan_and_enumerate_new_attack_surface",
        "purpose": "identify_additional_entry_points",
        "tools": [
          "nmap",
          "service_enumeration"
        ]
      }
    },
    "optimization_rules": [
      {
        "rule": "always_test_union_injection_when_basic_sqli_confirmed",
        "reasoning": "union_allows_direct_data_extraction_vs_blind_techniques",
        "applicability": "confirmed_sql_injection_vulnerability"
      },
      {
        "rule": "analyze_response_differences_carefully_when_waf_present",
        "reasoning": "subtle_differences_indicate_successful_bypass_or_injection",
        "applicability": "filtered_or_waf_protected_applications"
      },
      {
        "rule": "enumerate_information_schema_systematically",
        "reasoning": "provides_complete_database_structure_for_targeted_extraction",
        "applicability": "union_sql_injection_successful"
      },
      {
        "rule": "rescan_ports_after_significant_application_state_changes",
        "reasoning": "applications_may_dynamically_open_services_based_on_actions",
        "applicability": "interactive_applications_with_authentication"
      }
    ]
  },
  "applicability_rules": {
    "technique_rules": [
      {
        "technique": "Union SQL Injection",
        "mitre_id": "T1190",
        "required_services": [
          "http",
          "mysql",
          "php"
        ],
        "required_ports": [
          80,
          443
        ],
        "os_requirements": [
          "linux",
          "windows"
        ],
        "environmental_prerequisites": [
          "web_application_with_database",
          "user_input_parameters",
          "php_mysql_backend",
          "injectable_sql_parameters"
        ],
        "success_indicators": [
          "different_responses_to_sql_syntax",
          "error_message_variations",
          "response_length_differences",
          "successful_union_select_execution"
        ],
        "incompatible_with": [
          "prepared_statements_only",
          "strict_input_validation",
          "complete_sql_filtering"
        ],
        "confidence_boosters": [
          "php_session_cookies_present",
          "post_parameters_accepted",
          "database_error_leakage",
          "inconsistent_filtering"
        ],
        "typical_success_rate": 0.75,
        "estimated_time": "15-45 minutes"
      },
      {
        "technique": "Command Injection via Headers",
        "mitre_id": "T1059.004",
        "required_services": [
          "http",
          "php"
        ],
        "required_ports": [
          80,
          443
        ],
        "os_requirements": [
          "linux"
        ],
        "environmental_prerequisites": [
          "web_application_processing_headers",
          "system_command_execution",
          "insufficient_header_validation",
          "privileged_web_process"
        ],
        "success_indicators": [
          "x_forwarded_for_processing",
          "system_command_responses",
          "firewall_modification_capability",
          "sudo_privileges_detected"
        ],
        "incompatible_with": [
          "header_sanitization",
          "restricted_system_calls",
          "containerized_environment"
        ],
        "confidence_boosters": [
          "firewall_php_endpoint_exists",
          "nginx_reverse_proxy_setup",
          "sudo_nopasswd_configuration",
          "www_data_privileged_access"
        ],
        "typical_success_rate": 0.65,
        "estimated_time": "10-30 minutes"
      },
      {
        "technique": "SSH Credential Reuse",
        "mitre_id": "T1078.003",
        "required_services": [
          "ssh"
        ],
        "required_ports": [
          22
        ],
        "os_requirements": [
          "linux"
        ],
        "environmental_prerequisites": [
          "ssh_service_accessible",
          "database_credentials_obtained",
          "password_reuse_practices",
          "valid_system_accounts"
        ],
        "success_indicators": [
          "database_password_extracted",
          "user_enumeration_successful",
          "ssh_authentication_accepted",
          "shell_access_granted"
        ],
        "incompatible_with": [
          "key_only_authentication",
          "account_lockout_policies",
          "network_segmentation"
        ],
        "confidence_boosters": [
          "file_read_via_sql_injection",
          "passwd_file_accessible",
          "weak_password_policies",
          "shared_service_accounts"
        ],
        "typical_success_rate": 0.45,
        "estimated_time": "5-15 minutes"
      }
    ],
    "environmental_detectors": {
      "php_web_application": {
        "port_indicators": [
          80,
          443
        ],
        "service_indicators": [
          "http",
          "https",
          "nginx",
          "apache"
        ],
        "banner_indicators": [
          "PHP",
          "PHPSESSID",
          "nginx",
          "X-Powered-By"
        ],
        "confidence_threshold": 0.85
      },
      "mysql_database": {
        "port_indicators": [
          3306
        ],
        "service_indicators": [
          "mysql"
        ],
        "banner_indicators": [
          "MySQL",
          "MariaDB"
        ],
        "confidence_threshold": 0.9
      },
      "linux_system": {
        "port_indicators": [
          22
        ],
        "service_indicators": [
          "ssh",
          "OpenSSH"
        ],
        "banner_indicators": [
          "Ubuntu",
          "Linux",
          "OpenSSH"
        ],
        "confidence_threshold": 0.8
      }
    },
    "attack_prioritization": {
      "high_priority": [
        {
          "attack": "sql_injection_detection",
          "when": "php_web_application_detected",
          "reason": "high_success_rate_for_file_read_and_data_extraction"
        },
        {
          "attack": "directory_bruteforce",
          "when": "web_service_detected",
          "reason": "reveals_additional_endpoints_like_firewall_php"
        }
      ],
      "medium_priority": [
        {
          "attack": "header_injection_testing",
          "when": "nginx_proxy_detected",
          "reason": "x_forwarded_for_commonly_processed_unsafely"
        },
        {
          "attack": "credential_reuse_testing",
          "when": "database_credentials_obtained",
          "reason": "password_reuse_common_in_ctf_environments"
        }
      ]
    }
  },
  "technique_intelligence": {
    "techniques": [
      {
        "name": "Union SQL Injection",
        "mitre_id": "T1190",
        "category": "initial_access",
        "phase": "exploitation",
        "tools_used": [
          {
            "name": "curl",
            "command_template": "curl -s -X POST {target_url} -d \"player=' union select {query};-- -\"",
            "actual_command": "curl -s -X POST http://10.10.11.128 -d \"player=' union select user();-- -\"",
            "output_pattern": "Sorry, {result} you are not eligible",
            "effectiveness_rating": 5,
            "reliability": 0.95
          }
        ],
        "prerequisites": [
          "web_application_with_sql_backend",
          "injectable_parameter_identified",
          "basic_waf_bypass_knowledge"
        ],
        "success_indicators": [
          "database_user_extracted",
          "table_enumeration_successful",
          "file_read_capability_confirmed"
        ],
        "common_failures": [
          "waf_blocking_common_payloads",
          "insufficient_database_privileges",
          "query_structure_mismatch"
        ],
        "follow_up_techniques": [
          "database_enumeration",
          "file_system_access",
          "credential_extraction"
        ],
        "time_investment": "30-60 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "SQL File Read",
        "mitre_id": "T1005",
        "category": "collection",
        "phase": "exploitation",
        "tools_used": [
          {
            "name": "curl",
            "command_template": "curl -s -X POST {target_url} -d \"player=' union select load_file('{file_path}');-- -\"",
            "actual_command": "curl -s -X POST http://10.10.11.128 -d \"player=' union select load_file('/etc/passwd');-- -\"",
            "output_pattern": "File contents in response",
            "effectiveness_rating": 5,
            "reliability": 0.9
          }
        ],
        "prerequisites": [
          "sql_injection_established",
          "file_read_privileges_available",
          "target_file_paths_known"
        ],
        "success_indicators": [
          "system_files_readable",
          "application_source_code_extracted",
          "configuration_files_accessed"
        ],
        "common_failures": [
          "insufficient_mysql_privileges",
          "file_path_restrictions",
          "secure_file_priv_limitations"
        ],
        "follow_up_techniques": [
          "credential_harvesting",
          "source_code_analysis",
          "privilege_escalation_planning"
        ],
        "time_investment": "15-30 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "Credential Reuse Attack",
        "mitre_id": "T1078",
        "category": "initial_access",
        "phase": "lateral_movement",
        "tools_used": [
          {
            "name": "sshpass",
            "command_template": "sshpass -p {password} ssh {username}@{target_ip}",
            "actual_command": "sshpass -p uhc-11qual-global-pw ssh uhc@10.10.11.128",
            "output_pattern": "SSH shell established",
            "effectiveness_rating": 4,
            "reliability": 0.85
          }
        ],
        "prerequisites": [
          "credentials_obtained_from_previous_step",
          "ssh_service_accessible",
          "username_enumeration_completed"
        ],
        "success_indicators": [
          "successful_ssh_authentication",
          "shell_access_established",
          "user_flag_accessible"
        ],
        "common_failures": [
          "password_not_reused_for_ssh",
          "account_locked_or_disabled",
          "ssh_key_authentication_required"
        ],
        "follow_up_techniques": [
          "local_enumeration",
          "privilege_escalation",
          "lateral_movement"
        ],
        "time_investment": "5-10 minutes",
        "skill_level": "beginner"
      }
    ],
    "tool_effectiveness": [
      {
        "tool": "curl",
        "use_case": "sql_injection_exploitation",
        "effectiveness_rating": 5,
        "reliability": 0.95,
        "learning_curve": "low",
        "essential_for": [
          "web_application_testing"
        ],
        "alternatives": [
          "sqlmap",
          "burp_suite",
          "manual_browser"
        ],
        "best_practices": [
          "use_proper_url_encoding",
          "implement_response_parsing",
          "test_payloads_incrementally"
        ]
      },
      {
        "tool": "sshpass",
        "use_case": "automated_ssh_authentication",
        "effectiveness_rating": 4,
        "reliability": 0.9,
        "learning_curve": "low",
        "essential_for": [
          "credential_testing"
        ],
        "alternatives": [
          "expect_scripts",
          "manual_ssh",
          "hydra"
        ],
        "best_practices": [
          "avoid_in_production_environments",
          "use_for_testing_only",
          "prefer_key_based_authentication"
        ]
      }
    ],
    "command_sequences": [
      {
        "sequence_name": "union_sqli_to_ssh_access",
        "steps": [
          {
            "step": 1,
            "command": "curl -s -X POST http://10.10.11.128 -d \"player=' union select user();-- -\"",
            "purpose": "Confirm SQL injection vulnerability",
            "expected_output": "Database user: uhc@localhost"
          },
          {
            "step": 2,
            "command": "curl -s -X POST http://10.10.11.128 -d \"player=' union select group_concat(SCHEMA_NAME) from INFORMATION_SCHEMA.schemata;-- -\"",
            "purpose": "Enumerate available databases",
            "expected_output": "Database list including november"
          },
          {
            "step": 3,
            "command": "curl -s -X POST http://10.10.11.128 -d \"player=' union select group_concat(one) from flag;-- -\"",
            "purpose": "Extract flag from database",
            "expected_output": "Flag: UHC{F1rst_5tep_2_Qualify}"
          },
          {
            "step": 4,
            "command": "curl -s -X POST http://10.10.11.128 -d \"player=' union select load_file('/var/www/html/config.php');-- -\"",
            "purpose": "Read database configuration file",
            "expected_output": "Database credentials revealed"
          },
          {
            "step": 5,
            "command": "sshpass -p uhc-11qual-global-pw ssh uhc@10.10.11.128",
            "purpose": "Authenticate via SSH with extracted credentials",
            "expected_output": "SSH shell as uhc user"
          }
        ],
        "success_rate": 0.92,
        "typical_duration": "45-90 minutes"
      }
    ]
  },
  "metadata": {
    "basic_metadata": {
      "name": "Union",
      "difficulty": "Medium",
      "os": "Linux (Ubuntu)",
      "platform": "HackTheBox",
      "release_date": "2021-11-22",
      "author": "ippsec",
      "estimated_time": "60-90 minutes"
    },
    "intelligence_metadata": {
      "attack_complexity": "medium",
      "skill_level_required": "intermediate",
      "primary_attack_vectors": [
        "sql_injection",
        "command_injection"
      ],
      "key_vulnerabilities": [
        "union_sql_injection",
        "x_forwarded_for_injection",
        "sudo_misconfiguration"
      ],
      "environment_type": "web_application_server",
      "real_world_relevance": "high",
      "learning_value": [
        "advanced_sql_injection",
        "header_injection",
        "privilege_escalation"
      ],
      "prerequisite_knowledge": [
        "sql_injection_basics",
        "linux_fundamentals",
        "web_application_security"
      ]
    },
    "categorization": {
      "primary_category": "web_exploitation",
      "subcategories": [
        "sql_injection",
        "command_injection",
        "privilege_escalation"
      ],
      "attack_types": [
        "initial_access",
        "credential_access",
        "privilege_escalation"
      ],
      "defensive_lessons": [
        "input_validation",
        "header_sanitization",
        "sudo_hardening",
        "waf_bypass_prevention"
      ]
    },
    "similarity_markers": {
      "similar_boxes": [
        "Admirer",
        "Schooled",
        "Previse"
      ],
      "similarity_reasons": [
        "web_exploitation",
        "sql_injection",
        "file_read_capabilities"
      ],
      "unique_aspects": [
        "x_forwarded_for_exploitation",
        "uhc_qualifier_theme",
        "firewall_modification_vector"
      ],
      "difficulty_factors": [
        "tricky_sql_injection_discovery",
        "header_injection_technique",
        "multiple_exploitation_stages"
      ]
    }
  },
  "extraction_metadata": {
    "parse_date": "2025-07-04T13:06:00.321221",
    "original_file": "0xdf_writeups/Htb Union.md",
    "content_length": 20447,
    "extraction_version": "2.0-claude",
    "model_used": "claude-sonnet-4-20250514"
  },
  "intelligence_confidence": 0.9166666666666667,
  "quality_breakdown": {
    "scenario_uniqueness": 1.0,
    "success_logic_clarity": 0.6666666666666666,
    "applicability_completeness": 1.0,
    "decision_tree_depth": 1.0,
    "technique_actionability": 1.0
  }
}