{
  "writeup_id": "Htb_Retro",
  "scenario_fingerprint": {
    "scenario_name": "windows_domain_controller_machine_account_esc",
    "primary_services": [
      "smb",
      "ldap",
      "kerberos",
      "dns",
      "adcs"
    ],
    "port_signature": "53+88+389+445+636",
    "service_combination": "dns+kerberos+ldap+smb+adcs",
    "os_family": "windows_server",
    "environment_type": "active_directory",
    "entry_vector": "smb_guest_access",
    "privilege_path": "trainee_account_to_machine_account_to_esc_to_admin",
    "attack_complexity": "easy",
    "estimated_time": "30-45 minutes",
    "scenario_confidence": 0.92,
    "distinguishing_factors": [
      "guest_smb_access",
      "trainee_account_weak_password",
      "machine_account_pre_windows_2000_password",
      "vulnerable_adcs_template"
    ],
    "environmental_clues": [
      "domain_controller_role",
      "smb_shares_with_notes",
      "trainee_documentation",
      "certificate_services_present"
    ],
    "similar_scenarios": [
      "escape_htb_medium",
      "authority_htb_medium"
    ],
    "unique_aspects": [
      "username_as_password_pattern",
      "machine_account_exploitation",
      "esc_certificate_attack",
      "pre_windows_2000_compatibility"
    ]
  },
  "success_patterns": {
    "success_factors": [
      {
        "technique": "Guest Account SMB Access",
        "success_reason": "Guest account enabled with null password allowing share enumeration",
        "prerequisite_indicators": [
          "smb_service_available",
          "guest_account_enabled",
          "null_session_allowed"
        ],
        "recognition_patterns": [
          "netexec fails without creds but succeeds with guest",
          "guest account accepts empty password",
          "shares enumerable with guest access"
        ],
        "failure_modes": [
          "guest_account_disabled",
          "null_sessions_blocked",
          "smb_signing_prevents_access"
        ],
        "environmental_factors": [
          "legacy_smb_configuration",
          "insufficient_hardening",
          "default_guest_settings"
        ],
        "success_probability": 0.65,
        "typical_timeframe": "2-5 minutes"
      },
      {
        "technique": "RID Cycling",
        "success_reason": "Guest account has sufficient privileges to enumerate domain users via RID brute force",
        "prerequisite_indicators": [
          "guest_account_access",
          "domain_controller_accessible",
          "rid_enumeration_allowed"
        ],
        "recognition_patterns": [
          "netexec --rid-brute returns user list",
          "sequential RID enumeration works",
          "domain users and groups revealed"
        ],
        "failure_modes": [
          "rid_enumeration_blocked",
          "insufficient_guest_privileges",
          "access_controls_prevent_enumeration"
        ],
        "environmental_factors": [
          "default_domain_permissions",
          "legacy_compatibility_settings",
          "insufficient_access_controls"
        ],
        "success_probability": 0.72,
        "typical_timeframe": "3-8 minutes"
      },
      {
        "technique": "Information Disclosure via SMB Shares",
        "success_reason": "Custom shares contain sensitive information accessible to guest account",
        "prerequisite_indicators": [
          "custom_smb_shares_exist",
          "guest_read_permissions",
          "sensitive_files_present"
        ],
        "recognition_patterns": [
          "non-standard share names (Trainees, Notes)",
          "readable files in shares",
          "administrative notes or documentation"
        ],
        "failure_modes": [
          "no_custom_shares",
          "proper_access_controls",
          "no_sensitive_information"
        ],
        "environmental_factors": [
          "poor_information_security_practices",
          "convenience_over_security",
          "inadequate_file_permissions"
        ],
        "success_probability": 0.58,
        "typical_timeframe": "5-10 minutes"
      }
    ],
    "critical_discoveries": [
      {
        "discovery": "Trainee account password policy hint",
        "discovery_method": "SMB share file analysis",
        "why_critical": "Reveals weak password practices for trainee accounts",
        "how_to_recognize": [
          "administrative notes about password issues",
          "mentions of shared accounts",
          "password reset complaints"
        ],
        "follow_up_actions": [
          "enumerate_trainee_usernames",
          "test_username_as_password",
          "attempt_common_weak_passwords"
        ]
      },
      {
        "discovery": "Domain user enumeration via RID cycling",
        "discovery_method": "netexec --rid-brute with guest account",
        "why_critical": "Provides complete user list for further attacks",
        "how_to_recognize": [
          "sequential RID numbers revealing users",
          "domain structure exposed",
          "service accounts identified"
        ],
        "follow_up_actions": [
          "compile_username_list",
          "attempt_asreproast",
          "test_weak_passwords"
        ]
      }
    ],
    "escalation_keys": [
      {
        "privilege_level": "guest_account",
        "escalation_method": "Information_Gathering_to_Credential_Attack",
        "why_possible": "Guest access reveals user enumeration and password policy weaknesses",
        "recognition_signs": [
          "guest_smb_access_available",
          "custom_shares_with_information",
          "rid_enumeration_possible"
        ],
        "exploitation_path": "Guest SMB → User Enumeration → Password Attacks → Valid Credentials"
      }
    ]
  },
  "decision_tree": {
    "decision_points": [
      {
        "step": 1,
        "situation": "Found ports 53,88,389,445 open on Windows host",
        "decision": "Identify as Domain Controller and enumerate SMB shares first",
        "reasoning": "Port combination indicates AD DC, SMB often has anonymous/guest access",
        "confidence": 0.95,
        "alternatives": [
          {
            "option": "kerberos_enumeration",
            "when": "if smb fails"
          },
          {
            "option": "ldap_enumeration",
            "when": "if anonymous ldap access"
          }
        ],
        "success_indicators": [
          "smb_shares_enumerated",
          "domain_name_discovered",
          "guest_access_confirmed"
        ],
        "next_decision": "enumerate_accessible_shares"
      },
      {
        "step": 2,
        "situation": "Guest account has read access to SMB shares",
        "decision": "Enumerate shares and perform RID cycling for user discovery",
        "reasoning": "Guest access often reveals sensitive information and user enumeration",
        "confidence": 0.9,
        "prerequisites": [
          "guest_smb_access"
        ],
        "success_indicators": [
          "files_found_in_shares",
          "users_enumerated_via_rid"
        ],
        "next_decision": "analyze_discovered_information"
      },
      {
        "step": 3,
        "situation": "Found note about trainee account using username as password",
        "decision": "Test credential pattern trainee:trainee based on discovered hint",
        "reasoning": "Direct hint in accessible file suggests weak password policy",
        "confidence": 0.85,
        "prerequisites": [
          "trainee_user_identified",
          "password_hint_found"
        ],
        "success_indicators": [
          "authentication_successful"
        ],
        "failure_fallbacks": [
          "password_spraying",
          "asreproast",
          "kerberoasting"
        ]
      },
      {
        "step": 4,
        "situation": "Valid domain credentials obtained",
        "decision": "Run BloodHound enumeration to identify privilege escalation paths",
        "reasoning": "Essential for mapping AD attack paths and finding vulnerabilities",
        "confidence": 0.95,
        "prerequisites": [
          "domain_credentials_valid"
        ],
        "success_indicators": [
          "bloodhound_data_collected",
          "attack_paths_identified"
        ],
        "next_decision": "identify_certificate_services_vulnerabilities"
      },
      {
        "step": 5,
        "situation": "ADCS environment detected with potential ESC vulnerabilities",
        "decision": "Enumerate certificate templates for ESC attacks",
        "reasoning": "ADCS often misconfigured and provides direct path to domain admin",
        "confidence": 0.8,
        "prerequisites": [
          "adcs_detected",
          "domain_user_access"
        ],
        "success_indicators": [
          "vulnerable_templates_found",
          "esc_attack_possible"
        ],
        "next_decision": "execute_certificate_attack"
      }
    ],
    "branching_logic": {
      "if_smb_guest_access_succeeds": {
        "action": "enumerate_shares_and_users",
        "tools": [
          "netexec",
          "smbclient",
          "rid-brute"
        ],
        "next_phase": "credential_discovery"
      },
      "if_password_hint_found": {
        "action": "test_credential_patterns",
        "patterns": [
          "username_as_password",
          "common_weak_passwords"
        ],
        "next_phase": "domain_authentication"
      },
      "if_domain_credentials_obtained": {
        "action": "bloodhound_enumeration",
        "tools": [
          "bloodhound-python",
          "sharphound"
        ],
        "next_phase": "privilege_escalation_identification"
      },
      "if_adcs_vulnerable": {
        "action": "execute_esc_attack",
        "tools": [
          "certipy",
          "rubeus"
        ],
        "target": "domain_admin_access"
      }
    },
    "optimization_rules": [
      {
        "rule": "always_try_guest_smb_access_on_dc",
        "reasoning": "high_success_rate_and_often_reveals_sensitive_information",
        "applicability": "domain_controller_environments"
      },
      {
        "rule": "prioritize_file_content_analysis_for_credential_hints",
        "reasoning": "direct_hints_often_more_reliable_than_brute_force",
        "applicability": "accessible_documentation_found"
      },
      {
        "rule": "run_bloodhound_immediately_after_domain_access",
        "reasoning": "essential_for_identifying_privilege_escalation_paths",
        "applicability": "any_domain_user_credentials_obtained"
      },
      {
        "rule": "check_for_adcs_when_cert_publishers_group_exists",
        "reasoning": "indicates_certificate_services_and_potential_esc_vulnerabilities",
        "applicability": "cert_publishers_group_enumerated"
      }
    ]
  },
  "applicability_rules": {
    "technique_rules": [
      {
        "technique": "ASREPRoast",
        "mitre_id": "T1558.004",
        "required_services": [
          "kerberos"
        ],
        "required_ports": [
          88
        ],
        "os_requirements": [
          "windows"
        ],
        "environmental_prerequisites": [
          "active_directory_domain",
          "kerberos_authentication_enabled",
          "accounts_without_preauth_exist"
        ],
        "success_indicators": [
          "GetNPUsers_returns_hashes",
          "domain_controller_accessible",
          "service_accounts_present"
        ],
        "incompatible_with": [
          "kerberos_disabled",
          "all_accounts_require_preauth",
          "network_isolation"
        ],
        "confidence_boosters": [
          "service_account_naming_patterns",
          "default_ad_configuration",
          "legacy_exchange_services"
        ],
        "typical_success_rate": 0.87,
        "estimated_time": "5-15 minutes"
      },
      {
        "technique": "SMB Anonymous Enumeration",
        "mitre_id": "T1135",
        "required_services": [
          "smb"
        ],
        "required_ports": [
          445,
          139
        ],
        "os_requirements": [
          "windows"
        ],
        "environmental_prerequisites": [
          "smb_service_enabled",
          "guest_account_enabled_or_null_sessions"
        ],
        "success_indicators": [
          "shares_enumerated",
          "guest_authentication_successful",
          "readable_shares_found"
        ],
        "incompatible_with": [
          "smb_disabled",
          "guest_account_disabled",
          "network_isolation"
        ],
        "confidence_boosters": [
          "custom_share_names",
          "default_configurations",
          "legacy_windows_versions"
        ],
        "typical_success_rate": 0.75,
        "estimated_time": "2-5 minutes"
      },
      {
        "technique": "ADCS ESC Attack",
        "mitre_id": "T1649",
        "required_services": [
          "adcs"
        ],
        "required_ports": [
          135,
          445
        ],
        "os_requirements": [
          "windows"
        ],
        "environmental_prerequisites": [
          "active_directory_certificate_services",
          "vulnerable_certificate_templates",
          "domain_credentials_available"
        ],
        "success_indicators": [
          "vulnerable_templates_found",
          "certificate_request_successful",
          "authentication_with_certificate"
        ],
        "incompatible_with": [
          "adcs_not_installed",
          "secure_template_configurations",
          "certificate_enrollment_restrictions"
        ],
        "confidence_boosters": [
          "default_template_configurations",
          "legacy_adcs_installations",
          "machine_account_access"
        ],
        "typical_success_rate": 0.82,
        "estimated_time": "10-30 minutes"
      },
      {
        "technique": "Username as Password",
        "mitre_id": "T1110.001",
        "required_services": [
          "any_authentication_service"
        ],
        "required_ports": [
          445,
          3389,
          5985
        ],
        "os_requirements": [
          "any"
        ],
        "environmental_prerequisites": [
          "user_accounts_identified",
          "weak_password_policies",
          "default_or_trainee_accounts"
        ],
        "success_indicators": [
          "successful_authentication",
          "account_enumeration_possible",
          "trainee_or_service_accounts_present"
        ],
        "incompatible_with": [
          "strong_password_policies",
          "account_lockout_enabled",
          "no_user_enumeration"
        ],
        "confidence_boosters": [
          "trainee_account_references",
          "service_account_naming_patterns",
          "legacy_systems"
        ],
        "typical_success_rate": 0.65,
        "estimated_time": "5-10 minutes"
      }
    ],
    "environmental_detectors": {
      "active_directory": {
        "port_indicators": [
          53,
          88,
          389,
          445,
          3268,
          636,
          3269
        ],
        "service_indicators": [
          "kerberos",
          "ldap",
          "smb",
          "dns"
        ],
        "banner_indicators": [
          "Active Directory",
          "Windows Server",
          "Domain Controller"
        ],
        "confidence_threshold": 0.95
      },
      "adcs_present": {
        "port_indicators": [
          135,
          445
        ],
        "service_indicators": [
          "msrpc",
          "microsoft-ds"
        ],
        "banner_indicators": [
          "Certificate Services",
          "ADCS"
        ],
        "confidence_threshold": 0.8
      },
      "smb_service": {
        "port_indicators": [
          445,
          139
        ],
        "service_indicators": [
          "microsoft-ds",
          "netbios-ssn"
        ],
        "banner_indicators": [
          "SMB",
          "CIFS"
        ],
        "confidence_threshold": 0.9
      }
    },
    "attack_prioritization": {
      "high_priority": [
        {
          "attack": "smb_anonymous_enumeration",
          "when": "smb_service_detected",
          "reason": "often_reveals_usernames_and_shares_no_creds_needed"
        },
        {
          "attack": "asreproast",
          "when": "active_directory_detected",
          "reason": "high_success_rate_no_creds_needed"
        },
        {
          "attack": "username_as_password",
          "when": "trainee_accounts_mentioned",
          "reason": "common_weak_configuration_quick_win"
        }
      ],
      "medium_priority": [
        {
          "attack": "adcs_esc_attack",
          "when": "active_directory_and_machine_account_access",
          "reason": "high_impact_but_requires_initial_access"
        }
      ]
    }
  },
  "technique_intelligence": {
    "techniques": [
      {
        "name": "SMB Guest Access Enumeration",
        "mitre_id": "T1135",
        "category": "discovery",
        "phase": "initial_access",
        "tools_used": [
          {
            "name": "netexec",
            "command_template": "netexec smb {target} -u guest -p '' --shares",
            "actual_command": "netexec smb dc.retro.vl -u guest -p '' --shares",
            "output_pattern": "Share permissions and access levels",
            "effectiveness_rating": 5,
            "reliability": 0.9
          },
          {
            "name": "smbclient",
            "command_template": "smbclient //{target}/{share} -U 'guest%'",
            "actual_command": "smbclient //dc.retro.vl/Trainees -U 'guest%'",
            "success_factors": [
              "guest_account_enabled",
              "readable_shares_available"
            ],
            "effectiveness_rating": 4
          }
        ],
        "prerequisites": [
          "smb_service_accessible",
          "guest_account_enabled",
          "shares_with_guest_access"
        ],
        "success_indicators": [
          "shares_enumerated_successfully",
          "files_accessible_without_credentials",
          "information_disclosure_achieved"
        ],
        "common_failures": [
          "guest_account_disabled",
          "no_accessible_shares",
          "network_connectivity_issues"
        ],
        "follow_up_techniques": [
          "credential_guessing",
          "information_gathering",
          "user_enumeration"
        ],
        "time_investment": "5-15 minutes",
        "skill_level": "beginner"
      },
      {
        "name": "RID Cycling",
        "mitre_id": "T1087.002",
        "category": "discovery",
        "phase": "reconnaissance",
        "tools_used": [
          {
            "name": "netexec",
            "command_template": "netexec smb {target} -u {username} -p {password} --rid-brute",
            "actual_command": "netexec smb dc.retro.vl -u guest -p '' --rid-brute",
            "output_pattern": "RID: DOMAIN\\username (SidType)",
            "effectiveness_rating": 5,
            "reliability": 0.95
          }
        ],
        "prerequisites": [
          "valid_domain_credentials",
          "smb_access_available",
          "domain_controller_accessible"
        ],
        "success_indicators": [
          "user_accounts_enumerated",
          "machine_accounts_discovered",
          "group_memberships_identified"
        ],
        "common_failures": [
          "insufficient_privileges",
          "rid_cycling_blocked",
          "authentication_failures"
        ],
        "follow_up_techniques": [
          "credential_guessing",
          "asreproasting",
          "kerberoasting"
        ],
        "time_investment": "2-10 minutes",
        "skill_level": "beginner"
      },
      {
        "name": "Weak Password Guessing",
        "mitre_id": "T1110.001",
        "category": "credential_access",
        "phase": "initial_access",
        "tools_used": [
          {
            "name": "netexec",
            "command_template": "netexec smb {target} -u {username} -p {password}",
            "actual_command": "netexec smb dc.retro.vl -u trainee -p trainee",
            "output_pattern": "[+] domain\\username:password",
            "effectiveness_rating": 4,
            "reliability": 0.7
          }
        ],
        "prerequisites": [
          "username_known",
          "weak_password_policy",
          "common_password_patterns"
        ],
        "success_indicators": [
          "successful_authentication",
          "credential_validation_positive",
          "increased_access_privileges"
        ],
        "common_failures": [
          "strong_password_policy",
          "account_lockout_mechanisms",
          "uncommon_password_patterns"
        ],
        "follow_up_techniques": [
          "authenticated_enumeration",
          "privilege_escalation",
          "lateral_movement"
        ],
        "time_investment": "1-5 minutes",
        "skill_level": "beginner"
      },
      {
        "name": "Machine Account Password Attack",
        "mitre_id": "T1558",
        "category": "credential_access",
        "phase": "privilege_escalation",
        "tools_used": [
          {
            "name": "netexec",
            "command_template": "netexec smb {target} -u '{machine_account}$' -p '{machine_account}'",
            "actual_command": "netexec smb dc.retro.vl -u 'BANKING$' -p 'BANKING'",
            "output_pattern": "Pre-Windows 2000 compatible machine account",
            "effectiveness_rating": 3,
            "reliability": 0.6
          }
        ],
        "prerequisites": [
          "machine_account_identified",
          "pre_windows_2000_compatibility",
          "weak_machine_account_password"
        ],
        "success_indicators": [
          "machine_account_authentication_successful",
          "elevated_privileges_obtained",
          "domain_access_achieved"
        ],
        "common_failures": [
          "modern_machine_account_passwords",
          "account_disabled",
          "strong_password_policy"
        ],
        "follow_up_techniques": [
          "certificate_template_abuse",
          "esc_attacks",
          "domain_privilege_escalation"
        ],
        "time_investment": "5-15 minutes",
        "skill_level": "intermediate"
      }
    ],
    "tool_effectiveness": [
      {
        "tool": "netexec",
        "use_case": "smb_enumeration_and_authentication",
        "effectiveness_rating": 5,
        "reliability": 0.95,
        "learning_curve": "low",
        "essential_for": [
          "windows_domain_environments"
        ],
        "alternatives": [
          "crackmapexec",
          "smbclient",
          "enum4linux"
        ],
        "best_practices": [
          "try_guest_account_first",
          "enumerate_shares_before_brute_force",
          "use_rid_cycling_for_user_discovery"
        ]
      },
      {
        "tool": "smbclient",
        "use_case": "smb_file_access_and_download",
        "effectiveness_rating": 4,
        "reliability": 0.98,
        "learning_curve": "low",
        "essential_for": [
          "file_extraction",
          "smb_interaction"
        ],
        "alternatives": [
          "mount.cifs",
          "netexec",
          "impacket-smbclient"
        ],
        "best_practices": [
          "download_all_accessible_files",
          "check_file_permissions",
          "look_for_configuration_files"
        ]
      }
    ],
    "command_sequences": [
      {
        "sequence_name": "smb_guest_to_domain_user",
        "steps": [
          {
            "step": 1,
            "command": "netexec smb dc.retro.vl -u guest -p '' --shares",
            "purpose": "Enumerate accessible SMB shares",
            "expected_output": "List of shares with guest access"
          },
          {
            "step": 2,
            "command": "smbclient //dc.retro.vl/Trainees -U 'guest%'",
            "purpose": "Access guest-readable share",
            "expected_output": "SMB shell with file listing"
          },
          {
            "step": 3,
            "command": "netexec smb dc.retro.vl -u guest -p '' --rid-brute",
            "purpose": "Enumerate domain users via RID cycling",
            "expected_output": "List of domain users including trainee"
          },
          {
            "step": 4,
            "command": "netexec smb dc.retro.vl -u trainee -p trainee",
            "purpose": "Test weak password hypothesis",
            "expected_output": "Successful authentication"
          }
        ],
        "success_rate": 0.75,
        "typical_duration": "10-20 minutes"
      }
    ]
  },
  "metadata": {
    "basic_metadata": {
      "name": "Retro",
      "difficulty": "Easy",
      "os": "Windows",
      "platform": "HackTheBox",
      "release_date": "2025-06-24",
      "author": "r0BIT",
      "estimated_time": "45-60 minutes"
    },
    "intelligence_metadata": {
      "attack_complexity": "low",
      "skill_level_required": "beginner",
      "primary_attack_vectors": [
        "smb_enumeration",
        "adcs_exploitation",
        "weak_credentials"
      ],
      "key_vulnerabilities": [
        "weak_machine_account_password",
        "vulnerable_adcs_template",
        "trainee_account_misconfiguration"
      ],
      "environment_type": "corporate_domain_controller",
      "real_world_relevance": "high",
      "learning_value": [
        "adcs_attacks",
        "machine_account_exploitation",
        "smb_enumeration"
      ],
      "prerequisite_knowledge": [
        "basic_ad_concepts",
        "smb_fundamentals",
        "certificate_services"
      ]
    },
    "categorization": {
      "primary_category": "active_directory",
      "subcategories": [
        "adcs_attacks",
        "credential_access",
        "smb_enumeration"
      ],
      "attack_types": [
        "credential_access",
        "privilege_escalation",
        "certificate_abuse"
      ],
      "defensive_lessons": [
        "secure_adcs_templates",
        "machine_account_hardening",
        "smb_share_permissions"
      ]
    },
    "similarity_markers": {
      "similar_boxes": [
        "Escape",
        "Authority",
        "Manager"
      ],
      "similarity_reasons": [
        "adcs_exploitation",
        "ad_environment",
        "certificate_attacks"
      ],
      "unique_aspects": [
        "pre_windows_2000_machine_account",
        "trainee_account_pattern"
      ],
      "difficulty_factors": [
        "straightforward_attack_path",
        "well_known_adcs_techniques"
      ]
    }
  },
  "extraction_metadata": {
    "parse_date": "2025-07-04T13:37:32.316059",
    "original_file": "0xdf_writeups/Htb Retro.md",
    "content_length": 32558,
    "extraction_version": "2.0-claude",
    "model_used": "claude-sonnet-4-20250514"
  },
  "intelligence_confidence": 1.0,
  "quality_breakdown": {
    "scenario_uniqueness": 1.0,
    "success_logic_clarity": 1.0,
    "applicability_completeness": 1.0,
    "decision_tree_depth": 1.0,
    "technique_actionability": 1.0
  }
}