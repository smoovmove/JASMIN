{
  "writeup_id": "Htb_Onetwoseven",
  "scenario_fingerprint": {
    "scenario_name": "linux_hosting_provider_sftp_tunnel",
    "primary_services": [
      "ssh",
      "http",
      "sftp"
    ],
    "port_signature": "22+80+60080",
    "service_combination": "ssh+http+filtered_admin",
    "os_family": "linux",
    "environment_type": "web_hosting_provider",
    "entry_vector": "sftp_tunneling",
    "privilege_path": "sftp_to_webshell_to_apt_mitm",
    "attack_complexity": "hard",
    "estimated_time": "3-4 hours",
    "scenario_confidence": 0.92,
    "distinguishing_factors": [
      "predictable_credential_generation",
      "ip_based_user_creation",
      "sftp_only_access",
      "filtered_admin_port",
      "localhost_privilege_escalation"
    ],
    "environmental_clues": [
      "hosting_provider_signup",
      "chroot_apache_issues",
      "trusted_network_admin_access",
      "apt_update_sudo_permissions"
    ],
    "similar_scenarios": [
      "carrier_htb_hard",
      "poison_htb_medium"
    ],
    "unique_aspects": [
      "md5_ip_based_credentials",
      "sftp_symlink_exploitation",
      "apt_package_mitm_privesc",
      "filtered_port_tunneling"
    ]
  },
  "success_patterns": {
    "success_factors": [
      {
        "technique": "SFTP_Credential_Generation",
        "success_reason": "Predictable credential algorithm based on IP address",
        "prerequisite_indicators": [
          "registration_system_available",
          "credentials_appear_deterministic",
          "base64_hex_patterns_in_credentials"
        ],
        "recognition_patterns": [
          "username format: ots-[base64]",
          "password format: [8-char hex]",
          "same credentials per IP consistently"
        ],
        "failure_modes": [
          "truly_random_generation",
          "server_side_session_tracking",
          "rate_limiting_on_registration"
        ],
        "environmental_factors": [
          "ctf_environment_design",
          "need_for_reproducible_credentials",
          "ip_based_user_separation"
        ],
        "success_probability": 0.95,
        "typical_timeframe": "10-30 minutes"
      },
      {
        "technique": "SFTP_Symlink_Traversal",
        "success_reason": "SFTP allows symlink creation without proper validation",
        "prerequisite_indicators": [
          "sftp_access_available",
          "symlink_command_enabled",
          "chroot_misconfiguration_hints"
        ],
        "recognition_patterns": [
          "ln -s command available in SFTP",
          "ability to create symlinks",
          "references to chroot issues in documentation"
        ],
        "failure_modes": [
          "symlinks_blocked_by_chroot",
          "sftp_restricted_commands",
          "proper_filesystem_isolation"
        ],
        "environmental_factors": [
          "misconfigured_chroot_jail",
          "sftp_server_permissions",
          "filesystem_access_controls"
        ],
        "success_probability": 0.75,
        "typical_timeframe": "15-45 minutes"
      },
      {
        "technique": "SSH_Tunneling_via_SFTP",
        "success_reason": "SSH port forwarding enabled despite shell restrictions",
        "prerequisite_indicators": [
          "ssh_service_available",
          "sftp_access_confirmed",
          "filtered_ports_discovered"
        ],
        "recognition_patterns": [
          "ssh allows sftp but blocks shell",
          "nmap shows filtered high ports",
          "admin panel references localhost access"
        ],
        "failure_modes": [
          "port_forwarding_disabled",
          "complete_ssh_restriction",
          "network_level_blocking"
        ],
        "environmental_factors": [
          "partial_ssh_restrictions",
          "internal_services_on_high_ports",
          "localhost_trust_assumptions"
        ],
        "success_probability": 0.8,
        "typical_timeframe": "20-40 minutes"
      }
    ],
    "critical_discoveries": [
      {
        "discovery": "localhost credentials (ots-yODc2NGQ:f528764d)",
        "discovery_method": "IP-based credential generation algorithm",
        "why_critical": "Provides access to user.txt and enables further enumeration",
        "how_to_recognize": [
          "credential generation follows IP hash pattern",
          "127.0.0.1 generates different credentials",
          "base64 encoding of MD5 hash portions"
        ],
        "follow_up_actions": [
          "connect_via_sftp_with_localhost_creds",
          "enumerate_filesystem_via_symlinks",
          "attempt_ssh_port_forwarding"
        ]
      },
      {
        "discovery": "admin panel on port 60080",
        "discovery_method": "HTML source code analysis",
        "why_critical": "Reveals internal service requiring localhost access",
        "how_to_recognize": [
          "commented HTML references to admin panel",
          "localhost-only access restrictions",
          "filtered port in nmap results"
        ],
        "follow_up_actions": [
          "setup_ssh_tunnel_to_port_60080",
          "access_admin_panel_via_tunnel",
          "enumerate_admin_functionality"
        ]
      }
    ],
    "escalation_keys": [
      {
        "privilege_level": "sftp_user",
        "escalation_method": "symlink_filesystem_traversal",
        "why_possible": "Chroot jail misconfiguration allows symlink creation",
        "recognition_signs": [
          "sftp_symlink_command_available",
          "documentation_mentions_chroot_issues",
          "ability_to_link_outside_home_directory"
        ],
        "exploitation_path": "SFTP symlink → filesystem traversal → credential discovery"
      },
      {
        "privilege_level": "external_user",
        "escalation_method": "ssh_tunnel_to_internal_services",
        "why_possible": "SSH allows port forwarding despite shell restrictions",
        "recognition_signs": [
          "ssh_connection_accepts_port_forwarding",
          "internal_services_on_filtered_ports",
          "localhost_trust_model"
        ],
        "exploitation_path": "SSH tunnel → internal admin panel → privilege escalation"
      }
    ]
  },
  "decision_tree": {
    "decision_points": [
      {
        "step": 1,
        "situation": "Found ports 22,80,60080 on Linux host with hosting service",
        "decision": "Investigate web service and look for account creation mechanism",
        "reasoning": "Hosting service likely provides user accounts with file access",
        "confidence": 0.9,
        "alternatives": [
          {
            "option": "direct_ssh_bruteforce",
            "when": "if no web registration found"
          },
          {
            "option": "web_vulnerability_scan",
            "when": "if standard web app"
          }
        ],
        "success_indicators": [
          "account_registration_available",
          "sftp_credentials_provided",
          "file_upload_capability"
        ],
        "next_decision": "analyze_credential_generation"
      },
      {
        "step": 2,
        "situation": "Discovered predictable credential generation based on IP",
        "decision": "Generate localhost credentials to access internal services",
        "reasoning": "Localhost IP often has special privileges and access to filtered ports",
        "confidence": 0.85,
        "prerequisites": [
          "credential_algorithm_identified",
          "filtered_ports_discovered"
        ],
        "success_indicators": [
          "localhost_sftp_access",
          "user_txt_accessible"
        ],
        "failure_fallbacks": [
          "try_other_internal_ips",
          "enumerate_existing_accounts"
        ]
      },
      {
        "step": 3,
        "situation": "SFTP access obtained but limited shell capabilities",
        "decision": "Exploit symlink functionality to escape chroot restrictions",
        "reasoning": "SFTP symlink commands can bypass directory restrictions in poorly configured chroot",
        "confidence": 0.8,
        "prerequisites": [
          "sftp_access_confirmed",
          "symlink_commands_available"
        ],
        "success_indicators": [
          "filesystem_traversal_successful",
          "sensitive_files_accessible"
        ],
        "failure_fallbacks": [
          "file_upload_attacks",
          "sftp_tunnel_creation"
        ]
      },
      {
        "step": 4,
        "situation": "Symlink traversal reveals admin panel directory and swap files",
        "decision": "Extract credentials from vim swap files",
        "reasoning": "Swap files often contain sensitive information like passwords",
        "confidence": 0.75,
        "prerequisites": [
          "admin_directory_accessible",
          "swap_files_discovered"
        ],
        "success_indicators": [
          "admin_credentials_extracted",
          "admin_panel_accessible"
        ],
        "failure_fallbacks": [
          "config_file_enumeration",
          "log_file_analysis"
        ]
      }
    ],
    "branching_logic": {
      "if_hosting_service_detected": {
        "action": "look_for_account_registration",
        "tools": [
          "web_browser",
          "curl"
        ],
        "next_phase": "credential_analysis"
      },
      "if_predictable_credentials_found": {
        "action": "generate_localhost_credentials",
        "purpose": "access_internal_services",
        "tools": [
          "bash",
          "md5sum",
          "base64"
        ]
      },
      "if_sftp_access_obtained": {
        "action": "test_symlink_capabilities",
        "purpose": "escape_chroot_restrictions",
        "tools": [
          "sftp_client"
        ]
      },
      "if_admin_files_accessible": {
        "action": "extract_sensitive_information",
        "purpose": "gain_admin_panel_access",
        "tools": [
          "vim",
          "file_recovery"
        ]
      }
    },
    "optimization_rules": [
      {
        "rule": "always_test_localhost_credentials_on_hosting_services",
        "reasoning": "localhost_often_has_special_privileges_and_internal_access",
        "applicability": "hosting_provider_environments"
      },
      {
        "rule": "exploit_symlink_functionality_in_restricted_environments",
        "reasoning": "symlinks_often_bypass_chroot_and_directory_restrictions",
        "applicability": "sftp_or_ftp_access_with_limited_shell"
      },
      {
        "rule": "always_check_for_vim_swap_files_in_web_directories",
        "reasoning": "swap_files_frequently_contain_sensitive_credentials",
        "applicability": "web_application_enumeration"
      }
    ]
  },
  "applicability_rules": {
    "technique_rules": [
      {
        "technique": "SFTP_Tunneling",
        "mitre_id": "T1572",
        "required_services": [
          "ssh",
          "sftp"
        ],
        "required_ports": [
          22
        ],
        "os_requirements": [
          "linux",
          "unix"
        ],
        "environmental_prerequisites": [
          "sftp_only_access_configured",
          "ssh_shell_disabled",
          "port_forwarding_enabled"
        ],
        "success_indicators": [
          "sftp_connection_successful",
          "ssh_shell_blocked",
          "internal_services_accessible"
        ],
        "incompatible_with": [
          "ssh_completely_disabled",
          "sftp_chrooted_strict",
          "port_forwarding_disabled"
        ],
        "confidence_boosters": [
          "filtered_high_ports_detected",
          "hosting_service_context",
          "localhost_admin_references"
        ],
        "typical_success_rate": 0.75,
        "estimated_time": "10-20 minutes"
      },
      {
        "technique": "Symlink_File_Read",
        "mitre_id": "T1005",
        "required_services": [
          "sftp",
          "file_system"
        ],
        "required_ports": [
          22
        ],
        "os_requirements": [
          "linux",
          "unix"
        ],
        "environmental_prerequisites": [
          "sftp_access_available",
          "symlink_creation_allowed",
          "target_files_readable"
        ],
        "success_indicators": [
          "symlink_creation_successful",
          "file_contents_accessible",
          "credentials_extracted"
        ],
        "incompatible_with": [
          "symlinks_disabled",
          "strict_chroot_jail",
          "file_permissions_restrictive"
        ],
        "confidence_boosters": [
          "web_application_present",
          "config_files_likely_exist",
          "weak_chroot_implementation"
        ],
        "typical_success_rate": 0.68,
        "estimated_time": "15-30 minutes"
      },
      {
        "technique": "Web_Shell_Upload",
        "mitre_id": "T1505.003",
        "required_services": [
          "http",
          "file_upload"
        ],
        "required_ports": [
          80,
          443
        ],
        "os_requirements": [
          "any"
        ],
        "environmental_prerequisites": [
          "web_application_accessible",
          "file_upload_functionality",
          "insufficient_upload_validation"
        ],
        "success_indicators": [
          "file_upload_successful",
          "web_shell_accessible",
          "command_execution_confirmed"
        ],
        "incompatible_with": [
          "strict_file_validation",
          "upload_disabled",
          "web_application_unavailable"
        ],
        "confidence_boosters": [
          "admin_panel_detected",
          "plugin_upload_feature",
          "weak_validation_logic"
        ],
        "typical_success_rate": 0.82,
        "estimated_time": "5-15 minutes"
      },
      {
        "technique": "Package_Manager_Hijack",
        "mitre_id": "T1195.002",
        "required_services": [
          "package_manager"
        ],
        "required_ports": [
          80,
          443
        ],
        "os_requirements": [
          "linux"
        ],
        "environmental_prerequisites": [
          "sudo_package_manager_access",
          "network_traffic_interceptable",
          "package_repository_accessible"
        ],
        "success_indicators": [
          "mitm_position_established",
          "malicious_package_served",
          "root_access_gained"
        ],
        "incompatible_with": [
          "https_certificate_pinning",
          "package_signing_enforced",
          "network_isolation_strict"
        ],
        "confidence_boosters": [
          "apt_sudo_permissions",
          "debian_based_system",
          "http_package_sources"
        ],
        "typical_success_rate": 0.71,
        "estimated_time": "20-45 minutes"
      }
    ],
    "environmental_detectors": {
      "hosting_service": {
        "port_indicators": [
          22,
          80,
          443
        ],
        "service_indicators": [
          "ssh",
          "sftp",
          "http"
        ],
        "banner_indicators": [
          "hosting",
          "sftp connections only",
          "Apache"
        ],
        "confidence_threshold": 0.8
      },
      "filtered_internal_service": {
        "port_indicators": [
          60080
        ],
        "service_indicators": [
          "filtered"
        ],
        "banner_indicators": [
          "admin",
          "localhost"
        ],
        "confidence_threshold": 0.75
      },
      "debian_linux": {
        "port_indicators": [
          22,
          80
        ],
        "service_indicators": [
          "OpenSSH",
          "Apache"
        ],
        "banner_indicators": [
          "Debian",
          "deb9"
        ],
        "confidence_threshold": 0.9
      }
    },
    "attack_prioritization": {
      "high_priority": [
        {
          "attack": "sftp_enumeration",
          "when": "sftp_only_access_detected",
          "reason": "often_leads_to_tunneling_opportunities"
        },
        {
          "attack": "credential_generation_analysis",
          "when": "predictable_credentials_suspected",
          "reason": "may_reveal_localhost_or_admin_access"
        }
      ],
      "medium_priority": [
        {
          "attack": "symlink_file_read",
          "when": "sftp_access_confirmed",
          "reason": "can_expose_configuration_files"
        },
        {
          "attack": "filtered_port_investigation",
          "when": "filtered_ports_detected",
          "reason": "may_indicate_internal_services"
        }
      ]
    }
  },
  "technique_intelligence": {
    "techniques": [
      {
        "name": "SFTP Symlink Directory Traversal",
        "mitre_id": "T1083",
        "category": "discovery",
        "phase": "lateral_movement",
        "tools_used": [
          {
            "name": "sftp",
            "command_template": "sftp {username}@{target}",
            "actual_command": "sftp ots-mM2Y3Y2U@10.10.10.133",
            "output_pattern": "Connected to {target}",
            "effectiveness_rating": 5,
            "reliability": 0.9
          },
          {
            "name": "symlink",
            "command_template": "symlink {source_path} {link_name}",
            "actual_command": "symlink /etc/passwd passwd",
            "success_factors": [
              "poor_chroot_implementation",
              "sftp_symlink_enabled"
            ],
            "effectiveness_rating": 4
          }
        ],
        "prerequisites": [
          "sftp_access_available",
          "symlink_command_enabled",
          "weak_chroot_implementation"
        ],
        "success_indicators": [
          "symlink_created_successfully",
          "external_files_accessible_via_web",
          "directory_traversal_achieved"
        ],
        "common_failures": [
          "proper_chroot_implementation",
          "symlink_disabled",
          "web_server_blocks_symlinks"
        ],
        "follow_up_techniques": [
          "credential_harvesting",
          "configuration_file_access",
          "source_code_disclosure"
        ],
        "time_investment": "10-20 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "SSH Port Forwarding",
        "mitre_id": "T1572",
        "category": "command_and_control",
        "phase": "lateral_movement",
        "tools_used": [
          {
            "name": "ssh",
            "command_template": "ssh -N -L {local_port}:{target_host}:{target_port} {username}@{ssh_server}",
            "actual_command": "ssh -N -L 60080:127.0.0.1:60080 ots-mM2Y3Y2U@10.10.10.133",
            "output_pattern": "connection_hangs_indicating_success",
            "effectiveness_rating": 5,
            "reliability": 0.95
          }
        ],
        "prerequisites": [
          "ssh_access_available",
          "port_forwarding_not_disabled",
          "target_service_running_locally"
        ],
        "success_indicators": [
          "ssh_connection_established",
          "local_port_accessible",
          "remote_service_reachable"
        ],
        "common_failures": [
          "port_forwarding_disabled",
          "firewall_blocking_connection",
          "service_not_running"
        ],
        "follow_up_techniques": [
          "admin_panel_access",
          "credential_brute_force",
          "service_enumeration"
        ],
        "time_investment": "5-10 minutes",
        "skill_level": "beginner"
      },
      {
        "name": "Credential Generation Algorithm Reverse Engineering",
        "mitre_id": "T1110",
        "category": "credential_access",
        "phase": "initial_access",
        "tools_used": [
          {
            "name": "bash_one_liner",
            "command_template": "IP={target_ip}; echo -n \"Username: ots-\"; echo -n $IP | md5sum | base64 -w0 | cut -c4-11; echo -n \"Password: \"; echo -n $IP | md5sum | cut -c-8",
            "actual_command": "IP=127.0.0.1; echo -n \"Username: ots-\"; echo -n $IP | md5sum | base64 -w0 | cut -c4-11; echo -n \"Password: \"; echo -n $IP | md5sum | cut -c-8",
            "output_pattern": "Username: ots-{base64_hash}\nPassword: {hex_hash}",
            "effectiveness_rating": 5,
            "reliability": 1.0
          }
        ],
        "prerequisites": [
          "predictable_credential_generation",
          "access_to_sample_credentials",
          "understanding_of_hashing_algorithms"
        ],
        "success_indicators": [
          "algorithm_successfully_reversed",
          "credentials_generated_for_target_ips",
          "authentication_successful"
        ],
        "common_failures": [
          "complex_generation_algorithm",
          "additional_salt_or_keys_used",
          "time_based_components"
        ],
        "follow_up_techniques": [
          "credential_validation",
          "service_enumeration",
          "privilege_escalation"
        ],
        "time_investment": "15-30 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "Vim Swap File Recovery",
        "mitre_id": "T1005",
        "category": "collection",
        "phase": "discovery",
        "tools_used": [
          {
            "name": "vim",
            "command_template": "vim {filename}",
            "actual_command": "vim login.php",
            "output_pattern": "swap_file_recovery_prompt",
            "effectiveness_rating": 4,
            "reliability": 0.85
          }
        ],
        "prerequisites": [
          "swap_file_accessible",
          "vim_installed",
          "proper_file_naming"
        ],
        "success_indicators": [
          "swap_file_detected",
          "recovery_option_presented",
          "source_code_recovered"
        ],
        "common_failures": [
          "corrupted_swap_file",
          "wrong_filename_assumption",
          "vim_not_available"
        ],
        "follow_up_techniques": [
          "credential_extraction",
          "source_code_analysis",
          "vulnerability_identification"
        ],
        "time_investment": "5-10 minutes",
        "skill_level": "beginner"
      }
    ],
    "tool_effectiveness": [
      {
        "tool": "SFTP",
        "use_case": "file_system_enumeration_with_symlinks",
        "effectiveness_rating": 5,
        "reliability": 0.9,
        "learning_curve": "low",
        "essential_for": [
          "restricted_ssh_environments"
        ],
        "alternatives": [
          "scp",
          "rsync"
        ],
        "best_practices": [
          "test_symlink_functionality_early",
          "enumerate_web_accessible_directories",
          "look_for_configuration_files"
        ]
      },
      {
        "tool": "SSH Port Forwarding",
        "use_case": "accessing_internal_services",
        "effectiveness_rating": 5,
        "reliability": 0.95,
        "learning_curve": "low",
        "essential_for": [
          "internal_service_access"
        ],
        "alternatives": [
          "chisel",
          "socat",
          "netsh"
        ],
        "best_practices": [
          "use_-N_flag_for_no_shell",
          "test_connectivity_before_forwarding",
          "consider_dynamic_forwarding_for_multiple_services"
        ]
      }
    ],
    "command_sequences": [
      {
        "sequence_name": "sftp_symlink_enumeration",
        "steps": [
          {
            "step": 1,
            "command": "sftp ots-mM2Y3Y2U@10.10.10.133",
            "purpose": "Establish SFTP connection",
            "expected_output": "Connected to target"
          },
          {
            "step": 2,
            "command": "symlink /etc/passwd passwd",
            "purpose": "Test symlink functionality",
            "expected_output": "Symlink created successfully"
          },
          {
            "step": 3,
            "command": "symlink / root",
            "purpose": "Access filesystem root",
            "expected_output": "Root directory accessible via web"
          },
          {
            "step": 4,
            "command": "symlink /var/www/html-admin/login.php login",
            "purpose": "Access admin source code",
            "expected_output": "Source code accessible via browser"
          }
        ],
        "success_rate": 0.85,
        "typical_duration": "10-15 minutes"
      },
      {
        "sequence_name": "credential_generation_and_access",
        "steps": [
          {
            "step": 1,
            "command": "IP=127.0.0.1; echo -n \"Username: ots-\"; echo -n $IP | md5sum | base64 -w0 | cut -c4-11; echo -n \"Password: \"; echo -n $IP | md5sum | cut -c-8",
            "purpose": "Generate localhost credentials",
            "expected_output": "Username: ots-yODc2NGQ Password: f528764d"
          },
          {
            "step": 2,
            "command": "sftp ots-yODc2NGQ@10.10.10.133",
            "purpose": "Connect with generated credentials",
            "expected_output": "SFTP connection established"
          },
          {
            "step": 3,
            "command": "get user.txt",
            "purpose": "Retrieve user flag",
            "expected_output": "User flag downloaded"
          }
        ],
        "success_rate": 0.95,
        "typical_duration": "5-10 minutes"
      }
    ]
  },
  "metadata": {
    "basic_metadata": {
      "name": "OneTwoSeven",
      "difficulty": "Hard",
      "os": "Linux",
      "platform": "HackTheBox",
      "release_date": "2019-04-20",
      "author": "jkr",
      "estimated_time": "4-6 hours"
    },
    "intelligence_metadata": {
      "attack_complexity": "high",
      "skill_level_required": "advanced",
      "primary_attack_vectors": [
        "sftp_tunneling",
        "symlink_attacks",
        "package_management"
      ],
      "key_vulnerabilities": [
        "logic_error_file_upload",
        "sudo_apt_privileges",
        "symlink_traversal"
      ],
      "environment_type": "web_hosting_provider",
      "real_world_relevance": "high",
      "learning_value": [
        "sftp_pivoting",
        "mitm_package_attacks",
        "symlink_exploitation"
      ],
      "prerequisite_knowledge": [
        "ssh_tunneling",
        "web_exploitation",
        "linux_package_management"
      ]
    },
    "categorization": {
      "primary_category": "web_exploitation",
      "subcategories": [
        "privilege_escalation",
        "tunneling",
        "file_system_attacks"
      ],
      "attack_types": [
        "initial_access",
        "privilege_escalation",
        "persistence"
      ],
      "defensive_lessons": [
        "restrict_sftp_access",
        "validate_file_uploads",
        "limit_sudo_privileges"
      ]
    },
    "similarity_markers": {
      "similar_boxes": [
        "Poison",
        "Nineveh",
        "Cronos"
      ],
      "similarity_reasons": [
        "complex_attack_chain",
        "file_system_exploitation",
        "web_to_system"
      ],
      "unique_aspects": [
        "sftp_tunneling",
        "apt_mitm_attack",
        "hosting_provider_scenario"
      ],
      "difficulty_factors": [
        "multiple_pivot_points",
        "creative_attack_vectors",
        "complex_enumeration"
      ]
    }
  },
  "extraction_metadata": {
    "parse_date": "2025-07-04T18:52:43.910174",
    "original_file": "0xdf_writeups/Htb Onetwoseven.md",
    "content_length": 56142,
    "extraction_version": "2.0-claude",
    "model_used": "claude-sonnet-4-20250514"
  },
  "intelligence_confidence": 1.0,
  "quality_breakdown": {
    "scenario_uniqueness": 1.0,
    "success_logic_clarity": 1.0,
    "applicability_completeness": 1.0,
    "decision_tree_depth": 1.0,
    "technique_actionability": 1.0
  }
}