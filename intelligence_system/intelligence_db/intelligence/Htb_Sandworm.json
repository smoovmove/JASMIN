{
  "writeup_id": "Htb_Sandworm",
  "scenario_fingerprint": {
    "scenario_name": "linux_flask_ssti_firejail_escape",
    "primary_services": [
      "http",
      "https",
      "ssh"
    ],
    "port_signature": "22+80+443",
    "service_combination": "ssh+nginx+flask",
    "os_family": "linux",
    "environment_type": "web_application",
    "entry_vector": "server_side_template_injection",
    "privilege_path": "ssti_to_firejail_escape_to_root",
    "attack_complexity": "medium",
    "estimated_time": "2-3 hours",
    "scenario_confidence": 0.92,
    "distinguishing_factors": [
      "pgp_encryption_functionality",
      "firejail_sandboxing",
      "flask_ssti_in_verification",
      "cve_2022_31214_firejail"
    ],
    "environmental_clues": [
      "flask_powered_website",
      "pgp_demo_functionality",
      "nginx_reverse_proxy",
      "ubuntu_22_04_jammy"
    ],
    "similar_scenarios": [
      "flask_ssti_boxes",
      "sandboxed_web_applications"
    ],
    "unique_aspects": [
      "spy_agency_theme",
      "pgp_message_processing",
      "firejail_container_escape",
      "rust_cron_modification"
    ]
  },
  "success_patterns": {
    "success_factors": [
      {
        "technique": "Server-Side Template Injection (SSTI)",
        "success_reason": "Flask application vulnerable to template injection in PGP verification demo",
        "prerequisite_indicators": [
          "flask_application_detected",
          "user_input_processed_server_side",
          "template_engine_accessible",
          "insufficient_input_sanitization"
        ],
        "recognition_patterns": [
          "flask powered footer indication",
          "default flask 404 pages",
          "user input reflected in responses",
          "template syntax evaluation possible"
        ],
        "failure_modes": [
          "input_properly_sanitized",
          "template_engine_sandboxed",
          "user_input_not_processed_server_side",
          "waf_blocking_payloads"
        ],
        "environmental_factors": [
          "flask_jinja2_template_engine",
          "pgp_verification_functionality",
          "demo_environment_less_secured",
          "direct_user_input_processing"
        ],
        "success_probability": 0.75,
        "typical_timeframe": "15-30 minutes"
      },
      {
        "technique": "Firejail Escape via CVE-2022-31214",
        "success_reason": "Vulnerable Firejail version with exploitable SUID binary",
        "prerequisite_indicators": [
          "firejail_sandbox_detected",
          "vulnerable_firejail_version",
          "suid_firejail_binary_present",
          "local_user_access_available"
        ],
        "recognition_patterns": [
          "restricted shell environment",
          "firejail process containment",
          "version enumeration shows vulnerable build",
          "suid binary permissions confirmed"
        ],
        "failure_modes": [
          "firejail_version_patched",
          "suid_bit_removed",
          "additional_hardening_measures",
          "exploit_detection_mechanisms"
        ],
        "environmental_factors": [
          "ubuntu_22.04_default_firejail",
          "unpatched_system_components",
          "default_firejail_configuration",
          "privilege_escalation_possible"
        ],
        "success_probability": 0.92,
        "typical_timeframe": "10-20 minutes"
      }
    ],
    "critical_discoveries": [
      {
        "discovery": "PGP verification demo SSTI vulnerability",
        "discovery_method": "Template injection testing in verification form",
        "why_critical": "Provides initial foothold through code execution",
        "how_to_recognize": [
          "flask application with user input processing",
          "template syntax reflected in responses",
          "demo functionality with relaxed security",
          "server-side processing of user data"
        ],
        "follow_up_actions": [
          "test_template_injection_payloads",
          "establish_reverse_shell",
          "enumerate_sandbox_environment",
          "identify_escape_vectors"
        ]
      },
      {
        "discovery": "Credentials in httpie configuration",
        "discovery_method": "File system enumeration within jail",
        "why_critical": "Enables lateral movement to different user account",
        "how_to_recognize": [
          "httpie config files in user directories",
          "stored authentication credentials",
          "api access configurations",
          "plaintext credential storage"
        ],
        "follow_up_actions": [
          "extract_stored_credentials",
          "test_credential_reuse",
          "access_user_account",
          "enumerate_new_privileges"
        ]
      }
    ],
    "escalation_keys": [
      {
        "privilege_level": "sandboxed_web_user",
        "escalation_method": "credential_discovery_to_user_account",
        "why_possible": "Httpie config contained reusable credentials",
        "recognition_signs": [
          "config_files_with_credentials",
          "credential_reuse_across_services",
          "insufficient_credential_isolation",
          "plaintext_storage_practices"
        ],
        "exploitation_path": "File enumeration → Credential extraction → User account access"
      },
      {
        "privilege_level": "user_account",
        "escalation_method": "firejail_cve_exploitation",
        "why_possible": "Vulnerable Firejail version with known CVE-2022-31214",
        "recognition_signs": [
          "firejail_suid_binary_present",
          "vulnerable_version_installed",
          "local_exploit_conditions_met",
          "privilege_escalation_vector_available"
        ],
        "exploitation_path": "CVE-2022-31214 exploit → SUID abuse → Root access"
      }
    ]
  },
  "decision_tree": {
    "decision_points": [
      {
        "step": 1,
        "situation": "Found ports 22,80,443 open on Linux host with nginx",
        "decision": "Enumerate web application thoroughly before attempting SSH",
        "reasoning": "Limited attack surface with only web and SSH, web likely has more vulnerabilities",
        "confidence": 0.9,
        "alternatives": [
          {
            "option": "ssh_enumeration",
            "when": "if web enumeration fails"
          },
          {
            "option": "certificate_analysis",
            "when": "always for HTTPS sites"
          }
        ],
        "success_indicators": [
          "virtual_hosts_discovered",
          "application_framework_identified",
          "interesting_endpoints_found"
        ],
        "next_decision": "analyze_web_application_functionality"
      },
      {
        "step": 2,
        "situation": "Discovered Flask application with PGP functionality",
        "decision": "Focus on PGP demo features for injection vulnerabilities",
        "reasoning": "PGP processing likely involves server-side operations that could be exploitable",
        "confidence": 0.85,
        "prerequisites": [
          "flask_application_confirmed",
          "pgp_demos_accessible"
        ],
        "success_indicators": [
          "server_side_processing_confirmed",
          "input_validation_weaknesses"
        ],
        "failure_fallbacks": [
          "directory_bruteforce",
          "login_bruteforce",
          "certificate_enumeration"
        ]
      },
      {
        "step": 3,
        "situation": "PGP verification demo accepts user input",
        "decision": "Test for server-side template injection in PGP verification",
        "reasoning": "Flask applications commonly vulnerable to SSTI, PGP verification processes user-controlled data",
        "confidence": 0.8,
        "prerequisites": [
          "pgp_verification_demo_found",
          "user_input_processed"
        ],
        "success_indicators": [
          "template_injection_confirmed",
          "code_execution_achieved"
        ],
        "failure_fallbacks": [
          "other_pgp_demos",
          "file_upload_testing",
          "parameter_pollution"
        ]
      }
    ],
    "branching_logic": {
      "if_ssti_succeeds": {
        "action": "establish_reverse_shell",
        "tools": [
          "python_reverse_shell",
          "nc",
          "bash"
        ],
        "next_phase": "post_exploitation_enumeration"
      },
      "if_ssti_fails": {
        "action": "try_alternative_web_attacks",
        "alternatives": [
          "file_inclusion",
          "command_injection",
          "authentication_bypass"
        ],
        "decision_criteria": "based_on_application_functionality"
      },
      "if_initial_access_obtained": {
        "action": "enumerate_jail_environment",
        "purpose": "identify_container_or_jail_escape_methods",
        "tools": [
          "linpeas",
          "manual_enumeration",
          "process_inspection"
        ]
      }
    },
    "optimization_rules": [
      {
        "rule": "always_test_ssti_in_flask_applications",
        "reasoning": "high_success_rate_and_common_vulnerability",
        "applicability": "flask_web_applications"
      },
      {
        "rule": "prioritize_unique_functionality_over_standard_attacks",
        "reasoning": "custom_features_more_likely_to_have_vulnerabilities",
        "applicability": "applications_with_specialized_features"
      },
      {
        "rule": "check_for_jail_or_container_environment_immediately",
        "reasoning": "affects_privilege_escalation_strategy",
        "applicability": "after_initial_shell_access"
      }
    ]
  },
  "applicability_rules": {
    "technique_rules": [
      {
        "technique": "Server-Side Template Injection",
        "mitre_id": "T1190",
        "required_services": [
          "http",
          "https"
        ],
        "required_ports": [
          80,
          443
        ],
        "os_requirements": [
          "linux",
          "windows"
        ],
        "environmental_prerequisites": [
          "flask_application_detected",
          "user_input_reflected_in_templates",
          "template_engine_accessible"
        ],
        "success_indicators": [
          "template_syntax_executed",
          "error_messages_reveal_template_engine",
          "mathematical_expressions_evaluated"
        ],
        "incompatible_with": [
          "input_sanitization_enabled",
          "template_sandboxing_active",
          "waf_blocking_payloads"
        ],
        "confidence_boosters": [
          "flask_error_pages_visible",
          "jinja2_template_engine",
          "user_controlled_template_variables"
        ],
        "typical_success_rate": 0.75,
        "estimated_time": "10-30 minutes"
      },
      {
        "technique": "Firejail Escape",
        "mitre_id": "T1611",
        "required_services": [
          "ssh"
        ],
        "required_ports": [
          22
        ],
        "os_requirements": [
          "linux"
        ],
        "environmental_prerequisites": [
          "firejail_sandbox_active",
          "vulnerable_firejail_version",
          "user_access_inside_jail"
        ],
        "success_indicators": [
          "firejail_process_visible",
          "cve_2022_31214_applicable",
          "jail_escape_successful"
        ],
        "incompatible_with": [
          "firejail_patched_version",
          "additional_security_layers",
          "restricted_file_permissions"
        ],
        "confidence_boosters": [
          "firejail_version_enumeration",
          "writable_directories_available",
          "cron_jobs_accessible"
        ],
        "typical_success_rate": 0.85,
        "estimated_time": "15-45 minutes"
      },
      {
        "technique": "Credential Harvesting from Config Files",
        "mitre_id": "T1552.001",
        "required_services": [
          "any"
        ],
        "required_ports": [],
        "os_requirements": [
          "linux",
          "windows"
        ],
        "environmental_prerequisites": [
          "file_system_access",
          "config_files_readable",
          "credentials_stored_plaintext"
        ],
        "success_indicators": [
          "httpie_config_found",
          "credentials_in_dotfiles",
          "application_config_accessible"
        ],
        "incompatible_with": [
          "encrypted_config_files",
          "restricted_file_permissions",
          "credential_vaults_used"
        ],
        "confidence_boosters": [
          "home_directory_access",
          "application_directories_writable",
          "backup_files_present"
        ],
        "typical_success_rate": 0.7,
        "estimated_time": "5-20 minutes"
      }
    ],
    "environmental_detectors": {
      "flask_application": {
        "port_indicators": [
          80,
          443,
          5000,
          8000
        ],
        "service_indicators": [
          "http",
          "https"
        ],
        "banner_indicators": [
          "Flask",
          "Werkzeug",
          "Jinja2"
        ],
        "response_indicators": [
          "Powered by Flask",
          "flask 404 page"
        ],
        "confidence_threshold": 0.8
      },
      "linux_system": {
        "port_indicators": [
          22
        ],
        "service_indicators": [
          "ssh",
          "OpenSSH"
        ],
        "banner_indicators": [
          "Ubuntu",
          "Linux"
        ],
        "confidence_threshold": 0.9
      },
      "firejail_environment": {
        "process_indicators": [
          "firejail"
        ],
        "file_indicators": [
          "/etc/firejail",
          "/.firejail"
        ],
        "command_indicators": [
          "firejail --version"
        ],
        "confidence_threshold": 0.95
      }
    },
    "attack_prioritization": {
      "high_priority": [
        {
          "attack": "server_side_template_injection",
          "when": "flask_application_detected",
          "reason": "common_vulnerability_in_flask_apps"
        },
        {
          "attack": "directory_bruteforce",
          "when": "web_service_detected",
          "reason": "reveals_hidden_endpoints_and_functionality"
        }
      ],
      "medium_priority": [
        {
          "attack": "credential_harvesting",
          "when": "file_system_access_gained",
          "reason": "often_leads_to_privilege_escalation"
        },
        {
          "attack": "firejail_escape",
          "when": "sandboxed_environment_detected",
          "reason": "necessary_for_full_system_compromise"
        }
      ],
      "low_priority": [
        {
          "attack": "ssh_bruteforce",
          "when": "ssh_service_detected",
          "reason": "time_consuming_low_success_rate"
        }
      ]
    }
  },
  "technique_intelligence": {
    "techniques": [
      {
        "name": "Server-Side Template Injection",
        "mitre_id": "T1190",
        "category": "initial_access",
        "phase": "initial_access",
        "tools_used": [
          {
            "name": "gpg",
            "command_template": "gpg --gen-key --batch --passphrase '' --quick-gen-key '{name} <{email}>' rsa4096",
            "actual_command": "gpg --gen-key",
            "output_pattern": "public and secret key created",
            "effectiveness_rating": 5,
            "reliability": 0.98
          },
          {
            "name": "curl",
            "command_template": "curl -k -X POST https://{target}/process -d 'public_key={key}&signed_text={payload}'",
            "actual_command": "curl -k -X POST https://ssa.htb/process -d 'public_key=malicious_key&signed_text=ssti_payload'",
            "success_factors": [
              "flask_jinja2_template_engine",
              "insufficient_input_validation"
            ],
            "effectiveness_rating": 4
          }
        ],
        "prerequisites": [
          "pgp_signature_verification_endpoint",
          "flask_application_with_jinja2",
          "user_controlled_input_in_templates"
        ],
        "success_indicators": [
          "template_injection_execution",
          "command_execution_achieved",
          "reverse_shell_established"
        ],
        "common_failures": [
          "input_sanitization_present",
          "template_sandboxing_enabled",
          "waf_blocking_payloads"
        ],
        "follow_up_techniques": [
          "firejail_escape",
          "credential_harvesting",
          "privilege_escalation"
        ],
        "time_investment": "30-60 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "Firejail Privilege Escalation",
        "mitre_id": "T1068",
        "category": "privilege_escalation",
        "phase": "privilege_escalation",
        "tools_used": [
          {
            "name": "firejoin",
            "command_template": "firejoin --join={pid}",
            "actual_command": "firejoin --join=1234",
            "output_pattern": "Switching to pid",
            "effectiveness_rating": 5,
            "reliability": 0.92
          },
          {
            "name": "CVE-2022-31214 exploit",
            "command_template": "./exploit.py",
            "actual_command": "python3 firejail_exploit.py",
            "success_factors": [
              "vulnerable_firejail_version",
              "suid_firejail_binary"
            ],
            "effectiveness_rating": 5
          }
        ],
        "prerequisites": [
          "firejail_environment_detected",
          "vulnerable_firejail_version",
          "suid_firejail_binary_present"
        ],
        "success_indicators": [
          "escaped_firejail_sandbox",
          "root_privileges_obtained",
          "full_system_access"
        ],
        "common_failures": [
          "patched_firejail_version",
          "missing_suid_permissions",
          "exploit_detection_mechanisms"
        ],
        "follow_up_techniques": [
          "persistence_establishment",
          "credential_dumping",
          "lateral_movement"
        ],
        "time_investment": "15-30 minutes",
        "skill_level": "advanced"
      },
      {
        "name": "Credential Harvesting from Config Files",
        "mitre_id": "T1552.001",
        "category": "credential_access",
        "phase": "credential_access",
        "tools_used": [
          {
            "name": "find",
            "command_template": "find /home -name '*.conf' -o -name 'config*' 2>/dev/null",
            "actual_command": "find /home -name '.httpie' -type d",
            "output_pattern": "configuration files found",
            "effectiveness_rating": 4,
            "reliability": 0.85
          },
          {
            "name": "cat",
            "command_template": "cat {config_file}",
            "actual_command": "cat /home/user/.config/httpie/sessions/localhost_5000/admin.json",
            "success_factors": [
              "plaintext_credentials",
              "accessible_config_files"
            ],
            "effectiveness_rating": 3
          }
        ],
        "prerequisites": [
          "file_system_access",
          "user_home_directory_readable",
          "application_config_files_present"
        ],
        "success_indicators": [
          "credentials_extracted_successfully",
          "credentials_provide_elevated_access",
          "authentication_successful"
        ],
        "common_failures": [
          "encrypted_configuration_files",
          "no_stored_credentials",
          "insufficient_file_permissions"
        ],
        "follow_up_techniques": [
          "credential_spraying",
          "privilege_escalation",
          "lateral_movement"
        ],
        "time_investment": "10-20 minutes",
        "skill_level": "beginner"
      }
    ],
    "tool_effectiveness": [
      {
        "tool": "gpg",
        "use_case": "pgp_key_generation_and_manipulation",
        "effectiveness_rating": 5,
        "reliability": 0.98,
        "learning_curve": "medium",
        "essential_for": [
          "pgp_based_attacks",
          "cryptographic_operations"
        ],
        "alternatives": [
          "openssl",
          "python_cryptography"
        ],
        "best_practices": [
          "generate_keys_with_appropriate_algorithms",
          "understand_public_private_key_relationships",
          "test_encryption_decryption_workflows"
        ]
      },
      {
        "tool": "feroxbuster",
        "use_case": "web_directory_enumeration",
        "effectiveness_rating": 4,
        "reliability": 0.95,
        "learning_curve": "low",
        "essential_for": [
          "web_application_reconnaissance"
        ],
        "alternatives": [
          "gobuster",
          "dirbuster",
          "ffuf"
        ],
        "best_practices": [
          "use_appropriate_wordlists_for_technology_stack",
          "configure_proper_filtering_for_404_responses",
          "adjust_thread_count_based_on_target_stability"
        ]
      },
      {
        "tool": "firejoin",
        "use_case": "firejail_sandbox_escape",
        "effectiveness_rating": 5,
        "reliability": 0.9,
        "learning_curve": "high",
        "essential_for": [
          "firejail_environments"
        ],
        "alternatives": [
          "manual_firejail_exploitation",
          "custom_exploits"
        ],
        "best_practices": [
          "identify_firejail_processes_first",
          "understand_sandbox_restrictions",
          "verify_escape_success_before_proceeding"
        ]
      }
    ],
    "command_sequences": [
      {
        "sequence_name": "ssti_to_initial_access",
        "steps": [
          {
            "step": 1,
            "command": "gpg --gen-key",
            "purpose": "Generate PGP key pair for exploitation",
            "expected_output": "Key pair created successfully"
          },
          {
            "step": 2,
            "command": "gpg --export --armor oxdf@ssa.htb",
            "purpose": "Export public key for injection",
            "expected_output": "ASCII armored public key"
          },
          {
            "step": 3,
            "command": "curl -k -X POST https://ssa.htb/process -d 'public_key=MALICIOUS_KEY&signed_text={{7*7}}'",
            "purpose": "Test for SSTI vulnerability",
            "expected_output": "Template injection execution (49)"
          },
          {
            "step": 4,
            "command": "curl -k -X POST https://ssa.htb/process -d 'public_key=KEY&signed_text={{request.application.__globals__.__builtins__.__import__(\"os\").popen(\"id\").read()}}'",
            "purpose": "Execute system commands via SSTI",
            "expected_output": "Command output showing user context"
          }
        ],
        "success_rate": 0.78,
        "typical_duration": "20-45 minutes"
      },
      {
        "sequence_name": "firejail_escape_to_root",
        "steps": [
          {
            "step": 1,
            "command": "ps aux | grep firejail",
            "purpose": "Identify firejail processes",
            "expected_output": "List of firejail processes with PIDs"
          },
          {
            "step": 2,
            "command": "firejoin --join=PID",
            "purpose": "Escape firejail sandbox",
            "expected_output": "Successful join to process outside jail"
          },
          {
            "step": 3,
            "command": "python3 cve-2022-31214.py",
            "purpose": "Exploit firejail for privilege escalation",
            "expected_output": "Root shell obtained"
          }
        ],
        "success_rate": 0.85,
        "typical_duration": "10-25 minutes"
      }
    ]
  },
  "metadata": {
    "basic_metadata": {
      "name": "Sandworm",
      "difficulty": "Medium",
      "os": "Linux Ubuntu",
      "platform": "HackTheBox",
      "release_date": "2023-06-17",
      "author": "C4rm3l0",
      "estimated_time": "2-3 hours"
    },
    "intelligence_metadata": {
      "attack_complexity": "medium",
      "skill_level_required": "intermediate",
      "primary_attack_vectors": [
        "ssti",
        "jail_escape",
        "cve_exploitation"
      ],
      "key_vulnerabilities": [
        "server_side_template_injection",
        "firejail_cve_2022_31214",
        "credential_exposure"
      ],
      "environment_type": "web_application_with_containerization",
      "real_world_relevance": "high",
      "learning_value": [
        "ssti_exploitation",
        "jail_escape_techniques",
        "cve_exploitation",
        "rust_program_modification"
      ],
      "prerequisite_knowledge": [
        "web_application_security",
        "template_injection",
        "linux_containers",
        "pgp_concepts"
      ]
    },
    "categorization": {
      "primary_category": "web_exploitation",
      "subcategories": [
        "template_injection",
        "jail_escape",
        "privilege_escalation"
      ],
      "attack_types": [
        "initial_access",
        "credential_access",
        "privilege_escalation",
        "container_escape"
      ],
      "defensive_lessons": [
        "input_validation",
        "template_security",
        "container_hardening",
        "credential_management"
      ]
    },
    "similarity_markers": {
      "similar_boxes": [
        "Templated",
        "Jail",
        "Escape"
      ],
      "similarity_reasons": [
        "ssti_vulnerability",
        "container_escape",
        "multi_stage_privilege_escalation"
      ],
      "unique_aspects": [
        "pgp_encryption_theme",
        "firejail_specific_cve",
        "rust_program_modification",
        "httpie_config_creds"
      ],
      "difficulty_factors": [
        "multiple_privilege_escalation_stages",
        "jail_escape_complexity",
        "cve_exploitation_required"
      ]
    }
  },
  "extraction_metadata": {
    "parse_date": "2025-07-04T18:06:48.589041",
    "original_file": "0xdf_writeups/Htb Sandworm.md",
    "content_length": 77549,
    "extraction_version": "2.0-claude",
    "model_used": "claude-sonnet-4-20250514"
  },
  "intelligence_confidence": 0.9166666666666667,
  "quality_breakdown": {
    "scenario_uniqueness": 1.0,
    "success_logic_clarity": 0.6666666666666666,
    "applicability_completeness": 1.0,
    "decision_tree_depth": 1.0,
    "technique_actionability": 1.0
  }
}