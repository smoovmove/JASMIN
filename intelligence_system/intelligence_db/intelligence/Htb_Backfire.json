{
  "writeup_id": "Htb_Backfire",
  "scenario_fingerprint": {
    "scenario_name": "havoc_c2_ssrf_websocket_rce",
    "primary_services": [
      "nginx",
      "ssh",
      "havoc_c2",
      "hardhat_c2"
    ],
    "port_signature": "22+443+8000+40056+5000+7096",
    "service_combination": "ssh+nginx+c2_framework",
    "os_family": "linux",
    "environment_type": "red_team_infrastructure",
    "entry_vector": "ssrf_to_websocket_rce",
    "privilege_path": "c2_exploit_to_jwt_forge_to_sudo_abuse",
    "attack_complexity": "hard",
    "estimated_time": "2-4 hours",
    "scenario_confidence": 0.92,
    "distinguishing_factors": [
      "x_havoc_header",
      "yaotl_config_exposure",
      "websocket_management_port",
      "chained_c2_frameworks"
    ],
    "environmental_clues": [
      "havoc_framework_deployment",
      "hardhat_c2_presence",
      "filtered_management_ports",
      "localhost_only_services"
    ],
    "similar_scenarios": [
      "red_team_infrastructure_compromise",
      "c2_framework_exploitation"
    ],
    "unique_aspects": [
      "dual_c2_framework_setup",
      "websocket_ssrf_chain",
      "tls_disabled_patch",
      "firewall_rule_sudo_abuse"
    ]
  },
  "success_patterns": {
    "success_factors": [
      {
        "technique": "SSRF_to_Internal_Services",
        "success_reason": "Havoc C2 server exposed unauthenticated SSRF vulnerability allowing access to internal management port",
        "prerequisite_indicators": [
          "havoc_c2_server_running",
          "x_havoc_header_present",
          "internal_services_accessible",
          "management_port_filtered_externally"
        ],
        "recognition_patterns": [
          "X-Havoc: true header in responses",
          "filtered ports in nmap (5000, 7096)",
          "configuration files exposed (yaotl files)",
          "websocket management ports mentioned"
        ],
        "failure_modes": [
          "ssrf_vulnerability_patched",
          "internal_services_not_accessible",
          "strict_network_segmentation"
        ],
        "environmental_factors": [
          "default_havoc_configuration",
          "internal_services_bound_localhost",
          "no_internal_network_filtering"
        ],
        "success_probability": 0.92,
        "typical_timeframe": "15-30 minutes"
      },
      {
        "technique": "Configuration_File_Disclosure",
        "success_reason": "Havoc configuration file exposed via directory listing containing credentials and internal architecture",
        "prerequisite_indicators": [
          "directory_listing_enabled",
          "configuration_files_present",
          "web_server_misconfiguration"
        ],
        "recognition_patterns": [
          "yaotl configuration files",
          "patch files revealing internal ports",
          "plaintext credentials in config",
          "internal service mappings"
        ],
        "failure_modes": [
          "directory_listing_disabled",
          "configuration_files_removed",
          "credentials_encrypted"
        ],
        "environmental_factors": [
          "development_environment_exposure",
          "insufficient_file_permissions",
          "debug_configurations_in_production"
        ],
        "success_probability": 0.95,
        "typical_timeframe": "5-10 minutes"
      },
      {
        "technique": "Chained_SSRF_to_RCE",
        "success_reason": "Combined SSRF vulnerability with authenticated RCE via websocket command injection",
        "prerequisite_indicators": [
          "ssrf_vulnerability_present",
          "internal_rce_endpoint_available",
          "websocket_communication_possible",
          "valid_credentials_obtained"
        ],
        "recognition_patterns": [
          "websocket endpoints accessible internally",
          "command injection in websocket handlers",
          "authentication bypass via SSRF",
          "demon callback handling vulnerabilities"
        ],
        "failure_modes": [
          "websocket_communication_blocked",
          "command_injection_filtered",
          "authentication_required_for_ssrf"
        ],
        "environmental_factors": [
          "vulnerable_havoc_version",
          "websocket_tls_disabled",
          "internal_network_trust_model"
        ],
        "success_probability": 0.78,
        "typical_timeframe": "30-60 minutes"
      }
    ],
    "critical_discoveries": [
      {
        "discovery": "havoc.yaotl configuration file",
        "discovery_method": "directory listing enumeration",
        "why_critical": "Exposed credentials, internal architecture, and service mappings",
        "how_to_recognize": [
          "yaotl file extension",
          "plaintext operator credentials",
          "internal port configurations",
          "localhost service bindings"
        ],
        "follow_up_actions": [
          "extract_all_credentials",
          "map_internal_services",
          "identify_management_ports",
          "test_credential_reuse"
        ]
      },
      {
        "discovery": "X-Havoc header indicating C2 framework",
        "discovery_method": "HTTP response header analysis",
        "why_critical": "Identified specific C2 framework enabling targeted exploit research",
        "how_to_recognize": [
          "X-Havoc: true header",
          "nginx proxy configuration",
          "filtered management ports",
          "websocket communication patterns"
        ],
        "follow_up_actions": [
          "research_havoc_vulnerabilities",
          "identify_cve_exploits",
          "map_internal_services",
          "test_ssrf_vectors"
        ]
      },
      {
        "discovery": "disable_tls.patch revealing internal architecture",
        "discovery_method": "exposed file analysis",
        "why_critical": "Revealed websocket management port 40056 and TLS bypass method",
        "how_to_recognize": [
          "patch file modifications",
          "websocket port references",
          "tls configuration changes",
          "localhost binding patterns"
        ],
        "follow_up_actions": [
          "target_management_port",
          "test_websocket_connections",
          "exploit_tls_bypass",
          "chain_with_ssrf"
        ]
      }
    ],
    "escalation_keys": [
      {
        "privilege_level": "unauthenticated_external",
        "escalation_method": "SSRF_to_Internal_RCE",
        "why_possible": "SSRF vulnerability allowed access to authenticated internal management interfaces",
        "recognition_signs": [
          "cve_2024_41570_applicable",
          "internal_services_accessible",
          "websocket_management_available",
          "command_injection_possible"
        ],
        "exploitation_path": "SSRF → Internal Websocket → Command Injection → Shell"
      },
      {
        "privilege_level": "configuration_disclosure",
        "escalation_method": "Credential_Extraction_to_Service_Access",
        "why_possible": "Configuration files contained plaintext credentials for multiple services",
        "recognition_signs": [
          "yaotl_files_exposed",
          "operator_credentials_present",
          "service_account_passwords",
          "internal_service_mappings"
        ],
        "exploitation_path": "Config Disclosure → Credential Extraction → Service Authentication → RCE"
      }
    ]
  },
  "decision_tree": {
    "decision_points": [
      {
        "step": 1,
        "situation": "Found ports 22,443,8000 open with X-Havoc header and filtered ports 5000,7096",
        "decision": "Identify as Havoc C2 infrastructure and enumerate configuration files",
        "reasoning": "X-Havoc header indicates Havoc C2 framework, filtered ports suggest internal services",
        "confidence": 0.95,
        "alternatives": [
          {
            "option": "directory_bruteforce",
            "when": "if config files not found"
          },
          {
            "option": "ssl_certificate_analysis",
            "when": "if no clear indicators"
          }
        ],
        "success_indicators": [
          "havoc_config_file_found",
          "credentials_discovered",
          "internal_port_information"
        ],
        "next_decision": "analyze_havoc_configuration"
      },
      {
        "step": 2,
        "situation": "Found havoc.yaotl config with credentials and localhost services on port 40056",
        "decision": "Research Havoc CVE vulnerabilities for SSRF/RCE exploitation",
        "reasoning": "Config reveals internal management port, need SSRF to access localhost services",
        "confidence": 0.9,
        "prerequisites": [
          "havoc_framework_identified",
          "internal_ports_discovered"
        ],
        "success_indicators": [
          "cve_2024_41570_identified",
          "ssrf_poc_available"
        ],
        "failure_fallbacks": [
          "credential_reuse_testing",
          "service_enumeration"
        ]
      },
      {
        "step": 3,
        "situation": "Identified CVE-2024-41570 SSRF and need to access port 40056 internally",
        "decision": "Chain SSRF with authenticated RCE via websocket exploitation",
        "reasoning": "SSRF provides access to internal management port, RCE available with authentication",
        "confidence": 0.85,
        "prerequisites": [
          "ssrf_vulnerability_confirmed",
          "internal_management_port_accessible"
        ],
        "success_indicators": [
          "websocket_connection_established",
          "command_injection_successful"
        ],
        "failure_fallbacks": [
          "direct_credential_authentication",
          "alternative_c2_exploitation"
        ]
      }
    ],
    "branching_logic": {
      "if_havoc_identified": {
        "action": "enumerate_configuration_files",
        "tools": [
          "curl",
          "feroxbuster"
        ],
        "next_phase": "vulnerability_research"
      },
      "if_config_found": {
        "action": "extract_credentials_and_internal_services",
        "purpose": "identify_attack_vectors",
        "tools": [
          "grep",
          "manual_analysis"
        ]
      },
      "if_ssrf_available": {
        "action": "chain_with_authenticated_rce",
        "purpose": "bypass_localhost_restrictions",
        "tools": [
          "custom_exploit_script",
          "websocket_client"
        ]
      },
      "if_credentials_obtained": {
        "action": "enumerate_additional_c2_infrastructure",
        "purpose": "lateral_movement_preparation",
        "tools": [
          "credential_reuse",
          "service_discovery"
        ]
      }
    },
    "optimization_rules": [
      {
        "rule": "always_check_for_c2_framework_indicators",
        "reasoning": "c2_frameworks_have_known_vulnerabilities_and_configs",
        "applicability": "red_team_infrastructure_targets"
      },
      {
        "rule": "prioritize_ssrf_for_internal_service_access",
        "reasoning": "bypasses_localhost_restrictions_common_in_c2",
        "applicability": "internal_services_discovered"
      },
      {
        "rule": "chain_unauthenticated_ssrf_with_authenticated_rce",
        "reasoning": "common_pattern_in_c2_framework_exploitation",
        "applicability": "havoc_and_similar_c2_frameworks"
      },
      {
        "rule": "extract_all_credentials_from_c2_configs",
        "reasoning": "credential_reuse_common_in_red_team_infrastructure",
        "applicability": "c2_configuration_files_accessible"
      }
    ]
  },
  "applicability_rules": {
    "technique_rules": [
      {
        "technique": "SSRF_to_Internal_Services",
        "mitre_id": "T1190",
        "required_services": [
          "http",
          "https"
        ],
        "required_ports": [
          80,
          443,
          8000,
          8080,
          8443
        ],
        "os_requirements": [
          "linux",
          "windows"
        ],
        "environmental_prerequisites": [
          "web_application_present",
          "internal_services_accessible",
          "ssrf_vulnerable_endpoint"
        ],
        "success_indicators": [
          "internal_port_responses",
          "localhost_service_enumeration",
          "filtered_ports_accessible"
        ],
        "incompatible_with": [
          "strict_network_segmentation",
          "ssrf_protections_enabled",
          "localhost_access_blocked"
        ],
        "confidence_boosters": [
          "filtered_ports_in_nmap",
          "localhost_only_services_mentioned",
          "internal_configuration_leaked"
        ],
        "typical_success_rate": 0.75,
        "estimated_time": "10-30 minutes"
      },
      {
        "technique": "Configuration_File_Disclosure",
        "mitre_id": "T1552.001",
        "required_services": [
          "http",
          "https"
        ],
        "required_ports": [
          80,
          443,
          8000,
          8080
        ],
        "os_requirements": [
          "linux",
          "windows"
        ],
        "environmental_prerequisites": [
          "directory_listing_enabled",
          "configuration_files_exposed",
          "web_server_misconfiguration"
        ],
        "success_indicators": [
          "credentials_in_config_files",
          "service_configuration_revealed",
          "internal_network_topology_exposed"
        ],
        "incompatible_with": [
          "proper_file_permissions",
          "directory_listing_disabled",
          "sensitive_files_protected"
        ],
        "confidence_boosters": [
          "nginx_directory_listing",
          "patch_files_exposed",
          "yaotl_config_files_present"
        ],
        "typical_success_rate": 0.9,
        "estimated_time": "5-10 minutes"
      },
      {
        "technique": "C2_Framework_Exploitation",
        "mitre_id": "T1219",
        "required_services": [
          "websocket",
          "http"
        ],
        "required_ports": [
          40056,
          443,
          8000
        ],
        "os_requirements": [
          "linux",
          "windows"
        ],
        "environmental_prerequisites": [
          "havoc_c2_framework_detected",
          "websocket_management_port_accessible",
          "authentication_credentials_available"
        ],
        "success_indicators": [
          "x_havoc_header_present",
          "websocket_connection_established",
          "authenticated_rce_achieved"
        ],
        "incompatible_with": [
          "tls_required_websockets",
          "management_port_firewalled",
          "strong_authentication_enabled"
        ],
        "confidence_boosters": [
          "havoc_yaotl_config_found",
          "disable_tls_patch_present",
          "default_credentials_in_config"
        ],
        "typical_success_rate": 0.85,
        "estimated_time": "15-45 minutes"
      }
    ],
    "environmental_detectors": {
      "havoc_c2_framework": {
        "port_indicators": [
          40056,
          443,
          8443
        ],
        "service_indicators": [
          "websocket",
          "https"
        ],
        "banner_indicators": [
          "X-Havoc",
          "havoc.yaotl"
        ],
        "confidence_threshold": 0.9
      },
      "web_application": {
        "port_indicators": [
          80,
          443,
          8000,
          8080,
          8443
        ],
        "service_indicators": [
          "http",
          "https"
        ],
        "technology_indicators": [
          "nginx",
          "apache",
          "iis"
        ],
        "confidence_threshold": 0.9
      },
      "directory_listing": {
        "port_indicators": [
          8000,
          8080
        ],
        "service_indicators": [
          "http"
        ],
        "banner_indicators": [
          "Index of /",
          "Directory listing"
        ],
        "confidence_threshold": 0.95
      }
    },
    "attack_prioritization": {
      "high_priority": [
        {
          "attack": "configuration_file_disclosure",
          "when": "directory_listing_detected",
          "reason": "immediate_credential_and_service_discovery"
        },
        {
          "attack": "ssrf_to_internal_services",
          "when": "filtered_ports_and_localhost_services_detected",
          "reason": "access_to_management_interfaces"
        },
        {
          "attack": "c2_framework_exploitation",
          "when": "havoc_framework_detected",
          "reason": "authenticated_rce_with_known_credentials"
        }
      ],
      "medium_priority": [
        {
          "attack": "websocket_exploitation",
          "when": "websocket_service_detected",
          "reason": "potential_command_injection_vector"
        }
      ]
    }
  },
  "technique_intelligence": {
    "techniques": [
      {
        "name": "Havoc C2 SSRF Exploitation",
        "mitre_id": "T1190",
        "category": "initial_access",
        "phase": "initial_access",
        "tools_used": [
          {
            "name": "Havoc-C2-SSRF-poc",
            "command_template": "python exploit.py -t {target_url} -i {attacker_ip} -p {attacker_port}",
            "actual_command": "uv run --script exploit.py -t https://10.10.11.49 -i 10.10.14.6 -p 80",
            "output_pattern": "HTTP response from internal services",
            "effectiveness_rating": 5,
            "reliability": 0.95
          }
        ],
        "prerequisites": [
          "havoc_c2_server_accessible",
          "vulnerable_version_0.7",
          "demon_listener_configured"
        ],
        "success_indicators": [
          "agent_registration_successful",
          "socket_creation_successful",
          "internal_http_responses_received"
        ],
        "common_failures": [
          "patched_havoc_version",
          "network_connectivity_issues",
          "incorrect_target_configuration"
        ],
        "follow_up_techniques": [
          "internal_service_enumeration",
          "websocket_exploitation",
          "authenticated_rce_chaining"
        ],
        "time_investment": "10-20 minutes",
        "skill_level": "intermediate"
      },
      {
        "name": "Configuration File Intelligence Gathering",
        "mitre_id": "T1005",
        "category": "collection",
        "phase": "reconnaissance",
        "tools_used": [
          {
            "name": "curl",
            "command_template": "curl -k {target_url}:{port}/{config_file}",
            "actual_command": "curl -k http://10.10.11.49:8000/havoc.yaotl",
            "output_pattern": "Teamserver configuration with credentials",
            "effectiveness_rating": 5,
            "reliability": 1.0
          }
        ],
        "prerequisites": [
          "directory_listing_enabled",
          "configuration_files_exposed"
        ],
        "success_indicators": [
          "credentials_extracted",
          "internal_ports_identified",
          "service_configuration_revealed"
        ],
        "common_failures": [
          "files_not_accessible",
          "encrypted_configuration",
          "incomplete_information"
        ],
        "follow_up_techniques": [
          "credential_validation",
          "port_enumeration",
          "service_exploitation"
        ],
        "time_investment": "5-10 minutes",
        "skill_level": "beginner"
      },
      {
        "name": "Chained SSRF to WebSocket RCE",
        "mitre_id": "T1210",
        "category": "lateral_movement",
        "phase": "exploitation",
        "tools_used": [
          {
            "name": "Custom Python Script",
            "command_template": "python chained_exploit.py -t {target} --internal-port {port}",
            "actual_command": "python chained_exploit.py -t https://10.10.11.49 --internal-port 40056",
            "output_pattern": "Command execution via websocket",
            "effectiveness_rating": 4,
            "reliability": 0.85
          }
        ],
        "prerequisites": [
          "ssrf_vulnerability_confirmed",
          "websocket_management_port_accessible",
          "valid_credentials_available"
        ],
        "success_indicators": [
          "websocket_connection_established",
          "command_injection_successful",
          "reverse_shell_obtained"
        ],
        "common_failures": [
          "websocket_protocol_mismatch",
          "authentication_failures",
          "payload_encoding_issues"
        ],
        "follow_up_techniques": [
          "privilege_escalation",
          "lateral_movement",
          "persistence_establishment"
        ],
        "time_investment": "30-60 minutes",
        "skill_level": "advanced"
      }
    ],
    "tool_effectiveness": [
      {
        "tool": "Havoc-C2-SSRF-poc",
        "use_case": "exploiting_havoc_c2_ssrf",
        "effectiveness_rating": 5,
        "reliability": 0.95,
        "learning_curve": "medium",
        "essential_for": [
          "havoc_c2_exploitation"
        ],
        "alternatives": [
          "manual_packet_crafting",
          "custom_exploit_development"
        ],
        "best_practices": [
          "verify_havoc_version_before_exploitation",
          "test_connectivity_to_target_first",
          "chain_with_authenticated_exploits_for_maximum_impact"
        ]
      },
      {
        "tool": "nmap",
        "use_case": "initial_reconnaissance",
        "effectiveness_rating": 5,
        "reliability": 0.98,
        "learning_curve": "low",
        "essential_for": [
          "network_reconnaissance"
        ],
        "alternatives": [
          "masscan",
          "rustscan"
        ],
        "best_practices": [
          "use_min_rate_for_faster_scanning",
          "follow_up_with_service_version_detection",
          "note_filtered_ports_for_internal_access"
        ]
      }
    ],
    "command_sequences": [
      {
        "sequence_name": "havoc_c2_exploitation_chain",
        "steps": [
          {
            "step": 1,
            "command": "nmap -p- --min-rate 10000 10.10.11.49",
            "purpose": "Identify open and filtered ports",
            "expected_output": "Ports 22, 443, 8000 open; 5000, 7096 filtered"
          },
          {
            "step": 2,
            "command": "curl -k http://10.10.11.49:8000/havoc.yaotl",
            "purpose": "Extract Havoc configuration and credentials",
            "expected_output": "Configuration with users ilya and sergej passwords"
          },
          {
            "step": 3,
            "command": "uv run --script exploit.py -t https://10.10.11.49 -i 10.10.14.6 -p 80",
            "purpose": "Test SSRF vulnerability",
            "expected_output": "Successful agent registration and socket creation"
          },
          {
            "step": 4,
            "command": "python chained_exploit.py -t https://10.10.11.49 --websocket-port 40056",
            "purpose": "Chain SSRF with WebSocket RCE",
            "expected_output": "Remote code execution and shell access"
          }
        ],
        "success_rate": 0.82,
        "typical_duration": "45-90 minutes"
      }
    ]
  },
  "metadata": {
    "basic_metadata": {
      "name": "Backfire",
      "difficulty": "Medium",
      "os": "Linux",
      "platform": "HackTheBox",
      "release_date": "2025-01-18",
      "author": "hyperreality, chebuya",
      "estimated_time": "2-4 hours"
    },
    "intelligence_metadata": {
      "attack_complexity": "medium",
      "skill_level_required": "intermediate",
      "primary_attack_vectors": [
        "ssrf",
        "websocket_exploitation",
        "jwt_forgery"
      ],
      "key_vulnerabilities": [
        "ssrf_to_admin_port",
        "authenticated_rce",
        "default_jwt_secret",
        "sudo_privilege_escalation"
      ],
      "environment_type": "red_team_infrastructure",
      "real_world_relevance": "very_high",
      "learning_value": [
        "c2_exploitation",
        "chained_exploits",
        "websocket_attacks",
        "jwt_attacks"
      ],
      "prerequisite_knowledge": [
        "web_exploitation",
        "ssrf_concepts",
        "websocket_protocols",
        "jwt_fundamentals"
      ]
    },
    "categorization": {
      "primary_category": "red_team_infrastructure",
      "subcategories": [
        "c2_exploitation",
        "web_exploitation",
        "privilege_escalation"
      ],
      "attack_types": [
        "ssrf",
        "rce",
        "authentication_bypass",
        "privilege_escalation"
      ],
      "defensive_lessons": [
        "secure_c2_configuration",
        "jwt_secret_management",
        "internal_network_segmentation",
        "sudo_rule_hardening"
      ]
    },
    "similarity_markers": {
      "similar_boxes": [
        "Intentions",
        "Broker",
        "Sandworm"
      ],
      "similarity_reasons": [
        "chained_web_exploits",
        "complex_attack_paths",
        "modern_technologies"
      ],
      "unique_aspects": [
        "havoc_c2_exploitation",
        "hardhatc2_exploitation",
        "websocket_ssrf_chain"
      ],
      "difficulty_factors": [
        "multiple_c2_frameworks",
        "complex_exploit_chaining",
        "websocket_communication"
      ]
    }
  },
  "extraction_metadata": {
    "parse_date": "2025-07-04T18:31:53.172820",
    "original_file": "0xdf_writeups/Htb Backfire.md",
    "content_length": 39784,
    "extraction_version": "2.0-claude",
    "model_used": "claude-sonnet-4-20250514"
  },
  "intelligence_confidence": 1.0,
  "quality_breakdown": {
    "scenario_uniqueness": 1.0,
    "success_logic_clarity": 1.0,
    "applicability_completeness": 1.0,
    "decision_tree_depth": 1.0,
    "technique_actionability": 1.0
  }
}